System\Main.s1FNAME "msx-windows.rom" 3PageSize: equ 0x4000 56 org 0x40008 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11System\Main.s9 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619System\Main.s10 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2428REG0SAV: equ 0xF3DF29REG1SAV: equ 0xF3E030REG2SAV: equ 0xF3E131REG3SAV: equ 0xF3E232REG4SAV: equ 0xF3E333REG5SAV: equ 0xF3E434REG6SAV: equ 0xF3E535REG7SAV: equ 0xF3E637REG8SAV: equ 0xFFE738REG9SAV: equ 0xFFE839REG10SAV: equ 0xFFE940REG11SAV: equ 0xFFEA41REG12SAV: equ 0xFFEB42REG13SAV: equ 0xFFEC43REG14SAV: equ 0xFFED44REG15SAV: equ 0xFFEE45REG16SAV: equ 0xFFEF46REG17SAV: equ 0xFFF047REG18SAV: equ 0xFFF148REG19SAV: equ 0xFFF249REG20SAV: equ 0xFFF350REG21SAV: equ 0xFFF451REG22SAV: equ 0xFFF552REG23SAV: equ 0xFFF65456REG25SAV: equ 0xFFFA57REG26SAV: equ 0xFFFB58REG27SAV: equ 0xFFFC59System\Main.s11 Include/CommonRoutines.s1411ClearRam:12 ld hl, RamStart 13 ld de, RamEnd + 1 15.loop:16 xor a 17 ld (hl), a19 inc hl20 call BIOS_DCOMPR 21 ret z22 jp .loop2629ClearRamArea:30 xor a31.loop:32 ld (hl), a33 inc hl34 djnz .loop36 ret4044SetPaletteColor:45 push bc46 47 ld b, a 48 ld c, 16 49 call BIOS_WRTVDP50 ld c, PORT_2 51 pop de53 ld a, d 54 di55 out (c), a56 ld a, e 57 ei58 out (c), a60 ret6266SetPaletteColor_Without_DI_EI:67 push bc68 69 ld b, a 70 ld c, 16 71 call WRTVDP_without_DI_EI72 ld c, PORT_2 73 pop de75 ld a, d 77 out (c), a78 ld a, e 80 out (c), a82 ret8590SetPaletteColor_FromAddress:91 92 ld b, a 93 ld c, 16 94 call BIOS_WRTVDP95 ld c, PORT_2 97 ld a, (hl) 98 di99 out (c), a100 inc hl101 ld a, (hl) 102 ei103 out (c), a105 ret109110LoadPalette:111 112 ld b, 0 113 ld c, 16 114 call BIOS_WRTVDP115 ld c, PORT_2 117 ld b, 16118.loop:119 di120 ld a, (hl)121 out (c), a122 inc hl123 ld a, (hl)124 out (c), a125 ei126 inc hl127 djnz .loop128 129 ret133134EnableRomPage2:135137 call BIOS_RSLREG138 rrca139 rrca140 and 3 141 ld c,a142 ld b,0143 ld hl, BIOS_EXPTBL144 add hl,bc145 ld a,(hl)146 and 80h147 or c148 ld c,a149 inc hl150 inc hl151 inc hl152 inc hl153 ld a,(hl)154 and 0Ch155 or c156 ld h,080h157 call BIOS_ENASLT 159 ret162166Wait_B_Vblanks:167 168 push bc169 170 .loop:172 ld a, (BIOS_JIFFY)173 ld c, a174 .waitVBlank:175 ld a, (BIOS_JIFFY)176 cp c177 jp z, .waitVBlank179 djnz .loop180 181 pop bc183 ret185Wait_15_Vblanks:186 ld c, 15188 .loop:189 ld a, (BIOS_JIFFY)190 ld b, a191 .waitVBlank:192 ld a, (BIOS_JIFFY)193 cp b194 jp z, .waitVBlank196 dec c197 jp nz, .loop199 ret201Wait_Vblank:202.loop:203 ld a, (BIOS_JIFFY)204 ld b, a205.waitVBlank:206 ld a, (BIOS_JIFFY)207 cp b208 jp z, .waitVBlank210 ret212216SetVdp_Write:218 227 rlc h228 rla229 rlc h230 rla231 srl h232 srl h234 di235 236 out (PORT_1), a237 ld a, 14 + 128238 out (PORT_1), a240 241 ld a, l242 nop243 out (PORT_1), a244 ld a, h245 or 64246 ei247 out (PORT_1),a248 ret250254SetVdp_Read:255 rlc h256 rla257 rlc h258 rla259 srl h260 srl h261 di262 out (PORT_1), a263 ld a, 14 + 128264 out (PORT_1), a265 ld a, l266 nop267 out (PORT_1), a268 ld a, h269 ei270 out (PORT_1), a271 ret274282303 304306308310312317325333336ClearVram_MSX2:337 xor a 338 ld hl, 0 339 call SetVDP_Write341351 xor a353 357 358 ld d, 2 359.loop_2:360 ld c, 0 361.loop_1:362 ld b, 0 363.loop:364 out (PORT_0), a365 djnz .loop366 dec c367 jp nz, .loop_1368 dec d369 jp nz, .loop_2371 ret374Screen11:375 377 ld a, 8378 call BIOS_CHGMOD380 ld a, (REG25SAV)381 or 0001 1000 b382 ld (REG25SAV), a 383 ld b, a384 385 ld c, 25 386 call BIOS_WRTVDP387 ret389SetSprites16x16:390 ld a, (REG1SAV)391 or 0000 0010 b392 ld (REG1SAV), a393 ld b, a394 ld c, 1 395 call BIOS_WRTVDP396 ret398Set192Lines:399 403 ld a, (REG9SAV)404 and 0111 1111 b405 ld (REG9SAV), a406 ld b, a407 ld c, 9 408 call BIOS_WRTVDP409 ret411SetColor0ToNonTransparent:412 417 ld a, (REG8SAV)418 or 0010 0000 b419 ld b, 0010 1000 b 420 ld c, 0x08 421 call BIOS_WRTVDP422 ret424SetColor0ToTransparent:425 429 ld a, (REG8SAV)430 and 1101 1111 b431 ld (REG8SAV), a432 ld b, a433 ld c, 8 434 call BIOS_WRTVDP435 ret437DisableSprites:438 ld a, (REG8SAV)439 or 0000 0010 b440 ld b, a441 ld c, 8 442 call BIOS_WRTVDP443 ret445EnableSprites:446 ld a, (REG8SAV)447 and 1111 1101 b448 ld b, a449 ld c, 8 450 call BIOS_WRTVDP451 ret453457LDIRVM_MSX2:458 459 ex de, hl460 461 call SetVdp_Write462 ex de, hl463 ld d, c464 465 ld c, PORT_0 466 ld b, 0467.loop_1:468 otir469 dec d470 jp nz, .loop_1471 ret475481RandomNumber:482 push hl483 ld hl, (Seed)484 add hl, hl485 sbc a, a486 and 0x83487 xor l488 ld l, a489 ld (Seed), hl490 pop hl491 ret493 502 506512CheckCollision_16x16_16x16:514 ld a, d 515 sub b 516 jr c, .x1IsLarger 517 sub 16 518 ret nc 519 jp .checkVerticalCollision520.x1IsLarger:521 neg 526 527 sub 16 528 ret nc 530.checkVerticalCollision:531 ld a, e 532 sub c 533 jr c, .y1IsLarger 534 sub 16 535 ret 536.y1IsLarger:537 neg 542 543 sub 16 544 ret 548554CheckCollision_16x16_32x16:556 ld a, d 557 sub b 558 jr c, .x1IsLarger 559 sub 16 560 ret nc 561 jp .checkVerticalCollision562.x1IsLarger:563 neg 568 569 sub 32 570 ret nc 572.checkVerticalCollision:573 ld a, e 574 sub c 575 jr c, .y1IsLarger 576 sub 16 577 ret 578.y1IsLarger:579 neg 584 585 sub 16 586 ret 591597CheckCollision_8x8_16x16:599 ld a, d 600 sub b 601 jr c, .x1IsLarger 602 sub 8 603 ret nc 604 jp .checkVerticalCollision605.x1IsLarger:606 neg 611 612 sub 16 613 ret nc 615.checkVerticalCollision:616 ld a, e 617 sub c 618 jr c, .y1IsLarger 619 sub 8 620 ret 621.y1IsLarger:622 neg 627 628 sub 16 629 ret 635637643CheckCollision_Point_16x16:645 649 650 ld a, d651 cp b652 ret nc 654 ld a, b655 add 16 656 cp d657 ret nc 659 660 ld a, e661 cp c662 ret nc 664 667 ld a, e668 add 16669 ld e, a670 ld a, c671 cp e672 ret674 678 682 685 691696699709713716719724 725727734738740748 749757763770776779786792800802810817824827833835 837845850855859862873880885890893900905907913916918922926928931934937942 943946949 950955959962967 968971973 974979983987Execute_VDP_LMMM:988Execute_VDP_HMMM:989 ld a, 32 990 di991 out (PORT_1), a992 ld a, 17 + 128993 out (PORT_1), a994 ld c, 0x9B995.vdpReady:996 ld a, 2997 di998 out (PORT_1), a 999 ld a, 15 + 1281000 out (PORT_1), a1001 in a, (PORT_1)1002 rra1003 ld a, 0 1004 out (PORT_1), a1005 ld a, 15 + 1281006 ei1007 out (PORT_1), a 1008 jp c, .vdpReady1009 outi 1010 outi 1011 outi1012 outi1013 outi1014 outi1015 outi1016 outi1017 outi1018 outi1019 outi1020 outi1021 outi1022 outi1023 outi1024 ret10261030Execute_VDP_PSET:1031Execute_VDP_LINE:1032Execute_VDP_HMMV:1033 ld a, 36 1034 di1035 out (PORT_1), a1036 ld a, 17 + 1281037 out (PORT_1), a1038 ld c, 0x9B1039.vdpReady:1040 ld a, 21041 di1042 out (PORT_1), a 1043 ld a, 15 + 1281044 out (PORT_1), a1045 in a, (PORT_1)1046 rra1047 ld a, 0 1048 out (PORT_1), a1049 ld a, 15 + 1281050 ei1051 out (PORT_1), a 1052 jp c, .vdpReady1053 outi 1054 outi 1055 outi1056 outi1057 outi1058 outi1059 outi1060 outi1061 outi1062 outi1063 outi1064 ret10671070Execute_VDP_YMMM:1071 ld a, 34 1072 di1073 out (PORT_1), a1074 ld a, 17 + 1281075 out (PORT_1), a1076 ld c, 0x9B1077.vdpReady:1078 ld a, 21079 di1080 out (PORT_1), a 1081 ld a, 15 + 1281082 out (PORT_1), a1083 in a, (PORT_1)1084 rra1085 ld a, 0 1086 out (PORT_1), a1087 ld a, 15 + 1281088 ei1089 out (PORT_1), a 1090 jp c, .vdpReady1091 outi 1092 outi 1093 outi1094 outi1095 outi1096 outi1097 outi1098 outi1099 outi1100 outi1101 outi1102 outi1103 outi1104 ret1106VDP_COMMAND_HMMC: equ 1111 0000 b 1107VDP_COMMAND_YMMM: equ 1110 0000 b 1108VDP_COMMAND_HMMM: equ 1101 0000 b 1109VDP_COMMAND_HMMV: equ 1100 0000 b 11111112VDP_COMMAND_LMMC: equ 1011 0000 b 1113VDP_COMMAND_LMCM: equ 1010 0000 b 1114VDP_COMMAND_LMMM: equ 1001 0000 b 1115VDP_COMMAND_LMMV: equ 1000 0000 b 1117VDP_COMMAND_LINE: equ 0111 0000 b1118VDP_COMMAND_SRCH: equ 0110 0000 b1119VDP_COMMAND_PSET: equ 0101 0000 b1120VDP_COMMAND_POINT: equ 0100 0000 b1122VDP_COMMAND_STOP: equ 0000 0000 b11251126VDP_LOGIC_OPERATION_IMP: equ 0000 b1127VDP_LOGIC_OPERATION_AND: equ 0001 b1128VDP_LOGIC_OPERATION_OR: equ 0010 b1129VDP_LOGIC_OPERATION_XOR: equ 0011 b1130VDP_LOGIC_OPERATION_NOT: equ 0100 b1132VDP_LOGIC_OPERATION_TIMP: equ 1000 b1133VDP_LOGIC_OPERATION_TAND: equ 1001 b1134VDP_LOGIC_OPERATION_TOR: equ 1010 b1135VDP_LOGIC_OPERATION_TXOR: equ 1011 b1136VDP_LOGIC_OPERATION_TNOT: equ 1100 b11411145ReadStatusReg:11461147 ld a,(0007h) 1148 inc a1149 ld c,a 1151 out (c),b1152 ld a,080h+151153 out (c),a11541155 1156 ld a,(0006h) 1157 inc a1158 ld c,a 1159 in b,(c) 1160 11611162 ld a,(0007h) 1163 inc a1164 ld c,a 1165 xor a1166 out (c),a1167 ld a,080h+151168 out (c),a1169 1171 ret11741175WRTVDP_without_DI_EI:1176 ld a, b1177 1178 out (PORT_1),a1179 ld a, c1180 or 1281181 1183 out (PORT_1), a1184 ret11881191SNSMAT_NO_DI_EI:1192 ld c, a1193.C_OK:11941195 in a, (PPI.C)1196 and 0xf0 1197 or c11981199 out (PPI.C), a1200 in a, (PPI.B)1201 ret120412071209JP_HL:1210 jp (hl)1211JP_BC:1212 push bc1213 ret1214JP_DE:1215 push de1216 ret1217JP_IX:1218 jp (ix)1219JP_IY:1220 jp (iy)1221JP_HL_S:1222 exx1223 push hl1224 exx1225 ret1226JP_BC_S:1227 exx1228 push bc1229 exx1230 ret1231JP_DE_S:1232 exx1233 push de1234 exx1235 ret12381240Fast_LDIR_Multiples_of_16:12411242.loop:1243 ldi 1244 ldi1245 ldi1246 ldi1247 ldi1248 ldi1249 ldi1250 ldi1251 ldi1252 ldi1253 ldi1254 ldi1255 ldi1256 ldi1257 ldi1258 ldi1259 jp pe, .loop System\Main.s1314 System/Constants.s134SCREEN_MAPPING_DESKTOP: equ 2555SCREEN_MAPPING_TASKBAR: equ 2546 7SCREEN_MAPPING_WINDOWS: equ 0000 0000 b8SCREEN_MAPPING_WINDOWS_TITLE_BAR: equ 0001 0000 b9SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON: equ 0010 0000 b10SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON: equ 0011 0000 b11SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON: equ 0100 0000 b12SCREEN_MAPPING_WINDOWS_RESIZE_CORNER: equ 0101 0000 b15WINDOW_STATE:16.MINIMIZED: equ 117.RESTORED: equ 218.MAXIMIZED: equ 321MOUSE_ON_JOYPORT_1: equ 0x131022MOUSE_ON_JOYPORT_2: equ 0x6C2024MOUSE_PORT: equ MOUSE_ON_JOYPORT_1System\Main.s15 System/Interrupt.s1_INIT_INTERRUPT:3 4 xor a5 ld (os.interruptBusy), a7 ld hl, .storeOldInterruptHook_init8 ld de, os.storeOldInterruptHook9 ld bc, 610 ldir12 ld hl, BIOS_H_TIMI13 ld de, os.storeOldInterruptHook14 ld bc, 515 ldir17 ld hl, INTERRUPT18 ld de, BIOS_H_TIMI19 ld bc, 320 ldir22 ret26.storeOldInterruptHook_init:27 db 0, 0, 0, 0, 028 db 0xc9 30INTERRUPT:31 32 jp HANDLER33 34HANDLER:35 36 ld a, (os.interruptBusy)37 and a38 ret nz39 ld a, 25540 ld (os.interruptBusy), a42 43 call _UPDATE_SYSTEM_TIME44 45 46 ld hl, (OS.ticksSinceLastInput)47 inc hl48 ld (OS.ticksSinceLastInput), hl50 55 58 ld de, MOUSE_PORT59 call GTMOUS60 61 ld a, h62 cp 25563 jp nz, .skip64 cp l65 call z, .noMouse67.skip:69 70 ld a, ixh71 ld (OS.mouseButton_1), a72 ld a, ixl73 ld (OS.mouseButton_2), a76 80 81 ld a, h82 neg83 ld h, a85 86 ld a, l87 neg88 ld l, a90 91 xor a92 or ixh 93 or ixl 94 or h 95 or l 96 jp z, .skip_197 ld de, 098 ld (OS.ticksSinceLastInput), de99.skip_1:100 101 ld e, h 102 ld d, l 103 ld a, (os.mouseX)104 ld l, a 105 ld a, (os.mouseY)106 ld h, a 107 call CLIPADD108 109 ld a, l110 ld (os.mouseX), a111 ld (os.mouseX_1), a112 ld a, h113 ld (os.mouseY), a114 ld (OS.mouseY_1), a116 xor a117 ld (os.interruptBusy), a119 jp os.storeOldInterruptHook121122.noMouse:123 124 ret126131 132System\Main.s16 System/Init/Init.s1 System/Init/InitVdp.s12NAMTBL: equ 0x1800 3PATTBL: equ 0x0000 4COLTBL: equ 0x2000 5SPRPAT: equ 0x3800 6SPRATR: equ 0x1b00 9_INIT_VDP:12 13 ld a, 15 14 ld (BIOS_FORCLR), a 15 ld a, 1 16 ld (BIOS_BAKCLR), a 17 ld a, 4 18 ld (BIOS_BDRCLR), a 19 call BIOS_CHGCLR 21 22 ld a, 223 call BIOS_CHGMOD25 call SetSprites16x1627 call BIOS_DISSCR29 30 32 33 xor a 34 ld bc, 1024 * 16 35 ld hl, 0x0000 36 call BIOS_FILVRM38 39 ld hl, TILE_PATTERNS 40 ld de, PATTBL 41 ld bc, TILE_PATTERNS.size 42 call BIOS_LDIRVM 44 ld hl, TILE_PATTERNS 45 ld de, PATTBL + (256 * 8) 46 ld bc, TILE_PATTERNS.size 47 call BIOS_LDIRVM 49 ld hl, TILE_PATTERNS 50 ld de, PATTBL + (512 * 8) 51 ld bc, TILE_PATTERNS.size 52 call BIOS_LDIRVM 54 55 ld a, 0x1f 56 ld bc, 256 * 8 * 3 57 ld hl, COLTBL 58 call BIOS_FILVRM60 61 ld a, 0xf1 62 ld bc, TILE_FONT_REVERSED_PATTERNS.size 63 ld hl, COLTBL + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 64 call BIOS_FILVRM65 66 ld a, 0xf1 67 ld bc, TILE_FONT_REVERSED_PATTERNS.size 68 ld hl, COLTBL + (256 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 69 call BIOS_FILVRM70 71 ld a, 0xf1 72 ld bc, TILE_FONT_REVERSED_PATTERNS.size 73 ld hl, COLTBL + (512 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 74 call BIOS_FILVRM76 82 99 100 ld hl, SPRITE_PATTERNS 101 ld de, SPRPAT 102 ld bc, SPRITE_PATTERNS.size 103 call BIOS_LDIRVM 105 111 call BIOS_ENASCR113 ret115122123NAMTBL_TEST:124 db TILE_EMPTY125 db TILE_EMPTY126 db TILE_WINDOW_TITLE_TOP_LEFT127 db TILE_WINDOW_TITLE_MIDDLE_TOP128 db TILE_WINDOW_TITLE_MIDDLE_TOP129 db TILE_WINDOW_TITLE_MIDDLE_TOP130 db TILE_WINDOW_TITLE_MIDDLE_TOP131 db TILE_WINDOW_TOP_RIGHT_CORNER_TOP132 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0134 db TILE_EMPTY135 db TILE_EMPTY136 db TILE_WINDOW_TITLE_BOTTOM_LEFT137 db TILE_WINDOW_TITLE_MIDDLE_BOTTOM138 db TILE_WINDOW_MINIMIZE_BUTTON139 db TILE_WINDOW_MAXIMIZE_BUTTON140 db TILE_WINDOW_CLOSE_BUTTON141 db TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM142 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0144 db TILE_EMPTY145 db TILE_EMPTY146 db TILE_WINDOW_BORDER_LEFT147 db TILE_FONT_LOWERCASE_A + 0148 db TILE_FONT_LOWERCASE_A + 25149 db TILE_FONT_NUMBERS_0 + 0150 db TILE_FONT_NUMBERS_0 + 9151 db TILE_WINDOW_BORDER_RIGHT152 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0154 db TILE_EMPTY155 db TILE_EMPTY156 db TILE_WINDOW_BORDER_LEFT157 db TILE_FONT_UPPERCASE_A + 0158 db TILE_FONT_UPPERCASE_A + 25159 db TILE_FONT_REVERSED_SYMBOLS + 0160 db TILE_EMPTY161 db TILE_WINDOW_BORDER_RIGHT162 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0164 db TILE_EMPTY165 db TILE_EMPTY166 db TILE_WINDOW_BORDER_LEFT167 169 db TILE_FONT_REVERSED_LOWERCASE_A + 0170 db TILE_FONT_REVERSED_LOWERCASE_A + 25171 db TILE_FONT_REVERSED_NUMBERS_0 + 0172 db TILE_FONT_REVERSED_NUMBERS_0 + 9173 db TILE_WINDOW_RESIZE_CORNER_TOP174 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0176 db TILE_EMPTY177 db TILE_EMPTY178 db TILE_WINDOW_BORDER_BOTTOM_LEFT179 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM180 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM181 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM182 db TILE_WINDOW_RESIZE_CORNER_LEFT183 db TILE_WINDOW_RESIZE_CORNER_RIGHT184 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0186 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0188.size: equ $ - NAMTBL_TEST191196System/Init/Init.s2 System/Init/InitRam.s1_INIT_RAM:3 5 xor a6 ld (RamStart), a7 ld hl, RamStart8 ld de, RamStart + 19 ld bc, RamEnd - RamStart - 110 ldir12 13 ld a, 0xff14 ld (OS.processes), a15 ld hl, OS.processes16 ld de, OS.processes + 117 ld bc, OS.processes_size - 118 ldir19 20 21 ld hl, OS.processes22 ld (OS.nextAvailableProcessAddr), hl24 25 ld hl, 026 ld (OS.currentProcessAddr), hl28 29 ld a, 128 - 830 ld (OS.mouseY), a31 ld (OS.mouseY_1), a32 ld a, 96 - 833 ld (OS.mouseX), a34 ld (OS.mouseX_1), a35 ld a, SPRITE_INDEX_CURSOR_036 ld (OS.mousePattern), a37 ld a, SPRITE_INDEX_CURSOR_138 ld (OS.mousePattern_1), a39 ld a, 1 40 ld (OS.mouseColor), a41 ld a, 15 42 ld (OS.mouseColor_1), a44 xor a45 ld (OS.mouseButton_1), a46 ld (OS.mouseButton_2), a47 ld (OS.oldMouseButton_1), a48 ld (OS.oldMouseButton_2), a49 50 ld (OS.isDraggingWindow), a51 ld (OS.dragOffset_X), a52 ld (OS.dragOffset_Y), a53 ld (OS.isResizingWindow), a54 ld (OS.resizeWindowCorner_BottomRight_X_Min), a55 ld (OS.resizeWindowCorner_BottomRight_Y_Min), a57 58 ld a, SPRITE_INDEX_WINDOW_TOP_LEFT59 ld (OS.windowCorner_TopLeft_Pattern), a60 ld a, SPRITE_INDEX_WINDOW_BOTTOM_LEFT61 ld (OS.windowCorner_BottomLeft_Pattern), a62 ld a, SPRITE_INDEX_WINDOW_TOP_RIGHT63 ld (OS.windowCorner_TopRight_Pattern), a64 ld a, SPRITE_INDEX_WINDOW_BOTTOM_RIGHT65 ld (OS.windowCorner_BottomRight_Pattern), a67 ld a, 15 68 ld (OS.windowCorner_TopLeft_Color), a69 ld (OS.windowCorner_BottomLeft_Color), a70 ld (OS.windowCorner_TopRight_Color), a71 ld (OS.windowCorner_BottomRight_Color), a73 74 ld a, 1111 1111 b75 ld (OS.keyboardMatrix + 0), a76 ld (OS.keyboardMatrix + 1), a77 ld (OS.keyboardMatrix + 2), a78 ld (OS.keyboardMatrix + 3), a79 ld (OS.keyboardMatrix + 4), a80 ld (OS.keyboardMatrix + 5), a81 ld (OS.keyboardMatrix + 6), a82 ld (OS.keyboardMatrix + 7), a83 ld (OS.keyboardMatrix + 8), a84 ld (OS.keyboardMatrix + 9), a87 88 ld a, 889 ld (OS.nextWindow_x), a90 ld a, 491 ld (OS.nextWindow_y), a93 xor a94 ld (OS.mouseOver_Activated), a95 ld (OS.mouseOver_screenMappingValue), a96 ld (OS.mouseOver_tileToBeRestored), a97 ld hl, 098 ld (OS.mouseOver_NAMTBL_addr), a102 call _INIT_SCREEN_MAPPING106 ret109System/Init/Init.s7_INIT:9 10 xor a11 ld (BIOS_CLIKSW), a13 call _INIT_VDP15 call _INIT_RAM17 call _INIT_SYSTEM_TIME19 call _INIT_INTERRUPT21 call _INIT_DESKTOP25 28 call _DRAW_DESKTOP29 call _DRAW_TASKBAR31 ret34System\Main.s17 System/Desktop/Desktop.s1 System/Desktop/Taskbar.s1810_DRAW_TASKBAR:12 13 ld hl, TASKBAR_INIT 14 ld de, NAMTBL + (32 * 22) 15 ld bc, 64 16 call BIOS_LDIRVM 20 call _DRAW_TASKBAR_BUTTONS23 call _DRAW_TASKBAR_CLOCK26 ret30_DRAW_TASKBAR_BUTTONS:32 ld iy, NAMTBL + (32 * 23) + 534 35 ld hl, 0xffff36 ld (OS.taskbar_Button_0_Process_addr), hl37 ld (OS.taskbar_Button_1_Process_addr), hl38 ld (OS.taskbar_Button_2_Process_addr), hl39 ld (OS.taskbar_Button_3_Process_addr), hl41 ld hl, OS.taskbar_Button_0_Process_addr42 ld (TempWord), hl44 45 ld hl, OS.processes46 ld b, MAX_PROCESS_ID + 147.loop_1:48 ld a, (hl)49 inc a50 jp z, .next 52 55 push hl 56 pop ix58 59 push de60 ld de, (TempWord)62 ld a, l63 ld (de), a64 inc de65 ld a, h66 ld (de), a67 inc de69 ld (TempWord), de70 pop de72 push hl, bc73 74 ld bc, PROCESS_STRUCT_IX.taskbarTitle75 add hl, bc77 push hl 78 pop de80 push iy 81 pop hl82 call BIOS_SETWRT84 ld c, 4 86 .loop_2:87 ld a, (de)88 cp 3389 jp z, .end_191 push de93 ld de, (OS.currentProcessAddr)94 95 push ix 96 pop hl98 call BIOS_DCOMPR100 pop de102 jp nz, .printNormal104 105 ld a, (de)106 add TILE_FONT_LOWERCASE_A - TILE_FONT_REVERSED_LOWERCASE_A107 jp .continue_2108 .printNormal:109 ld a, (de)110 .continue_2:111 out (PORT_0), a113 dec c114 jp z, .end_1116 inc de117 jp .loop_2119 .end_1:120 121 ld bc, 5122 add iy, bc 124 pop bc, hl128.next:129 ld de, Process_struct.size130 add hl, de132 djnz .loop_1134 ret138139_DRAW_TASKBAR_CLOCK:141 142 ld hl, NAMTBL + (32 * 23) + 26 143 call BIOS_SETWRT144 ld c, PORT_0147 ld b, TILE_FONT_REVERSED_NUMBERS_0149 150 ld a, (OS.currentTime_Hours)151 srl a 152 srl a 153 srl a 154 srl a 155 or a156 jp z, .skipTensOfHours 157 add b 158 jp .continue159.skipTensOfHours:160 ld a, TILE_EMPTY_BLACK161.continue:162 out (c), a164 165 ld a, (OS.currentTime_Hours)166 and 0000 1111 b167 add b 168 out (c), a170 171 nop172 nop173 ld a, TILE_FONT_REVERSED_SYMBOLS + 0 174 out (c), a176 177 ld a, (OS.currentTime_Minutes)178 srl a 179 srl a 180 srl a 181 srl a 182 add b 183 out (c), a184 185 186 ld a, (OS.currentTime_Minutes)187 and 0000 1111 b188 add b 189 out (c), a191 ret195TASKBAR_INIT:196 197 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP198 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP199 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP200 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP201 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP202 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP203 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP204 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP206 207 db TILE_EMPTY_BLACK, TILE_HOME_ICON, TILE_EMPTY_BLACK208 209 db TILE_SHOW_DESKTOP_ICON, TILE_EMPTY_BLACK211 db TILE_EMPTY_BLACK212 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK213 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK214 222 223 db TILE_EMPTY_BLACK224 225 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK226 230 231 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK232 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK233 234 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK235 236 240 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK241 242 db TILE_EMPTY_BLACK243System/Desktop/Desktop.s4_INIT_DESKTOP:5 6 ld ix, Notepad.Header7 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_0 * 8) 8 call _LOAD_ICON_FROM_APP_HEADER9 11 ld ix, Calc.Header12 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_1 * 8) 13 call _LOAD_ICON_FROM_APP_HEADER14 16 ld ix, Calc.Header17 ld de, PATTBL + (256 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 18 call _LOAD_ICON_FROM_APP_HEADER20 ld ix, Notepad.Header21 ld de, PATTBL + (512 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 22 call _LOAD_ICON_FROM_APP_HEADER24 26 27 ld a, TILE_EMPTY28 ld (OS.desktop_Tiles), a29 ld hl, OS.desktop_Tiles30 ld de, OS.desktop_Tiles + 131 ld bc, 0 + (32 * 22) - 132 ldir35 43 49 52 56 60 64 ld ix, Notepad.Header65 ld a, TILE_BASE_DESKTOP_ICON_066 ld hl, OS.desktop_Tiles67 call _DRAW_DESKTOP_ICON69 ld ix, Calc.Header70 ld a, TILE_BASE_DESKTOP_ICON_171 ld hl, OS.desktop_Tiles + 872 call _DRAW_DESKTOP_ICON74 ld ix, Calc.Header75 ld a, TILE_BASE_DESKTOP_ICON_076 ld hl, OS.desktop_Tiles + (256)77 call _DRAW_DESKTOP_ICON79 ld ix, Notepad.Header80 ld a, TILE_BASE_DESKTOP_ICON_081 ld hl, OS.desktop_Tiles + (512)82 call _DRAW_DESKTOP_ICON84 ret8893_LOAD_ICON_FROM_APP_HEADER:95 96 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)97 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)99 101 ld bc, NUMBER_OF_TILES_PER_ICON * 8 102 call BIOS_LDIRVM104 ret108113_LOAD_ICON_INVERTED_FROM_APP_HEADER:115 push de116 117 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)118 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)120 121 ld de, TempIcon122 ld bc, NUMBER_OF_TILES_PER_ICON * 8 123 ldir125 ld hl, TempIcon126 ld b, NUMBER_OF_TILES_PER_ICON * 8127 .loop_100:128 ld a, (hl)129 cpl 130 ld (hl), a131 inc hl132 djnz .loop_100134 135 ld hl, TempIcon136 ld de, ICON_BORDERS_FILLED_OR_MASK137 ld b, NUMBER_OF_TILES_PER_ICON * 8138 .loop_200:139 ld a, (hl)140 ld c, a141 ld a, (de)142 or c143 ld (hl), a144 inc hl145 inc de146 djnz .loop_200147 148 150 pop de152 ld hl, TempIcon 154 ld bc, NUMBER_OF_TILES_PER_ICON * 8 155 call BIOS_LDIRVM157 ret161_DRAW_DESKTOP_ICON:162 push hl163 ld de, 0 + (32 * 1) + 3164 add hl, de165 166 167 ld de, 32169 ld b, 3170 .loop_1:171 push hl172 ld (hl), a173 174 inc a175 add hl, de176 ld (hl), a178 inc a179 add hl, de180 ld (hl), a182 inc a183 pop hl184 inc hl186 djnz .loop_1187 pop hl189 190 ld de, 0 + (32 * 4) + 1191 add hl, de192 ld b, 7 193.loop_10:194 ld a, (ix + PROCESS_STRUCT_IX.iconTitle)195 196 ld (hl), a197 inc ix198 inc hl199 djnz .loop_10202 ret206_DRAW_DESKTOP_ICON_NAME_REVERSED:207 208 ld de, 0 + (32 * 4) + 1209 add hl, de210 ld b, 7 211.loop_10:212 ld a, (ix + PROCESS_STRUCT_IX.iconTitle)213 cp TILE_EMPTY214 jp z, .cont_1216219220 sub TILE_FONT_LOWERCASE_A - TILE_FONT_REVERSED_LOWERCASE_A 221.cont_1:222 ld (hl), a223 inc ix224 inc hl225 djnz .loop_10227 ret231_DRAW_DESKTOP:233244 ld hl, NAMTBL245 call BIOS_SETWRT246 ld hl, OS.desktop_Tiles247 ld c, PORT_0249 ld d, 22 250.outerLoop:251 ld b, 32 252 .innerLoop:253 outi254 jp nz, .innerLoop 256 dec d257 jp nz, .outerLoop259 ret262ICON_BORDERS_FILLED_OR_MASK:263 db 11111111 b264 db 10000000 b265 db 10000000 b266 db 10000000 b267 db 10000000 b268 db 10000000 b269 db 10000000 b270 db 10000000 b272 db 10000000 b273 db 10000000 b274 db 10000000 b275 db 10000000 b276 db 10000000 b277 db 10000000 b278 db 10000000 b279 db 10000000 b281 db 10000000 b282 db 10000000 b283 db 10000000 b284 db 10000000 b285 db 10000000 b286 db 10000000 b287 db 10000000 b288 db 11111111 b290 db 11111111 b291 db 00000000 b292 db 00000000 b293 db 00000000 b294 db 00000000 b295 db 00000000 b296 db 00000000 b297 db 00000000 b299 db 00000000 b300 db 00000000 b301 db 00000000 b302 db 00000000 b303 db 00000000 b304 db 00000000 b305 db 00000000 b306 db 00000000 b308 db 00000000 b309 db 00000000 b310 db 00000000 b311 db 00000000 b312 db 00000000 b313 db 00000000 b314 db 00000000 b315 db 11111111 b318 db 11111111 b319 db 00000001 b320 db 00000001 b321 db 00000001 b322 db 00000001 b323 db 00000001 b324 db 00000001 b325 db 00000001 b327 db 00000001 b328 db 00000001 b329 db 00000001 b330 db 00000001 b331 db 00000001 b332 db 00000001 b333 db 00000001 b334 db 00000001 b336 db 00000001 b337 db 00000001 b338 db 00000001 b339 db 00000001 b340 db 00000001 b341 db 00000001 b342 db 00000001 b343 db 11111111 b344System\Main.s18 System/Window/Window.s1 System/Window/DrawWindow.s13_DRAW_WINDOW:5 7 8 ld a, (ix + PROCESS_STRUCT_IX.windowState) 9 cp WINDOW_STATE.MINIMIZED10 ret z12 13 cp WINDOW_STATE.MAXIMIZED14 jp z, _DRAW_WINDOW_MAXIMIZED15 16 17 ld l, (ix + PROCESS_STRUCT_IX.x) 18 ld h, (ix + PROCESS_STRUCT_IX.y) 19 20 call _CONVERT_COL_LINE_TO_LINEAR21 22 27 28 ld bc, NAMTBL29 add hl, bc33 34 38 40 push hl41 call BIOS_SETWRT42 43 ld a, TILE_WINDOW_TITLE_TOP_LEFT44 out (PORT_0), a46 ld a, (ix + PROCESS_STRUCT_IX.width) 47 sub 2 48 ld b, a49 .loop_1: 50 ld a, TILE_WINDOW_TITLE_MIDDLE_TOP51 out (PORT_0), a52 djnz .loop_154 nop55 nop56 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_TOP57 out (PORT_0), a58 pop hl59 60 61 ld de, 3262 add hl, de63 64 push hl65 call BIOS_SETWRT66 ld a, TILE_WINDOW_TITLE_BOTTOM_LEFT67 out (PORT_0), a68 69 ld a, (ix + PROCESS_STRUCT_IX.width) 70 sub 5 71 ld b, a72 .loop_2:73 ld a, TILE_WINDOW_TITLE_MIDDLE_BOTTOM74 out (PORT_0), a75 djnz .loop_277 nop78 nop79 ld a, TILE_WINDOW_MINIMIZE_BUTTON80 out (PORT_0), a82 nop83 nop84 ld a, TILE_WINDOW_MAXIMIZE_BUTTON85 out (PORT_0), a87 nop88 nop89 ld a, TILE_WINDOW_CLOSE_BUTTON90 out (PORT_0), a92 nop93 nop94 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM95 out (PORT_0), a96 pop hl98 99 push hl, ix100 inc hl101 call BIOS_SETWRT102 103 ld b, 16 104 .loop_10:105 ld a, (ix + PROCESS_STRUCT_IX.windowTitle) 106 or a 107 jp z, .endLoop_10108 out (PORT_0), a109 inc ix110 djnz .loop_10111 .endLoop_10:112 pop ix, hl114 116 ld a, (ix + PROCESS_STRUCT_IX.height) 117 sub 4 118 ld b, a119.loop_height:120 push bc122 ld de, 32123 add hl, de124 125 push hl126 call BIOS_SETWRT127 ld a, TILE_WINDOW_BORDER_LEFT128 out (PORT_0), a130 ld a, (ix + PROCESS_STRUCT_IX.width) 131 sub 2 132 ld b, a133 .loop_3:134 ld a, TILE_EMPTY135 out (PORT_0), a136 djnz .loop_3138 nop139 nop140 ld a, TILE_WINDOW_BORDER_RIGHT141 out (PORT_0), a142 pop hl144 pop bc145 djnz .loop_height147 149 150 ld de, 32151 add hl, de152 153 push hl154 call BIOS_SETWRT155 ld a, TILE_WINDOW_BORDER_LEFT156 out (PORT_0), a157 158 ld a, (ix + PROCESS_STRUCT_IX.width) 159 sub 2 160 ld b, a161 .loop_4:162 ld a, TILE_EMPTY163 out (PORT_0), a164 djnz .loop_4166 nop167 nop168 ld a, TILE_WINDOW_RESIZE_CORNER_TOP169 out (PORT_0), a170 pop hl172 173 ld de, 32174 add hl, de175 176 push hl177 call BIOS_SETWRT178 ld a, TILE_WINDOW_BORDER_BOTTOM_LEFT179 out (PORT_0), a180 181 ld a, (ix + PROCESS_STRUCT_IX.width) 182 sub 3 183 ld b, a184 .loop_5:185 ld a, TILE_WINDOW_BORDER_MIDDLE_BOTTOM186 out (PORT_0), a187 djnz .loop_5189 nop190 nop191 ld a, TILE_WINDOW_RESIZE_CORNER_LEFT192 out (PORT_0), a194 nop195 nop196 ld a, TILE_WINDOW_RESIZE_CORNER_RIGHT197 out (PORT_0), a198 pop hl200 204 206 ld e, (ix + PROCESS_STRUCT_IX.drawAddr) 207 ld d, (ix + PROCESS_STRUCT_IX.drawAddr + 1) 208 call JP_DE212 ret216_DRAW_WINDOW_MAXIMIZED:217 ld hl, NAMTBL219 220 push hl221 call BIOS_SETWRT222 223 ld a, 32 - 3 224 ld b, a225 .loop_2:226 ld a, TILE_WINDOW_TITLE_MIDDLE_BOTTOM227 out (PORT_0), a228 djnz .loop_2230 nop231 nop232 ld a, TILE_WINDOW_MINIMIZE_BUTTON233 out (PORT_0), a235 nop236 nop237 ld a, TILE_WINDOW_MAXIMIZE_BUTTON238 out (PORT_0), a240 nop241 nop242 ld a, TILE_WINDOW_CLOSE_BUTTON243 out (PORT_0), a244 pop hl246 247 push hl, ix248 inc hl249 call BIOS_SETWRT250 251 ld b, 16 252 .loop_10:253 ld a, (ix + PROCESS_STRUCT_IX.windowTitle) 254 or a 255 jp z, .endLoop_10256 out (PORT_0), a257 inc ix258 djnz .loop_10259 .endLoop_10:260 pop ix, hl263 264 ld bc, 32265 add hl, bc266 call BIOS_SETWRT268 ld a, TILE_EMPTY269 ld c, PORT_0271 ld d, 21 272.outerLoop:273 ld b, 32 274 .innerLoop:275 out (c), a276 nop277 djnz .innerLoop278 dec d279 jp nz, .outerLoop282 ret286289_DRAW_STRING:290 291 call BIOS_SETWRT292 293.loop:294 ld a, (de)295 or a296 ret z 298 302 303 304 cp 32305 jp z, .setTileEmpty307 308 add -65 + TILE_FONT_UPPERCASE_A 311.continue:312 out (PORT_0), a314 inc de316 jp .loop318.setTileEmpty:319 ld a, TILE_EMPTY320 jp .continue322System/Window/Window.s2 System/Window/CloseWindow.s13_CLOSE_WINDOW:5 10 12 retSystem/Window/Window.s3 System/Window/ScreenMapping.s14_UPDATE_SCREEN:6 12 16 call Wait_Vblank18 call _DRAW_DESKTOP22 23 call _INIT_SCREEN_MAPPING25 28 ld c, 0 29 ld de, Process_struct.size31.outerLoop:32 ld hl, OS.processes + PROCESS_STRUCT_IX.layer 34 ld b, MAX_PROCESS_ID + 135 .innerLoop:36 37 ld a, (hl)38 cp c39 push hl, de, bc40 call z, .execute41 pop bc, de, hl43 ld de, Process_struct.size44 add hl, de46 djnz .innerLoop48 inc c49 ld a, c50 cp MAX_PROCESS_ID + 151 ret z53 jp .outerLoop55 57.execute:59 60 ld de, PROCESS_STRUCT_IX.layer61 xor a 62 sbc hl, de64 65 push hl66 pop ix68 69 ld l, (ix + PROCESS_STRUCT_IX.x) 70 ld h, (ix + PROCESS_STRUCT_IX.y) 71 72 push ix73 call _CONVERT_COL_LINE_TO_LINEAR74 pop ix76 call _UPDATE_SCREEN_MAPPING_WINDOW78 call _DRAW_WINDOW80 ret8487_UPDATE_SCREEN_MAPPING_WINDOW:89 90 ld a, (ix + PROCESS_STRUCT_IX.windowState) 91 cp WINDOW_STATE.MINIMIZED92 ret z94 95 cp WINDOW_STATE.MAXIMIZED96 jp z, _UPDATE_SCREEN_MAPPING_WINDOW_MAXIMIZED98 99 ex de, hl100 ld hl, OS.screenMapping101 add hl, de102 103 ld de, 32 105 106 push hl107 ld c, (ix + PROCESS_STRUCT_IX.height) 108 .outerLoop_1:109 push hl110 ld b, (ix + PROCESS_STRUCT_IX.width) 111 .loop_20:112 113 114 ld a, (ix + PROCESS_STRUCT_IX.processId)115 or SCREEN_MAPPING_WINDOWS116 117 ld (hl), a118 inc hl119 djnz .loop_20120 pop hl122 add hl, de123 dec c124 jp nz, .outerLoop_1125 pop hl127 128 ld a, (ix + PROCESS_STRUCT_IX.processId)129 or SCREEN_MAPPING_WINDOWS_TITLE_BAR130 ld c, a132 133 push hl134 ld b, (ix + PROCESS_STRUCT_IX.width) 135 .loop_21:136 ld (hl), c137 inc hl138 djnz .loop_21139 pop hl140 141 add hl, de 142 push hl143 ld a, (ix + PROCESS_STRUCT_IX.width) 144 sub 4 145 ld b, a146 .loop_22:147 ld (hl), c148 inc hl149 djnz .loop_22151 ld a, (ix + PROCESS_STRUCT_IX.processId)152 or SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON153 ld (hl), a154 inc hl156 ld a, (ix + PROCESS_STRUCT_IX.processId)157 or SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON158 ld (hl), a159 inc hl161 ld a, (ix + PROCESS_STRUCT_IX.processId)162 or SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON163 ld (hl), a164 inc hl166 pop hl168 170 171 ld a, (ix + PROCESS_STRUCT_IX.x)172 ld l, (ix + PROCESS_STRUCT_IX.width)173 dec l174 add l175 ld l, a177 178 ld a, (ix + PROCESS_STRUCT_IX.Y)179 ld h, (ix + PROCESS_STRUCT_IX.height)180 dec h181 add h182 ld h, a183 call _CONVERT_COL_LINE_TO_LINEAR184 185 ld de, OS.screenMapping186 add hl, de188 push hl 189 pop iy191 ld a, (ix + PROCESS_STRUCT_IX.processId)192 or SCREEN_MAPPING_WINDOWS_RESIZE_CORNER193 195 196 ld (iy), a197 ld (iy - 1), a198 ld (iy - 32), a199 ld (iy - 33), a201 ret205_UPDATE_SCREEN_MAPPING_WINDOW_MAXIMIZED:207 208 ld hl, OS.screenMapping209 210 push hl211 212 ld a, (ix + PROCESS_STRUCT_IX.processId)213 or SCREEN_MAPPING_WINDOWS215 ld (hl), a216 ld de, OS.screenMapping + 1217 ld bc, 0 + (32 * 22) - 1218 ldir219 pop hl223 224 ld a, (ix + PROCESS_STRUCT_IX.processId)225 or SCREEN_MAPPING_WINDOWS_TITLE_BAR227 229 ld b, 32 - 3 230 .loop_21:231 ld (hl), a232 inc hl233 djnz .loop_21234 237 ld a, (ix + PROCESS_STRUCT_IX.processId)238 or SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON239 ld (hl), a240 inc hl242 ld a, (ix + PROCESS_STRUCT_IX.processId)243 or SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON244 ld (hl), a245 inc hl247 ld a, (ix + PROCESS_STRUCT_IX.processId)248 or SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON249 ld (hl), a250 253 ret257258_INIT_SCREEN_MAPPING:260 261 ld hl, OS.screenMapping262 push hl 263 pop de264 inc de265 ld bc, 0 + (32 * 22) - 1 266 ld a, SCREEN_MAPPING_DESKTOP 267 ld (hl), a268 ldir270275 276277 278284 ld a, SCREEN_MAPPING_TASKBAR 285 ld b, 32 * 2 286.loop_2:287 ld (hl), a288 inc hl289 djnz .loop_2292 retSystem/Window/Window.s713_CONVERT_COL_LINE_TO_LINEAR:14 15 26 xor a 28 srl h 29 rra 30 srl h31 rra32 srl h33 rra35 or l 36 ld l, a38 ret4146_GET_WINDOW_BASE_NAMTBL:48 49 ld a, (ix + PROCESS_STRUCT_IX.windowState)50 cp WINDOW_STATE.MAXIMIZED51 jp z, .isMaximized53 54 ld l, (ix + PROCESS_STRUCT_IX.x) 55 ld h, (ix + PROCESS_STRUCT_IX.y) 56 57 call _CONVERT_COL_LINE_TO_LINEAR58 59 ld bc, NAMTBL + (32 * 2) + 160 add hl, bc62 ret64.isMaximized:65 68 ld hl, NAMTBL + 3270 ret7478_GET_WINDOW_TITLE_BASE_NAMTBL:80 81 ld a, (ix + PROCESS_STRUCT_IX.windowState)82 cp WINDOW_STATE.MAXIMIZED83 jp z, .isMaximized85 86 ld l, (ix + PROCESS_STRUCT_IX.x) 87 ld h, (ix + PROCESS_STRUCT_IX.y) 88 89 call _CONVERT_COL_LINE_TO_LINEAR90 91 ld bc, NAMTBL92 add hl, bc94 ret96.isMaximized:97 ld hl, NAMTBL99 retSystem\Main.s19 System/Keyboard/Keyboard.s1 18_READ_KEYBOARD:20 ld a, (BIOS_NEWKEY + 8)21 ld b, a23 push bc24 bit 7, b 25 call z, .keyPressed_R26 pop bc28 push bc29 bit 4, b 30 call z, .keyPressed_L31 pop bc34 35 ld a, b36 ld (OS.keyboardMatrix + 8), a38 41 ret43.keyPressed_R:44 45 ld a, (OS.keyboardMatrix + 8)46 bit 7, a47 ret z49 51 ld hl, Notepad.Header52 call _LOAD_PROCESS54 ret56.keyPressed_L:57 58 ld a, (OS.keyboardMatrix + 8)59 bit 4, a60 ret z62 69 ld hl, Calc.Header70 call _LOAD_PROCESS72 ret7579 80838588 8994System\Main.s20 System/Mouse/Mouse.s1 System/Mouse/DrawMouseCursor.s1_DRAW_MOUSE_CURSOR:3 4 ld hl, SPRATR5 call BIOS_SETWRT6 ld c, PORT_07 ld hl, OS.mouseSpriteAttributes9 ld a, (hl) 10 dec a11 inc hl12 out (c), a 14 17 nop18 nop19 nop20 outi 22 nop23 nop24 nop25 outi 27 nop28 nop29 nop30 outi 32 ld a, (hl) 33 dec a34 inc hl35 out (c), a 37 nop38 nop39 nop40 outi 42 nop43 nop44 nop45 outi 47 nop48 nop49 nop50 outi 5464 65 ld a, (OS.isDraggingWindow)66 ld b, a67 ld a, (OS.isResizingWindow)68 or b69 jp z, .skip_171 ld a, (hl) 72 dec a73 inc hl74 out (c), a 76 nop77 nop78 nop79 outi 81 nop82 nop83 nop84 outi 86 nop87 nop88 nop89 outi 92 ld a, (hl) 93 dec a94 inc hl95 out (c), a 97 nop98 nop99 nop100 outi 102 nop103 nop104 nop105 outi 107 nop108 nop109 nop110 outi 113 ld a, (hl) 114 dec a115 inc hl116 out (c), a 118 nop119 nop120 nop121 outi 123 nop124 nop125 nop126 outi 128 nop129 nop130 nop131 outi 134 ld a, (hl) 135 dec a136 inc hl137 out (c), a 139 nop140 nop141 nop142 outi 144 nop145 nop146 nop147 outi 149 nop150 nop151 nop152 outi 157.skip_1:158 nop159 nop160 ld a, 208161 out (c), a 165 166 ld a, (OS.mouseX) 168 srl a 169 srl a 170 srl a 171 ld l, a173 ld a, (OS.mouseY) 175 srl a 176 srl a 177 srl a 178 ld h, a180 call _CONVERT_COL_LINE_TO_LINEAR182 ld bc, OS.screenMapping183 add hl, bc185 ld a, (hl)187 ld (OS.currentTileMouseOver), a189 196 ret198201System/Mouse/Mouse.s2 System/Mouse/MouseClick.s1_MOUSE_CLICK:3 10 11 ld a, (OS.isDraggingWindow)12 or a13 jp z, .skip_10014 15 ld a, (OS.mouseButton_1) 16 or a17 jp z, _END_DRAG_WINDOW18 jp _DO_DRAG_WINDOW19 jp .skip_121.skip_100:22 23 ld a, (OS.isResizingWindow)24 or a25 jp z, .skip_126 27 ld a, (OS.mouseButton_1) 28 or a29 jp z, _END_RESIZE_WINDOW30 jp _DO_RESIZE_WINDOW31 33.skip_1:35 37 ld a, (OS.mouseButton_1) 38 ld b, a39 or a40 jp z, .return43 ld a, (OS.oldMouseButton_1) 44 or a45 jp nz, .return48 49 ld a, b50 ld (OS.oldMouseButton_1), a53 55 56 ld a, (OS.currentTileMouseOver)58 59 cp SCREEN_MAPPING_DESKTOP 60 jp z, .click_Desktop61 cp SCREEN_MAPPING_TASKBAR 62 jp z, .click_Taskbar64 65 and 0000 1111 b 66 ld c, a68 73 ld a, (OS.currentTileMouseOver)74 and 1111 0000 b 76 cp SCREEN_MAPPING_WINDOWS77 jp z, .click_Window79 cp SCREEN_MAPPING_WINDOWS_TITLE_BAR80 jp z, .click_WindowTitleBar82 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON83 jp z, .click_WindowCloseButton85 cp SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON86 jp z, .click_WindowMaximizeButton88 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON89 jp z, .click_WindowMinimizeButton91 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER92 jp z, .click_WindowResizeCorner94 ret96.return:97 98 ld a, b99 ld (OS.oldMouseButton_1), a100 ret102104.click_Window:107 108 call _GET_PROCESS_BY_ID109 call z, _SET_CURRENT_PROCESS110 ret nz112 115 ret117119.click_WindowTitleBar:121 124 125 call _GET_PROCESS_BY_ID126 push hl127 call z, _SET_CURRENT_PROCESS128 pop ix130 call _START_DRAG_WINDOW132 ret135137.click_WindowCloseButton:139 140 call _GET_PROCESS_BY_ID142 ret nz144 call _CLOSE_PROCESS146 ret148150.click_WindowMinimizeButton:152 153 call _GET_PROCESS_BY_ID154 ret nz156 call _MINIMIZE_PROCESS158 ret160162163.click_WindowMaximizeButton:165 166 call _GET_PROCESS_BY_ID167 ret nz169 push hl 170 pop ix172 176 ld a, (ix + PROCESS_STRUCT_IX.windowState)177 cp WINDOW_STATE.RESTORED178 jp z, .isRestored180 call _RESTORE_PROCESS181 ret183.isRestored:184 call _MAXIMIZE_PROCESS185 ret187189.click_WindowResizeCorner:191 192 call _GET_PROCESS_BY_ID193 push hl194 call z, _SET_CURRENT_PROCESS195 pop ix197 call _START_RESIZE_WINDOW199 ret201203.click_Desktop:206 208 ld h, 3 * 8 209 ld l, 1 * 8 210 ld ix, Notepad.Header 211 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_0 * 8) 212 ld bc, OS.desktop_Tiles 213 call _CHECK_CLICK_DESKTOP_ICON214 ret nz 216 218 ld h, 11 * 8 219 ld l, 1 * 8 220 ld ix, Calc.Header 221 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_1 * 8) 222 ld bc, OS.desktop_Tiles + 8 223 call _CHECK_CLICK_DESKTOP_ICON224 ret nz 226 228 ld h, 3 * 8 229 ld l, 9 * 8 230 ld ix, Calc.Header 231 ld de, PATTBL + (256 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 232 ld bc, OS.desktop_Tiles + 256 233 call _CHECK_CLICK_DESKTOP_ICON234 ret nz 236 238 ld h, 3 * 8 239 ld l, 17 * 8 240 ld ix, Notepad.Header 241 ld de, PATTBL + (512 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 242 ld bc, OS.desktop_Tiles + 512 243 call _CHECK_CLICK_DESKTOP_ICON244 ret nz 248 250 call _INIT_DESKTOP252 call _UPDATE_SCREEN254 ret256258.click_Taskbar:260 262 ld a, (OS.mouseY)263 cp 191 + 1 - 10 264 ret c268 ld a, (OS.mouseX)269 270 271 cp 20 * 8272 ld hl, (OS.taskbar_Button_3_Process_addr)273 jp nc, .click_Taskbar_button275 276 cp 15 * 8277 ld hl, (OS.taskbar_Button_2_Process_addr)278 jp nc, .click_Taskbar_button280 281 cp 10 * 8282 ld hl, (OS.taskbar_Button_1_Process_addr)283 jp nc, .click_Taskbar_button285 286 cp 5 * 8287 ld hl, (OS.taskbar_Button_0_Process_addr)288 jp nc, .click_Taskbar_button290 291 cp 3 * 8292 jp c, .skip_10293 cp 4 * 8294 jp c, .click_Taskbar_ShowDesktop295.skip_10:298 ret302.click_Taskbar_ShowDesktop:304 305 ld hl, OS.processes306 ld de, Process_struct.size307 ld b, MAX_PROCESS_ID + 1308.loop_1:309 ld a, (hl)310 cp 0xff 311 jp z, .next_1313 push hl, de, bc314 ld c, a315 call _GET_PROCESS_BY_ID317 call _MINIMIZE_PROCESS318 pop bc, de, hl320.next_1:321 add hl, de322 djnz .loop_1323 324 ret327329.click_Taskbar_button:331 332 push hl333 inc hl334 ld a, l335 or h336 pop hl337 ret z339 push hl 340 pop ix342 343 ld a, (ix + PROCESS_STRUCT_IX.windowState)344 cp WINDOW_STATE.MINIMIZED345 jp nz, .skip_20347 ld a, (ix + PROCESS_STRUCT_IX.previousWindowState)348 ld (ix + PROCESS_STRUCT_IX.windowState), a349.skip_20:351 call _SET_CURRENT_PROCESS353 ret356365_CHECK_CLICK_DESKTOP_ICON:367 ld a, (OS.mouseX)368 369 cp h 370 jp c, .not_click_icon371 372 ld a, 3 * 8373 add h374 ld h, a375 ld a, (OS.mouseX)376 cp h 377 jp nc, .not_click_icon379 ld a, (OS.mouseY)380 381 cp l 382 jp c, .not_click_icon383 384 ld a, 3 * 8385 add l386 ld l, a387 ld a, (OS.mouseY)388 cp l 389 jp nc, .not_click_icon391 393 push ix, hl, de, bc394 call _INIT_DESKTOP395 pop bc, de, hl, ix397 push ix, bc398 400 call _LOAD_ICON_INVERTED_FROM_APP_HEADER401 pop hl, ix403 405 call _DRAW_DESKTOP_ICON_NAME_REVERSED407 call _UPDATE_SCREEN409 ld a, 1 410 or a411 ret413.not_click_icon:414 xor a 415 retSystem/Mouse/Mouse.s3 System/Mouse/MouseOver.s1_MOUSE_OVER:3 4 ld a, (OS.isDraggingWindow)5 ld b, a6 ld a, (OS.isResizingWindow)7 or b8 ret nz10 11 ld a, (OS.mouseOver_Activated)12 or a13 jp z, .skip_115 16 ld a, (OS.currentTileMouseOver)17 ld b, a18 ld a, (OS.mouseOver_screenMappingValue)19 cp b20 ret z21 22 23 ld a, (OS.mouseOver_screenMappingValue)24 and 1111 0000 b25 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER26 jp nz, .notOver_WindowButton27 jp .notOver_ResizeCorner29.skip_1:32 33 ld a, (OS.currentTileMouseOver)35 36 cp SCREEN_MAPPING_DESKTOP 37 ret z38 cp SCREEN_MAPPING_TASKBAR 39 ret z42 43 and 0000 1111 b 44 ld c, a46 ld a, (OS.currentTileMouseOver)47 and 1111 0000 b 50 53 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON54 jp z, .over_WindowCloseButton56 cp SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON57 jp z, .over_WindowMaximizeRestoreButton59 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON60 jp z, .over_WindowMinimizeRestoreButton62 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER63 jp z, .over_WindowResizeCorner65 ret67.over_WindowCloseButton:69 70 call _GET_PROCESS_BY_ID71 ret nz73 call .getWindowCloseButton_NAMTBL75 ld iy, TILE_WINDOW_CLOSE_BUTTON_PATTERN76 ld b, TILE_WINDOW_CLOSE_BUTTON78 call .setMouseOver80 ret84.over_WindowMaximizeRestoreButton:86 87 call _GET_PROCESS_BY_ID88 ret nz90 call .getWindowCloseButton_NAMTBL91 dec hl 93 ld iy, TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN94 ld b, TILE_WINDOW_MAXIMIZE_BUTTON96 call .setMouseOver98 ret102.over_WindowMinimizeRestoreButton:104 105 call _GET_PROCESS_BY_ID106 ret nz108 call .getWindowCloseButton_NAMTBL109 dec hl110 dec hl 112 ld iy, TILE_WINDOW_MINIMIZE_BUTTON_PATTERN113 ld b, TILE_WINDOW_MINIMIZE_BUTTON115 call .setMouseOver117 ret121.over_WindowResizeCorner:122 123 124 ld a, (OS.mouseOver_Activated)125 or a126 ret nz128 129 ld a, 1130 ld (OS.mouseOver_Activated), a132 133 ld a, (OS.currentTileMouseOver)134 ld (OS.mouseOver_screenMappingValue), a136 137 138 ld hl, SPRITE_CURSOR_RESIZE_PATTERN 139 ld de, SPRPAT + (SPRITE_INDEX_CURSOR_0 * 32) 140 ld bc, SPRITE_CURSOR_RESIZE_PATTERN.size 141 call BIOS_LDIRVM 144 147 ret151.notOver_ResizeCorner:152 153 xor a154 ld (OS.mouseOver_Activated), a156 157 ld (OS.mouseOver_screenMappingValue), a161 162 ld hl, SPRITE_CURSOR_ARROW_PATTERN 163 ld de, SPRPAT + (SPRITE_INDEX_CURSOR_0 * 32) 164 ld bc, SPRITE_CURSOR_ARROW_PATTERN.size 165 call BIOS_LDIRVM 169 172 ret176.notOver_WindowButton:178 179 ld a, (OS.mouseOver_screenMappingValue)180 and 0000 1111 b 181 ld c, a184 185 xor a186 ld (OS.mouseOver_Activated), a188 189 ld (OS.mouseOver_screenMappingValue), a192 193 call _GET_PROCESS_BY_ID194 ret nz 197 198 199 200 ld hl, (OS.mouseOver_NAMTBL_addr)201 call BIOS_SETWRT203 204 ld a, (OS.mouseOver_tileToBeRestored)205 out (PORT_0), a207 ret212216.setMouseOver:218220 221 ld a, (OS.mouseOver_Activated)222 or a223 ret nz225 227 ld a, b228 ld (OS.mouseOver_tileToBeRestored), a230 231 ld a, 1232 ld (OS.mouseOver_Activated), a234 235 ld a, (OS.currentTileMouseOver)236 ld (OS.mouseOver_screenMappingValue), a238 242 push hl244 247 ld a, (OS.mouseY)248 cp 64249 jp c, .updateScreenTop250 cp 128251 jp c, .updateScreenMiddle252 jp .updateScreenBottom254.updateScreenTop:255 258 push iy 259 pop hl261 ld de, PATTBL + (TILE_MOUSE_OVER * 8) 262 ld bc, 8 263 call BIOS_LDIRVM 265 ld a, 0xe1 267 ld bc, 8 268 ld hl, COLTBL + (TILE_MOUSE_OVER * 8) 269 call BIOS_FILVRM270 271 jp .continue_1273.updateScreenMiddle:274 277 push iy 278 pop hl280 ld de, PATTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 281 ld bc, 8 282 call BIOS_LDIRVM 284 ld a, 0xe1 285 ld bc, 8 286 ld hl, COLTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 287 call BIOS_FILVRM288 289 jp .continue_1291.updateScreenBottom:292 295 push iy 296 pop hl298 ld de, PATTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 299 ld bc, 8 300 call BIOS_LDIRVM 302 ld a, 0xe1 303 ld bc, 8 304 ld hl, COLTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 305 call BIOS_FILVRM306 307.continue_1:309 pop hl311 312 313 ld (OS.mouseOver_NAMTBL_addr), hl315 316 call BIOS_SETWRT317 ld a, TILE_MOUSE_OVER318 out (PORT_0), a320 ret322329336338345347350354358.getWindowCloseButton_NAMTBL:359 push hl 360 pop ix361 call _GET_WINDOW_TITLE_BASE_NAMTBL362 363 ld a, (ix + PROCESS_STRUCT_IX.windowState)364 cp WINDOW_STATE.MAXIMIZED365 jp z, .isMaximized367 368 ld c, (ix + PROCESS_STRUCT_IX.width) 369 ld b, 0370 add hl, bc371 ld bc, 32 - 2 372 add hl, bc373 374 ret376.isMaximized:377 ld bc, 32 - 1378 add hl, bc379 380 retSystem/Mouse/Mouse.s4 System/Mouse/DisableMouseOver.s13_DISABLE_MOUSE_OVER:4 6 xor a7 ld (OS.mouseOver_Activated), a9 10 ld (OS.mouseOver_screenMappingValue), a12 13 ld hl, (OS.mouseOver_NAMTBL_addr)14 call BIOS_SETWRT16 ld a, TILE_EMPTY17 out (PORT_0), a19 ld a, SCREEN_MAPPING_DESKTOP 20 ld (OS.currentTileMouseOver), a21 22 retSystem/Mouse/Mouse.s5 System/Mouse/DragWindow.s13_START_DRAG_WINDOW:5 6 ld a, (ix + PROCESS_STRUCT_IX.windowState)7 cp WINDOW_STATE.RESTORED8 ret nz12 13 ld a, 114 ld (OS.isDraggingWindow), a17 18 ld a, (ix + PROCESS_STRUCT_IX.x) 23 add a 24 add a25 add a26 inc a 27 ld (OS.windowCorner_TopLeft_X), a28 ld b, a30 ld a, (OS.mouseX)32 sub b34 ld (OS.dragOffset_X), a 38 39 ld a, (ix + PROCESS_STRUCT_IX.y) 44 add a 45 add a46 add a47 add 6 48 ld (OS.windowCorner_TopLeft_Y), a49 ld b, a51 ld a, (OS.mouseY)53 sub b55 ld (OS.dragOffset_Y), a57 call _ADJUST_WINDOW_DRAG_CORNERS61 72 79 ret8384_ADJUST_WINDOW_DRAG_CORNERS:85 86 ld a, (ix + PROCESS_STRUCT_IX.width)87 add a 88 add a89 add a90 ld b, a91 ld a, (OS.windowCorner_TopLeft_X)92 ld (OS.windowCorner_BottomLeft_X), a93 add b94 sub 16 + 5 95 ld (OS.windowCorner_TopRight_X), a96 ld (OS.windowCorner_BottomRight_X), a97 98 99 ld a, (ix + PROCESS_STRUCT_IX.height)100 add a 101 add a102 add a103 ld b, a104 ld a, (OS.windowCorner_TopLeft_Y)105 ld (OS.windowCorner_TopRight_Y), a106 add b107 sub 16 + 10108 ld (OS.windowCorner_BottomLeft_Y), a109 ld (OS.windowCorner_BottomRight_Y), a111 112 ld a, (BIOS_JIFFY)113 and 0011 1100 b114 srl a 115 srl a 116 ld hl, DRAG_WINDOW_SPRITE_COLOR_LUT117 ld b, 0118 ld c, a119 add hl, bc120 ld a, (hl)121 ld (OS.windowCorner_TopLeft_Color), a122 ld (OS.windowCorner_BottomLeft_Color), a123 ld (OS.windowCorner_TopRight_Color), a124 ld (OS.windowCorner_BottomRight_Color), a126 ret128129DRAG_WINDOW_SPRITE_COLOR_LUT: 130 db 15, 14, 14, 7, 5, 5, 4, 1, 1, 4, 4, 5, 7, 7, 14, 15134_DO_DRAG_WINDOW:135 137 138 ld a, (OS.mouseX)139 ld l, a140 ld h, 0x80 142 ld a, (OS.dragOffset_X)143 ld e, a144 ld d, 0145 xor a 146 sbc hl, de148 push hl149 150 ld de, 0x8000 + 1151 call BIOS_DCOMPR 152 jp nc, .skip_20153 ld a, 1154 jp .cont_10155 .skip_20:156 ld a, l157 .cont_10:158 ld (OS.windowCorner_TopLeft_X), a159 pop hl160 161 162 ld a, (ix + PROCESS_STRUCT_IX.width)163 add a 164 add a165 add a166 ld c, a167 ld b, 0168 or a 169 jp z, .skip_3170 add hl, bc172 173 ld de, 0x8000 + (255 + 2)174 call BIOS_DCOMPR 175 jp nc, .skip_3 176 jp .skip_4 177.skip_3:178 179 ld a, 1 180 sub c181 ld (OS.windowCorner_TopLeft_X), a182.skip_4:183 185 186 ld a, (OS.dragOffset_Y)187 ld b, a188 ld a, (OS.mouseY)189 sub b190 192 193 cp 191194 jp nc, .skip_1195 196 cp 6197 jp nc, .skip_2198.skip_1:199 ld a, 6200.skip_2:201 ld (OS.windowCorner_TopLeft_Y), a203 205 ld b, a206 ld a, (ix + PROCESS_STRUCT_IX.height)207 add a 208 add a209 add a210 ld c, a211 add b213 cp 191 - 9214 jp c, .skip_5216 217 ld a, 191 - 9218 sub c219 ld (OS.windowCorner_TopLeft_Y), a220.skip_5:221 222 224 call _ADJUST_WINDOW_DRAG_CORNERS226 ret230_END_DRAG_WINDOW:231 232 233 xor a234 ld (OS.isDraggingWindow), a236 ld ix, (OS.currentProcessAddr)238 ld a, (OS.windowCorner_TopLeft_X)239 dec a 240 srl a 241 srl a 242 srl a 243 ld (ix + PROCESS_STRUCT_IX.x), a245 ld a, (OS.windowCorner_TopLeft_Y)246 sub 6 247 srl a 248 srl a 249 srl a 250 ld (ix + PROCESS_STRUCT_IX.y), a252 call _UPDATE_SCREEN254 ret255System/Mouse/Mouse.s6 System/Mouse/ResizeWindow.s13_START_RESIZE_WINDOW:5 6 ld a, (ix + PROCESS_STRUCT_IX.windowState)7 cp WINDOW_STATE.RESTORED8 ret nz12 13 ld a, 114 ld (OS.isResizingWindow), a17 19 21 ld a, (ix + PROCESS_STRUCT_IX.x) 23 add a 24 add a25 add a 26 inc a 27 ld (OS.windowCorner_TopLeft_X), a28 ld (OS.windowCorner_BottomLeft_X), a29 dec a 30 ld c, a 31 ld a, (ix + PROCESS_STRUCT_IX.width) 33 add a 34 add a35 add a 36 add c 37 sub 16 + 4 38 ld (OS.windowCorner_BottomRight_X), a39 ld b, a41 ld a, (OS.mouseX)43 sub b45 ld (OS.dragOffset_X), a47 48 ld a, (ix + PROCESS_STRUCT_IX.minWidth) 50 add a 51 add a52 add a 53 add c 54 sub 16 + 4 55 ld (OS.resizeWindowCorner_BottomRight_X_Min), a59 61 63 ld a, (ix + PROCESS_STRUCT_IX.y) 65 add a 66 add a67 add a 68 add 6 69 ld (OS.windowCorner_TopLeft_Y), a70 ld (OS.windowCorner_TopRight_Y), a71 sub 6 72 ld c, a 73 ld a, (ix + PROCESS_STRUCT_IX.height) 75 add a 76 add a77 add a 78 add c 79 sub 16 + 4 80 ld (OS.windowCorner_BottomRight_Y), a81 ld b, a83 ld a, (OS.mouseY)85 sub b87 ld (OS.dragOffset_Y), a90 91 ld a, (ix + PROCESS_STRUCT_IX.minHeight) 93 add a 94 add a95 add a 96 add c 97 sub 16 + 4 98 ld (OS.resizeWindowCorner_BottomRight_Y_Min), a101 103 call _ADJUST_WINDOW_RESIZE_CORNERS106 ret110111_ADJUST_WINDOW_RESIZE_CORNERS:113 ld a, (OS.windowCorner_BottomRight_X)114 ld (OS.windowCorner_TopRight_X), a116 ld a, (OS.windowCorner_BottomRight_Y)117 ld (OS.windowCorner_BottomLeft_Y), a120 121 ld a, (BIOS_JIFFY)122 and 0011 1100 b123 srl a 124 srl a 125 ld hl, DRAG_WINDOW_SPRITE_COLOR_LUT126 ld b, 0127 ld c, a128 add hl, bc129 ld a, (hl)130 ld (OS.windowCorner_TopLeft_Color), a131 ld (OS.windowCorner_BottomLeft_Color), a132 ld (OS.windowCorner_TopRight_Color), a133 ld (OS.windowCorner_BottomRight_Color), a135 ret137142_DO_RESIZE_WINDOW:144 145 ld a, (OS.dragOffset_X)146 ld b, a147 ld a, (OS.mouseX)148 sub b149 jp c, .lessThanMinWidth 150 ld (OS.windowCorner_BottomRight_X), a152 155 ld b, a 156 ld a, (OS.resizeWindowCorner_BottomRight_X_Min)157 cp b158 jp nc, .lessThanMinWidth 159 jp .cont_1160.lessThanMinWidth:161 ld a, (OS.resizeWindowCorner_BottomRight_X_Min)162 ld (OS.windowCorner_BottomRight_X), a163 jp .cont_2 164.cont_1:167 170 ld b, 256 - 16 - 4 171 ld a, (OS.windowCorner_BottomRight_X)172 cp b173 jp nc, .greaterThanMaxWidth 174 jp .cont_2175.greaterThanMaxWidth:176 ld a, 256 - 16 - 4 177 ld (OS.windowCorner_BottomRight_X), a178.cont_2:180 182 183 ld a, (OS.dragOffset_Y)184 ld b, a185 ld a, (OS.mouseY)186 sub b187 jp c, .lessThanMinHeight 188 ld (OS.windowCorner_BottomRight_Y), a190 193 ld b, a 194 ld a, (OS.resizeWindowCorner_BottomRight_Y_Min)195 cp b196 jp nc, .lessThanMinHeight 197 jp .cont_10198.lessThanMinHeight:199 ld a, (OS.resizeWindowCorner_BottomRight_Y_Min)200 ld (OS.windowCorner_BottomRight_Y), a201 jp .cont_20 202.cont_10:205 208 ld b, 192 - 16 - 16 - 4 209 ld a, (OS.windowCorner_BottomRight_Y)210 cp b211 jp nc, .greaterThanMaxHeight 212 jp .cont_20213.greaterThanMaxHeight:214 ld a, 192 - 16 - 16 - 4 215 ld (OS.windowCorner_BottomRight_Y), a216.cont_20:218 220 call _ADJUST_WINDOW_RESIZE_CORNERS222 ret225_END_RESIZE_WINDOW:226 227 228 xor a229 ld (OS.isResizingWindow), a231 ld ix, (OS.currentProcessAddr)233 234 ld a, (OS.windowCorner_BottomRight_X)235 dec a 236 add 16 + 4 237 srl a 238 srl a 239 srl a 241 ld b, (ix + PROCESS_STRUCT_IX.x)243 sub b245 inc a 246 ld (ix + PROCESS_STRUCT_IX.width), a250 251 ld a, (OS.windowCorner_BottomRight_Y)252 add 16 + 4 253 srl a 254 srl a 255 srl a 257 ld b, (ix + PROCESS_STRUCT_IX.y)259 sub b261 ld (ix + PROCESS_STRUCT_IX.height), a265 call _UPDATE_SCREEN267 ret268System/Mouse/Mouse.s10WAIT1: equ 10 11WAIT2: equ 30 141623GTMOUS:24 ld b, WAIT2 25 call GTOFS2 27 28 ld ix, 029 bit 4, a30 jp nz, .mouseButton_1_NotClicked31 ld ixh, 132.mouseButton_1_NotClicked:33 bit 5, a34 jp nz, .mouseButton_2_NotClicked35 ld ixl, 136.mouseButton_2_NotClicked:38 and 0x0F39 rlca40 rlca41 rlca42 rlca43 ld c, a44 call GTOFST 45 and 0x0F46 or c47 ld h, a 48 call GTOFST 49 and 0x0F50 rlca51 rlca52 rlca53 rlca54 ld c, a55 call GTOFST 56 and 0x0F57 or c58 ld l, a 59 ret60 61GTOFST: 62 ld b, WAIT163GTOFS2: 64 ld a, 15 66 out (0xA0), a67 in a, (0xA1) 68 and 0x80 69 or d 70 out (0xA1), a71 xor e72 ld d, a73 74 call WAITMS 75 76 ld a, 1477 out (0xA0), a78 79 in a, (0xA2)80 ret81WAITMS:82 ld a, b83WTTR:84 djnz WTTR85 db 0xED,0x55 86 rlca87 rlca88 ld b, a89WTTR2:90 djnz WTTR291 ld b, a 92WTTR3:93 djnz WTTR395 ret 97105CLIPADD:106 107 ld a, l108 ld b, e109 call LIMITADD110 ld l, a111 112 ld a, h113 ld b, d114 call LIMITADD115 ld h, a116 cp 191117 ret c118 ld h, 191119 ret120 121LIMITADD:122 123127 128 129 sub 128 130 add a, b 131 jp pe, .CLIP 132 add a, 128 133 ret 134.CLIP: 135 ld a, b 136 cpl 137 add a, a 138 sbc a, a 139 ret 140System\Main.s21 System/Process/Process.s1 System/Process/LoadProcess.s13_LOAD_PROCESS:5 6 ld de, (OS.nextAvailableProcessAddr)7 ld a, 0xff8 cp d9 jp nz, .skip_010 cp e11 jp z, .showAlertMaxProcessLimitReached12.skip_0:14 15 push hl16 ld a, 0xff17 ld hl, (OS.nextAvailableProcessAddr)18 ld (hl), a19 20 push hl 21 pop de23 inc de25 27 ld bc, Process_struct.size - 128 ldir29 pop hl32 34 ld de, (OS.nextAvailableProcessAddr) 35 ld bc, Process_struct.size_Header 36 ldir 38 39 ld hl, (OS.nextAvailableProcessAddr)40 ld (OS.currentProcessAddr), hl43 45 46 49 50 54 58 62 65 66 ld hl, (OS.currentProcessAddr)67 call _GET_NEXT_AVAILABLE_PROCESS_ID68 ld a, ixh69 cp 25570 jp z, .maxProcessLimitReached71 ld hl, (OS.currentProcessAddr)72 ld (hl), a 74 75 call _GET_NEXT_AVAILABLE_PROCESS_ADDR76 78 ld (OS.nextAvailableProcessAddr), hl82 ld ix, (OS.currentProcessAddr)84 86 87 88 call _GET_NUMBER_OF_PROCESSES_OPENED89 dec a90 ld (ix + PROCESS_STRUCT_IX.layer), a92 ld a, WINDOW_STATE.RESTORED93 ld (ix + PROCESS_STRUCT_IX.previousWindowState), a95 97 ld a, (OS.nextWindow_x)98 ld (ix + PROCESS_STRUCT_IX.x), a99 add 2100 ld (OS.nextWindow_x), a102 ld a, (OS.nextWindow_y)103 ld (ix + PROCESS_STRUCT_IX.y), a104 add 2105 ld (OS.nextWindow_y), a106 cp 12107 call nc, .resetNextWindow_XY 113 call _UPDATE_SCREEN116 call _DRAW_TASKBAR118 120 ld ix, (OS.currentProcessAddr)121 ld e, (ix + PROCESS_STRUCT_IX.openAddr) 122 ld d, (ix + PROCESS_STRUCT_IX.openAddr + 1) 123 call JP_DE127 133 134 135 142 ret144.maxProcessLimitReached:145 146 ld hl, 0xffff147 ld (OS.nextAvailableProcessAddr), hl149 ret151.showAlertMaxProcessLimitReached:153 157 ret159.resetNextWindow_XY:160 xor a161 ld (OS.nextWindow_x), a162 ld (OS.nextWindow_y), a164 ret166System/Process/Process.s2 System/Process/SetCurrentProcess.s13_SET_CURRENT_PROCESS:5 6 ld (OS.currentProcessAddr), hl8 push hl 9 pop ix11 push hl12 13 ld c, (ix + PROCESS_STRUCT_IX.layer)14 15 16 call _ADJUST_LAYER_OF_PROCESSES18 19 call _GET_NUMBER_OF_PROCESSES_OPENED20 dec a21 ld (ix + PROCESS_STRUCT_IX.layer), a22 pop hl24 call _UPDATE_SCREEN26 call _DRAW_TASKBAR28 33 36 ret40System/Process/Process.s3 System/Process/CloseProcess.s13_CLOSE_PROCESS:5 6 push hl7 pop ix9 10 push hl11 ld e, (ix + PROCESS_STRUCT_IX.closeAddr) 12 ld d, (ix + PROCESS_STRUCT_IX.closeAddr + 1) 13 call JP_DE14 pop hl16 17 push hl18 ld c, (ix + PROCESS_STRUCT_IX.layer)19 call _ADJUST_LAYER_OF_PROCESSES20 pop hl23 push hl24 call _CLOSE_WINDOW25 pop hl30 push hl31 32 ld a, 0xff33 34 ld (hl), a35 36 push hl 37 pop de39 inc de41 43 ld bc, Process_struct.size - 145 ldir46 47 pop hl49 call _DISABLE_MOUSE_OVER50 55 58 62 65 71 call _UPDATE_SCREEN74 call _DRAW_TASKBAR76 77 call _GET_NEXT_AVAILABLE_PROCESS_ADDR78 80 ld (OS.nextAvailableProcessAddr), hl84 85 ld hl, 0x000086 ld (OS.currentProcessAddr), hl90 ret91System/Process/Process.s4 System/Process/MinimizeProcess.s13_MINIMIZE_PROCESS:5 6 push hl7 pop ix9 10 ld a, (ix + PROCESS_STRUCT_IX.windowState)11 ld (ix + PROCESS_STRUCT_IX.previousWindowState), a13 14 ld a, WINDOW_STATE.MINIMIZED15 ld (ix + PROCESS_STRUCT_IX.windowState), a17 push ix19 20 ld hl, (OS.currentProcessAddr)21 push ix 22 pop de23 call BIOS_DCOMPR 24 jp nz, .skip_126 ld hl, 0x000027 ld (OS.currentProcessAddr), hl28 .skip_1:30 pop ix32 call _CLOSE_WINDOW34 call _UPDATE_SCREEN36 call _DISABLE_MOUSE_OVER37 42 45 49 52 57 call _DRAW_TASKBAR 60 retSystem/Process/Process.s5 System/Process/MaximizeProcess.s13_MAXIMIZE_PROCESS:5 6 push hl7 pop ix9 10 ld a, WINDOW_STATE.MAXIMIZED11 ld (ix + PROCESS_STRUCT_IX.windowState), a13 call _SET_CURRENT_PROCESS15 17 call _DISABLE_MOUSE_OVER18 23 26 30 33 38 40 retSystem/Process/Process.s6 System/Process/RestoreProcess.s13_RESTORE_PROCESS:5 6 push hl7 pop ix9 10 ld a, WINDOW_STATE.RESTORED11 ld (ix + PROCESS_STRUCT_IX.windowState), a13 call _SET_CURRENT_PROCESS15 call _DISABLE_MOUSE_OVER17 retSystem/Process/Process.s10MAX_PROCESS_ID: equ 3 1417_GET_NEXT_AVAILABLE_PROCESS_ID:18 ld ixh, 0 20.outerLoop:21 ld hl, OS.processes23.loop:24 ld a, (hl)25 cp ixh26 jp z, .goToNext 28 ld bc, Process_struct.size29 add hl, bc 31 32 ld de, OS.processes_end33 call BIOS_DCOMPR 34 jp nz, .loop36 37 ret39.goToNext:40 inc ixh41 ld a, ixh42 cp MAX_PROCESS_ID + 143 jp nz, .outerLoop45 46 ld ixh, 25548 ret5154_GET_NEXT_AVAILABLE_PROCESS_ADDR:56 ld hl, OS.processes57 ld de, Process_struct.size58 ld b, MAX_PROCESS_ID + 159.loop:60 ld a, (hl)61 62 inc a 63 ret z65 add hl, de67 djnz .loop69 70 ld hl, 0xffff72 ret7679_GET_NUMBER_OF_PROCESSES_OPENED:81 ld hl, OS.processes82 ld de, Process_struct.size83 ld b, MAX_PROCESS_ID + 184 xor a 85.loop:86 ld c, (hl)87 88 inc c 89 jp z, .next91 92 inc a94.next:95 add hl, de97 djnz .loop99 ret103109_GET_PROCESS_BY_ID:110 111 ld hl, OS.processes112 ld de, Process_struct.size113 ld b, MAX_PROCESS_ID + 1114.loop_1:115 ld a, (hl)116 cp c117 ret z118 add hl, de119 djnz .loop_1121 122 ld hl, 0x0000123 xor a 125 ret128130134138145150152157162167170_ADJUST_LAYER_OF_PROCESSES:172 ld hl, OS.processes + PROCESS_STRUCT_IX.layer173 ld de, Process_struct.size174 ld b, MAX_PROCESS_ID + 1175.loop:176 ld a, (hl)177 cp 0xff178 jp z, .next 180 cp c181 jp c, .next 183 184 dec a185 ld (hl), a187.next:188 add hl, de190 djnz .loop192 ret194System\Main.s22 System/Time/Time.s1_INIT_SYSTEM_TIME:3 xor a5 ld (os.timeCounter), a7 8 ld a, 0x129 ld (OS.currentTime_Hours), a10 xor a11 ld (OS.currentTime_Minutes), a12 ld (OS.currentTime_Seconds), a13 ld (OS.timeCounter), a15 16 ld hl, OS.currentDate17 ld (hl), a18 inc hl19 ld (hl), a20 inc hl21 ld (hl), a23 ret27SYSTEM_HERTZ_RATE: equ 60 29_UPDATE_SYSTEM_TIME:31 ld a, (os.timeCounter)32 inc a33 ld (os.timeCounter), a34 cp SYSTEM_HERTZ_RATE35 ret nz37 38 xor a39 ld (os.timeCounter), a41 43 44 ld a, (OS.currentTime_Seconds)45 inc a 46 daa47 ld (OS.currentTime_Seconds), a49 50 cp 0x6051 ret nz52 ld a, (OS.currentTime_Minutes)53 inc a 54 daa55 ld (OS.currentTime_Minutes), a56 57 xor a58 ld (OS.currentTime_Seconds), a60 61 ld a, (OS.currentTime_Minutes)62 cp 0x6063 ret nz64 ld a, (OS.currentTime_Hours)65 inc a66 daa68 cp 0x13 69 jp nz, .not13Hours70 ld a, 0x0171.not13Hours:72 ld (OS.currentTime_Hours), a73 74 xor a75 ld (OS.currentTime_Minutes), a79 retSystem\Main.s2426 Graphics/Tiles.s1TILE_PATTERNS:35TILE_EMPTY: equ 06 DB 00000000b7 DB 00000000b8 DB 00000000b9 DB 00000000b10 DB 00000000b11 DB 00000000b12 DB 00000000b13 DB 00000000b15TILE_WINDOW_TITLE_TOP_LEFT: equ 116 DB 00000000b17 DB 00000000b18 DB 00000000b19 DB 00000000b20 DB 00000000b21 DB 00000000b22 DB 01111111b23 DB 01111111b25TILE_WINDOW_TITLE_BOTTOM_LEFT: equ 226 DB 01111111b27 DB 01111111b28 DB 01111111b29 DB 01111111b30 DB 01111111b31 DB 01111111b32 DB 01111111b33 DB 01111111b35TILE_WINDOW_TITLE_MIDDLE_TOP: equ 336 DB 00000000b37 DB 00000000b38 DB 00000000b39 DB 00000000b40 DB 00000000b41 DB 00000000b42 DB 11111111b43 DB 11111111b45TILE_EMPTY_BLACK: equ 446TILE_WINDOW_TITLE_MIDDLE_BOTTOM: equ 447 DB 11111111b48 DB 11111111b49 DB 11111111b50 DB 11111111b51 DB 11111111b52 DB 11111111b53 DB 11111111b54 DB 11111111b56TILE_WINDOW_BORDER_LEFT: equ 557 DB 01000000b58 DB 01000000b59 DB 01000000b60 DB 01000000b61 DB 01000000b62 DB 01000000b63 DB 01000000b64 DB 01000000b66TILE_WINDOW_BORDER_BOTTOM_LEFT: equ 667 DB 01000000b68 DB 01000000b69 DB 01000000b70 DB 01111111b71 DB 00001111b72 DB 00001111b73 DB 00001111b74 DB 00000000b76TILE_WINDOW_BORDER_MIDDLE_BOTTOM: equ 777 DB 00000000b78 DB 00000000b79 DB 00000000b80 DB 11111111b81 DB 11111111b82 DB 11111111b83 DB 11111111b84 DB 00000000b86TILE_WINDOW_RESIZE_CORNER_LEFT: equ 887 DB 00000001b88 DB 00000011b89 DB 00000110b90 DB 11111111b91 DB 11111111b92 DB 11111111b93 DB 11111111b94 DB 00000000b96TILE_WINDOW_RESIZE_CORNER_TOP: equ 997 DB 00011110b98 DB 00011110b99 DB 00011110b100 DB 00011110b101 DB 00011110b102 DB 00111110b103 DB 01111110b104 DB 11011110b106TILE_WINDOW_RESIZE_CORNER_RIGHT: equ 10107 DB 10111110b108 DB 01111110b109 DB 11011110b110 DB 11111110b111 DB 11111110b112 DB 11111110b113 DB 11111110b114 DB 00000000b117TILE_WINDOW_MINIMIZE_BUTTON_PATTERN:118TILE_WINDOW_MINIMIZE_BUTTON: equ 11119 DB 11111111b120 DB 11111111b121 DB 11111111b122 DB 11111111b123 DB 11000001b124 DB 11000001b125 DB 11111111b126 DB 11111111b128TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN:129TILE_WINDOW_MAXIMIZE_BUTTON: equ 12130 DB 11111111b131 DB 11000001b132 DB 11000001b133 DB 11011101b134 DB 11011101b135 DB 11000001b136 DB 11111111b137 DB 11111111b139TILE_WINDOW_CLOSE_BUTTON_PATTERN:140TILE_WINDOW_CLOSE_BUTTON: equ 13141 DB 11111111b142 DB 11011101b143 DB 11101011b144 DB 11110111b145 DB 11101011b146 DB 11011101b147 DB 11111111b148 DB 11111111b149 150TILE_WINDOW_TOP_RIGHT_CORNER_TOP: equ 14151 DB 00000000b152 DB 00000000b153 DB 00000000b154 DB 00000000b155 DB 00000000b156 DB 00000000b157 DB 11110000b158 DB 11110000b160TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM: equ 15161 DB 11110000b162 DB 11111110b163 DB 11111110b164 DB 11111110b165 DB 11111110b166 DB 11111110b167 DB 11111110b168 DB 11111110b170TILE_WINDOW_BORDER_RIGHT: equ 16171 DB 00011110b172 DB 00011110b173 DB 00011110b174 DB 00011110b175 DB 00011110b176 DB 00011110b177 DB 00011110b178 DB 00011110b180190192TILE_TASKBAR_TOP: equ 17193 DB 00000000 b194 DB 00000000 b195 DB 00000000 b196 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 11111111 b200 DB 11111111 b202TILE_HOME_ICON: equ 18203 DB 11100111 b204 DB 11011011 b205 DB 10111101 b206 DB 01100110 b207 DB 11000011 b208 DB 10000001 b209 DB 10011001 b210 DB 10011001 b212TILE_SHOW_DESKTOP_ICON: equ 19213 DB 10011001 b214 DB 10111101 b215 DB 11111111 b216 DB 11111111 b217 DB 11111111 b218 DB 10111101 b219 DB 10011001 b220 DB 11111111 b222224234244254264274284294304314324 360362BASE_INDEX_TILE_FONT: equ 20364TILE_FONT_REVERSED_PATTERNS:366368TILE_FONT_REVERSED_NUMBERS_PATTERNS:370TILE_FONT_REVERSED_NUMBERS_0: equ BASE_INDEX_TILE_FONT + 0372 373 db 00000000 b374 db 00111100 b375 db 01100110 b376 db 01101110 b377 db 01110110 b378 db 01100110 b379 db 00111100 b380 db 00000000 b381 382 db 00000000 b383 db 00011000 b384 db 00111000 b385 db 00011000 b386 db 00011000 b387 db 00011000 b388 db 01111110 b389 db 00000000 b390 391 db 00000000 b392 db 00111100 b393 db 01100110 b394 db 00001100 b395 db 00011000 b396 db 00110000 b397 db 01111110 b398 db 00000000 b399 400 db 00000000 b401 db 01111110 b402 db 00001100 b403 db 00011000 b404 db 00001100 b405 db 01100110 b406 db 00111100 b407 db 00000000 b408 409 db 00000000 b410 db 00001100 b411 db 00011100 b412 db 00111100 b413 db 01101100 b414 db 01111110 b415 db 00001100 b416 db 00000000 b417 418 db 00000000 b419 db 01111110 b420 db 01100000 b421 db 01111100 b422 db 00000110 b423 db 01100110 b424 db 00111100 b425 db 00000000 b426 427 db 00000000 b428 db 00111100 b429 db 01100000 b430 db 01111100 b431 db 01100110 b432 db 01100110 b433 db 00111100 b434 db 00000000 b435 436 db 00000000 b437 db 01111110 b438 db 00000110 b439 db 00001100 b440 db 00011000 b441 db 00110000 b442 db 00110000 b443 db 00000000 b444 445 db 00000000 b446 db 00111100 b447 db 01100110 b448 db 00111100 b449 db 01100110 b450 db 01100110 b451 db 00111100 b452 db 00000000 b453 454 db 00000000 b455 db 00111100 b456 db 01100110 b457 db 00111110 b458 db 00000110 b459 db 00001100 b460 db 00111000 b461 db 00000000 b464467TILE_FONT_REVERSED_LOWERCASE_PATTERNS:469TILE_FONT_REVERSED_LOWERCASE_A: equ TILE_FONT_REVERSED_NUMBERS_0 + 10471 472 db 00000000 b473 db 00000000 b474 db 00111100 b475 db 00000110 b476 db 00111110 b477 db 01100110 b478 db 00111110 b479 db 00000000 b480 481 db 00000000 b482 db 01100000 b483 db 01100000 b484 db 01111100 b485 db 01100110 b486 db 01100110 b487 db 01111100 b488 db 00000000 b489 490 db 00000000 b491 db 00000000 b492 db 00111100 b493 db 01100000 b494 db 01100000 b495 db 01100000 b496 db 00111100 b497 db 00000000 b498 499 db 00000000 b500 db 00000110 b501 db 00000110 b502 db 00111110 b503 db 01100110 b504 db 01100110 b505 db 00111110 b506 db 00000000 b507 508 db 00000000 b509 db 00000000 b510 db 00111100 b511 db 01100110 b512 db 01111110 b513 db 01100000 b514 db 00111100 b515 db 00000000 b516 517 db 00000000 b518 db 00001110 b519 db 00011000 b520 db 00111110 b521 db 00011000 b522 db 00011000 b523 db 00011000 b524 db 00000000 b525 526 db 00000000 b527 db 00000000 b528 db 00111110 b529 db 01100110 b530 db 01100110 b531 db 00111110 b532 db 00000110 b533 db 01111100 b534 535 db 00000000 b536 db 01100000 b537 db 01100000 b538 db 01111100 b539 db 01100110 b540 db 01100110 b541 db 01100110 b542 db 00000000 b543 544 db 00000000 b545 db 00011000 b546 db 00000000 b547 db 00111000 b548 db 00011000 b549 db 00011000 b550 db 00111100 b551 db 00000000 b552 553 db 00000000 b554 db 00000110 b555 db 00000000 b556 db 00000110 b557 db 00000110 b558 db 00000110 b559 db 00000110 b560 db 00111100 b561 562 db 00000000 b563 db 01100000 b564 db 01100000 b565 db 01101100 b566 db 01111000 b567 db 01101100 b568 db 01100110 b569 db 00000000 b570 571 db 00000000 b572 db 00111000 b573 db 00011000 b574 db 00011000 b575 db 00011000 b576 db 00011000 b577 db 00111100 b578 db 00000000 b579 580 db 00000000 b581 db 00000000 b582 db 01100110 b583 db 01111111 b584 db 01111111 b585 db 01101011 b586 db 01100011 b587 db 00000000 b588 589 db 00000000 b590 db 00000000 b591 db 01111100 b592 db 01100110 b593 db 01100110 b594 db 01100110 b595 db 01100110 b596 db 00000000 b597 598 db 00000000 b599 db 00000000 b600 db 00111100 b601 db 01100110 b602 db 01100110 b603 db 01100110 b604 db 00111100 b605 db 00000000 b606 607 db 00000000 b608 db 00000000 b609 db 01111100 b610 db 01100110 b611 db 01100110 b612 db 01111100 b613 db 01100000 b614 db 01100000 b615 616 db 00000000 b617 db 00000000 b618 db 00111110 b619 db 01100110 b620 db 01100110 b621 db 00111110 b622 db 00000110 b623 db 00000110 b624 625 db 00000000 b626 db 00000000 b627 db 01111100 b628 db 01100110 b629 db 01100000 b630 db 01100000 b631 db 01100000 b632 db 00000000 b633 634 db 00000000 b635 db 00000000 b636 db 00111110 b637 db 01100000 b638 db 00111100 b639 db 00000110 b640 db 01111100 b641 db 00000000 b642 643 db 00000000 b644 db 00011000 b645 db 01111110 b646 db 00011000 b647 db 00011000 b648 db 00011000 b649 db 00001110 b650 db 00000000 b651 652 db 00000000 b653 db 00000000 b654 db 01100110 b655 db 01100110 b656 db 01100110 b657 db 01100110 b658 db 00111110 b659 db 00000000 b660 661 db 00000000 b662 db 00000000 b663 db 01100110 b664 db 01100110 b665 db 01100110 b666 db 00111100 b667 db 00011000 b668 db 00000000 b669 670 db 00000000 b671 db 00000000 b672 db 01100011 b673 db 01101011 b674 db 01111111 b675 db 00111110 b676 db 00110110 b677 db 00000000 b678 679 db 00000000 b680 db 00000000 b681 db 01100110 b682 db 00111100 b683 db 00011000 b684 db 00111100 b685 db 01100110 b686 db 00000000 b687 688 db 00000000 b689 db 00000000 b690 db 01100110 b691 db 01100110 b692 db 01100110 b693 db 00111110 b694 db 00001100 b695 db 01111000 b696 697 db 00000000 b698 db 00000000 b699 db 01111110 b700 db 00001100 b701 db 00011000 b702 db 00110000 b703 db 01111110 b704 db 00000000 b706TILE_FONT_REVERSED_LOWERCASE_PATTERNS.size: equ $ - TILE_FONT_REVERSED_LOWERCASE_PATTERNS709711TILE_FONT_REVERSED_SYMBOLS_PATTERNS:713TILE_FONT_REVERSED_SYMBOLS: equ TILE_FONT_REVERSED_LOWERCASE_A + 26715 716 db 00000000 b717 db 00000000 b718 db 00011000 b719 db 00011000 b720 db 00000000 b721 db 00011000 b722 db 00011000 b723 db 00000000 b725728TILE_FONT_REVERSED_PATTERNS.SIZE: equ $ - TILE_FONT_REVERSED_PATTERNS731733735TILE_FONT_NUMBERS_PATTERNS:737TILE_FONT_NUMBERS_0: equ TILE_FONT_REVERSED_SYMBOLS + 1739 740 db 00000000 b741 db 00111100 b742 db 01100110 b743 db 01101110 b744 db 01110110 b745 db 01100110 b746 db 00111100 b747 db 00000000 b748 749 db 00000000 b750 db 00011000 b751 db 00111000 b752 db 00011000 b753 db 00011000 b754 db 00011000 b755 db 01111110 b756 db 00000000 b757 758 db 00000000 b759 db 00111100 b760 db 01100110 b761 db 00001100 b762 db 00011000 b763 db 00110000 b764 db 01111110 b765 db 00000000 b766 767 db 00000000 b768 db 01111110 b769 db 00001100 b770 db 00011000 b771 db 00001100 b772 db 01100110 b773 db 00111100 b774 db 00000000 b775 776 db 00000000 b777 db 00001100 b778 db 00011100 b779 db 00111100 b780 db 01101100 b781 db 01111110 b782 db 00001100 b783 db 00000000 b784 785 db 00000000 b786 db 01111110 b787 db 01100000 b788 db 01111100 b789 db 00000110 b790 db 01100110 b791 db 00111100 b792 db 00000000 b793 794 db 00000000 b795 db 00111100 b796 db 01100000 b797 db 01111100 b798 db 01100110 b799 db 01100110 b800 db 00111100 b801 db 00000000 b802 803 db 00000000 b804 db 01111110 b805 db 00000110 b806 db 00001100 b807 db 00011000 b808 db 00110000 b809 db 00110000 b810 db 00000000 b811 812 db 00000000 b813 db 00111100 b814 db 01100110 b815 db 00111100 b816 db 01100110 b817 db 01100110 b818 db 00111100 b819 db 00000000 b820 821 db 00000000 b822 db 00111100 b823 db 01100110 b824 db 00111110 b825 db 00000110 b826 db 00001100 b827 db 00111000 b828 db 00000000 b832835TILE_FONT_LOWERCASE_PATTERNS:837TILE_FONT_LOWERCASE_A: equ TILE_FONT_NUMBERS_0 + 10839 840 db 00000000 b841 db 00000000 b842 db 00111100 b843 db 00000110 b844 db 00111110 b845 db 01100110 b846 db 00111110 b847 db 00000000 b848 849 db 00000000 b850 db 01100000 b851 db 01100000 b852 db 01111100 b853 db 01100110 b854 db 01100110 b855 db 01111100 b856 db 00000000 b857 858 db 00000000 b859 db 00000000 b860 db 00111100 b861 db 01100000 b862 db 01100000 b863 db 01100000 b864 db 00111100 b865 db 00000000 b866 867 db 00000000 b868 db 00000110 b869 db 00000110 b870 db 00111110 b871 db 01100110 b872 db 01100110 b873 db 00111110 b874 db 00000000 b875 876 db 00000000 b877 db 00000000 b878 db 00111100 b879 db 01100110 b880 db 01111110 b881 db 01100000 b882 db 00111100 b883 db 00000000 b884 885 db 00000000 b886 db 00001110 b887 db 00011000 b888 db 00111110 b889 db 00011000 b890 db 00011000 b891 db 00011000 b892 db 00000000 b893 894 db 00000000 b895 db 00000000 b896 db 00111110 b897 db 01100110 b898 db 01100110 b899 db 00111110 b900 db 00000110 b901 db 01111100 b902 903 db 00000000 b904 db 01100000 b905 db 01100000 b906 db 01111100 b907 db 01100110 b908 db 01100110 b909 db 01100110 b910 db 00000000 b911 912 db 00000000 b913 db 00011000 b914 db 00000000 b915 db 00111000 b916 db 00011000 b917 db 00011000 b918 db 00111100 b919 db 00000000 b920 921 db 00000000 b922 db 00000110 b923 db 00000000 b924 db 00000110 b925 db 00000110 b926 db 00000110 b927 db 00000110 b928 db 00111100 b929 930 db 00000000 b931 db 01100000 b932 db 01100000 b933 db 01101100 b934 db 01111000 b935 db 01101100 b936 db 01100110 b937 db 00000000 b938 939 db 00000000 b940 db 00111000 b941 db 00011000 b942 db 00011000 b943 db 00011000 b944 db 00011000 b945 db 00111100 b946 db 00000000 b947 948 db 00000000 b949 db 00000000 b950 db 01100110 b951 db 01111111 b952 db 01111111 b953 db 01101011 b954 db 01100011 b955 db 00000000 b956 957 db 00000000 b958 db 00000000 b959 db 01111100 b960 db 01100110 b961 db 01100110 b962 db 01100110 b963 db 01100110 b964 db 00000000 b965 966 db 00000000 b967 db 00000000 b968 db 00111100 b969 db 01100110 b970 db 01100110 b971 db 01100110 b972 db 00111100 b973 db 00000000 b974 975 db 00000000 b976 db 00000000 b977 db 01111100 b978 db 01100110 b979 db 01100110 b980 db 01111100 b981 db 01100000 b982 db 01100000 b983 984 db 00000000 b985 db 00000000 b986 db 00111110 b987 db 01100110 b988 db 01100110 b989 db 00111110 b990 db 00000110 b991 db 00000110 b992 993 db 00000000 b994 db 00000000 b995 db 01111100 b996 db 01100110 b997 db 01100000 b998 db 01100000 b999 db 01100000 b1000 db 00000000 b1001 1002 db 00000000 b1003 db 00000000 b1004 db 00111110 b1005 db 01100000 b1006 db 00111100 b1007 db 00000110 b1008 db 01111100 b1009 db 00000000 b1010 1011 db 00000000 b1012 db 00011000 b1013 db 01111110 b1014 db 00011000 b1015 db 00011000 b1016 db 00011000 b1017 db 00001110 b1018 db 00000000 b1019 1020 db 00000000 b1021 db 00000000 b1022 db 01100110 b1023 db 01100110 b1024 db 01100110 b1025 db 01100110 b1026 db 00111110 b1027 db 00000000 b1028 1029 db 00000000 b1030 db 00000000 b1031 db 01100110 b1032 db 01100110 b1033 db 01100110 b1034 db 00111100 b1035 db 00011000 b1036 db 00000000 b1037 1038 db 00000000 b1039 db 00000000 b1040 db 01100011 b1041 db 01101011 b1042 db 01111111 b1043 db 00111110 b1044 db 00110110 b1045 db 00000000 b1046 1047 db 00000000 b1048 db 00000000 b1049 db 01100110 b1050 db 00111100 b1051 db 00011000 b1052 db 00111100 b1053 db 01100110 b1054 db 00000000 b1055 1056 db 00000000 b1057 db 00000000 b1058 db 01100110 b1059 db 01100110 b1060 db 01100110 b1061 db 00111110 b1062 db 00001100 b1063 db 01111000 b1064 1065 db 00000000 b1066 db 00000000 b1067 db 01111110 b1068 db 00001100 b1069 db 00011000 b1070 db 00110000 b1071 db 01111110 b1072 db 00000000 b107410761078TILE_FONT_UPPERCASE_PATTERNS:1080TILE_FONT_UPPERCASE_A: equ TILE_FONT_LOWERCASE_A + 261082 1083 db 00000000 b1084 db 00011000 b1085 db 00111100 b1086 db 01100110 b1087 db 01100110 b1088 db 01111110 b1089 db 01100110 b1090 db 00000000 b1091 1092 db 00000000 b1093 db 01111100 b1094 db 01100110 b1095 db 01111100 b1096 db 01100110 b1097 db 01100110 b1098 db 01111100 b1099 db 00000000 b1100 1101 db 00000000 b1102 db 00111100 b1103 db 01100110 b1104 db 01100000 b1105 db 01100000 b1106 db 01100110 b1107 db 00111100 b1108 db 00000000 b1109 1110 db 00000000 b1111 db 01111000 b1112 db 01101100 b1113 db 01100110 b1114 db 01100110 b1115 db 01101100 b1116 db 01111000 b1117 db 00000000 b1118 1119 db 00000000 b1120 db 01111110 b1121 db 01100000 b1122 db 01111100 b1123 db 01100000 b1124 db 01100000 b1125 db 01111110 b1126 db 00000000 b1127 1128 db 00000000 b1129 db 01111110 b1130 db 01100000 b1131 db 01111100 b1132 db 01100000 b1133 db 01100000 b1134 db 01100000 b1135 db 00000000 b1136 1137 db 00000000 b1138 db 00111110 b1139 db 01100000 b1140 db 01100000 b1141 db 01101110 b1142 db 01100110 b1143 db 00111110 b1144 db 00000000 b1145 1146 db 00000000 b1147 db 01100110 b1148 db 01100110 b1149 db 01111110 b1150 db 01100110 b1151 db 01100110 b1152 db 01100110 b1153 db 00000000 b1154 1155 db 00000000 b1156 db 01111110 b1157 db 00011000 b1158 db 00011000 b1159 db 00011000 b1160 db 00011000 b1161 db 01111110 b1162 db 00000000 b1163 1164 db 00000000 b1165 db 00000110 b1166 db 00000110 b1167 db 00000110 b1168 db 00000110 b1169 db 01100110 b1170 db 00111100 b1171 db 00000000 b1172 1173 db 00000000 b1174 db 01100110 b1175 db 01101100 b1176 db 01111000 b1177 db 01111000 b1178 db 01101100 b1179 db 01100110 b1180 db 00000000 b1181 1182 db 00000000 b1183 db 01100000 b1184 db 01100000 b1185 db 01100000 b1186 db 01100000 b1187 db 01100000 b1188 db 01111110 b1189 db 00000000 b1190 1191 db 00000000 b1192 db 01100011 b1193 db 01110111 b1194 db 01111111 b1195 db 01101011 b1196 db 01100011 b1197 db 01100011 b1198 db 00000000 b1199 1200 db 00000000 b1201 db 01100110 b1202 db 01110110 b1203 db 01111110 b1204 db 01111110 b1205 db 01101110 b1206 db 01100110 b1207 db 00000000 b1208 1209 db 00000000 b1210 db 00111100 b1211 db 01100110 b1212 db 01100110 b1213 db 01100110 b1214 db 01100110 b1215 db 00111100 b1216 db 00000000 b1217 1218 db 00000000 b1219 db 01111100 b1220 db 01100110 b1221 db 01100110 b1222 db 01111100 b1223 db 01100000 b1224 db 01100000 b1225 db 00000000 b1226 1227 db 00000000 b1228 db 00111100 b1229 db 01100110 b1230 db 01100110 b1231 db 01100110 b1232 db 01101100 b1233 db 00110110 b1234 db 00000000 b1235 1236 db 00000000 b1237 db 01111100 b1238 db 01100110 b1239 db 01100110 b1240 db 01111100 b1241 db 01101100 b1242 db 01100110 b1243 db 00000000 b1244 1245 db 00000000 b1246 db 00111100 b1247 db 01100000 b1248 db 00111100 b1249 db 00000110 b1250 db 00000110 b1251 db 00111100 b1252 db 00000000 b1253 1254 db 00000000 b1255 db 01111110 b1256 db 00011000 b1257 db 00011000 b1258 db 00011000 b1259 db 00011000 b1260 db 00011000 b1261 db 00000000 b1262 1263 db 00000000 b1264 db 01100110 b1265 db 01100110 b1266 db 01100110 b1267 db 01100110 b1268 db 01100110 b1269 db 01111110 b1270 db 00000000 b1271 1272 db 00000000 b1273 db 01100110 b1274 db 01100110 b1275 db 01100110 b1276 db 01100110 b1277 db 00111100 b1278 db 00011000 b1279 db 00000000 b1280 1281 db 00000000 b1282 db 01100011 b1283 db 01100011 b1284 db 01101011 b1285 db 01111111 b1286 db 01110111 b1287 db 01100011 b1288 db 00000000 b1289 1290 db 00000000 b1291 db 01100110 b1292 db 01100110 b1293 db 00111100 b1294 db 00111100 b1295 db 01100110 b1296 db 01100110 b1297 db 00000000 b1298 1299 db 00000000 b1300 db 01100110 b1301 db 01100110 b1302 db 00111100 b1303 db 00011000 b1304 db 00011000 b1305 db 00011000 b1306 db 00000000 b1307 1308 db 00000000 b1309 db 01111110 b1310 db 00001100 b1311 db 00011000 b1312 db 00110000 b1313 db 01100000 b1314 db 01111110 b1315 db 00000000 b1318TILE_PATTERNS.size: equ $ - TILE_PATTERNS13201323TILE_MOUSE_OVER: equ TILE_BASE_DESKTOP_ICONS - 1132513271329NUMBER_OF_TILES_PER_ICON: equ 91331TILE_BASE_DESKTOP_ICONS: equ 190 1333 TILE_BASE_DESKTOP_ICON_0: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 0)1334 TILE_BASE_DESKTOP_ICON_1: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 1)133613381340NUMBER_OF_TILES_RESERVED_PER_PROCESS: equ 121342TILE_BASE_INDEX_PROCESSES: equ 208 1344 TILE_BASE_INDEX_PROCESS_0: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 0)1345 TILE_BASE_INDEX_PROCESS_1: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 1)1346 TILE_BASE_INDEX_PROCESS_2: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 2)1347 TILE_BASE_INDEX_PROCESS_3: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 3)System\Main.s27 Graphics/Sprites.s1SPRITE_PATTERNS:3SPRITE_CURSOR_ARROW_PATTERN:5SPRITE_INDEX_CURSOR_0: equ 0 * 46 8 DB 10000000b9 DB 11000000b10 DB 10100000b11 DB 10010000b12 DB 10001000b13 DB 10000100b14 DB 10000010b15 DB 10000001b16 DB 10000000b17 DB 10000000b18 DB 10000011b19 DB 10010010b20 DB 10101001b21 DB 11001001b22 DB 00000110b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b27 DB 00000000b28 DB 00000000b29 DB 00000000b30 DB 00000000b31 DB 00000000b32 DB 10000000b33 DB 01000000b34 DB 11000000b35 DB 00000000b36 DB 00000000b37 DB 00000000b38 DB 00000000b39 DB 00000000b40SPRITE_INDEX_CURSOR_1: equ 1 * 441 42 DB 00000000b43 DB 00000000b44 DB 01000000b45 DB 01100000b46 DB 01110000b47 DB 01111000b48 DB 01111100b49 DB 01111110b50 DB 01111111b51 DB 01111111b52 DB 01111100b53 DB 01101100b54 DB 01000110b55 DB 00000110b56 DB 00000000b57 DB 00000000b58 DB 00000000b59 DB 00000000b60 DB 00000000b61 DB 00000000b62 DB 00000000b63 DB 00000000b64 DB 00000000b65 DB 00000000b66 DB 00000000b67 DB 10000000b68 DB 00000000b69 DB 00000000b70 DB 00000000b71 DB 00000000b72 DB 00000000b73 DB 00000000b74SPRITE_CURSOR_ARROW_PATTERN.size: equ $ - SPRITE_CURSOR_ARROW_PATTERN76SPRITE_INDEX_WINDOW_TOP_LEFT: equ 2 * 477 DB 11001100 b78 DB 10000000 b79 DB 00000000 b80 DB 00000000 b81 DB 10000000 b82 DB 10000000 b83 DB 00000000 b84 DB 00000000 b86 DB 10000000 b87 DB 10000000 b88 DB 00000000 b89 DB 00000000 b90 DB 10000000 b91 DB 10000000 b92 DB 00000000 b93 DB 00000000 b95 DB 11001100 b96 DB 00000000 b97 DB 00000000 b98 DB 00000000 b99 DB 00000000 b100 DB 00000000 b101 DB 00000000 b102 DB 00000000 b104 DB 00000000 b105 DB 00000000 b106 DB 00000000 b107 DB 00000000 b108 DB 00000000 b109 DB 00000000 b110 DB 00000000 b111 DB 00000000 b113SPRITE_INDEX_WINDOW_TOP_RIGHT: equ 3 * 4114 DB 11001100 b115 DB 00000000 b116 DB 00000000 b117 DB 00000000 b118 DB 00000000 b119 DB 00000000 b120 DB 00000000 b121 DB 00000000 b123 DB 00000000 b124 DB 00000000 b125 DB 00000000 b126 DB 00000000 b127 DB 00000000 b128 DB 00000000 b129 DB 00000000 b130 DB 00000000 b132 DB 00110011 b133 DB 00000001 b134 DB 00000000 b135 DB 00000000 b136 DB 00000001 b137 DB 00000001 b138 DB 00000000 b139 DB 00000000 b141 DB 00000001 b142 DB 00000001 b143 DB 00000000 b144 DB 00000000 b145 DB 00000001 b146 DB 00000001 b147 DB 00000000 b148 DB 00000000 b150SPRITE_INDEX_WINDOW_BOTTOM_LEFT: equ 4 * 4151 DB 00000000 b152 DB 00000000 b153 DB 10000000 b154 DB 10000000 b155 DB 00000000 b156 DB 00000000 b157 DB 10000000 b158 DB 10000000 b160 DB 00000000 b161 DB 00000000 b162 DB 10000000 b163 DB 10000000 b164 DB 00000000 b165 DB 00000000 b166 DB 10000000 b167 DB 11001100 b169 DB 00000000 b170 DB 00000000 b171 DB 00000000 b172 DB 00000000 b173 DB 00000000 b174 DB 00000000 b175 DB 00000000 b176 DB 00000000 b178 DB 00000000 b179 DB 00000000 b180 DB 00000000 b181 DB 00000000 b182 DB 00000000 b183 DB 00000000 b184 DB 00000000 b185 DB 11001100 b187SPRITE_INDEX_WINDOW_BOTTOM_RIGHT: equ 5 * 4188 DB 00000000 b189 DB 00000000 b190 DB 00000000 b191 DB 00000000 b192 DB 00000000 b193 DB 00000000 b194 DB 00000000 b195 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 00000000 b200 DB 00000000 b201 DB 00000000 b202 DB 00000000 b203 DB 00000000 b204 DB 00110011 b206 DB 00000000 b207 DB 00000000 b208 DB 00000001 b209 DB 00000001 b210 DB 00000000 b211 DB 00000000 b212 DB 00000001 b213 DB 00000001 b215 DB 00000000 b216 DB 00000000 b217 DB 00000001 b218 DB 00000001 b219 DB 00000000 b220 DB 00000000 b221 DB 00000001 b222 DB 00110011 b224SPRITE_PATTERNS.size: equ $ - SPRITE_PATTERNS228SPRITE_CURSOR_RESIZE_PATTERN:229 230 DB 11111110b231 DB 10000100b232 DB 10001000b233 DB 10000100b234 DB 10100010b235 DB 11010001b236 DB 10001000b237 DB 00000100b238 DB 00000010b239 DB 00000001b240 DB 00000000b241 DB 00000000b242 DB 00000000b243 DB 00000000b244 DB 00000000b245 DB 00000000b246 DB 00000000b247 DB 00000000b248 DB 00000000b249 DB 00000000b250 DB 00000000b251 DB 00000000b252 DB 10000000b253 DB 01000000b254 DB 00100000b255 DB 00010001b256 DB 10001011b257 DB 01000101b258 DB 00100001b259 DB 00010001b260 DB 00100001b261 DB 01111111b262 263 DB 00000000b264 DB 01111000b265 DB 01110000b266 DB 01111000b267 DB 01011100b268 DB 00001110b269 DB 00000111b270 DB 00000011b271 DB 00000001b272 DB 00000000b273 DB 00000000b274 DB 00000000b275 DB 00000000b276 DB 00000000b277 DB 00000000b278 DB 00000000b279 DB 00000000b280 DB 00000000b281 DB 00000000b282 DB 00000000b283 DB 00000000b284 DB 00000000b285 DB 00000000b286 DB 10000000b287 DB 11000000b288 DB 11100000b289 DB 01110000b290 DB 00111010b291 DB 00011110b292 DB 00001110b293 DB 00011110b294 DB 00000000b295.size: equ $ - SPRITE_CURSOR_RESIZE_PATTERNSystem\Main.s3031 Apps/Notepad/Header.s1Notepad:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 - 39.y: db 410.width: db 1311.height: db 812.minWidth: db 1013.minHeight: db 615.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 13 17 db TILE_FONT_REVERSED_LOWERCASE_A + 14 18 db TILE_FONT_REVERSED_LOWERCASE_A + 19 19 db TILE_FONT_REVERSED_LOWERCASE_A + 4 20 db TILE_FONT_REVERSED_LOWERCASE_A + 15 21 db TILE_FONT_REVERSED_LOWERCASE_A + 0 22 db TILE_FONT_REVERSED_LOWERCASE_A + 3 23 db 0 24 db 3325 db 3326 db 3327 db 3328 db 3329 db 3330 db 3331 db 3332.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 13 34 db TILE_FONT_REVERSED_LOWERCASE_A + 14 35 db TILE_FONT_REVERSED_LOWERCASE_A + 19 36 db TILE_FONT_REVERSED_LOWERCASE_A + 4 37.iconTitle:38 db TILE_FONT_LOWERCASE_A + 13 39 db TILE_FONT_LOWERCASE_A + 14 40 db TILE_FONT_LOWERCASE_A + 19 41 db TILE_FONT_LOWERCASE_A + 4 42 db TILE_FONT_LOWERCASE_A + 15 43 db TILE_FONT_LOWERCASE_A + 0 44 db TILE_FONT_LOWERCASE_A + 3 46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Notepad_Open52.workAddr: dw Notepad_Work53.drawAddr: dw Notepad_Draw54.clickAddr: dw Notepad_Click55.closeAddr: dw Notepad_Close57.iconAddr: dw Notepad_Icon59.ramSize: dw 1024 6263Notepad.StartProgramCode:65Notepad_Open:66 Apps/Notepad/Open.s14 10 11 14 call _GET_WINDOW_BASE_NAMTBL16 17 ld bc, 32 * 118 add hl, bc20 ld de, TEST_NOTEPAD_OPEN_EVENT_STRING21 call _DRAW_STRING23 29 ret32TEST_NOTEPAD_OPEN_EVENT_STRING: db 'N OPEN', 033Apps/Notepad/Header.s68Notepad_Work:69 Apps/Notepad/Work.s14 10 11 14 call _GET_WINDOW_BASE_NAMTBL17 20 21 ld bc, 32 * 222 add hl, bc24 ld de, TEST_NOTEPAD_WORK_EVENT_STRING25 call _DRAW_STRING27 31 35 ret38TEST_NOTEPAD_WORK_EVENT_STRING: db 'N WORK', 0Apps/Notepad/Header.s71Notepad_Draw:72 Apps/Notepad/Draw.s14 7 8 9 10 13 call _GET_WINDOW_BASE_NAMTBL15 ld de, TEST_NOTEPAD_DRAW_EVENT_STRING16 call _DRAW_STRING18 ret21TEST_NOTEPAD_DRAW_EVENT_STRING: db 'N DRAW', 0Apps/Notepad/Header.s74Notepad_Click:75 Apps/Notepad/Click.s1 2 3 retApps/Notepad/Header.s77Notepad_Close:78 Apps/Notepad/Close.s1 3 11 retApps/Notepad/Header.s80Notepad.EndProgramCode: 8485Notepad_Icon:86 Apps/Notepad/Icon.s12 DB 00000000b3 DB 00000001b4 DB 00000010b5 DB 00000010b6 DB 00000100b7 DB 00000100b8 DB 00001000b9 DB 00001000b11 DB 00010001b12 DB 00010000b13 DB 00100000b14 DB 00100000b15 DB 01000000b16 DB 01000000b17 DB 10000000b18 DB 10000000b20 DB 10000000b21 DB 01111111b22 DB 00000000b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b27 DB 00000000b2931 DB 01101101b32 DB 10110110b33 DB 01001001b34 DB 00000000b35 DB 00000000b36 DB 00000000b37 DB 11111111b38 DB 00000000b40 DB 11111110b41 DB 00000000b42 DB 00000000b43 DB 00000000b44 DB 00000000b45 DB 00000001b46 DB 00000001b47 DB 00000010b49 DB 00000010b50 DB 11111101b51 DB 10000000b52 DB 10111111b53 DB 10000000b54 DB 10101010b55 DB 01111111b56 DB 00111111b5859 DB 10110000b60 DB 11011100b61 DB 00100110b62 DB 00001011b63 DB 00001011b64 DB 00010011b65 DB 00010111b66 DB 00100011b68 DB 00100111b69 DB 01010011b70 DB 01000111b71 DB 10110011b72 DB 10000111b73 DB 01110011b74 DB 00000111b75 DB 11110011b77 DB 00000111b78 DB 11110011b79 DB 00000111b80 DB 11110011b81 DB 00000111b82 DB 10101111b83 DB 11111110b84 DB 11111100b85Apps/Notepad/Header.s87System\Main.s32 Apps/Calc/Header.s1Calc:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 + 139.y: db 1010.width: db 1411.height: db 812.minWidth: db 1213.minHeight: db 815.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 2 17 db TILE_FONT_REVERSED_LOWERCASE_A + 0 18 db TILE_FONT_REVERSED_LOWERCASE_A + 11 19 db TILE_FONT_REVERSED_LOWERCASE_A + 2 20 db 0 21 db 3322 db 3323 db 3324 db 3325 db 3326 db 3327 db 3328 db 3329 db 3330 db 3331 db 3332.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 2 34 db TILE_FONT_REVERSED_LOWERCASE_A + 0 35 db TILE_FONT_REVERSED_LOWERCASE_A + 11 36 db TILE_FONT_REVERSED_LOWERCASE_A + 2 37.iconTitle:38 db TILE_EMPTY39 db TILE_FONT_LOWERCASE_A + 2 40 db TILE_FONT_LOWERCASE_A + 0 41 db TILE_FONT_LOWERCASE_A + 11 42 db TILE_FONT_LOWERCASE_A + 2 43 db TILE_EMPTY44 db TILE_EMPTY46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Calc_Open52.workAddr: dw Calc_Work53.drawAddr: dw Calc_Draw54.clickAddr: dw Calc_Click55.closeAddr: dw Calc_Close57.iconAddr: dw Calc_Icon59.ramSize: dw 1024 6263Calc.StartProgramCode:65Calc_Open:66 Apps/Calc/Open.s14 7 ld l, (ix + PROCESS_STRUCT_IX.x) 8 ld h, (ix + PROCESS_STRUCT_IX.y) 9 call _CONVERT_COL_LINE_TO_LINEAR10 11 ld bc, NAMTBL + (32 * 2) + 112 add hl, bc14 16 call BIOS_SETWRT17 ld a, TILE_FONT_UPPERCASE_A + 1 18 out (PORT_0), a20 retApps/Calc/Header.s68Calc_Work:69 Apps/Calc/Work.s14 7 ld l, (ix + PROCESS_STRUCT_IX.x) 8 ld h, (ix + PROCESS_STRUCT_IX.y) 9 call _CONVERT_COL_LINE_TO_LINEAR10 11 ld bc, NAMTBL + (32 * 4) + 112 add hl, bc14 16 call BIOS_SETWRT17 ld a, (OS.timeCounter)18 ld d, a 19 20 and 1111 0000 b21 srl a 22 srl a 23 srl a 24 srl a 25 ld b, TILE_FONT_NUMBERS_0 + 026 add b27 out (PORT_0), a29 ld a, d 30 and 0000 1111 b31 ld b, TILE_FONT_NUMBERS_0 + 032 add b33 out (PORT_0), a36 retApps/Calc/Header.s71Calc_Draw:72 Apps/Calc/Draw.s1 2 3 retApps/Calc/Header.s74Calc_Click:75 Apps/Calc/Click.s1 2 3 retApps/Calc/Header.s77Calc_Close:78 Apps/Calc/Close.s1 4 13 retApps/Calc/Header.s80Calc.EndProgramCode: 8485Calc_Icon:86 Apps/Calc/Icon.s1 DB 00000000b2 DB 00000000b3 DB 00111111b4 DB 01000000b5 DB 01011111b6 DB 01010000b7 DB 01011111b8 DB 01000000b10 DB 01001001b11 DB 01011011b12 DB 01000000b13 DB 01001001b14 DB 01011011b15 DB 01000000b16 DB 01001001b17 DB 01011011b19 DB 01000000b20 DB 00111111b21 DB 00011111b22 DB 00000000b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b28 DB 00000000b29 DB 00000000b30 DB 11111111b31 DB 00000000b32 DB 11111000b33 DB 00001000b34 DB 11111000b35 DB 00000000b37 DB 00100100b38 DB 01101101b39 DB 00000000b40 DB 00100100b41 DB 01101101b42 DB 00000000b43 DB 00100100b44 DB 01101101b46 DB 00000000b47 DB 11111111b48 DB 11111111b49 DB 00000000b50 DB 00000000b51 DB 00000000b52 DB 00000000b53 DB 00000000b55 DB 00000000b56 DB 00000000b57 DB 11111000b58 DB 00000100b59 DB 00000110b60 DB 00000110b61 DB 00000110b62 DB 00000110b64 DB 10010110b65 DB 10110110b66 DB 00000110b67 DB 10010110b68 DB 10110110b69 DB 00000110b70 DB 00010110b71 DB 11110110b73 DB 00000110b74 DB 11111110b75 DB 11111100b76 DB 00000000b77 DB 00000000b78 DB 00000000b79 DB 00000000b80 DB 00000000b81Apps/Calc/Header.s87System\Main.s36Execute:37 38 di 39 im 1 40 ld sp, (BIOS_HIMEM) 41 ei43 46 call _INIT48 52 56 60 64 69 70 76 80 84.OS_MainLoop:87 88 call _GET_NUMBER_OF_PROCESSES_OPENED89 ld (Temp), a91 92 call _DRAW_MOUSE_CURSOR93 call _MOUSE_CLICK94 call _MOUSE_OVER96 97 call _READ_KEYBOARD100 101 ld a, (OS.timeCounter)102 or a103 jp nz, .skip104 105 call _DRAW_TASKBAR_CLOCK107 .skip:108 110 111 ld ix, (OS.currentProcessAddr)112 ld a, ixl113 or ixh114 jp z, .noCurrentProcess 116 ld e, (ix + PROCESS_STRUCT_IX.workAddr) 117 ld d, (ix + PROCESS_STRUCT_IX.workAddr + 1) 118 call JP_DE119 .noCurrentProcess:121 jp .OS_MainLoop125 db "End ROM started at 0x4000"127 ds PageSize - ($ - 0x4000), 255 131132 org 0xc000, 0xe5ff134 System/Ram.s13710121519RamStart:2123Seed: rw 125OS:2728.mouseSpriteAttributes:29.mouseY: rb 130.mouseX: rb 131.mousePattern: rb 132.mouseColor: rb 133.mouseY_1: rb 134.mouseX_1: rb 135.mousePattern_1: rb 136.mouseColor_1: rb 137.windowCorner_TopLeft_Y: rb 138.windowCorner_TopLeft_X: rb 139.windowCorner_TopLeft_Pattern: rb 140.windowCorner_TopLeft_Color: rb 141.windowCorner_TopRight_Y: rb 142.windowCorner_TopRight_X: rb 143.windowCorner_TopRight_Pattern: rb 144.windowCorner_TopRight_Color: rb 145.windowCorner_BottomLeft_Y: rb 146.windowCorner_BottomLeft_X: rb 147.windowCorner_BottomLeft_Pattern: rb 148.windowCorner_BottomLeft_Color: rb 149.windowCorner_BottomRight_Y: rb 150.windowCorner_BottomRight_X: rb 151.windowCorner_BottomRight_Pattern: rb 152.windowCorner_BottomRight_Color: rb 154.mouseButton_1: rb 155.mouseButton_2: rb 157.oldMouseButton_1: rb 158.oldMouseButton_2: rb 160.isDraggingWindow: rb 161.dragOffset_X: rb 1 62.dragOffset_Y: rb 163.isResizingWindow: rb 164.resizeWindowCorner_BottomRight_X_Min: rb 165.resizeWindowCorner_BottomRight_Y_Min: rb 167.keyboardMatrix: rb 10 69.ticksSinceLastInput: rw 1 7273.currentTime: 74.currentTime_Hours: rb 175.currentTime_Minutes: rb 176.currentTime_Seconds: rb 178.currentDate: rb 3 80.timeCounter: rb 1 8485.storeOldInterruptHook: rb 686.interruptBusy: rb 189919399.screenMapping: rb 32*24100.currentTileMouseOver: rb 1 102.nextWindow_x: rb 1103.nextWindow_y: rb 1105.mouseOver_Activated: rb 1106.mouseOver_screenMappingValue: rb 1107.mouseOver_tileToBeRestored: rb 1108.mouseOver_NAMTBL_addr: rw 1110.taskbar_Button_0_Process_addr: rw 1111.taskbar_Button_1_Process_addr: rw 1112.taskbar_Button_2_Process_addr: rw 1113.taskbar_Button_3_Process_addr: rw 1115.desktop_Tiles: rb 32 * 22117118.currentProcessAddr: rw 1 119.nextAvailableProcessAddr: rw 1121123.processes: 124 rb Process_struct.size * (MAX_PROCESS_ID + 1) 125 .process_slot_0: equ .processes + (Process_struct.size * 0)126 .process_slot_1: equ .processes + (Process_struct.size * 1)127 .process_slot_2: equ .processes + (Process_struct.size * 2)128 .process_slot_3: equ .processes + (Process_struct.size * 3)129.processes_end:130.processes_size: equ $ - .processes132134Process_struct:135.processId: rb 1 136.windowState: rb 1 137.x: rb 1138.y: rb 1139.width: rb 1140.height: rb 1141.minWidth: rb 1142.minHeight: rb 1144.windowTitle: rb 16145.taskbarTitle: rb 4146.iconTitle: rb 7147.isFixedSize: rb 1 148.vertScrollbarEnabled: rb 1 149.vertScrollbarPosition: rb 1150154159160.openAddr: rw 1161.workAddr: rw 1162.drawAddr: rw 1163.clickAddr: rw 1164.closeAddr: rw 1166.iconAddr: rw 1 168.ramSize: rw 1 177.size_Header: equ $ - Process_struct179180.ramStartAddr: rw 1181.vramStartTileAddr: rw 1183.layer: rb 1 186.previousWindowState: rb 1 188.size: equ $ - Process_struct190193PROCESS_STRUCT_IX:194.processId: equ Process_struct.processId - Process_struct195.windowState: equ Process_struct.windowState - Process_struct196.x: equ Process_struct.x - Process_struct197.y: equ Process_struct.y - Process_struct198.width: equ Process_struct.width - Process_struct199.height: equ Process_struct.height - Process_struct200.minWidth: equ Process_struct.minWidth - Process_struct201.minHeight: equ Process_struct.minHeight - Process_struct203.windowTitle: equ Process_struct.windowTitle - Process_struct204.taskbarTitle: equ Process_struct.taskbarTitle - Process_struct205.iconTitle: equ Process_struct.iconTitle - Process_struct206.isFixedSize: equ Process_struct.isFixedSize - Process_struct207.vertScrollbarEnabled: equ Process_struct.vertScrollbarEnabled - Process_struct208.vertScrollbarPosition: equ Process_struct.vertScrollbarPosition - Process_struct210.openAddr: equ Process_struct.openAddr - Process_struct211.workAddr: equ Process_struct.workAddr - Process_struct212.drawAddr: equ Process_struct.drawAddr - Process_struct213.clickAddr: equ Process_struct.clickAddr - Process_struct214.closeAddr: equ Process_struct.closeAddr - Process_struct216.iconAddr: equ Process_struct.iconAddr - Process_struct218220.layer: equ Process_struct.layer - Process_struct222.previousWindowState: equ Process_struct.previousWindowState - Process_struct224226227Temp: rb 1228TempWord: rw 1230232TempIcon: rb NUMBER_OF_TILES_PER_ICON * 8236RamEnd:System\Main.s135