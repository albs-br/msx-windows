System\Main.s1FNAME "msx-windows.rom" 3PageSize: equ 0x4000 56 org 0x40008 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11System\Main.s9 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619System\Main.s10 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2428REG0SAV: equ 0xF3DF29REG1SAV: equ 0xF3E030REG2SAV: equ 0xF3E131REG3SAV: equ 0xF3E232REG4SAV: equ 0xF3E333REG5SAV: equ 0xF3E434REG6SAV: equ 0xF3E535REG7SAV: equ 0xF3E637REG8SAV: equ 0xFFE738REG9SAV: equ 0xFFE839REG10SAV: equ 0xFFE940REG11SAV: equ 0xFFEA41REG12SAV: equ 0xFFEB42REG13SAV: equ 0xFFEC43REG14SAV: equ 0xFFED44REG15SAV: equ 0xFFEE45REG16SAV: equ 0xFFEF46REG17SAV: equ 0xFFF047REG18SAV: equ 0xFFF148REG19SAV: equ 0xFFF249REG20SAV: equ 0xFFF350REG21SAV: equ 0xFFF451REG22SAV: equ 0xFFF552REG23SAV: equ 0xFFF65456REG25SAV: equ 0xFFFA57REG26SAV: equ 0xFFFB58REG27SAV: equ 0xFFFC59System\Main.s11 Include/CommonRoutines.s1411ClearRam:12 ld hl, RamStart 13 ld de, RamEnd + 1 15.loop:16 xor a 17 ld (hl), a19 inc hl20 call BIOS_DCOMPR 21 ret z22 jp .loop2629ClearRamArea:30 xor a31.loop:32 ld (hl), a33 inc hl34 djnz .loop36 ret4044SetPaletteColor:45 push bc46 47 ld b, a 48 ld c, 16 49 call BIOS_WRTVDP50 ld c, PORT_2 51 pop de53 ld a, d 54 di55 out (c), a56 ld a, e 57 ei58 out (c), a60 ret6266SetPaletteColor_Without_DI_EI:67 push bc68 69 ld b, a 70 ld c, 16 71 call WRTVDP_without_DI_EI72 ld c, PORT_2 73 pop de75 ld a, d 77 out (c), a78 ld a, e 80 out (c), a82 ret8590SetPaletteColor_FromAddress:91 92 ld b, a 93 ld c, 16 94 call BIOS_WRTVDP95 ld c, PORT_2 97 ld a, (hl) 98 di99 out (c), a100 inc hl101 ld a, (hl) 102 ei103 out (c), a105 ret109110LoadPalette:111 112 ld b, 0 113 ld c, 16 114 call BIOS_WRTVDP115 ld c, PORT_2 117 ld b, 16118.loop:119 di120 ld a, (hl)121 out (c), a122 inc hl123 ld a, (hl)124 out (c), a125 ei126 inc hl127 djnz .loop128 129 ret133134EnableRomPage2:135137 call BIOS_RSLREG138 rrca139 rrca140 and 3 141 ld c,a142 ld b,0143 ld hl, BIOS_EXPTBL144 add hl,bc145 ld a,(hl)146 and 80h147 or c148 ld c,a149 inc hl150 inc hl151 inc hl152 inc hl153 ld a,(hl)154 and 0Ch155 or c156 ld h,080h157 call BIOS_ENASLT 159 ret162166Wait_B_Vblanks:167 168 push bc169 170 .loop:172 ld a, (BIOS_JIFFY)173 ld c, a174 .waitVBlank:175 ld a, (BIOS_JIFFY)176 cp c177 jp z, .waitVBlank179 djnz .loop180 181 pop bc183 ret185Wait_15_Vblanks:186 ld c, 15188 .loop:189 ld a, (BIOS_JIFFY)190 ld b, a191 .waitVBlank:192 ld a, (BIOS_JIFFY)193 cp b194 jp z, .waitVBlank196 dec c197 jp nz, .loop199 ret201Wait_Vblank:202.loop:203 ld a, (BIOS_JIFFY)204 ld b, a205.waitVBlank:206 ld a, (BIOS_JIFFY)207 cp b208 jp z, .waitVBlank210 ret212216SetVdp_Write:218 227 rlc h228 rla229 rlc h230 rla231 srl h232 srl h234 di235 236 out (PORT_1), a237 ld a, 14 + 128238 out (PORT_1), a240 241 ld a, l242 nop243 out (PORT_1), a244 ld a, h245 or 64246 ei247 out (PORT_1),a248 ret250254SetVdp_Read:255 rlc h256 rla257 rlc h258 rla259 srl h260 srl h261 di262 out (PORT_1), a263 ld a, 14 + 128264 out (PORT_1), a265 ld a, l266 nop267 out (PORT_1), a268 ld a, h269 ei270 out (PORT_1), a271 ret274282303 304306308310312317325333336ClearVram_MSX2:337 xor a 338 ld hl, 0 339 call SetVDP_Write341351 xor a353 357 358 ld d, 2 359.loop_2:360 ld c, 0 361.loop_1:362 ld b, 0 363.loop:364 out (PORT_0), a365 djnz .loop366 dec c367 jp nz, .loop_1368 dec d369 jp nz, .loop_2371 ret374Screen11:375 377 ld a, 8378 call BIOS_CHGMOD380 ld a, (REG25SAV)381 or 0001 1000 b382 ld (REG25SAV), a 383 ld b, a384 385 ld c, 25 386 call BIOS_WRTVDP387 ret389SetSprites16x16:390 ld a, (REG1SAV)391 or 0000 0010 b392 ld (REG1SAV), a393 ld b, a394 ld c, 1 395 call BIOS_WRTVDP396 ret398Set192Lines:399 403 ld a, (REG9SAV)404 and 0111 1111 b405 ld (REG9SAV), a406 ld b, a407 ld c, 9 408 call BIOS_WRTVDP409 ret411SetColor0ToNonTransparent:412 417 ld a, (REG8SAV)418 or 0010 0000 b419 ld b, 0010 1000 b 420 ld c, 0x08 421 call BIOS_WRTVDP422 ret424SetColor0ToTransparent:425 429 ld a, (REG8SAV)430 and 1101 1111 b431 ld (REG8SAV), a432 ld b, a433 ld c, 8 434 call BIOS_WRTVDP435 ret437DisableSprites:438 ld a, (REG8SAV)439 or 0000 0010 b440 ld b, a441 ld c, 8 442 call BIOS_WRTVDP443 ret445EnableSprites:446 ld a, (REG8SAV)447 and 1111 1101 b448 ld b, a449 ld c, 8 450 call BIOS_WRTVDP451 ret453457LDIRVM_MSX2:458 459 ex de, hl460 461 call SetVdp_Write462 ex de, hl463 ld d, c464 465 ld c, PORT_0 466 ld b, 0467.loop_1:468 otir469 dec d470 jp nz, .loop_1471 ret475481RandomNumber:482 push hl483 ld hl, (Seed)484 add hl, hl485 sbc a, a486 and 0x83487 xor l488 ld l, a489 ld (Seed), hl490 pop hl491 ret493 502 506512CheckCollision_16x16_16x16:514 ld a, d 515 sub b 516 jr c, .x1IsLarger 517 sub 16 518 ret nc 519 jp .checkVerticalCollision520.x1IsLarger:521 neg 526 527 sub 16 528 ret nc 530.checkVerticalCollision:531 ld a, e 532 sub c 533 jr c, .y1IsLarger 534 sub 16 535 ret 536.y1IsLarger:537 neg 542 543 sub 16 544 ret 548554CheckCollision_16x16_32x16:556 ld a, d 557 sub b 558 jr c, .x1IsLarger 559 sub 16 560 ret nc 561 jp .checkVerticalCollision562.x1IsLarger:563 neg 568 569 sub 32 570 ret nc 572.checkVerticalCollision:573 ld a, e 574 sub c 575 jr c, .y1IsLarger 576 sub 16 577 ret 578.y1IsLarger:579 neg 584 585 sub 16 586 ret 591597CheckCollision_8x8_16x16:599 ld a, d 600 sub b 601 jr c, .x1IsLarger 602 sub 8 603 ret nc 604 jp .checkVerticalCollision605.x1IsLarger:606 neg 611 612 sub 16 613 ret nc 615.checkVerticalCollision:616 ld a, e 617 sub c 618 jr c, .y1IsLarger 619 sub 8 620 ret 621.y1IsLarger:622 neg 627 628 sub 16 629 ret 635637643CheckCollision_Point_16x16:645 649 650 ld a, d651 cp b652 ret nc 654 ld a, b655 add 16 656 cp d657 ret nc 659 660 ld a, e661 cp c662 ret nc 664 667 ld a, e668 add 16669 ld e, a670 ld a, c671 cp e672 ret674 678 682 685 691696699709713716719724 725727734738740748 749757763770776779786792800802810817824827833835 837845850855859862873880885890893900905907913916918922926928931934937942 943946949 950955959962967 968971973 974979983987Execute_VDP_LMMM:988Execute_VDP_HMMM:989 ld a, 32 990 di991 out (PORT_1), a992 ld a, 17 + 128993 out (PORT_1), a994 ld c, 0x9B995.vdpReady:996 ld a, 2997 di998 out (PORT_1), a 999 ld a, 15 + 1281000 out (PORT_1), a1001 in a, (PORT_1)1002 rra1003 ld a, 0 1004 out (PORT_1), a1005 ld a, 15 + 1281006 ei1007 out (PORT_1), a 1008 jp c, .vdpReady1009 outi 1010 outi 1011 outi1012 outi1013 outi1014 outi1015 outi1016 outi1017 outi1018 outi1019 outi1020 outi1021 outi1022 outi1023 outi1024 ret10261030Execute_VDP_PSET:1031Execute_VDP_LINE:1032Execute_VDP_HMMV:1033 ld a, 36 1034 di1035 out (PORT_1), a1036 ld a, 17 + 1281037 out (PORT_1), a1038 ld c, 0x9B1039.vdpReady:1040 ld a, 21041 di1042 out (PORT_1), a 1043 ld a, 15 + 1281044 out (PORT_1), a1045 in a, (PORT_1)1046 rra1047 ld a, 0 1048 out (PORT_1), a1049 ld a, 15 + 1281050 ei1051 out (PORT_1), a 1052 jp c, .vdpReady1053 outi 1054 outi 1055 outi1056 outi1057 outi1058 outi1059 outi1060 outi1061 outi1062 outi1063 outi1064 ret10671070Execute_VDP_YMMM:1071 ld a, 34 1072 di1073 out (PORT_1), a1074 ld a, 17 + 1281075 out (PORT_1), a1076 ld c, 0x9B1077.vdpReady:1078 ld a, 21079 di1080 out (PORT_1), a 1081 ld a, 15 + 1281082 out (PORT_1), a1083 in a, (PORT_1)1084 rra1085 ld a, 0 1086 out (PORT_1), a1087 ld a, 15 + 1281088 ei1089 out (PORT_1), a 1090 jp c, .vdpReady1091 outi 1092 outi 1093 outi1094 outi1095 outi1096 outi1097 outi1098 outi1099 outi1100 outi1101 outi1102 outi1103 outi1104 ret1106VDP_COMMAND_HMMC: equ 1111 0000 b 1107VDP_COMMAND_YMMM: equ 1110 0000 b 1108VDP_COMMAND_HMMM: equ 1101 0000 b 1109VDP_COMMAND_HMMV: equ 1100 0000 b 11111112VDP_COMMAND_LMMC: equ 1011 0000 b 1113VDP_COMMAND_LMCM: equ 1010 0000 b 1114VDP_COMMAND_LMMM: equ 1001 0000 b 1115VDP_COMMAND_LMMV: equ 1000 0000 b 1117VDP_COMMAND_LINE: equ 0111 0000 b1118VDP_COMMAND_SRCH: equ 0110 0000 b1119VDP_COMMAND_PSET: equ 0101 0000 b1120VDP_COMMAND_POINT: equ 0100 0000 b1122VDP_COMMAND_STOP: equ 0000 0000 b11251126VDP_LOGIC_OPERATION_IMP: equ 0000 b1127VDP_LOGIC_OPERATION_AND: equ 0001 b1128VDP_LOGIC_OPERATION_OR: equ 0010 b1129VDP_LOGIC_OPERATION_XOR: equ 0011 b1130VDP_LOGIC_OPERATION_NOT: equ 0100 b1132VDP_LOGIC_OPERATION_TIMP: equ 1000 b1133VDP_LOGIC_OPERATION_TAND: equ 1001 b1134VDP_LOGIC_OPERATION_TOR: equ 1010 b1135VDP_LOGIC_OPERATION_TXOR: equ 1011 b1136VDP_LOGIC_OPERATION_TNOT: equ 1100 b11411145ReadStatusReg:11461147 ld a,(0007h) 1148 inc a1149 ld c,a 1151 out (c),b1152 ld a,080h+151153 out (c),a11541155 1156 ld a,(0006h) 1157 inc a1158 ld c,a 1159 in b,(c) 1160 11611162 ld a,(0007h) 1163 inc a1164 ld c,a 1165 xor a1166 out (c),a1167 ld a,080h+151168 out (c),a1169 1171 ret11741175WRTVDP_without_DI_EI:1176 ld a, b1177 1178 out (PORT_1),a1179 ld a, c1180 or 1281181 1183 out (PORT_1), a1184 ret11881191SNSMAT_NO_DI_EI:1192 ld c, a1193.C_OK:11941195 in a, (PPI.C)1196 and 0xf0 1197 or c11981199 out (PPI.C), a1200 in a, (PPI.B)1201 ret120412071209JP_HL:1210 jp (hl)1211JP_BC:1212 push bc1213 ret1214JP_DE:1215 push de1216 ret1217JP_IX:1218 jp (ix)1219JP_IY:1220 jp (iy)1221JP_HL_S:1222 exx1223 push hl1224 exx1225 ret1226JP_BC_S:1227 exx1228 push bc1229 exx1230 ret1231JP_DE_S:1232 exx1233 push de1234 exx1235 ret12381240Fast_LDIR_Multiples_of_16:12411242.loop:1243 ldi 1244 ldi1245 ldi1246 ldi1247 ldi1248 ldi1249 ldi1250 ldi1251 ldi1252 ldi1253 ldi1254 ldi1255 ldi1256 ldi1257 ldi1258 ldi1259 jp pe, .loop System\Main.s1314 System/Constants.s134SCREEN_MAPPING_DESKTOP: equ 2555SCREEN_MAPPING_TASKBAR: equ 2546 7SCREEN_MAPPING_WINDOWS: equ 0000 0000 b8SCREEN_MAPPING_WINDOWS_TITLE_BAR: equ 0001 0000 b9SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON: equ 0010 0000 b10SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON: equ 0011 0000 b11SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON: equ 0100 0000 b12SCREEN_MAPPING_WINDOWS_RESIZE_CORNER: equ 0101 0000 b15WINDOW_STATE:16.MINIMIZED: equ 117.RESTORED: equ 218.MAXIMIZED: equ 321MOUSE_ON_JOYPORT_1: equ 0x131022MOUSE_ON_JOYPORT_2: equ 0x6C2024MOUSE_PORT: equ MOUSE_ON_JOYPORT_126MOUSE_DOUBLE_CLICK_INTERVAL: equ 30 System\Main.s15 System/Interrupt.s1_INIT_INTERRUPT:3 4 xor a5 ld (os.interruptBusy), a7 ld hl, .storeOldInterruptHook_init8 ld de, os.storeOldInterruptHook9 ld bc, 610 ldir12 ld hl, BIOS_H_TIMI13 ld de, os.storeOldInterruptHook14 ld bc, 515 ldir17 ld hl, INTERRUPT18 ld de, BIOS_H_TIMI19 ld bc, 320 ldir22 ret26.storeOldInterruptHook_init:27 db 0, 0, 0, 0, 028 db 0xc9 30INTERRUPT:31 32 jp HANDLER33 34HANDLER:35 36 ld a, (os.interruptBusy)37 and a38 ret nz39 ld a, 25540 ld (os.interruptBusy), a42 43 call _UPDATE_SYSTEM_TIME44 45 46 ld hl, (OS.ticksSinceLastInput)47 inc hl48 ld (OS.ticksSinceLastInput), hl50 55 58 ld de, MOUSE_PORT59 call GTMOUS60 61 ld a, h62 cp 25563 jp nz, .skip64 cp l65 call z, .noMouse67.skip:69 70 ld a, ixh71 ld (OS.mouseButton_1), a72 ld a, ixl73 ld (OS.mouseButton_2), a76 80 81 ld a, h82 neg83 ld h, a85 86 ld a, l87 neg88 ld l, a90 91 xor a92 or ixh 93 or ixl 94 or h 95 or l 96 jp z, .skip_197 ld de, 098 ld (OS.ticksSinceLastInput), de99.skip_1:100 101 ld e, h 102 ld d, l 103 ld a, (os.mouseX)104 ld l, a 105 ld a, (os.mouseY)106 ld h, a 107 call CLIPADD108 109 ld a, l110 ld (os.mouseX), a111 ld (os.mouseX_1), a112 ld a, h113 ld (os.mouseY), a114 ld (OS.mouseY_1), a116 xor a117 ld (os.interruptBusy), a119 jp os.storeOldInterruptHook121122.noMouse:123 124 ret126131 132System\Main.s16 System/Init/Init.s1 System/Init/InitVdp.s12NAMTBL: equ 0x1800 3PATTBL: equ 0x0000 4COLTBL: equ 0x2000 5SPRPAT: equ 0x3800 6SPRATR: equ 0x1b00 9_INIT_VDP:12 13 ld a, 15 14 ld (BIOS_FORCLR), a 15 ld a, 1 16 ld (BIOS_BAKCLR), a 17 ld a, 4 18 ld (BIOS_BDRCLR), a 19 call BIOS_CHGCLR 21 22 ld a, 223 call BIOS_CHGMOD25 call SetSprites16x1627 call BIOS_DISSCR29 30 32 33 xor a 34 ld bc, 1024 * 16 35 ld hl, 0x0000 36 call BIOS_FILVRM38 39 ld hl, TILE_PATTERNS 40 ld de, PATTBL 41 ld bc, TILE_PATTERNS.size 42 call BIOS_LDIRVM 44 ld hl, TILE_PATTERNS 45 ld de, PATTBL + (256 * 8) 46 ld bc, TILE_PATTERNS.size 47 call BIOS_LDIRVM 49 ld hl, TILE_PATTERNS 50 ld de, PATTBL + (512 * 8) 51 ld bc, TILE_PATTERNS.size 52 call BIOS_LDIRVM 54 55 ld a, 0x1f 56 ld bc, 256 * 8 * 3 57 ld hl, COLTBL 58 call BIOS_FILVRM60 61 ld a, 0xf1 62 ld bc, TILE_FONT_REVERSED_PATTERNS.size 63 ld hl, COLTBL + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 64 call BIOS_FILVRM65 66 ld a, 0xf1 67 ld bc, TILE_FONT_REVERSED_PATTERNS.size 68 ld hl, COLTBL + (256 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 69 call BIOS_FILVRM70 71 ld a, 0xf1 72 ld bc, TILE_FONT_REVERSED_PATTERNS.size 73 ld hl, COLTBL + (512 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 74 call BIOS_FILVRM76 77 ld hl, COLTBL + (TILE_FILLED_COLORS_PATTERNS - TILE_PATTERNS) 78 call .fillTileColor81 82 ld hl, COLTBL + (256 * 8) + (TILE_FILLED_COLORS_PATTERNS - TILE_PATTERNS) 83 call .fillTileColor85 86 ld hl, COLTBL + (512 * 8) + (TILE_FILLED_COLORS_PATTERNS - TILE_PATTERNS) 87 call .fillTileColor90 96 113 114 ld hl, SPRITE_PATTERNS 115 ld de, SPRPAT 116 ld bc, SPRITE_PATTERNS.size 117 call BIOS_LDIRVM 119 125 call BIOS_ENASCR127 ret129.fillTileColor:130 ld d, 2131.loop_Colors:132 push hl, de133 134 sla d 135 sla d 136 sla d 137 sla d 139 ld a, 0000 0001 b140 or d142 ld bc, 8143 call BIOS_FILVRM144 pop de, hl146 ld bc, 8147 add hl, bc149 inc d150 ld a, d151 cp 15152 jp nz, .loop_Colors154 ret156163164NAMTBL_TEST:165 db TILE_EMPTY166 db TILE_EMPTY167 db TILE_WINDOW_TITLE_TOP_LEFT168 db TILE_WINDOW_TITLE_MIDDLE_TOP169 db TILE_WINDOW_TITLE_MIDDLE_TOP170 db TILE_WINDOW_TITLE_MIDDLE_TOP171 db TILE_WINDOW_TITLE_MIDDLE_TOP172 db TILE_WINDOW_TOP_RIGHT_CORNER_TOP173 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0175 db TILE_EMPTY176 db TILE_EMPTY177 db TILE_WINDOW_TITLE_BOTTOM_LEFT178 db TILE_WINDOW_TITLE_MIDDLE_BOTTOM179 db TILE_WINDOW_MINIMIZE_BUTTON180 db TILE_WINDOW_MAXIMIZE_BUTTON181 db TILE_WINDOW_CLOSE_BUTTON182 db TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM183 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0185 db TILE_EMPTY186 db TILE_EMPTY187 db TILE_WINDOW_BORDER_LEFT188 db TILE_FONT_LOWERCASE_A + 0189 db TILE_FONT_LOWERCASE_A + 25190 db TILE_FONT_NUMBERS_0 + 0191 db TILE_FONT_NUMBERS_0 + 9192 db TILE_WINDOW_BORDER_RIGHT193 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0195 db TILE_EMPTY196 db TILE_EMPTY197 db TILE_WINDOW_BORDER_LEFT198 db TILE_FONT_UPPERCASE_A + 0199 db TILE_FONT_UPPERCASE_A + 25200 db TILE_FONT_REVERSED_SYMBOLS + 0201 db TILE_EMPTY202 db TILE_WINDOW_BORDER_RIGHT203 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0205 db TILE_EMPTY206 db TILE_EMPTY207 db TILE_WINDOW_BORDER_LEFT208 210 db TILE_FONT_REVERSED_LOWERCASE_A + 0211 db TILE_FONT_REVERSED_LOWERCASE_A + 25212 db TILE_FONT_REVERSED_NUMBERS_0 + 0213 db TILE_FONT_REVERSED_NUMBERS_0 + 9214 db TILE_WINDOW_RESIZE_CORNER_TOP215 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0217 db TILE_EMPTY218 db TILE_EMPTY219 db TILE_WINDOW_BORDER_BOTTOM_LEFT220 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM221 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM222 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM223 db TILE_WINDOW_RESIZE_CORNER_LEFT224 db TILE_WINDOW_RESIZE_CORNER_RIGHT225 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0227 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0229.size: equ $ - NAMTBL_TEST232237System/Init/Init.s2 System/Init/InitRam.s1_INIT_RAM:3 5 xor a6 ld (RamStart), a7 ld hl, RamStart8 ld de, RamStart + 19 ld bc, RamEnd - RamStart - 110 ldir12 13 ld a, 0xff14 ld (OS.processes), a15 ld hl, OS.processes16 ld de, OS.processes + 117 ld bc, OS.processes_size - 118 ldir19 20 21 ld hl, OS.processes22 ld (OS.nextAvailableProcessAddr), hl24 25 ld hl, 026 ld (OS.currentProcessAddr), hl28 29 ld a, 128 - 830 ld (OS.mouseY), a31 ld (OS.mouseY_1), a32 ld a, 96 - 833 ld (OS.mouseX), a34 ld (OS.mouseX_1), a35 ld a, SPRITE_INDEX_CURSOR_036 ld (OS.mousePattern), a37 ld a, SPRITE_INDEX_CURSOR_138 ld (OS.mousePattern_1), a39 ld a, 1 40 ld (OS.mouseColor), a41 ld a, 15 42 ld (OS.mouseColor_1), a44 xor a45 ld (OS.mouseButton_1), a46 ld (OS.mouseButton_2), a47 ld (OS.oldMouseButton_1), a48 ld (OS.oldMouseButton_2), a49 ld (OS.isDoubleClick), a50 51 ld (OS.isDraggingWindow), a52 ld (OS.dragOffset_X), a53 ld (OS.dragOffset_Y), a54 ld (OS.isResizingWindow), a55 ld (OS.resizeWindowCorner_BottomRight_X_Min), a56 ld (OS.resizeWindowCorner_BottomRight_Y_Min), a58 ld hl, 059 ld (OS.mouseLastClick_Jiffy), hl61 62 ld a, SPRITE_INDEX_WINDOW_TOP_LEFT63 ld (OS.windowCorner_TopLeft_Pattern), a64 ld a, SPRITE_INDEX_WINDOW_BOTTOM_LEFT65 ld (OS.windowCorner_BottomLeft_Pattern), a66 ld a, SPRITE_INDEX_WINDOW_TOP_RIGHT67 ld (OS.windowCorner_TopRight_Pattern), a68 ld a, SPRITE_INDEX_WINDOW_BOTTOM_RIGHT69 ld (OS.windowCorner_BottomRight_Pattern), a71 ld a, 15 72 ld (OS.windowCorner_TopLeft_Color), a73 ld (OS.windowCorner_BottomLeft_Color), a74 ld (OS.windowCorner_TopRight_Color), a75 ld (OS.windowCorner_BottomRight_Color), a77 78 ld a, 1111 1111 b79 ld (OS.oldKeyboardMatrix + 0), a80 ld (OS.oldKeyboardMatrix + 1), a81 ld (OS.oldKeyboardMatrix + 2), a82 ld (OS.oldKeyboardMatrix + 3), a83 ld (OS.oldKeyboardMatrix + 4), a84 ld (OS.oldKeyboardMatrix + 5), a85 ld (OS.oldKeyboardMatrix + 6), a86 ld (OS.oldKeyboardMatrix + 7), a87 ld (OS.oldKeyboardMatrix + 8), a88 ld (OS.oldKeyboardMatrix + 9), a91 92 ld a, 093 ld (OS.nextWindow_x), a94 ld a, 095 ld (OS.nextWindow_y), a97 xor a98 ld (OS.mouseOver_Activated), a99 ld (OS.mouseOver_screenMappingValue), a100 ld (OS.mouseOver_tileToBeRestored), a101 ld hl, 0102 ld (OS.mouseOver_NAMTBL_addr), a106 call _INIT_SCREEN_MAPPING110 ret113System/Init/Init.s7_INIT:9 10 xor a11 ld (BIOS_CLIKSW), a13 call _INIT_VDP15 call _INIT_RAM17 call _INIT_SYSTEM_TIME19 call _INIT_INTERRUPT21 call _INIT_DESKTOP25 28 call _DRAW_DESKTOP29 call _DRAW_TASKBAR31 ret34System\Main.s17 System/Desktop/Desktop.s1 System/Desktop/Taskbar.s1810_DRAW_TASKBAR:12 13 ld hl, TASKBAR_INIT 14 ld de, NAMTBL + (32 * 22) 15 ld bc, 64 16 call BIOS_LDIRVM 20 call _DRAW_TASKBAR_BUTTONS23 call _DRAW_TASKBAR_CLOCK26 ret30_DRAW_TASKBAR_BUTTONS:32 ld iy, NAMTBL + (32 * 23) + 534 35 ld hl, 0xffff36 ld (OS.taskbar_Button_0_Process_addr), hl37 ld (OS.taskbar_Button_1_Process_addr), hl38 ld (OS.taskbar_Button_2_Process_addr), hl39 ld (OS.taskbar_Button_3_Process_addr), hl41 ld hl, OS.taskbar_Button_0_Process_addr42 ld (TempWord), hl44 45 ld hl, OS.processes46 ld b, MAX_PROCESS_ID + 147.loop_1:48 ld a, (hl)49 inc a50 jp z, .next 52 55 push hl 56 pop ix58 59 push de60 ld de, (TempWord)62 ld a, l63 ld (de), a64 inc de65 ld a, h66 ld (de), a67 inc de69 ld (TempWord), de70 pop de72 push hl, bc73 74 ld bc, PROCESS_STRUCT_IX.taskbarTitle75 add hl, bc77 push hl 78 pop de80 push iy 81 pop hl82 call BIOS_SETWRT84 ld c, 4 86 .loop_2:87 91 push de93 ld de, (OS.currentProcessAddr)94 95 push ix 96 pop hl98 call BIOS_DCOMPR100 pop de102 jp nz, .printNormal104 105 ld a, (de)106 107 cp TILE_EMPTY_BLACK108 jp z, .printTileWhite109 110 add TILE_FONT_LOWERCASE_A - TILE_FONT_REVERSED_LOWERCASE_A111 jp .continue_2112 113 .printTileWhite:114 ld a, TILE_EMPTY115 jp .continue_2116 117 .printNormal:118 ld a, (de)119 .continue_2:120 out (PORT_0), a122 dec c123 jp z, .end_1125 inc de126 jp .loop_2128 .end_1:129 130 ld bc, 5131 add iy, bc 133 pop bc, hl137.next:138 ld de, Process_struct.size139 add hl, de141 djnz .loop_1143 ret147148_DRAW_TASKBAR_CLOCK:150 151 ld hl, NAMTBL + (32 * 23) + 26 152 call BIOS_SETWRT153 ld c, PORT_0156 ld b, TILE_FONT_REVERSED_NUMBERS_0158 159 ld a, (OS.currentTime_Hours)160 srl a 161 srl a 162 srl a 163 srl a 164 or a165 jp z, .skipTensOfHours 166 add b 167 jp .continue168.skipTensOfHours:169 ld a, TILE_EMPTY_BLACK170.continue:171 out (c), a173 174 ld a, (OS.currentTime_Hours)175 and 0000 1111 b176 add b 177 out (c), a179 180 nop181 nop182 ld a, TILE_FONT_REVERSED_SYMBOLS + 0 183 out (c), a185 186 ld a, (OS.currentTime_Minutes)187 srl a 188 srl a 189 srl a 190 srl a 191 add b 192 out (c), a193 194 195 ld a, (OS.currentTime_Minutes)196 and 0000 1111 b197 add b 198 out (c), a200 ret204TASKBAR_INIT:205 206 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP207 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP208 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP209 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP210 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP211 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP212 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP213 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP215 216 db TILE_EMPTY_BLACK, TILE_HOME_ICON, TILE_EMPTY_BLACK217 218 db TILE_SHOW_DESKTOP_ICON, TILE_EMPTY_BLACK220 db TILE_EMPTY_BLACK221 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK222 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK223 231 232 db TILE_EMPTY_BLACK233 234 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK235 239 240 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK241 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK242 243 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK244 245 249 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK250 251 db TILE_EMPTY_BLACK252System/Desktop/Desktop.s4_INIT_DESKTOP:5 6 ld ix, Notepad.Header7 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_0 * 8) 8 call _LOAD_ICON_FROM_APP_HEADER9 11 ld ix, Calc.Header12 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_1 * 8) 13 call _LOAD_ICON_FROM_APP_HEADER14 16 ld ix, Paint.Header17 ld de, PATTBL + (256 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 18 call _LOAD_ICON_FROM_APP_HEADER20 ld ix, Settings.Header21 ld de, PATTBL + (512 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 22 call _LOAD_ICON_FROM_APP_HEADER24 26 27 ld a, TILE_EMPTY28 ld (OS.desktop_Tiles), a29 ld hl, OS.desktop_Tiles30 ld de, OS.desktop_Tiles + 131 ld bc, 0 + (32 * 22) - 132 ldir35 43 49 52 56 60 64 65 ld ix, Notepad.Header66 ld a, TILE_BASE_DESKTOP_ICON_067 ld hl, OS.desktop_Tiles68 call _DRAW_DESKTOP_ICON70 71 ld ix, Calc.Header72 ld a, TILE_BASE_DESKTOP_ICON_173 ld hl, OS.desktop_Tiles + 874 call _DRAW_DESKTOP_ICON78 79 ld ix, Paint.Header80 ld a, TILE_BASE_DESKTOP_ICON_081 ld hl, OS.desktop_Tiles + (256)82 call _DRAW_DESKTOP_ICON86 87 ld ix, Settings.Header88 ld a, TILE_BASE_DESKTOP_ICON_089 ld hl, OS.desktop_Tiles + (512)90 call _DRAW_DESKTOP_ICON92 ret96101_LOAD_ICON_FROM_APP_HEADER:103 104 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)105 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)107 109 ld bc, NUMBER_OF_TILES_PER_ICON * 8 110 call BIOS_LDIRVM112 ret116121_LOAD_ICON_INVERTED_FROM_APP_HEADER:123 push de124 125 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)126 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)128 129 ld de, TempIcon130 ld bc, NUMBER_OF_TILES_PER_ICON * 8 131 ldir133 ld hl, TempIcon134 ld b, NUMBER_OF_TILES_PER_ICON * 8135 .loop_100:136 ld a, (hl)137 cpl 138 ld (hl), a139 inc hl140 djnz .loop_100142 143 ld hl, TempIcon144 ld de, ICON_BORDERS_FILLED_OR_MASK145 ld b, NUMBER_OF_TILES_PER_ICON * 8146 .loop_200:147 ld a, (hl)148 ld c, a149 ld a, (de)150 or c151 ld (hl), a152 inc hl153 inc de154 djnz .loop_200155 156 158 pop de160 ld hl, TempIcon 162 ld bc, NUMBER_OF_TILES_PER_ICON * 8 163 call BIOS_LDIRVM165 ret169_DRAW_DESKTOP_ICON:170 push hl171 ld de, 0 + (32 * 1) + 3172 add hl, de173 174 175 ld de, 32177 ld b, 3178 .loop_1:179 push hl180 ld (hl), a181 182 inc a183 add hl, de184 ld (hl), a186 inc a187 add hl, de188 ld (hl), a190 inc a191 pop hl192 inc hl194 djnz .loop_1195 pop hl197 198 ld de, 0 + (32 * 4) + 1199 add hl, de200 ld b, 7 201.loop_10:202 ld a, (ix + PROCESS_STRUCT_IX.iconTitle)203 204 ld (hl), a205 inc ix206 inc hl207 djnz .loop_10210 ret214_DRAW_DESKTOP_ICON_NAME_REVERSED:215 216 ld de, 0 + (32 * 4) + 1217 add hl, de218 ld b, 7 219.loop_10:220 ld a, (ix + PROCESS_STRUCT_IX.iconTitle)221 cp TILE_EMPTY222 jp z, .cont_1224227228 sub TILE_FONT_LOWERCASE_A - TILE_FONT_REVERSED_LOWERCASE_A 229.cont_1:230 ld (hl), a231 inc ix232 inc hl233 djnz .loop_10235 ret239_DRAW_DESKTOP:241252 ld hl, NAMTBL253 call BIOS_SETWRT254 ld hl, OS.desktop_Tiles255 ld c, PORT_0257 ld d, 22 258.outerLoop:259 ld b, 32 260 .innerLoop:261 outi262 jp nz, .innerLoop 264 dec d265 jp nz, .outerLoop267 ret270ICON_BORDERS_FILLED_OR_MASK:271 db 11111111 b272 db 10000000 b273 db 10000000 b274 db 10000000 b275 db 10000000 b276 db 10000000 b277 db 10000000 b278 db 10000000 b280 db 10000000 b281 db 10000000 b282 db 10000000 b283 db 10000000 b284 db 10000000 b285 db 10000000 b286 db 10000000 b287 db 10000000 b289 db 10000000 b290 db 10000000 b291 db 10000000 b292 db 10000000 b293 db 10000000 b294 db 10000000 b295 db 10000000 b296 db 11111111 b298 db 11111111 b299 db 00000000 b300 db 00000000 b301 db 00000000 b302 db 00000000 b303 db 00000000 b304 db 00000000 b305 db 00000000 b307 db 00000000 b308 db 00000000 b309 db 00000000 b310 db 00000000 b311 db 00000000 b312 db 00000000 b313 db 00000000 b314 db 00000000 b316 db 00000000 b317 db 00000000 b318 db 00000000 b319 db 00000000 b320 db 00000000 b321 db 00000000 b322 db 00000000 b323 db 11111111 b326 db 11111111 b327 db 00000001 b328 db 00000001 b329 db 00000001 b330 db 00000001 b331 db 00000001 b332 db 00000001 b333 db 00000001 b335 db 00000001 b336 db 00000001 b337 db 00000001 b338 db 00000001 b339 db 00000001 b340 db 00000001 b341 db 00000001 b342 db 00000001 b344 db 00000001 b345 db 00000001 b346 db 00000001 b347 db 00000001 b348 db 00000001 b349 db 00000001 b350 db 00000001 b351 db 11111111 b352System\Main.s18 System/Window/Window.s1 System/Window/DrawWindow.s13_DRAW_WINDOW:5 7 8 ld a, (ix + PROCESS_STRUCT_IX.windowState) 9 cp WINDOW_STATE.MINIMIZED10 ret z12 13 cp WINDOW_STATE.MAXIMIZED14 jp z, _DRAW_WINDOW_MAXIMIZED15 16 17 ld l, (ix + PROCESS_STRUCT_IX.x) 18 ld h, (ix + PROCESS_STRUCT_IX.y) 19 20 call _CONVERT_COL_LINE_TO_LINEAR21 22 27 28 ld bc, NAMTBL29 add hl, bc33 34 38 40 push hl41 call BIOS_SETWRT42 43 ld a, TILE_WINDOW_TITLE_TOP_LEFT44 out (PORT_0), a46 ld a, (ix + PROCESS_STRUCT_IX.width) 47 sub 2 48 ld b, a49 .loop_1: 50 ld a, TILE_WINDOW_TITLE_MIDDLE_TOP51 out (PORT_0), a52 djnz .loop_154 nop55 nop56 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_TOP57 out (PORT_0), a58 pop hl59 60 61 ld de, 3262 add hl, de63 64 push hl65 call BIOS_SETWRT66 ld a, TILE_WINDOW_TITLE_BOTTOM_LEFT67 out (PORT_0), a68 69 ld a, (ix + PROCESS_STRUCT_IX.width) 70 sub 5 71 ld b, a72 .loop_2:73 ld a, TILE_WINDOW_TITLE_MIDDLE_BOTTOM74 out (PORT_0), a75 djnz .loop_277 nop78 nop79 ld a, TILE_WINDOW_MINIMIZE_BUTTON80 out (PORT_0), a82 nop83 nop84 ld a, TILE_WINDOW_MAXIMIZE_BUTTON85 out (PORT_0), a87 nop88 nop89 ld a, TILE_WINDOW_CLOSE_BUTTON90 out (PORT_0), a92 nop93 nop94 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM95 out (PORT_0), a96 pop hl98 99 push hl, ix100 inc hl101 call BIOS_SETWRT102 103 ld b, 16 104 .loop_10:105 ld a, (ix + PROCESS_STRUCT_IX.windowTitle) 106 or a 107 jp z, .endLoop_10108 out (PORT_0), a109 inc ix110 djnz .loop_10111 .endLoop_10:112 pop ix, hl114 116 ld a, (ix + PROCESS_STRUCT_IX.height) 117 sub 4 118 ld b, a119.loop_height:120 push bc122 ld de, 32123 add hl, de124 125 push hl126 call BIOS_SETWRT127 ld a, TILE_WINDOW_BORDER_LEFT128 out (PORT_0), a130 ld a, (ix + PROCESS_STRUCT_IX.width) 131 sub 2 132 ld b, a133 .loop_3:134 ld a, TILE_EMPTY135 out (PORT_0), a136 djnz .loop_3138 nop139 nop140 ld a, TILE_WINDOW_BORDER_RIGHT141 out (PORT_0), a142 pop hl144 pop bc145 djnz .loop_height147 149 150 ld de, 32151 add hl, de152 153 push hl154 call BIOS_SETWRT155 ld a, TILE_WINDOW_BORDER_LEFT156 out (PORT_0), a157 158 ld a, (ix + PROCESS_STRUCT_IX.width) 159 sub 2 160 ld b, a161 .loop_4:162 ld a, TILE_EMPTY163 out (PORT_0), a164 djnz .loop_4166 nop167 nop168 ld a, TILE_WINDOW_RESIZE_CORNER_TOP169 out (PORT_0), a170 pop hl172 173 ld de, 32174 add hl, de175 176 push hl177 call BIOS_SETWRT178 ld a, TILE_WINDOW_BORDER_BOTTOM_LEFT179 out (PORT_0), a180 181 ld a, (ix + PROCESS_STRUCT_IX.width) 182 sub 3 183 ld b, a184 .loop_5:185 ld a, TILE_WINDOW_BORDER_MIDDLE_BOTTOM186 out (PORT_0), a187 djnz .loop_5189 nop190 nop191 ld a, TILE_WINDOW_RESIZE_CORNER_LEFT192 out (PORT_0), a194 nop195 nop196 ld a, TILE_WINDOW_RESIZE_CORNER_RIGHT197 out (PORT_0), a198 pop hl200 204 206 ld e, (ix + PROCESS_STRUCT_IX.drawAddr) 207 ld d, (ix + PROCESS_STRUCT_IX.drawAddr + 1) 208 call JP_DE212 ret216_DRAW_WINDOW_MAXIMIZED:217 ld hl, NAMTBL219 220 push hl221 call BIOS_SETWRT222 223 ld a, 32 - 3 224 ld b, a225 .loop_2:226 ld a, TILE_WINDOW_TITLE_MIDDLE_BOTTOM227 out (PORT_0), a228 djnz .loop_2230 nop231 nop232 ld a, TILE_WINDOW_MINIMIZE_BUTTON233 out (PORT_0), a235 nop236 nop237 ld a, TILE_WINDOW_MAXIMIZE_BUTTON238 out (PORT_0), a240 nop241 nop242 ld a, TILE_WINDOW_CLOSE_BUTTON243 out (PORT_0), a244 pop hl246 247 push hl, ix248 inc hl249 call BIOS_SETWRT250 251 ld b, 16 252 .loop_10:253 ld a, (ix + PROCESS_STRUCT_IX.windowTitle) 254 or a 255 jp z, .endLoop_10256 out (PORT_0), a257 inc ix258 djnz .loop_10259 .endLoop_10:260 pop ix, hl263 264 ld bc, 32265 add hl, bc266 call BIOS_SETWRT268 ld a, TILE_EMPTY269 ld c, PORT_0271 ld d, 21 272.outerLoop:273 ld b, 32 274 .innerLoop:275 out (c), a276 nop277 djnz .innerLoop278 dec d279 jp nz, .outerLoop282 286 288 ld e, (ix + PROCESS_STRUCT_IX.drawAddr) 289 ld d, (ix + PROCESS_STRUCT_IX.drawAddr + 1) 290 call JP_DE294 ret298301_DRAW_STRING:302 303 call BIOS_SETWRT304 305.loop:306 ld a, (de)307 or a308 ret z 310 314 315 316 cp 32317 jp z, .setTileEmpty319 320 add -65 + TILE_FONT_UPPERCASE_A 323.continue:324 out (PORT_0), a326 inc de328 jp .loop330.setTileEmpty:331 ld a, TILE_EMPTY332 jp .continue334System/Window/Window.s2 System/Window/CloseWindow.s13_CLOSE_WINDOW:5 10 12 retSystem/Window/Window.s3 System/Window/ScreenMapping.s14_UPDATE_SCREEN:6 12 16 call Wait_Vblank18 call _DRAW_DESKTOP22 23 call _INIT_SCREEN_MAPPING25 28 ld c, 0 29 ld de, Process_struct.size31.outerLoop:32 ld hl, OS.processes + PROCESS_STRUCT_IX.layer 34 ld b, MAX_PROCESS_ID + 135 .innerLoop:36 37 ld a, (hl)38 cp c39 push hl, de, bc40 call z, .execute41 pop bc, de, hl43 ld de, Process_struct.size44 add hl, de46 djnz .innerLoop48 inc c49 ld a, c50 cp MAX_PROCESS_ID + 151 ret z53 jp .outerLoop55 57.execute:59 60 ld de, PROCESS_STRUCT_IX.layer61 xor a 62 sbc hl, de64 65 push hl66 pop ix68 69 ld l, (ix + PROCESS_STRUCT_IX.x) 70 ld h, (ix + PROCESS_STRUCT_IX.y) 71 72 push ix73 call _CONVERT_COL_LINE_TO_LINEAR74 pop ix76 call _UPDATE_SCREEN_MAPPING_WINDOW78 call _DRAW_WINDOW80 ret8487_UPDATE_SCREEN_MAPPING_WINDOW:89 90 ld a, (ix + PROCESS_STRUCT_IX.windowState) 91 cp WINDOW_STATE.MINIMIZED92 ret z94 95 cp WINDOW_STATE.MAXIMIZED96 jp z, _UPDATE_SCREEN_MAPPING_WINDOW_MAXIMIZED98 99 ex de, hl100 ld hl, OS.screenMapping101 add hl, de102 103 ld de, 32 105 106 push hl107 ld c, (ix + PROCESS_STRUCT_IX.height) 108 .outerLoop_1:109 push hl110 ld b, (ix + PROCESS_STRUCT_IX.width) 111 .loop_20:112 113 114 ld a, (ix + PROCESS_STRUCT_IX.processId)115 or SCREEN_MAPPING_WINDOWS116 117 ld (hl), a118 inc hl119 djnz .loop_20120 pop hl122 add hl, de123 dec c124 jp nz, .outerLoop_1125 pop hl127 128 ld a, (ix + PROCESS_STRUCT_IX.processId)129 or SCREEN_MAPPING_WINDOWS_TITLE_BAR130 ld c, a132 133 push hl134 ld b, (ix + PROCESS_STRUCT_IX.width) 135 .loop_21:136 ld (hl), c137 inc hl138 djnz .loop_21139 pop hl140 141 add hl, de 142 push hl143 ld a, (ix + PROCESS_STRUCT_IX.width) 144 sub 4 145 ld b, a146 .loop_22:147 ld (hl), c148 inc hl149 djnz .loop_22151 ld a, (ix + PROCESS_STRUCT_IX.processId)152 or SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON153 ld (hl), a154 inc hl156 ld a, (ix + PROCESS_STRUCT_IX.processId)157 or SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON158 ld (hl), a159 inc hl161 ld a, (ix + PROCESS_STRUCT_IX.processId)162 or SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON163 ld (hl), a164 inc hl166 pop hl168 170 171 ld a, (ix + PROCESS_STRUCT_IX.x)172 ld l, (ix + PROCESS_STRUCT_IX.width)173 dec l174 add l175 ld l, a177 178 ld a, (ix + PROCESS_STRUCT_IX.y)179 ld h, (ix + PROCESS_STRUCT_IX.height)180 dec h181 add h182 ld h, a183 call _CONVERT_COL_LINE_TO_LINEAR184 185 ld de, OS.screenMapping186 add hl, de188 push hl 189 pop iy191 ld a, (ix + PROCESS_STRUCT_IX.processId)192 or SCREEN_MAPPING_WINDOWS_RESIZE_CORNER193 194 195 ld (iy), a196 ld (iy - 1), a197 ld (iy - 32), a198 ld (iy - 33), a200 ret204_UPDATE_SCREEN_MAPPING_WINDOW_MAXIMIZED:206 207 ld hl, OS.screenMapping208 209 push hl210 211 ld a, (ix + PROCESS_STRUCT_IX.processId)212 or SCREEN_MAPPING_WINDOWS214 ld (hl), a215 ld de, OS.screenMapping + 1216 ld bc, 0 + (32 * 22) - 1217 ldir218 pop hl222 223 ld a, (ix + PROCESS_STRUCT_IX.processId)224 or SCREEN_MAPPING_WINDOWS_TITLE_BAR226 228 ld b, 32 - 3 229 .loop_21:230 ld (hl), a231 inc hl232 djnz .loop_21233 236 ld a, (ix + PROCESS_STRUCT_IX.processId)237 or SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON238 ld (hl), a239 inc hl241 ld a, (ix + PROCESS_STRUCT_IX.processId)242 or SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON243 ld (hl), a244 inc hl246 ld a, (ix + PROCESS_STRUCT_IX.processId)247 or SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON248 ld (hl), a249 252 ret256257_INIT_SCREEN_MAPPING:259 260 ld hl, OS.screenMapping261 push hl 262 pop de263 inc de264 ld bc, 0 + (32 * 22) - 1 265 ld a, SCREEN_MAPPING_DESKTOP 266 ld (hl), a267 ldir269274 275276 277283 ld a, SCREEN_MAPPING_TASKBAR 284 ld b, 32 * 2 285.loop_2:286 ld (hl), a287 inc hl288 djnz .loop_2291 retSystem/Window/Window.s4 System/Window/DrawOnWindowUsefulArea.s17DRAW_ON_WINDOW_USEFUL_AREA:9 ld iyh, 0 11.outerLoop:13 ld a, (ix + PROCESS_STRUCT_IX.windowState)14 cp WINDOW_STATE.RESTORED15 jp z, .isRestored17 18 ld a, 23 - 1 19 jp .checkHeight21 .isRestored:22 23 ld a, (ix + PROCESS_STRUCT_IX.height)24 sub 3 26 .checkHeight:27 cp iyh28 ret z 29 ret c 31 push bc, hl, de33 ex de, hl 34 35 push hl, de36 call BIOS_SETWRT37 pop hl, de 39 ld c, PORT_040 .innerLoop:41 42 outi43 jp nz, .innerLoop 45 pop de47 48 ex de, hl49 ld bc, 3250 add hl, bc51 ex de, hl53 pop hl54 pop bc56 57 ld c, b58 ld b, 059 add hl, bc60 ld b, c62 inc iyh 64 dec iyl 65 jp nz, .outerLoop67 retSystem/Window/Window.s814_CONVERT_COL_LINE_TO_LINEAR:15 16 27 xor a 29 srl h 30 rra 31 srl h32 rra33 srl h34 rra36 or l 37 ld l, a39 ret4247GET_USEFUL_WINDOW_BASE_NAMTBL:49 50 ld a, (ix + PROCESS_STRUCT_IX.windowState)51 cp WINDOW_STATE.MAXIMIZED52 jp z, .isMaximized54 55 ld l, (ix + PROCESS_STRUCT_IX.x) 56 ld h, (ix + PROCESS_STRUCT_IX.y) 57 58 call _CONVERT_COL_LINE_TO_LINEAR59 60 ld bc, NAMTBL + (32 * 2) + 161 add hl, bc63 ret65.isMaximized:66 69 ld hl, NAMTBL + 3271 ret7579_GET_WINDOW_TITLE_BASE_NAMTBL:81 82 ld a, (ix + PROCESS_STRUCT_IX.windowState)83 cp WINDOW_STATE.MAXIMIZED84 jp z, .isMaximized86 87 ld l, (ix + PROCESS_STRUCT_IX.x) 88 ld h, (ix + PROCESS_STRUCT_IX.y) 89 90 call _CONVERT_COL_LINE_TO_LINEAR91 92 ld bc, NAMTBL93 add hl, bc95 ret97.isMaximized:98 ld hl, NAMTBL100 ret104108GET_WINDOW_USEFUL_WIDTH:109 ld a, (ix + PROCESS_STRUCT_IX.windowState)110 cp WINDOW_STATE.RESTORED111 jp z, .isRestored113 114 ld a, 32115 116 ret118.isRestored:119 ld a, (ix + PROCESS_STRUCT_IX.width)120 sub 3 122 ret126130GET_WINDOW_USEFUL_HEIGHT:132 ld a, (ix + PROCESS_STRUCT_IX.windowState)133 cp WINDOW_STATE.RESTORED134 jp z, .isRestored136 137 ld a, 24 - 2 - 1 138 139 ret141.isRestored:142 ld a, (ix + PROCESS_STRUCT_IX.height)143 sub 3 145 ret149154GET_WINDOW_LAST_USEFUL_COLUMN:155 ld a, (ix + PROCESS_STRUCT_IX.windowState)156 cp WINDOW_STATE.RESTORED157 jp z, .isRestored159 160 ld a, 31161 162 ret164.isRestored:165 ld a, (ix + PROCESS_STRUCT_IX.x)166 ld b, (ix + PROCESS_STRUCT_IX.width)167 sub 4168 add b170 ret174179GET_WINDOW_NAMTBL_LAST_USEFUL_COLUMN:181 182 ld a, (ix + PROCESS_STRUCT_IX.windowState)183 cp WINDOW_STATE.MAXIMIZED184 jp z, .isMaximized186 187 ld a, (ix + PROCESS_STRUCT_IX.x) 188 ld b, (ix + PROCESS_STRUCT_IX.width)189 add b190 sub 2 191 ld l, a193 ld h, (ix + PROCESS_STRUCT_IX.y) 194 195 call _CONVERT_COL_LINE_TO_LINEAR196 197 ld bc, NAMTBL + (32 * 2)198 add hl, bc200 ret203.isMaximized:204 ld hl, NAMTBL + 32 + 31 206 ret207System\Main.s19 System/Keyboard/Keyboard.s1 18ASCII_CODE_LOWERCASE_A: equ 972122_READ_KEYBOARD:24 25 ld a, (BIOS_NEWKEY + 6)26 bit 2, a27 ret nz29 31 32 ld hl, (BIOS_NEWKEY + 3)34 35 ld bc, (BIOS_NEWKEY + 5)37 push hl, bc38 39 bit 3, h 40 jp z, .keyPressed_N42 bit 5, h 43 jp z, .keyPressed_P45 46 bit 0, l 47 jp z, .keyPressed_C49 50 bit 0, c 51 jp z, .keyPressed_S53 .continue:54 pop bc, hl57 58 ld (OS.oldKeyboardMatrix + 3), hl59 ld (OS.oldKeyboardMatrix + 5), bc61 ret63.keyPressed_N:64 65 ld a, (OS.oldKeyboardMatrix + 4)66 bit 3, a 67 jp z, .continue69 70 ld hl, Notepad.Header71 call _LOAD_PROCESS73 jp .continue75.keyPressed_P:76 77 ld a, (OS.oldKeyboardMatrix + 4)78 bit 5, a 79 jp z, .continue81 82 ld hl, Paint.Header83 call _LOAD_PROCESS85 jp .continue87.keyPressed_C:88 89 ld a, (OS.oldKeyboardMatrix + 3)90 bit 0, a 91 jp z, .continue93 94 ld hl, Calc.Header95 call _LOAD_PROCESS97 jp .continue99.keyPressed_S:100 101 ld a, (OS.oldKeyboardMatrix + 5)102 bit 0, a 103 jp z, .continue105 106 ld hl, Settings.Header107 call _LOAD_PROCESS109 jp .continue112116 117120122125 126131137143145 146148150153156159162165168171174176178181184187190193196199203207211215219223227231236240242247249252System\Main.s20 System/Mouse/Mouse.s1 System/Mouse/DrawMouseCursor.s1_DRAW_MOUSE_CURSOR:3 4 ld hl, SPRATR5 call BIOS_SETWRT6 ld c, PORT_07 ld hl, OS.mouseSpriteAttributes9 ld a, (hl) 10 dec a11 inc hl12 out (c), a 14 17 nop18 nop19 nop20 outi 22 nop23 nop24 nop25 outi 27 nop28 nop29 nop30 outi 32 ld a, (hl) 33 dec a34 inc hl35 out (c), a 37 nop38 nop39 nop40 outi 42 nop43 nop44 nop45 outi 47 nop48 nop49 nop50 outi 5464 65 ld a, (OS.isDraggingWindow)66 ld b, a67 ld a, (OS.isResizingWindow)68 or b69 jp z, .skip_171 ld a, (hl) 72 dec a73 inc hl74 out (c), a 76 nop77 nop78 nop79 outi 81 nop82 nop83 nop84 outi 86 nop87 nop88 nop89 outi 92 ld a, (hl) 93 dec a94 inc hl95 out (c), a 97 nop98 nop99 nop100 outi 102 nop103 nop104 nop105 outi 107 nop108 nop109 nop110 outi 113 ld a, (hl) 114 dec a115 inc hl116 out (c), a 118 nop119 nop120 nop121 outi 123 nop124 nop125 nop126 outi 128 nop129 nop130 nop131 outi 134 ld a, (hl) 135 dec a136 inc hl137 out (c), a 139 nop140 nop141 nop142 outi 144 nop145 nop146 nop147 outi 149 nop150 nop151 nop152 outi 157.skip_1:158 nop159 nop160 ld a, 208161 out (c), a 165 166 ld a, (OS.mouseX) 168 srl a 169 srl a 170 srl a 171 ld l, a173 ld a, (OS.mouseY) 175 srl a 176 srl a 177 srl a 178 ld h, a180 call _CONVERT_COL_LINE_TO_LINEAR182 ld bc, OS.screenMapping183 add hl, bc185 ld a, (hl)187 ld (OS.currentTileMouseOver), a189 196 ret198201System/Mouse/Mouse.s2 System/Mouse/MouseClick.s1_MOUSE_CLICK:3 10 11 ld a, (OS.isDraggingWindow)12 or a13 jp z, .skip_10014 15 ld a, (OS.mouseButton_1) 16 or a17 jp z, _END_DRAG_WINDOW18 jp _DO_DRAG_WINDOW19 jp .skip_121.skip_100:22 23 ld a, (OS.isResizingWindow)24 or a25 jp z, .skip_126 27 ld a, (OS.mouseButton_1) 28 or a29 jp z, _END_RESIZE_WINDOW30 jp _DO_RESIZE_WINDOW31 33.skip_1:35 37 ld a, (OS.mouseButton_1) 38 ld b, a39 or a40 jp z, .return43 ld a, (OS.oldMouseButton_1) 44 or a45 jp nz, .return48 49 ld a, b50 ld (OS.oldMouseButton_1), a53 55 56 ld de, (OS.mouseLastClick_Jiffy)57 ld hl, (BIOS_JIFFY)58 ld (OS.mouseLastClick_Jiffy), hl 59 xor a 60 sbc hl, de 62 ld de, MOUSE_DOUBLE_CLICK_INTERVAL63 call BIOS_DCOMPR 64 jp nc, .isNotDoubleClick65 66 ld a, 167 jp .continue_168.isNotDoubleClick:69 xor a 70.continue_1:71 ld (OS.isDoubleClick), a75 76 ld a, (OS.currentTileMouseOver)78 79 cp SCREEN_MAPPING_DESKTOP 80 jp z, .click_Desktop81 cp SCREEN_MAPPING_TASKBAR 82 jp z, .click_Taskbar84 85 and 0000 1111 b 86 ld c, a88 93 ld a, (OS.currentTileMouseOver)94 and 1111 0000 b 96 cp SCREEN_MAPPING_WINDOWS97 jp z, .click_Window99 cp SCREEN_MAPPING_WINDOWS_TITLE_BAR100 jp z, .click_WindowTitleBar102 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON103 jp z, .click_WindowCloseButton105 cp SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON106 jp z, .click_WindowMaximizeButton108 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON109 jp z, .click_WindowMinimizeButton111 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER112 jp z, .click_WindowResizeCorner114 ret116.return:117 118 ld a, b119 ld (OS.oldMouseButton_1), a120 ret122124.click_Window:127 128 call _GET_PROCESS_BY_ID129 ret nz131 push hl 132 call z, _SET_CURRENT_PROCESS133 pop ix135 136 ld e, (ix + PROCESS_STRUCT_IX.clickAddr) 137 ld d, (ix + PROCESS_STRUCT_IX.clickAddr + 1) 138 call JP_DE140 ret142144.click_WindowTitleBar:147 148 ld a, (OS.isDoubleClick)149 or a150 jp nz, .click_WindowMaximizeButton153 154 call _GET_PROCESS_BY_ID155 push hl156 call z, _SET_CURRENT_PROCESS157 pop ix159 175 call _START_DRAG_WINDOW177 ret180182.click_WindowCloseButton:184 185 call _GET_PROCESS_BY_ID187 ret nz189 call _CLOSE_PROCESS191 ret193195.click_WindowMinimizeButton:197 198 call _GET_PROCESS_BY_ID199 ret nz201 call _MINIMIZE_PROCESS203 ret205207208.click_WindowMaximizeButton:210 211 call _GET_PROCESS_BY_ID212 ret nz214 push hl 215 pop ix217 221 ld a, (ix + PROCESS_STRUCT_IX.windowState)222 cp WINDOW_STATE.RESTORED223 jp z, .isRestored225 call _RESTORE_PROCESS226 ret228.isRestored:229 call _MAXIMIZE_PROCESS230 ret232234.click_WindowResizeCorner:236 237 call _GET_PROCESS_BY_ID238 push hl239 call z, _SET_CURRENT_PROCESS240 pop ix242 call _START_RESIZE_WINDOW244 ret246248.click_Desktop:251 253 ld h, 3 * 8 254 ld l, 1 * 8 255 ld ix, Notepad.Header 256 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_0 * 8) 257 ld bc, OS.desktop_Tiles 258 call _CHECK_CLICK_DESKTOP_ICON259 ret nz 261 263 ld h, 11 * 8 264 ld l, 1 * 8 265 ld ix, Calc.Header 266 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_1 * 8) 267 ld bc, OS.desktop_Tiles + 8 268 call _CHECK_CLICK_DESKTOP_ICON269 ret nz 271 273 ld h, 3 * 8 274 ld l, 9 * 8 275 ld ix, Paint.Header 276 ld de, PATTBL + (256 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 277 ld bc, OS.desktop_Tiles + 256 278 call _CHECK_CLICK_DESKTOP_ICON279 ret nz 281 283 ld h, 3 * 8 284 ld l, 17 * 8 285 ld ix, Settings.Header 286 ld de, PATTBL + (512 * 8) + (TILE_BASE_DESKTOP_ICON_0 * 8) 287 ld bc, OS.desktop_Tiles + 512 288 call _CHECK_CLICK_DESKTOP_ICON289 ret nz 293 295 call _INIT_DESKTOP297 call _UPDATE_SCREEN299 ret301303.click_Taskbar:305 307 ld a, (OS.mouseY)308 cp 191 + 1 - 10 309 ret c313 ld a, (OS.mouseX)314 315 316 cp 20 * 8317 ld hl, (OS.taskbar_Button_3_Process_addr)318 jp nc, .click_Taskbar_button320 321 cp 15 * 8322 ld hl, (OS.taskbar_Button_2_Process_addr)323 jp nc, .click_Taskbar_button325 326 cp 10 * 8327 ld hl, (OS.taskbar_Button_1_Process_addr)328 jp nc, .click_Taskbar_button330 331 cp 5 * 8332 ld hl, (OS.taskbar_Button_0_Process_addr)333 jp nc, .click_Taskbar_button335 336 cp 3 * 8337 jp c, .skip_10338 cp 4 * 8339 jp c, .click_Taskbar_ShowDesktop340.skip_10:343 ret347.click_Taskbar_ShowDesktop:349 350 ld hl, OS.processes351 ld de, Process_struct.size352 ld b, MAX_PROCESS_ID + 1353.loop_1:354 ld a, (hl)355 cp 0xff 356 jp z, .next_1358 push hl, de, bc359 ld c, a360 call _GET_PROCESS_BY_ID362 call _MINIMIZE_PROCESS363 pop bc, de, hl365.next_1:366 add hl, de367 djnz .loop_1368 369 ret372374.click_Taskbar_button:376 377 push hl378 inc hl379 ld a, l380 or h381 pop hl382 ret z384 push hl 385 pop ix387 388 ld a, (ix + PROCESS_STRUCT_IX.windowState)389 cp WINDOW_STATE.MINIMIZED390 jp nz, .skip_20392 ld a, (ix + PROCESS_STRUCT_IX.previousWindowState)393 ld (ix + PROCESS_STRUCT_IX.windowState), a394.skip_20:396 call _SET_CURRENT_PROCESS398 ret401410_CHECK_CLICK_DESKTOP_ICON:412 ld a, (OS.mouseX)413 414 cp h 415 jp c, .not_click_icon416 417 ld a, 3 * 8418 add h419 ld h, a420 ld a, (OS.mouseX)421 cp h 422 jp nc, .not_click_icon424 ld a, (OS.mouseY)425 426 cp l 427 jp c, .not_click_icon428 429 ld a, 3 * 8430 add l431 ld l, a432 ld a, (OS.mouseY)433 cp l 434 jp nc, .not_click_icon436 437 ld a, (OS.isDoubleClick)438 or a439 jp z, .isNotDoubleClick_1440 push ix 441 pop hl442 call _LOAD_PROCESS443 jp .retNZ444.isNotDoubleClick_1:446 448 push ix, hl, de, bc449 call _INIT_DESKTOP450 pop bc, de, hl, ix452 push ix, bc453 455 call _LOAD_ICON_INVERTED_FROM_APP_HEADER456 pop hl, ix458 460 call _DRAW_DESKTOP_ICON_NAME_REVERSED462 call _UPDATE_SCREEN464.retNZ:465 ld a, 1 466 or a467 ret469.not_click_icon:470 xor a 471 retSystem/Mouse/Mouse.s3 System/Mouse/MouseOver.s1_MOUSE_OVER:3 4 ld a, (OS.isDraggingWindow)5 ld b, a6 ld a, (OS.isResizingWindow)7 or b8 ret nz10 11 ld a, (OS.mouseOver_Activated)12 or a13 jp z, .skip_115 16 ld a, (OS.currentTileMouseOver)17 ld b, a18 ld a, (OS.mouseOver_screenMappingValue)19 cp b20 ret z21 22 23 ld a, (OS.mouseOver_screenMappingValue)24 and 1111 0000 b25 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER26 jp nz, .notOver_WindowButton27 jp .notOver_ResizeCorner29.skip_1:32 33 ld a, (OS.currentTileMouseOver)35 36 cp SCREEN_MAPPING_DESKTOP 37 ret z38 cp SCREEN_MAPPING_TASKBAR 39 ret z42 43 and 0000 1111 b 44 ld c, a46 ld a, (OS.currentTileMouseOver)47 and 1111 0000 b 50 53 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON54 jp z, .over_WindowCloseButton56 cp SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON57 jp z, .over_WindowMaximizeRestoreButton59 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON60 jp z, .over_WindowMinimizeRestoreButton62 cp SCREEN_MAPPING_WINDOWS_RESIZE_CORNER63 jp z, .over_WindowResizeCorner65 ret67.over_WindowCloseButton:69 70 call _GET_PROCESS_BY_ID71 ret nz73 call .getWindowCloseButton_NAMTBL75 ld iy, TILE_WINDOW_CLOSE_BUTTON_PATTERN76 ld b, TILE_WINDOW_CLOSE_BUTTON78 call .setMouseOver80 ret84.over_WindowMaximizeRestoreButton:86 87 call _GET_PROCESS_BY_ID88 ret nz90 call .getWindowCloseButton_NAMTBL91 dec hl 93 ld iy, TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN94 ld b, TILE_WINDOW_MAXIMIZE_BUTTON96 call .setMouseOver98 ret102.over_WindowMinimizeRestoreButton:104 105 call _GET_PROCESS_BY_ID106 ret nz108 call .getWindowCloseButton_NAMTBL109 dec hl110 dec hl 112 ld iy, TILE_WINDOW_MINIMIZE_BUTTON_PATTERN113 ld b, TILE_WINDOW_MINIMIZE_BUTTON115 call .setMouseOver117 ret121.over_WindowResizeCorner:122 123 124 ld a, (OS.mouseOver_Activated)125 or a126 ret nz128 129 ld a, 1130 ld (OS.mouseOver_Activated), a132 133 ld a, (OS.currentTileMouseOver)134 ld (OS.mouseOver_screenMappingValue), a136 137 138 ld hl, SPRITE_CURSOR_RESIZE_PATTERN 139 ld de, SPRPAT + (SPRITE_INDEX_CURSOR_0 * 32) 140 ld bc, SPRITE_CURSOR_RESIZE_PATTERN.size 141 call BIOS_LDIRVM 144 147 ret151.notOver_ResizeCorner:152 153 xor a154 ld (OS.mouseOver_Activated), a156 157 ld (OS.mouseOver_screenMappingValue), a161 162 ld hl, SPRITE_CURSOR_ARROW_PATTERN 163 ld de, SPRPAT + (SPRITE_INDEX_CURSOR_0 * 32) 164 ld bc, SPRITE_CURSOR_ARROW_PATTERN.size 165 call BIOS_LDIRVM 169 172 ret176.notOver_WindowButton:178 179 ld a, (OS.mouseOver_screenMappingValue)180 and 0000 1111 b 181 ld c, a184 185 xor a186 ld (OS.mouseOver_Activated), a188 189 ld (OS.mouseOver_screenMappingValue), a192 193 call _GET_PROCESS_BY_ID194 ret nz 197 198 199 200 ld hl, (OS.mouseOver_NAMTBL_addr)201 call BIOS_SETWRT203 204 ld a, (OS.mouseOver_tileToBeRestored)205 out (PORT_0), a207 ret212216.setMouseOver:218220 221 ld a, (OS.mouseOver_Activated)222 or a223 ret nz225 227 ld a, b228 ld (OS.mouseOver_tileToBeRestored), a230 231 ld a, 1232 ld (OS.mouseOver_Activated), a234 235 ld a, (OS.currentTileMouseOver)236 ld (OS.mouseOver_screenMappingValue), a238 242 push hl244 247 ld a, (OS.mouseY)248 cp 64249 jp c, .updateScreenTop250 cp 128251 jp c, .updateScreenMiddle252 jp .updateScreenBottom254.updateScreenTop:255 258 push iy 259 pop hl261 ld de, PATTBL + (TILE_MOUSE_OVER * 8) 262 ld bc, 8 263 call BIOS_LDIRVM 265 ld a, 0xe1 267 ld bc, 8 268 ld hl, COLTBL + (TILE_MOUSE_OVER * 8) 269 call BIOS_FILVRM270 271 jp .continue_1273.updateScreenMiddle:274 277 push iy 278 pop hl280 ld de, PATTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 281 ld bc, 8 282 call BIOS_LDIRVM 284 ld a, 0xe1 285 ld bc, 8 286 ld hl, COLTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 287 call BIOS_FILVRM288 289 jp .continue_1291.updateScreenBottom:292 295 push iy 296 pop hl298 ld de, PATTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 299 ld bc, 8 300 call BIOS_LDIRVM 302 ld a, 0xe1 303 ld bc, 8 304 ld hl, COLTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 305 call BIOS_FILVRM306 307.continue_1:309 pop hl311 312 313 ld (OS.mouseOver_NAMTBL_addr), hl315 316 call BIOS_SETWRT317 ld a, TILE_MOUSE_OVER318 out (PORT_0), a320 ret322329336338345347350354358.getWindowCloseButton_NAMTBL:359 push hl 360 pop ix361 call _GET_WINDOW_TITLE_BASE_NAMTBL362 363 ld a, (ix + PROCESS_STRUCT_IX.windowState)364 cp WINDOW_STATE.MAXIMIZED365 jp z, .isMaximized367 368 ld c, (ix + PROCESS_STRUCT_IX.width) 369 ld b, 0370 add hl, bc371 ld bc, 32 - 2 372 add hl, bc373 374 ret376.isMaximized:377 ld bc, 32 - 1378 add hl, bc379 380 retSystem/Mouse/Mouse.s4 System/Mouse/DisableMouseOver.s13_DISABLE_MOUSE_OVER:4 6 xor a7 ld (OS.mouseOver_Activated), a9 10 ld (OS.mouseOver_screenMappingValue), a12 13 ld hl, (OS.mouseOver_NAMTBL_addr)14 call BIOS_SETWRT16 ld a, TILE_EMPTY17 out (PORT_0), a19 ld a, SCREEN_MAPPING_DESKTOP 20 ld (OS.currentTileMouseOver), a21 22 retSystem/Mouse/Mouse.s5 System/Mouse/DragWindow.s13_START_DRAG_WINDOW:5 6 ld a, (ix + PROCESS_STRUCT_IX.windowState)7 cp WINDOW_STATE.RESTORED8 ret nz12 13 ld a, 114 ld (OS.isDraggingWindow), a17 18 ld a, (ix + PROCESS_STRUCT_IX.x) 23 add a 24 add a25 add a26 inc a 27 ld (OS.windowCorner_TopLeft_X), a28 ld b, a30 ld a, (OS.mouseX)32 sub b34 ld (OS.dragOffset_X), a 38 39 ld a, (ix + PROCESS_STRUCT_IX.y) 44 add a 45 add a46 add a47 add 6 48 ld (OS.windowCorner_TopLeft_Y), a49 ld b, a51 ld a, (OS.mouseY)53 sub b55 ld (OS.dragOffset_Y), a57 call _ADJUST_WINDOW_DRAG_CORNERS61 72 79 ret8384_ADJUST_WINDOW_DRAG_CORNERS:85 86 ld a, (ix + PROCESS_STRUCT_IX.width)87 add a 88 add a89 add a90 ld b, a91 ld a, (OS.windowCorner_TopLeft_X)92 ld (OS.windowCorner_BottomLeft_X), a93 add b94 sub 16 + 5 95 ld (OS.windowCorner_TopRight_X), a96 ld (OS.windowCorner_BottomRight_X), a97 98 99 ld a, (ix + PROCESS_STRUCT_IX.height)100 add a 101 add a102 add a103 ld b, a104 ld a, (OS.windowCorner_TopLeft_Y)105 ld (OS.windowCorner_TopRight_Y), a106 add b107 sub 16 + 10108 ld (OS.windowCorner_BottomLeft_Y), a109 ld (OS.windowCorner_BottomRight_Y), a111 112 ld a, (BIOS_JIFFY)113 and 0011 1100 b114 srl a 115 srl a 116 ld hl, DRAG_WINDOW_SPRITE_COLOR_LUT117 ld b, 0118 ld c, a119 add hl, bc120 ld a, (hl)121 ld (OS.windowCorner_TopLeft_Color), a122 ld (OS.windowCorner_BottomLeft_Color), a123 ld (OS.windowCorner_TopRight_Color), a124 ld (OS.windowCorner_BottomRight_Color), a126 ret128129DRAG_WINDOW_SPRITE_COLOR_LUT: 130 db 15, 14, 14, 7, 5, 5, 4, 1, 1, 4, 4, 5, 7, 7, 14, 15134_DO_DRAG_WINDOW:135 137 138 ld a, (OS.mouseX)139 ld l, a140 ld h, 0x80 142 ld a, (OS.dragOffset_X)143 ld e, a144 ld d, 0145 xor a 146 sbc hl, de148 push hl149 150 ld de, 0x8000 + 1151 call BIOS_DCOMPR 152 jp nc, .skip_20153 ld a, 1154 jp .cont_10155 .skip_20:156 ld a, l157 .cont_10:158 ld (OS.windowCorner_TopLeft_X), a159 pop hl160 161 162 ld a, (ix + PROCESS_STRUCT_IX.width)163 add a 164 add a165 add a166 ld c, a167 ld b, 0168 or a 169 jp z, .skip_3170 add hl, bc172 173 ld de, 0x8000 + (255 + 2)174 call BIOS_DCOMPR 175 jp nc, .skip_3 176 jp .skip_4 177.skip_3:178 179 ld a, 1 180 sub c181 ld (OS.windowCorner_TopLeft_X), a182.skip_4:183 185 186 ld a, (OS.dragOffset_Y)187 ld b, a188 ld a, (OS.mouseY)189 sub b191 192 cp 191193 jp nc, .skip_1194 195 cp 6196 jp nc, .skip_2197.skip_1:198 ld a, 6199.skip_2:200 ld (OS.windowCorner_TopLeft_Y), a202 205 206 ld l, a207 ld h, 0x80 210 ld a, (ix + PROCESS_STRUCT_IX.height)211 add a 212 add a213 add a214 ld c, a215 ld b, 0217 add hl, bc219 ld de, 0x80b6 220 call BIOS_DCOMPR 221 jp c, .skip_5224 225 ld a, 191 - 9226 sub c227 ld (OS.windowCorner_TopLeft_Y), a228.skip_5:229 230 232 call _ADJUST_WINDOW_DRAG_CORNERS234 ret238_END_DRAG_WINDOW:239 240 241 xor a242 ld (OS.isDraggingWindow), a244 ld ix, (OS.currentProcessAddr)246 ld a, (OS.windowCorner_TopLeft_X)247 dec a 248 srl a 249 srl a 250 srl a 251 ld (ix + PROCESS_STRUCT_IX.x), a253 ld a, (OS.windowCorner_TopLeft_Y)254 sub 6 255 srl a 256 srl a 257 srl a 258 ld (ix + PROCESS_STRUCT_IX.y), a260 call _UPDATE_SCREEN262 ret263System/Mouse/Mouse.s6 System/Mouse/ResizeWindow.s13_START_RESIZE_WINDOW:5 6 ld a, (ix + PROCESS_STRUCT_IX.windowState)7 cp WINDOW_STATE.RESTORED8 ret nz12 13 ld a, 114 ld (OS.isResizingWindow), a17 19 21 ld a, (ix + PROCESS_STRUCT_IX.x) 23 add a 24 add a25 add a 26 inc a 27 ld (OS.windowCorner_TopLeft_X), a28 ld (OS.windowCorner_BottomLeft_X), a29 dec a 30 ld c, a 31 ld a, (ix + PROCESS_STRUCT_IX.width) 33 add a 34 add a35 add a 36 add c 37 sub 16 + 4 38 ld (OS.windowCorner_BottomRight_X), a39 ld b, a41 ld a, (OS.mouseX)43 sub b45 ld (OS.dragOffset_X), a47 48 ld a, (ix + PROCESS_STRUCT_IX.minWidth) 50 add a 51 add a52 add a 53 add c 54 sub 16 + 4 55 ld (OS.resizeWindowCorner_BottomRight_X_Min), a59 61 63 ld a, (ix + PROCESS_STRUCT_IX.y) 65 add a 66 add a67 add a 68 add 6 69 ld (OS.windowCorner_TopLeft_Y), a70 ld (OS.windowCorner_TopRight_Y), a71 sub 6 72 ld c, a 73 ld a, (ix + PROCESS_STRUCT_IX.height) 75 add a 76 add a77 add a 78 add c 79 sub 16 + 4 80 ld (OS.windowCorner_BottomRight_Y), a81 ld b, a83 ld a, (OS.mouseY)85 sub b87 ld (OS.dragOffset_Y), a90 91 ld a, (ix + PROCESS_STRUCT_IX.minHeight) 93 add a 94 add a95 add a 96 add c 97 sub 16 + 4 98 ld (OS.resizeWindowCorner_BottomRight_Y_Min), a101 103 call _ADJUST_WINDOW_RESIZE_CORNERS106 ret110111_ADJUST_WINDOW_RESIZE_CORNERS:113 ld a, (OS.windowCorner_BottomRight_X)114 ld (OS.windowCorner_TopRight_X), a116 ld a, (OS.windowCorner_BottomRight_Y)117 ld (OS.windowCorner_BottomLeft_Y), a120 121 ld a, (BIOS_JIFFY)122 and 0011 1100 b123 srl a 124 srl a 125 ld hl, DRAG_WINDOW_SPRITE_COLOR_LUT126 ld b, 0127 ld c, a128 add hl, bc129 ld a, (hl)130 ld (OS.windowCorner_TopLeft_Color), a131 ld (OS.windowCorner_BottomLeft_Color), a132 ld (OS.windowCorner_TopRight_Color), a133 ld (OS.windowCorner_BottomRight_Color), a135 ret137142_DO_RESIZE_WINDOW:144 145 ld a, (OS.dragOffset_X)146 ld b, a147 ld a, (OS.mouseX)148 sub b149 jp c, .lessThanMinWidth 150 ld (OS.windowCorner_BottomRight_X), a152 155 ld b, a 156 ld a, (OS.resizeWindowCorner_BottomRight_X_Min)157 cp b158 jp nc, .lessThanMinWidth 159 jp .cont_1160.lessThanMinWidth:161 ld a, (OS.resizeWindowCorner_BottomRight_X_Min)162 ld (OS.windowCorner_BottomRight_X), a163 jp .cont_2 164.cont_1:167 170 ld b, 256 - 16 - 4 171 ld a, (OS.windowCorner_BottomRight_X)172 cp b173 jp nc, .greaterThanMaxWidth 174 jp .cont_2175.greaterThanMaxWidth:176 ld a, 256 - 16 - 4 177 ld (OS.windowCorner_BottomRight_X), a178.cont_2:180 182 183 ld a, (OS.dragOffset_Y)184 ld b, a185 ld a, (OS.mouseY)186 sub b187 jp c, .lessThanMinHeight 188 ld (OS.windowCorner_BottomRight_Y), a190 193 ld b, a 194 ld a, (OS.resizeWindowCorner_BottomRight_Y_Min)195 cp b196 jp nc, .lessThanMinHeight 197 jp .cont_10198.lessThanMinHeight:199 ld a, (OS.resizeWindowCorner_BottomRight_Y_Min)200 ld (OS.windowCorner_BottomRight_Y), a201 jp .cont_20 202.cont_10:205 208 ld b, 192 - 16 - 16 - 4 209 ld a, (OS.windowCorner_BottomRight_Y)210 cp b211 jp nc, .greaterThanMaxHeight 212 jp .cont_20213.greaterThanMaxHeight:214 ld a, 192 - 16 - 16 - 4 215 ld (OS.windowCorner_BottomRight_Y), a216.cont_20:218 220 call _ADJUST_WINDOW_RESIZE_CORNERS222 ret225_END_RESIZE_WINDOW:226 227 228 xor a229 ld (OS.isResizingWindow), a231 ld ix, (OS.currentProcessAddr)233 234 ld a, (OS.windowCorner_BottomRight_X)235 dec a 236 add 16 + 4 237 srl a 238 srl a 239 srl a 241 ld b, (ix + PROCESS_STRUCT_IX.x)243 sub b245 inc a 246 ld (ix + PROCESS_STRUCT_IX.width), a250 251 ld a, (OS.windowCorner_BottomRight_Y)252 add 16 + 4 253 srl a 254 srl a 255 srl a 257 ld b, (ix + PROCESS_STRUCT_IX.y)259 sub b261 ld (ix + PROCESS_STRUCT_IX.height), a265 call _UPDATE_SCREEN267 ret268System/Mouse/Mouse.s10WAIT1: equ 10 11WAIT2: equ 30 141623GTMOUS:24 ld b, WAIT2 25 call GTOFS2 27 28 ld ix, 029 bit 4, a30 jp nz, .mouseButton_1_NotClicked31 ld ixh, 132.mouseButton_1_NotClicked:33 bit 5, a34 jp nz, .mouseButton_2_NotClicked35 ld ixl, 136.mouseButton_2_NotClicked:38 and 0x0F39 rlca40 rlca41 rlca42 rlca43 ld c, a44 call GTOFST 45 and 0x0F46 or c47 ld h, a 48 call GTOFST 49 and 0x0F50 rlca51 rlca52 rlca53 rlca54 ld c, a55 call GTOFST 56 and 0x0F57 or c58 ld l, a 59 ret60 61GTOFST: 62 ld b, WAIT163GTOFS2: 64 ld a, 15 66 out (0xA0), a67 in a, (0xA1) 68 and 0x80 69 or d 70 out (0xA1), a71 xor e72 ld d, a73 74 call WAITMS 75 76 ld a, 1477 out (0xA0), a78 79 in a, (0xA2)80 ret81WAITMS:82 ld a, b83WTTR:84 djnz WTTR85 db 0xED,0x55 86 rlca87 rlca88 ld b, a89WTTR2:90 djnz WTTR291 ld b, a 92WTTR3:93 djnz WTTR395 ret 97105CLIPADD:106 107 ld a, l108 ld b, e109 call LIMITADD110 ld l, a111 112 ld a, h113 ld b, d114 call LIMITADD115 ld h, a116 cp 191117 ret c118 ld h, 191119 ret120 121LIMITADD:122 123127 128 129 sub 128 130 add a, b 131 jp pe, .CLIP 132 add a, 128 133 ret 134.CLIP: 135 ld a, b 136 cpl 137 add a, a 138 sbc a, a 139 ret 143148CONVERT_MOUSE_POSITION_IN_PIXELS_TO_TILES:149 ld a, (OS.mouseY)150 152 153 srl a 154 srl a 155 srl a 156 ld h, a159 ld a, (OS.mouseX)161 162 srl a 163 srl a 164 srl a 165 ld l, a167 retSystem\Main.s21 System/Process/Process.s1 System/Process/LoadProcess.s13_LOAD_PROCESS:5 6 ld de, (OS.nextAvailableProcessAddr)7 ld a, 0xff8 cp d9 jp nz, .skip_010 cp e11 jp z, .showAlertMaxProcessLimitReached12.skip_0:14 15 push hl16 ld a, 0xff17 ld hl, (OS.nextAvailableProcessAddr)18 ld (hl), a19 20 push hl 21 pop de23 inc de25 27 ld bc, Process_struct.size - 128 ldir29 pop hl32 34 ld de, (OS.nextAvailableProcessAddr) 35 ld bc, Process_struct.size_Header 36 ldir 38 39 ld hl, (OS.nextAvailableProcessAddr)40 ld (OS.currentProcessAddr), hl43 45 46 49 50 54 58 62 65 66 ld hl, (OS.currentProcessAddr)67 call _GET_NEXT_AVAILABLE_PROCESS_ID68 ld a, ixh69 cp 25570 jp z, .maxProcessLimitReached71 ld hl, (OS.currentProcessAddr)72 ld (hl), a 74 75 call _GET_NEXT_AVAILABLE_PROCESS_ADDR76 78 ld (OS.nextAvailableProcessAddr), hl82 ld ix, (OS.currentProcessAddr)84 85 push ix 86 pop hl88 ld de, OS.process_slot_089 call BIOS_DCOMPR90 jp z, .isOnProcessSlot_092 ld de, OS.process_slot_193 call BIOS_DCOMPR94 jp z, .isOnProcessSlot_196 ld de, OS.process_slot_297 call BIOS_DCOMPR98 jp z, .isOnProcessSlot_2100 ld de, OS.process_slot_3101 call BIOS_DCOMPR102 jp z, .isOnProcessSlot_3104 jp .cont_1001106.isOnProcessSlot_0:107 ld hl, OS.processesVariablesArea_0108 110 jp .saveRamStartAddr112.isOnProcessSlot_1:113 ld hl, OS.processesVariablesArea_1114 jp .saveRamStartAddr116.isOnProcessSlot_2:117 ld hl, OS.processesVariablesArea_2118 jp .saveRamStartAddr120.isOnProcessSlot_3:121 ld hl, OS.processesVariablesArea_3122 124.saveRamStartAddr:125 ld (ix + PROCESS_STRUCT_IX.ramStartAddr), l126 ld (ix + PROCESS_STRUCT_IX.ramStartAddr + 1), h127 130.cont_1001:132 133 call _GET_NUMBER_OF_PROCESSES_OPENED134 dec a135 ld (ix + PROCESS_STRUCT_IX.layer), a137 ld a, WINDOW_STATE.RESTORED138 ld (ix + PROCESS_STRUCT_IX.previousWindowState), a140 142 ld a, (OS.nextWindow_x)143 144 ld b, (ix + PROCESS_STRUCT_IX.width)145 add b146 cp 32 + 1147 jp nc, .fixWidth148 ld a, (OS.nextWindow_x)149 jp .cont_200150.fixWidth:151 xor a152.cont_200:153 ld (ix + PROCESS_STRUCT_IX.x), a154 add 2155 ld (OS.nextWindow_x), a157 ld a, (OS.nextWindow_y)158 159 ld b, (ix + PROCESS_STRUCT_IX.height)160 add b161 cp 22 + 1162 jp nc, .fixHeight163 ld a, (OS.nextWindow_y)164 jp .cont_100165.fixHeight:166 xor a167.cont_100:168 ld (ix + PROCESS_STRUCT_IX.y), a169 add 2170 ld (OS.nextWindow_y), a171 cp 8172 call nc, .resetNextWindow_XY 176 178 ld ix, (OS.currentProcessAddr)179 ld e, (ix + PROCESS_STRUCT_IX.openAddr) 180 ld d, (ix + PROCESS_STRUCT_IX.openAddr + 1) 181 call JP_DE185 call _UPDATE_SCREEN188 call _DRAW_TASKBAR192 198 199 200 207 ret209.maxProcessLimitReached:210 211 ld hl, 0xffff212 ld (OS.nextAvailableProcessAddr), hl214 ret216.showAlertMaxProcessLimitReached:218 222 ret224.resetNextWindow_XY:225 xor a226 ld (OS.nextWindow_x), a227 ld (OS.nextWindow_y), a229 ret231System/Process/Process.s2 System/Process/SetCurrentProcess.s13_SET_CURRENT_PROCESS:5 8 9 ld (OS.currentProcessAddr), hl11 push hl 12 pop ix14 15 ld e, (ix + PROCESS_STRUCT_IX.getFocusAddr) 16 ld d, (ix + PROCESS_STRUCT_IX.getFocusAddr + 1) 17 call JP_DE18 20 push hl21 22 ld c, (ix + PROCESS_STRUCT_IX.layer)23 24 25 call _ADJUST_LAYER_OF_PROCESSES27 28 call _GET_NUMBER_OF_PROCESSES_OPENED29 dec a30 ld (ix + PROCESS_STRUCT_IX.layer), a31 pop hl33 call _UPDATE_SCREEN35 call _DRAW_TASKBAR37 42 45 ret49System/Process/Process.s3 System/Process/CloseProcess.s13_CLOSE_PROCESS:5 6 push hl7 pop ix9 10 push hl11 ld e, (ix + PROCESS_STRUCT_IX.closeAddr) 12 ld d, (ix + PROCESS_STRUCT_IX.closeAddr + 1) 13 call JP_DE14 pop hl16 17 push hl18 ld c, (ix + PROCESS_STRUCT_IX.layer)19 call _ADJUST_LAYER_OF_PROCESSES20 pop hl23 push hl24 call _CLOSE_WINDOW25 pop hl30 push hl31 32 ld a, 0xff33 34 ld (hl), a35 36 push hl 37 pop de39 inc de41 43 ld bc, Process_struct.size - 145 ldir46 47 pop hl49 call _DISABLE_MOUSE_OVER50 55 58 62 65 71 call _UPDATE_SCREEN74 call _DRAW_TASKBAR76 77 call _GET_NEXT_AVAILABLE_PROCESS_ADDR78 80 ld (OS.nextAvailableProcessAddr), hl84 85 ld hl, 0x000086 ld (OS.currentProcessAddr), hl90 ret91System/Process/Process.s4 System/Process/MinimizeProcess.s13_MINIMIZE_PROCESS:5 6 push hl7 pop ix9 10 ld a, (ix + PROCESS_STRUCT_IX.windowState)11 cp WINDOW_STATE.MINIMIZED12 ret z14 15 ld (ix + PROCESS_STRUCT_IX.previousWindowState), a17 18 ld a, WINDOW_STATE.MINIMIZED19 ld (ix + PROCESS_STRUCT_IX.windowState), a21 push ix23 24 ld hl, (OS.currentProcessAddr)25 push ix 26 pop de27 call BIOS_DCOMPR 28 jp nz, .skip_130 ld hl, 0x000031 ld (OS.currentProcessAddr), hl32 .skip_1:34 pop ix36 call _CLOSE_WINDOW38 call _UPDATE_SCREEN40 call _DISABLE_MOUSE_OVER41 46 49 53 56 61 call _DRAW_TASKBAR 64 retSystem/Process/Process.s5 System/Process/MaximizeProcess.s13_MAXIMIZE_PROCESS:5 6 push hl7 pop ix9 12 13 ld a, WINDOW_STATE.MAXIMIZED14 ld (ix + PROCESS_STRUCT_IX.windowState), a16 call _SET_CURRENT_PROCESS18 20 call _DISABLE_MOUSE_OVER22 24 retSystem/Process/Process.s6 System/Process/RestoreProcess.s13_RESTORE_PROCESS:5 6 push hl7 pop ix9 10 ld a, WINDOW_STATE.RESTORED11 ld (ix + PROCESS_STRUCT_IX.windowState), a13 call _SET_CURRENT_PROCESS15 call _DISABLE_MOUSE_OVER17 retSystem/Process/Process.s10MAX_PROCESS_ID: equ 3 1417_GET_NEXT_AVAILABLE_PROCESS_ID:18 ld ixh, 0 20.outerLoop:21 ld hl, OS.processes23.loop:24 ld a, (hl)25 cp ixh26 jp z, .goToNext 28 ld bc, Process_struct.size29 add hl, bc 31 32 ld de, OS.processes_end33 call BIOS_DCOMPR 34 jp nz, .loop36 37 ret39.goToNext:40 inc ixh41 ld a, ixh42 cp MAX_PROCESS_ID + 143 jp nz, .outerLoop45 46 ld ixh, 25548 ret5154_GET_NEXT_AVAILABLE_PROCESS_ADDR:56 ld hl, OS.processes57 ld de, Process_struct.size58 ld b, MAX_PROCESS_ID + 159.loop:60 ld a, (hl)61 62 inc a 63 ret z65 add hl, de67 djnz .loop69 70 ld hl, 0xffff72 ret7679_GET_NUMBER_OF_PROCESSES_OPENED:81 ld hl, OS.processes82 ld de, Process_struct.size83 ld b, MAX_PROCESS_ID + 184 xor a 85.loop:86 ld c, (hl)87 88 inc c 89 jp z, .next91 92 inc a94.next:95 add hl, de97 djnz .loop99 ret103109_GET_PROCESS_BY_ID:110 111 ld hl, OS.processes112 ld de, Process_struct.size113 ld b, MAX_PROCESS_ID + 1114.loop_1:115 ld a, (hl)116 cp c117 ret z118 add hl, de119 djnz .loop_1121 122 ld hl, 0x0000123 xor a 125 ret128130134138145150152157162167170_ADJUST_LAYER_OF_PROCESSES:172 ld hl, OS.processes + PROCESS_STRUCT_IX.layer173 ld de, Process_struct.size174 ld b, MAX_PROCESS_ID + 1175.loop:176 ld a, (hl)177 cp 0xff178 jp z, .next 180 cp c181 jp c, .next 183 184 dec a185 ld (hl), a187.next:188 add hl, de190 djnz .loop192 ret194System\Main.s22 System/Time/Time.s1_INIT_SYSTEM_TIME:3 xor a5 ld (os.timeCounter), a7 8 ld a, 0x129 ld (OS.currentTime_Hours), a10 xor a11 ld (OS.currentTime_Minutes), a12 ld (OS.currentTime_Seconds), a13 ld (OS.timeCounter), a15 16 ld hl, OS.currentDate17 ld (hl), a18 inc hl19 ld (hl), a20 inc hl21 ld (hl), a23 ret27SYSTEM_HERTZ_RATE: equ 60 29_UPDATE_SYSTEM_TIME:31 ld a, (os.timeCounter)32 inc a33 ld (os.timeCounter), a34 cp SYSTEM_HERTZ_RATE35 ret nz37 38 xor a39 ld (os.timeCounter), a41 43 44 ld a, (OS.currentTime_Seconds)45 inc a 46 daa47 ld (OS.currentTime_Seconds), a49 50 cp 0x6051 ret nz52 ld a, (OS.currentTime_Minutes)53 inc a 54 daa55 ld (OS.currentTime_Minutes), a56 57 xor a58 ld (OS.currentTime_Seconds), a60 61 ld a, (OS.currentTime_Minutes)62 cp 0x6063 ret nz64 ld a, (OS.currentTime_Hours)65 inc a66 daa68 cp 0x13 69 jp nz, .not13Hours70 ld a, 0x0171.not13Hours:72 ld (OS.currentTime_Hours), a73 74 xor a75 ld (OS.currentTime_Minutes), a79 retSystem\Main.s2426 Graphics/Tiles.s1TILE_PATTERNS:35TILE_EMPTY: equ 06 DB 00000000b7 DB 00000000b8 DB 00000000b9 DB 00000000b10 DB 00000000b11 DB 00000000b12 DB 00000000b13 DB 00000000b15TILE_WINDOW_TITLE_TOP_LEFT: equ 116 DB 00000000b17 DB 00000000b18 DB 00000000b19 DB 00000000b20 DB 00000000b21 DB 00000000b22 DB 01111111b23 DB 01111111b25TILE_WINDOW_TITLE_BOTTOM_LEFT: equ 226 DB 01111111b27 DB 01111111b28 DB 01111111b29 DB 01111111b30 DB 01111111b31 DB 01111111b32 DB 01111111b33 DB 01111111b35TILE_WINDOW_TITLE_MIDDLE_TOP: equ 336 DB 00000000b37 DB 00000000b38 DB 00000000b39 DB 00000000b40 DB 00000000b41 DB 00000000b42 DB 11111111b43 DB 11111111b45TILE_EMPTY_BLACK: equ 446TILE_WINDOW_TITLE_MIDDLE_BOTTOM: equ 447 DB 11111111b48 DB 11111111b49 DB 11111111b50 DB 11111111b51 DB 11111111b52 DB 11111111b53 DB 11111111b54 DB 11111111b56TILE_WINDOW_BORDER_LEFT: equ 557 DB 01000000b58 DB 01000000b59 DB 01000000b60 DB 01000000b61 DB 01000000b62 DB 01000000b63 DB 01000000b64 DB 01000000b66TILE_WINDOW_BORDER_BOTTOM_LEFT: equ 667 DB 01000000b68 DB 01000000b69 DB 01000000b70 DB 01111111b71 DB 00001111b72 DB 00001111b73 DB 00001111b74 DB 00000000b76TILE_WINDOW_BORDER_MIDDLE_BOTTOM: equ 777 DB 00000000b78 DB 00000000b79 DB 00000000b80 DB 11111111b81 DB 11111111b82 DB 11111111b83 DB 11111111b84 DB 00000000b86TILE_WINDOW_RESIZE_CORNER_LEFT: equ 887 DB 00000001b88 DB 00000011b89 DB 00000110b90 DB 11111111b91 DB 11111111b92 DB 11111111b93 DB 11111111b94 DB 00000000b96TILE_WINDOW_RESIZE_CORNER_TOP: equ 997 DB 00011110b98 DB 00011110b99 DB 00011110b100 DB 00011110b101 DB 00011110b102 DB 00111110b103 DB 01111110b104 DB 11011110b106TILE_WINDOW_RESIZE_CORNER_RIGHT: equ 10107 DB 10111110b108 DB 01111110b109 DB 11011110b110 DB 11111110b111 DB 11111110b112 DB 11111110b113 DB 11111110b114 DB 00000000b117TILE_WINDOW_MINIMIZE_BUTTON_PATTERN:118TILE_WINDOW_MINIMIZE_BUTTON: equ 11119 DB 11111111b120 DB 11111111b121 DB 11111111b122 DB 11111111b123 DB 11000001b124 DB 11000001b125 DB 11111111b126 DB 11111111b128TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN:129TILE_WINDOW_MAXIMIZE_BUTTON: equ 12130 DB 11111111b131 DB 11000001b132 DB 11000001b133 DB 11011101b134 DB 11011101b135 DB 11000001b136 DB 11111111b137 DB 11111111b139TILE_WINDOW_CLOSE_BUTTON_PATTERN:140TILE_WINDOW_CLOSE_BUTTON: equ 13141 DB 11111111b142 DB 11011101b143 DB 11101011b144 DB 11110111b145 DB 11101011b146 DB 11011101b147 DB 11111111b148 DB 11111111b149 150TILE_WINDOW_TOP_RIGHT_CORNER_TOP: equ 14151 DB 00000000b152 DB 00000000b153 DB 00000000b154 DB 00000000b155 DB 00000000b156 DB 00000000b157 DB 11110000b158 DB 11110000b160TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM: equ 15161 DB 11110000b162 DB 11111110b163 DB 11111110b164 DB 11111110b165 DB 11111110b166 DB 11111110b167 DB 11111110b168 DB 11111110b170TILE_WINDOW_BORDER_RIGHT: equ 16171 DB 00011110b172 DB 00011110b173 DB 00011110b174 DB 00011110b175 DB 00011110b176 DB 00011110b177 DB 00011110b178 DB 00011110b180190192TILE_TASKBAR_TOP: equ 17193 DB 00000000 b194 DB 00000000 b195 DB 00000000 b196 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 11111111 b200 DB 11111111 b202TILE_HOME_ICON: equ 18203 DB 11100111 b204 DB 11011011 b205 DB 10111101 b206 DB 01100110 b207 DB 11000011 b208 DB 10000001 b209 DB 10011001 b210 DB 10011001 b212TILE_SHOW_DESKTOP_ICON: equ 19213 DB 10011001 b214 DB 10111101 b215 DB 11111111 b216 DB 11111111 b217 DB 11111111 b218 DB 10111101 b219 DB 10011001 b220 DB 11111111 b222224TILE_LINE_TOP_LEFT: equ 20225 DB 00000000 b226 DB 00000000 b227 DB 00000000 b228 DB 00011111 b229 DB 00010000 b230 DB 00010000 b231 DB 00010000 b232 DB 00010000 b234TILE_LINE_TOP_RIGHT: equ 21235 DB 00000000 b236 DB 00000000 b237 DB 00000000 b238 DB 11110000 b239 DB 00010000 b240 DB 00010000 b241 DB 00010000 b242 DB 00010000 b244TILE_LINE_MID_RIGHT: equ 22245 DB 00010000 b246 DB 00010000 b247 DB 00010000 b248 DB 11110000 b249 DB 00010000 b250 DB 00010000 b251 DB 00010000 b252 DB 00010000 b254TILE_LINE_BOTTOM_RIGHT: equ 23255 DB 00010000 b256 DB 00010000 b257 DB 00010000 b258 DB 11110000 b259 DB 00000000 b260 DB 00000000 b261 DB 00000000 b262 DB 00000000 b264TILE_LINE_BOTTOM_LEFT: equ 24265 DB 00010000 b266 DB 00010000 b267 DB 00010000 b268 DB 00011111 b269 DB 00000000 b270 DB 00000000 b271 DB 00000000 b272 DB 00000000 b274TILE_LINE_BOTTOM_MID: equ 25275 DB 00010000 b276 DB 00010000 b277 DB 00010000 b278 DB 11111111 b279 DB 00000000 b280 DB 00000000 b281 DB 00000000 b282 DB 00000000 b284TILE_LINE_TOP_MID: equ 26285 DB 00000000 b286 DB 00000000 b287 DB 00000000 b288 DB 11111111 b289 DB 00010000 b290 DB 00010000 b291 DB 00010000 b292 DB 00010000 b294TILE_LINE_MID_LEFT: equ 27295 DB 00010000 b296 DB 00010000 b297 DB 00010000 b298 DB 00011111 b299 DB 00010000 b300 DB 00010000 b301 DB 00010000 b302 DB 00010000 b304TILE_LINE_VERTICAL: equ 28305 DB 00010000 b306 DB 00010000 b307 DB 00010000 b308 DB 00010000 b309 DB 00010000 b310 DB 00010000 b311 DB 00010000 b312 DB 00010000 b314TILE_LINE_MID_BOTTOM: equ 29315 DB 00010000 b316 DB 00010000 b317 DB 00010000 b318 DB 11111111 b319 DB 00000000 b320 DB 00000000 b321 DB 00000000 b322 DB 00000000 b324TILE_LINE_HORIZONTAL: equ 30325 DB 00000000 b326 DB 00000000 b327 DB 00000000 b328 DB 11111111 b329 DB 00000000 b330 DB 00000000 b331 DB 00000000 b332 DB 00000000 b334TILE_LINE_BOTTOM_RIGHT_SHADOW: equ 31335 DB 00011110 b336 DB 00011110 b337 DB 00011110 b338 DB 11111110 b339 DB 11111110 b340 DB 11111110 b341 DB 11111110 b342 DB 00000000 b344TILE_ARROW_UP: equ 32345 DB 00000000b346 DB 00000000b347 DB 00001000b348 DB 00011100b349 DB 00111110b350 DB 00000000b351 DB 00000000b352 DB 00000000b354TILE_ARROW_DOWN: equ 33355 DB 00000000b356 DB 00000000b357 DB 00000000b358 DB 00111110b359 DB 00011100b360 DB 00001000b361 DB 00000000b362 DB 00000000b364TILE_DOTS_VERTICAL: equ 34365 DB 00000000b366 DB 00001000b367 DB 00000000b368 DB 00000000b369 DB 00000000b370 DB 00001000b371 DB 00000000b372 DB 00000000b374TILE_ARROW_LEFT: equ 35375 DB 00000000b 376 DB 00000000b 377 DB 00010000b 378 DB 00011000b 379 DB 00011100b 380 DB 00011000b 381 DB 00010000b 382 DB 00000000b 384TILE_ARROW_RIGHT: equ 36385 DB 00000000b 386 DB 00000000b 387 DB 00001000b 388 DB 00011000b 389 DB 00111000b 390 DB 00011000b 391 DB 00001000b 392 DB 00000000b 394TILE_DOTS_HORIZONTAL: equ 37395 DB 00000000b396 DB 00000000b397 DB 00000000b398 DB 00000000b399 DB 00100010b400 DB 00000000b401 DB 00000000b402 DB 00000000b404 413423433435BASE_INDEX_TILE_FONT: equ 38437TILE_FONT_REVERSED_PATTERNS:439441TILE_FONT_REVERSED_NUMBERS_PATTERNS:443TILE_FONT_REVERSED_NUMBERS_0: equ BASE_INDEX_TILE_FONT + 0445 446 db 00000000 b447 db 00111100 b448 db 01100110 b449 db 01101110 b450 db 01110110 b451 db 01100110 b452 db 00111100 b453 db 00000000 b454 455 db 00000000 b456 db 00011000 b457 db 00111000 b458 db 00011000 b459 db 00011000 b460 db 00011000 b461 db 01111110 b462 db 00000000 b463 464 db 00000000 b465 db 00111100 b466 db 01100110 b467 db 00001100 b468 db 00011000 b469 db 00110000 b470 db 01111110 b471 db 00000000 b472 473 db 00000000 b474 db 01111110 b475 db 00001100 b476 db 00011000 b477 db 00001100 b478 db 01100110 b479 db 00111100 b480 db 00000000 b481 482 db 00000000 b483 db 00001100 b484 db 00011100 b485 db 00111100 b486 db 01101100 b487 db 01111110 b488 db 00001100 b489 db 00000000 b490 491 db 00000000 b492 db 01111110 b493 db 01100000 b494 db 01111100 b495 db 00000110 b496 db 01100110 b497 db 00111100 b498 db 00000000 b499 500 db 00000000 b501 db 00111100 b502 db 01100000 b503 db 01111100 b504 db 01100110 b505 db 01100110 b506 db 00111100 b507 db 00000000 b508 509 db 00000000 b510 db 01111110 b511 db 00000110 b512 db 00001100 b513 db 00011000 b514 db 00110000 b515 db 00110000 b516 db 00000000 b517 518 db 00000000 b519 db 00111100 b520 db 01100110 b521 db 00111100 b522 db 01100110 b523 db 01100110 b524 db 00111100 b525 db 00000000 b526 527 db 00000000 b528 db 00111100 b529 db 01100110 b530 db 00111110 b531 db 00000110 b532 db 00001100 b533 db 00111000 b534 db 00000000 b537540TILE_FONT_REVERSED_LOWERCASE_PATTERNS:542TILE_FONT_REVERSED_LOWERCASE_A: equ TILE_FONT_REVERSED_NUMBERS_0 + 10544 545 db 00000000 b546 db 00000000 b547 db 00111100 b548 db 00000110 b549 db 00111110 b550 db 01100110 b551 db 00111110 b552 db 00000000 b553 554 db 00000000 b555 db 01100000 b556 db 01100000 b557 db 01111100 b558 db 01100110 b559 db 01100110 b560 db 01111100 b561 db 00000000 b562 563 db 00000000 b564 db 00000000 b565 db 00111100 b566 db 01100000 b567 db 01100000 b568 db 01100000 b569 db 00111100 b570 db 00000000 b571 572 db 00000000 b573 db 00000110 b574 db 00000110 b575 db 00111110 b576 db 01100110 b577 db 01100110 b578 db 00111110 b579 db 00000000 b580 581 db 00000000 b582 db 00000000 b583 db 00111100 b584 db 01100110 b585 db 01111110 b586 db 01100000 b587 db 00111100 b588 db 00000000 b589 590 db 00000000 b591 db 00001110 b592 db 00011000 b593 db 00111110 b594 db 00011000 b595 db 00011000 b596 db 00011000 b597 db 00000000 b598 599 db 00000000 b600 db 00000000 b601 db 00111110 b602 db 01100110 b603 db 01100110 b604 db 00111110 b605 db 00000110 b606 db 01111100 b607 608 db 00000000 b609 db 01100000 b610 db 01100000 b611 db 01111100 b612 db 01100110 b613 db 01100110 b614 db 01100110 b615 db 00000000 b616 617 db 00000000 b618 db 00011000 b619 db 00000000 b620 db 00111000 b621 db 00011000 b622 db 00011000 b623 db 00111100 b624 db 00000000 b625 626 db 00000000 b627 db 00000110 b628 db 00000000 b629 db 00000110 b630 db 00000110 b631 db 00000110 b632 db 00000110 b633 db 00111100 b634 635 db 00000000 b636 db 01100000 b637 db 01100000 b638 db 01101100 b639 db 01111000 b640 db 01101100 b641 db 01100110 b642 db 00000000 b643 644 db 00000000 b645 db 00111000 b646 db 00011000 b647 db 00011000 b648 db 00011000 b649 db 00011000 b650 db 00111100 b651 db 00000000 b652 653 db 00000000 b654 db 00000000 b655 db 01100110 b656 db 01111111 b657 db 01111111 b658 db 01101011 b659 db 01100011 b660 db 00000000 b661 662 db 00000000 b663 db 00000000 b664 db 01111100 b665 db 01100110 b666 db 01100110 b667 db 01100110 b668 db 01100110 b669 db 00000000 b670 671 db 00000000 b672 db 00000000 b673 db 00111100 b674 db 01100110 b675 db 01100110 b676 db 01100110 b677 db 00111100 b678 db 00000000 b679 680 db 00000000 b681 db 00000000 b682 db 01111100 b683 db 01100110 b684 db 01100110 b685 db 01111100 b686 db 01100000 b687 db 01100000 b688 689 db 00000000 b690 db 00000000 b691 db 00111110 b692 db 01100110 b693 db 01100110 b694 db 00111110 b695 db 00000110 b696 db 00000110 b697 698 db 00000000 b699 db 00000000 b700 db 01111100 b701 db 01100110 b702 db 01100000 b703 db 01100000 b704 db 01100000 b705 db 00000000 b706 707 db 00000000 b708 db 00000000 b709 db 00111110 b710 db 01100000 b711 db 00111100 b712 db 00000110 b713 db 01111100 b714 db 00000000 b715 716 db 00000000 b717 db 00011000 b718 db 01111110 b719 db 00011000 b720 db 00011000 b721 db 00011000 b722 db 00001110 b723 db 00000000 b724 725 db 00000000 b726 db 00000000 b727 db 01100110 b728 db 01100110 b729 db 01100110 b730 db 01100110 b731 db 00111110 b732 db 00000000 b733 734 db 00000000 b735 db 00000000 b736 db 01100110 b737 db 01100110 b738 db 01100110 b739 db 00111100 b740 db 00011000 b741 db 00000000 b742 743 db 00000000 b744 db 00000000 b745 db 01100011 b746 db 01101011 b747 db 01111111 b748 db 00111110 b749 db 00110110 b750 db 00000000 b751 752 db 00000000 b753 db 00000000 b754 db 01100110 b755 db 00111100 b756 db 00011000 b757 db 00111100 b758 db 01100110 b759 db 00000000 b760 761 db 00000000 b762 db 00000000 b763 db 01100110 b764 db 01100110 b765 db 01100110 b766 db 00111110 b767 db 00001100 b768 db 01111000 b769 770 db 00000000 b771 db 00000000 b772 db 01111110 b773 db 00001100 b774 db 00011000 b775 db 00110000 b776 db 01111110 b777 db 00000000 b779TILE_FONT_REVERSED_LOWERCASE_PATTERNS.size: equ $ - TILE_FONT_REVERSED_LOWERCASE_PATTERNS782784TILE_FONT_REVERSED_SYMBOLS_PATTERNS:786TILE_FONT_REVERSED_SYMBOLS: equ TILE_FONT_REVERSED_LOWERCASE_A + 26788 789 db 00000000 b790 db 00000000 b791 db 00011000 b792 db 00011000 b793 db 00000000 b794 db 00011000 b795 db 00011000 b796 db 00000000 b798801TILE_FONT_REVERSED_PATTERNS.SIZE: equ $ - TILE_FONT_REVERSED_PATTERNS804806808TILE_FONT_NUMBERS_PATTERNS:810TILE_FONT_NUMBERS_0: equ TILE_FONT_REVERSED_SYMBOLS + 1812 813 db 00000000 b814 db 00111100 b815 db 01100110 b816 db 01101110 b817 db 01110110 b818 db 01100110 b819 db 00111100 b820 db 00000000 b821 822 db 00000000 b823 db 00011000 b824 db 00111000 b825 db 00011000 b826 db 00011000 b827 db 00011000 b828 db 01111110 b829 db 00000000 b830 831 db 00000000 b832 db 00111100 b833 db 01100110 b834 db 00001100 b835 db 00011000 b836 db 00110000 b837 db 01111110 b838 db 00000000 b839 840 db 00000000 b841 db 01111110 b842 db 00001100 b843 db 00011000 b844 db 00001100 b845 db 01100110 b846 db 00111100 b847 db 00000000 b848 849 db 00000000 b850 db 00001100 b851 db 00011100 b852 db 00111100 b853 db 01101100 b854 db 01111110 b855 db 00001100 b856 db 00000000 b857 858 db 00000000 b859 db 01111110 b860 db 01100000 b861 db 01111100 b862 db 00000110 b863 db 01100110 b864 db 00111100 b865 db 00000000 b866 867 db 00000000 b868 db 00111100 b869 db 01100000 b870 db 01111100 b871 db 01100110 b872 db 01100110 b873 db 00111100 b874 db 00000000 b875 876 db 00000000 b877 db 01111110 b878 db 00000110 b879 db 00001100 b880 db 00011000 b881 db 00110000 b882 db 00110000 b883 db 00000000 b884 885 db 00000000 b886 db 00111100 b887 db 01100110 b888 db 00111100 b889 db 01100110 b890 db 01100110 b891 db 00111100 b892 db 00000000 b893 894 db 00000000 b895 db 00111100 b896 db 01100110 b897 db 00111110 b898 db 00000110 b899 db 00001100 b900 db 00111000 b901 db 00000000 b905908TILE_FONT_LOWERCASE_PATTERNS:910TILE_FONT_LOWERCASE_A: equ TILE_FONT_NUMBERS_0 + 10912 913 db 00000000 b914 db 00000000 b915 db 00111100 b916 db 00000110 b917 db 00111110 b918 db 01100110 b919 db 00111110 b920 db 00000000 b921 922 db 00000000 b923 db 01100000 b924 db 01100000 b925 db 01111100 b926 db 01100110 b927 db 01100110 b928 db 01111100 b929 db 00000000 b930 931 db 00000000 b932 db 00000000 b933 db 00111100 b934 db 01100000 b935 db 01100000 b936 db 01100000 b937 db 00111100 b938 db 00000000 b939 940 db 00000000 b941 db 00000110 b942 db 00000110 b943 db 00111110 b944 db 01100110 b945 db 01100110 b946 db 00111110 b947 db 00000000 b948 949 db 00000000 b950 db 00000000 b951 db 00111100 b952 db 01100110 b953 db 01111110 b954 db 01100000 b955 db 00111100 b956 db 00000000 b957 958 db 00000000 b959 db 00001110 b960 db 00011000 b961 db 00111110 b962 db 00011000 b963 db 00011000 b964 db 00011000 b965 db 00000000 b966 967 db 00000000 b968 db 00000000 b969 db 00111110 b970 db 01100110 b971 db 01100110 b972 db 00111110 b973 db 00000110 b974 db 01111100 b975 976 db 00000000 b977 db 01100000 b978 db 01100000 b979 db 01111100 b980 db 01100110 b981 db 01100110 b982 db 01100110 b983 db 00000000 b984 985 db 00000000 b986 db 00011000 b987 db 00000000 b988 db 00111000 b989 db 00011000 b990 db 00011000 b991 db 00111100 b992 db 00000000 b993 994 db 00000000 b995 db 00000110 b996 db 00000000 b997 db 00000110 b998 db 00000110 b999 db 00000110 b1000 db 00000110 b1001 db 00111100 b1002 1003 db 00000000 b1004 db 01100000 b1005 db 01100000 b1006 db 01101100 b1007 db 01111000 b1008 db 01101100 b1009 db 01100110 b1010 db 00000000 b1011 1012 db 00000000 b1013 db 00111000 b1014 db 00011000 b1015 db 00011000 b1016 db 00011000 b1017 db 00011000 b1018 db 00111100 b1019 db 00000000 b1020 1021 db 00000000 b1022 db 00000000 b1023 db 01100110 b1024 db 01111111 b1025 db 01111111 b1026 db 01101011 b1027 db 01100011 b1028 db 00000000 b1029 1030 db 00000000 b1031 db 00000000 b1032 db 01111100 b1033 db 01100110 b1034 db 01100110 b1035 db 01100110 b1036 db 01100110 b1037 db 00000000 b1038 1039 db 00000000 b1040 db 00000000 b1041 db 00111100 b1042 db 01100110 b1043 db 01100110 b1044 db 01100110 b1045 db 00111100 b1046 db 00000000 b1047 1048 db 00000000 b1049 db 00000000 b1050 db 01111100 b1051 db 01100110 b1052 db 01100110 b1053 db 01111100 b1054 db 01100000 b1055 db 01100000 b1056 1057 db 00000000 b1058 db 00000000 b1059 db 00111110 b1060 db 01100110 b1061 db 01100110 b1062 db 00111110 b1063 db 00000110 b1064 db 00000110 b1065 1066 db 00000000 b1067 db 00000000 b1068 db 01111100 b1069 db 01100110 b1070 db 01100000 b1071 db 01100000 b1072 db 01100000 b1073 db 00000000 b1074 1075 db 00000000 b1076 db 00000000 b1077 db 00111110 b1078 db 01100000 b1079 db 00111100 b1080 db 00000110 b1081 db 01111100 b1082 db 00000000 b1083 1084 db 00000000 b1085 db 00011000 b1086 db 01111110 b1087 db 00011000 b1088 db 00011000 b1089 db 00011000 b1090 db 00001110 b1091 db 00000000 b1092 1093 db 00000000 b1094 db 00000000 b1095 db 01100110 b1096 db 01100110 b1097 db 01100110 b1098 db 01100110 b1099 db 00111110 b1100 db 00000000 b1101 1102 db 00000000 b1103 db 00000000 b1104 db 01100110 b1105 db 01100110 b1106 db 01100110 b1107 db 00111100 b1108 db 00011000 b1109 db 00000000 b1110 1111 db 00000000 b1112 db 00000000 b1113 db 01100011 b1114 db 01101011 b1115 db 01111111 b1116 db 00111110 b1117 db 00110110 b1118 db 00000000 b1119 1120 db 00000000 b1121 db 00000000 b1122 db 01100110 b1123 db 00111100 b1124 db 00011000 b1125 db 00111100 b1126 db 01100110 b1127 db 00000000 b1128 1129 db 00000000 b1130 db 00000000 b1131 db 01100110 b1132 db 01100110 b1133 db 01100110 b1134 db 00111110 b1135 db 00001100 b1136 db 01111000 b1137 1138 db 00000000 b1139 db 00000000 b1140 db 01111110 b1141 db 00001100 b1142 db 00011000 b1143 db 00110000 b1144 db 01111110 b1145 db 00000000 b114711491151TILE_FONT_UPPERCASE_PATTERNS:1153TILE_FONT_UPPERCASE_A: equ TILE_FONT_LOWERCASE_A + 261155 1156 db 00000000 b1157 db 00011000 b1158 db 00111100 b1159 db 01100110 b1160 db 01100110 b1161 db 01111110 b1162 db 01100110 b1163 db 00000000 b1164 1165 db 00000000 b1166 db 01111100 b1167 db 01100110 b1168 db 01111100 b1169 db 01100110 b1170 db 01100110 b1171 db 01111100 b1172 db 00000000 b1173 1174 db 00000000 b1175 db 00111100 b1176 db 01100110 b1177 db 01100000 b1178 db 01100000 b1179 db 01100110 b1180 db 00111100 b1181 db 00000000 b1182 1183 db 00000000 b1184 db 01111000 b1185 db 01101100 b1186 db 01100110 b1187 db 01100110 b1188 db 01101100 b1189 db 01111000 b1190 db 00000000 b1191 1192 db 00000000 b1193 db 01111110 b1194 db 01100000 b1195 db 01111100 b1196 db 01100000 b1197 db 01100000 b1198 db 01111110 b1199 db 00000000 b1200 1201 db 00000000 b1202 db 01111110 b1203 db 01100000 b1204 db 01111100 b1205 db 01100000 b1206 db 01100000 b1207 db 01100000 b1208 db 00000000 b1209 1210 db 00000000 b1211 db 00111110 b1212 db 01100000 b1213 db 01100000 b1214 db 01101110 b1215 db 01100110 b1216 db 00111110 b1217 db 00000000 b1218 1219 db 00000000 b1220 db 01100110 b1221 db 01100110 b1222 db 01111110 b1223 db 01100110 b1224 db 01100110 b1225 db 01100110 b1226 db 00000000 b1227 1228 db 00000000 b1229 db 01111110 b1230 db 00011000 b1231 db 00011000 b1232 db 00011000 b1233 db 00011000 b1234 db 01111110 b1235 db 00000000 b1236 1237 db 00000000 b1238 db 00000110 b1239 db 00000110 b1240 db 00000110 b1241 db 00000110 b1242 db 01100110 b1243 db 00111100 b1244 db 00000000 b1245 1246 db 00000000 b1247 db 01100110 b1248 db 01101100 b1249 db 01111000 b1250 db 01111000 b1251 db 01101100 b1252 db 01100110 b1253 db 00000000 b1254 1255 db 00000000 b1256 db 01100000 b1257 db 01100000 b1258 db 01100000 b1259 db 01100000 b1260 db 01100000 b1261 db 01111110 b1262 db 00000000 b1263 1264 db 00000000 b1265 db 01100011 b1266 db 01110111 b1267 db 01111111 b1268 db 01101011 b1269 db 01100011 b1270 db 01100011 b1271 db 00000000 b1272 1273 db 00000000 b1274 db 01100110 b1275 db 01110110 b1276 db 01111110 b1277 db 01111110 b1278 db 01101110 b1279 db 01100110 b1280 db 00000000 b1281 1282 db 00000000 b1283 db 00111100 b1284 db 01100110 b1285 db 01100110 b1286 db 01100110 b1287 db 01100110 b1288 db 00111100 b1289 db 00000000 b1290 1291 db 00000000 b1292 db 01111100 b1293 db 01100110 b1294 db 01100110 b1295 db 01111100 b1296 db 01100000 b1297 db 01100000 b1298 db 00000000 b1299 1300 db 00000000 b1301 db 00111100 b1302 db 01100110 b1303 db 01100110 b1304 db 01100110 b1305 db 01101100 b1306 db 00110110 b1307 db 00000000 b1308 1309 db 00000000 b1310 db 01111100 b1311 db 01100110 b1312 db 01100110 b1313 db 01111100 b1314 db 01101100 b1315 db 01100110 b1316 db 00000000 b1317 1318 db 00000000 b1319 db 00111100 b1320 db 01100000 b1321 db 00111100 b1322 db 00000110 b1323 db 00000110 b1324 db 00111100 b1325 db 00000000 b1326 1327 db 00000000 b1328 db 01111110 b1329 db 00011000 b1330 db 00011000 b1331 db 00011000 b1332 db 00011000 b1333 db 00011000 b1334 db 00000000 b1335 1336 db 00000000 b1337 db 01100110 b1338 db 01100110 b1339 db 01100110 b1340 db 01100110 b1341 db 01100110 b1342 db 01111110 b1343 db 00000000 b1344 1345 db 00000000 b1346 db 01100110 b1347 db 01100110 b1348 db 01100110 b1349 db 01100110 b1350 db 00111100 b1351 db 00011000 b1352 db 00000000 b1353 1354 db 00000000 b1355 db 01100011 b1356 db 01100011 b1357 db 01101011 b1358 db 01111111 b1359 db 01110111 b1360 db 01100011 b1361 db 00000000 b1362 1363 db 00000000 b1364 db 01100110 b1365 db 01100110 b1366 db 00111100 b1367 db 00111100 b1368 db 01100110 b1369 db 01100110 b1370 db 00000000 b1371 1372 db 00000000 b1373 db 01100110 b1374 db 01100110 b1375 db 00111100 b1376 db 00011000 b1377 db 00011000 b1378 db 00011000 b1379 db 00000000 b1380 1381 db 00000000 b1382 db 01111110 b1383 db 00001100 b1384 db 00011000 b1385 db 00110000 b1386 db 01100000 b1387 db 01111110 b1388 db 00000000 b13901392TILE_FONT_SYMBOLS_PATTERNS:1394TILE_FONT_SYMBOLS: equ TILE_FONT_UPPERCASE_A + 261396TILE_EXCLAMATION: equ TILE_FONT_SYMBOLS + 01397 db 00000000 b1398 db 00011000 b1399 db 00011000 b1400 db 00011000 b1401 db 00011000 b1402 db 00000000 b1403 db 00011000 b1404 db 00000000 b1406TILE_DOUBLE_QUOTE: equ TILE_FONT_SYMBOLS + 11407 db 00000000 b1408 db 01100110 b1409 db 01100110 b1410 db 01100110 b1411 db 00000000 b1412 db 00000000 b1413 db 00000000 b1414 db 00000000 b1416TILE_PERCENT: equ TILE_FONT_SYMBOLS + 21417 db 00000000 b1418 db 01100110 b1419 db 01101100 b1420 db 00011000 b1421 db 00110000 b1422 db 01100110 b1423 db 01000110 b1424 db 00000000 b1426TILE_SINGLE_QUOTE: equ TILE_FONT_SYMBOLS + 31427 db 00000000 b1428 db 00011000 b1429 db 00011000 b1430 db 00011000 b1431 db 00000000 b1432 db 00000000 b1433 db 00000000 b1434 db 00000000 b1436TILE_OPEN_ROUND_BRACKETS: equ TILE_FONT_SYMBOLS + 41437 db 00000000 b1438 db 00001110 b1439 db 00011100 b1440 db 00011000 b1441 db 00011000 b1442 db 00011100 b1443 db 00001110 b1444 db 00000000 b1446TILE_CLOSE_ROUND_BRACKETS: equ TILE_FONT_SYMBOLS + 51447 db 00000000 b1448 db 01110000 b1449 db 00111000 b1450 db 00011000 b1451 db 00011000 b1452 db 00111000 b1453 db 01110000 b1454 db 00000000 b1456TILE_STAR: equ TILE_FONT_SYMBOLS + 61457 db 00000000 b1458 db 01100110 b1459 db 00111100 b1460 db 11111111 b1461 db 00111100 b1462 db 01100110 b1463 db 00000000 b1464 db 00000000 b1466TILE_PLUS: equ TILE_FONT_SYMBOLS + 71467 db 00000000 b1468 db 00011000 b1469 db 00011000 b1470 db 01111110 b1471 db 00011000 b1472 db 00011000 b1473 db 00000000 b1474 db 00000000 b1476TILE_COMMA: equ TILE_FONT_SYMBOLS + 81477 db 00000000 b1478 db 00000000 b1479 db 00000000 b1480 db 00000000 b1481 db 00000000 b1482 db 00011000 b1483 db 00011000 b1484 db 00110000 b1486TILE_MINUS: equ TILE_FONT_SYMBOLS + 91487 db 00000000 b1488 db 00000000 b1489 db 00000000 b1490 db 01111110 b1491 db 00000000 b1492 db 00000000 b1493 db 00000000 b1494 db 00000000 b1496TILE_DOT: equ TILE_FONT_SYMBOLS + 101497 db 00000000 b1498 db 00000000 b1499 db 00000000 b1500 db 00000000 b1501 db 00000000 b1502 db 00011000 b1503 db 00011000 b1504 db 00000000 b1506TILE_SLASH: equ TILE_FONT_SYMBOLS + 111507 db 00000000 b1508 db 00000110 b1509 db 00001100 b1510 db 00011000 b1511 db 00110000 b1512 db 01100000 b1513 db 01000000 b1514 db 00000000 b1515 1516 db 00000000 b1517 db 00000000 b1518 db 00011000 b1519 db 00011000 b1520 db 00000000 b1521 db 00011000 b1522 db 00011000 b1523 db 00000000 b1524 1525 db 00000000 b1526 db 00000000 b1527 db 00011000 b1528 db 00011000 b1529 db 00000000 b1530 db 00011000 b1531 db 00011000 b1532 db 00110000 b1533 1534 db 00000110 b1535 db 00001100 b1536 db 00011000 b1537 db 00110000 b1538 db 00011000 b1539 db 00001100 b1540 db 00000110 b1541 db 00000000 b1543TILE_EQUAL: equ TILE_FONT_SYMBOLS + 151544 db 00000000 b1545 db 00000000 b1546 db 01111110 b1547 db 00000000 b1548 db 00000000 b1549 db 01111110 b1550 db 00000000 b1551 db 00000000 b1552 1553 db 01100000 b1554 db 00110000 b1555 db 00011000 b1556 db 00001100 b1557 db 00011000 b1558 db 00110000 b1559 db 01100000 b1560 db 00000000 b1561 1562 db 00000000 b1563 db 00111100 b1564 db 01100110 b1565 db 00001100 b1566 db 00011000 b1567 db 00000000 b1568 db 00011000 b1569 db 00000000 b1570 1571 db 00011000 b1572 db 00111100 b1573 db 01100000 b1574 db 00111100 b1575 db 00000110 b1576 db 00000110 b1577 db 00111100 b1578 db 00000000 b1579 1580 db 00000000 b1581 db 01000000 b1582 db 01100000 b1583 db 00110000 b1584 db 00011000 b1585 db 00001100 b1586 db 00000110 b1587 db 00000000 b1588 1589 db 00000000 b1590 db 00001000 b1591 db 00011100 b1592 db 00110110 b1593 db 01100011 b1594 db 00000000 b1595 db 00000000 b1596 db 00000000 b1597 1598 db 00000000 b1599 db 00000000 b1600 db 00000000 b1601 db 00000000 b1602 db 00000000 b1603 db 00000000 b1604 db 11111111 b1605 db 00000000 b16071609TILE_FILLED_COLORS_PATTERNS:1611TILE_FILLED_COLORS: equ TILE_FONT_SYMBOLS + 221613TILE_COLOR_1: equ TILE_EMPTY_BLACK1615TILE_COLOR_2: equ TILE_FILLED_COLORS + 01616 db 11111111 b1617 db 11111111 b1618 db 11111111 b1619 db 11111111 b1620 db 11111111 b1621 db 11111111 b1622 db 11111111 b1623 db 11111111 b1625TILE_COLOR_3: equ TILE_FILLED_COLORS + 11626 db 11111111 b1627 db 11111111 b1628 db 11111111 b1629 db 11111111 b1630 db 11111111 b1631 db 11111111 b1632 db 11111111 b1633 db 11111111 b1635TILE_COLOR_4: equ TILE_FILLED_COLORS + 21636 db 11111111 b1637 db 11111111 b1638 db 11111111 b1639 db 11111111 b1640 db 11111111 b1641 db 11111111 b1642 db 11111111 b1643 db 11111111 b1645TILE_COLOR_5: equ TILE_FILLED_COLORS + 31646 db 11111111 b1647 db 11111111 b1648 db 11111111 b1649 db 11111111 b1650 db 11111111 b1651 db 11111111 b1652 db 11111111 b1653 db 11111111 b1655TILE_COLOR_6: equ TILE_FILLED_COLORS + 41656 db 11111111 b1657 db 11111111 b1658 db 11111111 b1659 db 11111111 b1660 db 11111111 b1661 db 11111111 b1662 db 11111111 b1663 db 11111111 b1665TILE_COLOR_7: equ TILE_FILLED_COLORS + 51666 db 11111111 b1667 db 11111111 b1668 db 11111111 b1669 db 11111111 b1670 db 11111111 b1671 db 11111111 b1672 db 11111111 b1673 db 11111111 b1675TILE_COLOR_8: equ TILE_FILLED_COLORS + 61676 db 11111111 b1677 db 11111111 b1678 db 11111111 b1679 db 11111111 b1680 db 11111111 b1681 db 11111111 b1682 db 11111111 b1683 db 11111111 b1685TILE_COLOR_9: equ TILE_FILLED_COLORS + 71686 db 11111111 b1687 db 11111111 b1688 db 11111111 b1689 db 11111111 b1690 db 11111111 b1691 db 11111111 b1692 db 11111111 b1693 db 11111111 b1695TILE_COLOR_10: equ TILE_FILLED_COLORS + 81696 db 11111111 b1697 db 11111111 b1698 db 11111111 b1699 db 11111111 b1700 db 11111111 b1701 db 11111111 b1702 db 11111111 b1703 db 11111111 b1705TILE_COLOR_11: equ TILE_FILLED_COLORS + 91706 db 11111111 b1707 db 11111111 b1708 db 11111111 b1709 db 11111111 b1710 db 11111111 b1711 db 11111111 b1712 db 11111111 b1713 db 11111111 b1715TILE_COLOR_12: equ TILE_FILLED_COLORS + 101716 db 11111111 b1717 db 11111111 b1718 db 11111111 b1719 db 11111111 b1720 db 11111111 b1721 db 11111111 b1722 db 11111111 b1723 db 11111111 b1725TILE_COLOR_13: equ TILE_FILLED_COLORS + 111726 db 11111111 b1727 db 11111111 b1728 db 11111111 b1729 db 11111111 b1730 db 11111111 b1731 db 11111111 b1732 db 11111111 b1733 db 11111111 b1735TILE_COLOR_14: equ TILE_FILLED_COLORS + 121736 db 11111111 b1737 db 11111111 b1738 db 11111111 b1739 db 11111111 b1740 db 11111111 b1741 db 11111111 b1742 db 11111111 b1743 db 11111111 b1745TILE_COLOR_15: equ TILE_EMPTY17471749TILE_PATTERNS.size: equ $ - TILE_PATTERNS1751175317551757TILE_MOUSE_OVER: equ TILE_BASE_DESKTOP_ICONS - 1175917611763NUMBER_OF_TILES_PER_ICON: equ 91765TILE_BASE_DESKTOP_ICONS: equ 190 1767 TILE_BASE_DESKTOP_ICON_0: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 0)1768 TILE_BASE_DESKTOP_ICON_1: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 1)177017721774NUMBER_OF_TILES_RESERVED_PER_PROCESS: equ 121776TILE_BASE_INDEX_PROCESSES: equ 208 1778 TILE_BASE_INDEX_PROCESS_0: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 0)1779 TILE_BASE_INDEX_PROCESS_1: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 1)1780 TILE_BASE_INDEX_PROCESS_2: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 2)1781 TILE_BASE_INDEX_PROCESS_3: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 3)1782System\Main.s27 Graphics/Sprites.s1SPRITE_PATTERNS:3SPRITE_CURSOR_ARROW_PATTERN:5SPRITE_INDEX_CURSOR_0: equ 0 * 46 8 DB 10000000b9 DB 11000000b10 DB 10100000b11 DB 10010000b12 DB 10001000b13 DB 10000100b14 DB 10000010b15 DB 10000001b16 DB 10000000b17 DB 10000000b18 DB 10000011b19 DB 10010010b20 DB 10101001b21 DB 11001001b22 DB 00000110b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b27 DB 00000000b28 DB 00000000b29 DB 00000000b30 DB 00000000b31 DB 00000000b32 DB 10000000b33 DB 01000000b34 DB 11000000b35 DB 00000000b36 DB 00000000b37 DB 00000000b38 DB 00000000b39 DB 00000000b40SPRITE_INDEX_CURSOR_1: equ 1 * 441 42 DB 00000000b43 DB 00000000b44 DB 01000000b45 DB 01100000b46 DB 01110000b47 DB 01111000b48 DB 01111100b49 DB 01111110b50 DB 01111111b51 DB 01111111b52 DB 01111100b53 DB 01101100b54 DB 01000110b55 DB 00000110b56 DB 00000000b57 DB 00000000b58 DB 00000000b59 DB 00000000b60 DB 00000000b61 DB 00000000b62 DB 00000000b63 DB 00000000b64 DB 00000000b65 DB 00000000b66 DB 00000000b67 DB 10000000b68 DB 00000000b69 DB 00000000b70 DB 00000000b71 DB 00000000b72 DB 00000000b73 DB 00000000b74SPRITE_CURSOR_ARROW_PATTERN.size: equ $ - SPRITE_CURSOR_ARROW_PATTERN76SPRITE_INDEX_WINDOW_TOP_LEFT: equ 2 * 477 DB 11001100 b78 DB 10000000 b79 DB 00000000 b80 DB 00000000 b81 DB 10000000 b82 DB 10000000 b83 DB 00000000 b84 DB 00000000 b86 DB 10000000 b87 DB 10000000 b88 DB 00000000 b89 DB 00000000 b90 DB 10000000 b91 DB 10000000 b92 DB 00000000 b93 DB 00000000 b95 DB 11001100 b96 DB 00000000 b97 DB 00000000 b98 DB 00000000 b99 DB 00000000 b100 DB 00000000 b101 DB 00000000 b102 DB 00000000 b104 DB 00000000 b105 DB 00000000 b106 DB 00000000 b107 DB 00000000 b108 DB 00000000 b109 DB 00000000 b110 DB 00000000 b111 DB 00000000 b113SPRITE_INDEX_WINDOW_TOP_RIGHT: equ 3 * 4114 DB 11001100 b115 DB 00000000 b116 DB 00000000 b117 DB 00000000 b118 DB 00000000 b119 DB 00000000 b120 DB 00000000 b121 DB 00000000 b123 DB 00000000 b124 DB 00000000 b125 DB 00000000 b126 DB 00000000 b127 DB 00000000 b128 DB 00000000 b129 DB 00000000 b130 DB 00000000 b132 DB 00110011 b133 DB 00000001 b134 DB 00000000 b135 DB 00000000 b136 DB 00000001 b137 DB 00000001 b138 DB 00000000 b139 DB 00000000 b141 DB 00000001 b142 DB 00000001 b143 DB 00000000 b144 DB 00000000 b145 DB 00000001 b146 DB 00000001 b147 DB 00000000 b148 DB 00000000 b150SPRITE_INDEX_WINDOW_BOTTOM_LEFT: equ 4 * 4151 DB 00000000 b152 DB 00000000 b153 DB 10000000 b154 DB 10000000 b155 DB 00000000 b156 DB 00000000 b157 DB 10000000 b158 DB 10000000 b160 DB 00000000 b161 DB 00000000 b162 DB 10000000 b163 DB 10000000 b164 DB 00000000 b165 DB 00000000 b166 DB 10000000 b167 DB 11001100 b169 DB 00000000 b170 DB 00000000 b171 DB 00000000 b172 DB 00000000 b173 DB 00000000 b174 DB 00000000 b175 DB 00000000 b176 DB 00000000 b178 DB 00000000 b179 DB 00000000 b180 DB 00000000 b181 DB 00000000 b182 DB 00000000 b183 DB 00000000 b184 DB 00000000 b185 DB 11001100 b187SPRITE_INDEX_WINDOW_BOTTOM_RIGHT: equ 5 * 4188 DB 00000000 b189 DB 00000000 b190 DB 00000000 b191 DB 00000000 b192 DB 00000000 b193 DB 00000000 b194 DB 00000000 b195 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 00000000 b200 DB 00000000 b201 DB 00000000 b202 DB 00000000 b203 DB 00000000 b204 DB 00110011 b206 DB 00000000 b207 DB 00000000 b208 DB 00000001 b209 DB 00000001 b210 DB 00000000 b211 DB 00000000 b212 DB 00000001 b213 DB 00000001 b215 DB 00000000 b216 DB 00000000 b217 DB 00000001 b218 DB 00000001 b219 DB 00000000 b220 DB 00000000 b221 DB 00000001 b222 DB 00110011 b224SPRITE_PATTERNS.size: equ $ - SPRITE_PATTERNS228SPRITE_CURSOR_RESIZE_PATTERN:229 230 DB 11111110b231 DB 10000100b232 DB 10001000b233 DB 10000100b234 DB 10100010b235 DB 11010001b236 DB 10001000b237 DB 00000100b238 DB 00000010b239 DB 00000001b240 DB 00000000b241 DB 00000000b242 DB 00000000b243 DB 00000000b244 DB 00000000b245 DB 00000000b246 DB 00000000b247 DB 00000000b248 DB 00000000b249 DB 00000000b250 DB 00000000b251 DB 00000000b252 DB 10000000b253 DB 01000000b254 DB 00100000b255 DB 00010001b256 DB 10001011b257 DB 01000101b258 DB 00100001b259 DB 00010001b260 DB 00100001b261 DB 01111111b262 263 DB 00000000b264 DB 01111000b265 DB 01110000b266 DB 01111000b267 DB 01011100b268 DB 00001110b269 DB 00000111b270 DB 00000011b271 DB 00000001b272 DB 00000000b273 DB 00000000b274 DB 00000000b275 DB 00000000b276 DB 00000000b277 DB 00000000b278 DB 00000000b279 DB 00000000b280 DB 00000000b281 DB 00000000b282 DB 00000000b283 DB 00000000b284 DB 00000000b285 DB 00000000b286 DB 10000000b287 DB 11000000b288 DB 11100000b289 DB 01110000b290 DB 00111010b291 DB 00011110b292 DB 00001110b293 DB 00011110b294 DB 00000000b295.size: equ $ - SPRITE_CURSOR_RESIZE_PATTERNSystem\Main.s3031 Apps/Notepad/Header.s1Notepad:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 - 39.y: db 410.width: db 1411.height: db 812.minWidth: db 1213.minHeight: db 615.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 13 17 db TILE_FONT_REVERSED_LOWERCASE_A + 14 18 db TILE_FONT_REVERSED_LOWERCASE_A + 19 19 db TILE_FONT_REVERSED_LOWERCASE_A + 4 20 db TILE_FONT_REVERSED_LOWERCASE_A + 15 21 db TILE_FONT_REVERSED_LOWERCASE_A + 0 22 db TILE_FONT_REVERSED_LOWERCASE_A + 3 23 db 0 24 db 025 db 026 db 027 db 028 db 029 db 030 db 031 db 032.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 13 34 db TILE_FONT_REVERSED_LOWERCASE_A + 14 35 db TILE_FONT_REVERSED_LOWERCASE_A + 19 36 db TILE_FONT_REVERSED_LOWERCASE_A + 4 37.iconTitle:38 db TILE_FONT_LOWERCASE_A + 13 39 db TILE_FONT_LOWERCASE_A + 14 40 db TILE_FONT_LOWERCASE_A + 19 41 db TILE_FONT_LOWERCASE_A + 4 42 db TILE_FONT_LOWERCASE_A + 15 43 db TILE_FONT_LOWERCASE_A + 0 44 db TILE_FONT_LOWERCASE_A + 3 46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Notepad_Open52.workAddr: dw Notepad_Work53.drawAddr: dw Notepad_Draw54.clickAddr: dw Notepad_Click55.getFocusAddr: dw Notepad_GetFocus56.loseFocusAddr: dw Notepad_LoseFocus57.closeAddr: dw Notepad_Close59.iconAddr: dw Notepad_Icon61.ramSize: dw 1024 6465Notepad.StartProgramCode:67Notepad_Open:68 Apps/Notepad/Open.s14 5 ld l, (ix + PROCESS_STRUCT_IX.ramStartAddr)6 ld h, (ix + PROCESS_STRUCT_IX.ramStartAddr + 1)8 push hl 9 pop iy11 12 xor a13 ld (iy + NOTEPAD_VARS.CURSOR_POSITION), a15 16 ld a, TEXT_END_OF_FILE17 ld (iy + NOTEPAD_VARS.TEXT_START), a19 20 call BIOS_KILBUF22 25 31 32 35 37 41 44 50 ret51Apps/Notepad/Header.s70Notepad_Work:71 Apps/Notepad/Work.s14 8 call BIOS_CHSNS 9 ret z11 call BIOS_CHGET12 14 cp 9715 ret c16 17 cp 122 + 118 ret nc20 24 25 ld l, (ix + PROCESS_STRUCT_IX.ramStartAddr)26 ld h, (ix + PROCESS_STRUCT_IX.ramStartAddr + 1)28 push hl 29 pop iy32 33 ld b, TILE_FONT_LOWERCASE_A - ASCII_CODE_LOWERCASE_A34 add b36 37 ld d, 038 ld e, (iy + NOTEPAD_VARS.CURSOR_POSITION)39 push iy40 add iy, de41 ld (iy + NOTEPAD_VARS.TEXT_START), a42 pop iy43 44 45 inc (iy + NOTEPAD_VARS.CURSOR_POSITION)47 48 ld a, TEXT_END_OF_FILE49 ld d, 050 ld e, (iy + NOTEPAD_VARS.CURSOR_POSITION)51 push iy52 add iy, de53 ld (iy + NOTEPAD_VARS.TEXT_START), a54 pop iy57 58 ld e, (ix + PROCESS_STRUCT_IX.drawAddr) 59 ld d, (ix + PROCESS_STRUCT_IX.drawAddr + 1) 60 call JP_DE62 68 69 72 75 78 82 85 89 93 ret94Apps/Notepad/Header.s73Notepad_Draw:74 Apps/Notepad/Draw.s14 5 call GET_WINDOW_NAMTBL_LAST_USEFUL_COLUMN7.cont_1:8 call BIOS_SETWRT9 ld c, PORT_010 ld a, TILE_ARROW_UP11 out (c), a13 call GET_WINDOW_USEFUL_HEIGHT14 sub 2 15 ld b, a16 ld de, 3217 add hl, de 18.loop_1:19 call BIOS_SETWRT20 ld a, TILE_DOTS_VERTICAL21 out (c), a22 add hl, de 23 djnz .loop_125 call BIOS_SETWRT26 ld c, PORT_027 ld a, TILE_ARROW_DOWN28 out (c), a30 33 call GET_USEFUL_WINDOW_BASE_NAMTBL35 call BIOS_SETWRT37 41 42 ld l, (ix + PROCESS_STRUCT_IX.ramStartAddr)43 ld h, (ix + PROCESS_STRUCT_IX.ramStartAddr + 1)45 push hl 46 pop iy48 50 ld d, 0 51 push iy52.loop:53 ld a, (iy + NOTEPAD_VARS.TEXT_START)54 cp TEXT_END_OF_FILE55 jp z, .endLoop56 57 ld e, a59 ld a, (ix + PROCESS_STRUCT_IX.windowState)60 cp WINDOW_STATE.RESTORED61 jp z, .isRestored63 64 ld b, 3265 jp .checkWidth67 .isRestored:68 69 ld a, (ix + PROCESS_STRUCT_IX.width)70 sub 371 ld b, a72 73 .checkWidth:74 ld a, d75 76 cp b77 jp nc, .ignore79 ld a, e80 out (PORT_0), a81 82 .ignore:84 inc d85 inc iy86 jp .loop88.endLoop:89 pop iy91 ret92Apps/Notepad/Header.s76Notepad_Click:77 Apps/Notepad/Click.s14 5 6 retApps/Notepad/Header.s79Notepad_GetFocus:80 Apps/Notepad/GetFocus.s14 5 call BIOS_KILBUF6 7 retApps/Notepad/Header.s82Notepad_LoseFocus:83 Apps/Notepad/LoseFocus.s14 5 6 retApps/Notepad/Header.s85Notepad_Close:86 Apps/Notepad/Close.s14 6 14 retApps/Notepad/Header.s88Notepad.EndProgramCode: 9293Notepad.StartProgramData:95Notepad_Icon:96 Apps/Notepad/Icon.s12 DB 00000000b3 DB 00000001b4 DB 00000010b5 DB 00000010b6 DB 00000100b7 DB 00000100b8 DB 00001000b9 DB 00001000b11 DB 00010001b12 DB 00010000b13 DB 00100000b14 DB 00100000b15 DB 01000000b16 DB 01000000b17 DB 10000000b18 DB 10000000b20 DB 10000000b21 DB 01111111b22 DB 00000000b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b27 DB 00000000b2931 DB 01101101b32 DB 10110110b33 DB 01001001b34 DB 00000000b35 DB 00000000b36 DB 00000000b37 DB 11111111b38 DB 00000000b40 DB 11111110b41 DB 00000000b42 DB 00000000b43 DB 00000000b44 DB 00000000b45 DB 00000001b46 DB 00000001b47 DB 00000010b49 DB 00000010b50 DB 11111101b51 DB 10000000b52 DB 10111111b53 DB 10000000b54 DB 10101010b55 DB 01111111b56 DB 00111111b5859 DB 10110000b60 DB 11011100b61 DB 00100110b62 DB 00001011b63 DB 00001011b64 DB 00010011b65 DB 00010111b66 DB 00100011b68 DB 00100111b69 DB 01010011b70 DB 01000111b71 DB 10110011b72 DB 10000111b73 DB 01110011b74 DB 00000111b75 DB 11110011b77 DB 00000111b78 DB 11110011b79 DB 00000111b80 DB 11110011b81 DB 00000111b82 DB 10101111b83 DB 11111110b84 DB 11111100b85Apps/Notepad/Header.s98Notepad_Data:99 Apps/Notepad/Data.s12NOTEPAD_VARS:3 .CURSOR_POSITION: equ 04 .TEXT_START: equ 16TEXT_END_OF_FILE: equ 25581012Apps/Notepad/Header.s101Notepad.EndProgramData: 103System\Main.s32 Apps/Calc/Header.s1Calc:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 + 139.y: db 810.width: db 1411.height: db 1812.minWidth: db 1413.minHeight: db 1815.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 2 17 db TILE_FONT_REVERSED_LOWERCASE_A + 0 18 db TILE_FONT_REVERSED_LOWERCASE_A + 11 19 db TILE_FONT_REVERSED_LOWERCASE_A + 2 20 db 0 21 db 022 db 023 db 024 db 025 db 026 db 027 db 028 db 029 db 030 db 031 db 032.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 2 34 db TILE_FONT_REVERSED_LOWERCASE_A + 0 35 db TILE_FONT_REVERSED_LOWERCASE_A + 11 36 db TILE_FONT_REVERSED_LOWERCASE_A + 2 37.iconTitle:38 db TILE_EMPTY39 db TILE_FONT_LOWERCASE_A + 2 40 db TILE_FONT_LOWERCASE_A + 0 41 db TILE_FONT_LOWERCASE_A + 11 42 db TILE_FONT_LOWERCASE_A + 2 43 db TILE_EMPTY44 db TILE_EMPTY46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Calc_Open52.workAddr: dw Calc_Work53.drawAddr: dw Calc_Draw54.clickAddr: dw Calc_Click55.getFocusAddr: dw Calc_GetFocus56.loseFocusAddr: dw Calc_LoseFocus57.closeAddr: dw Calc_Close59.iconAddr: dw Calc_Icon61.ramSize: dw 1024 6465Calc.StartProgramCode:67Calc_Open:68 Apps/Calc/Open.s14 10 11 14 16 22 retApps/Calc/Header.s70Calc_Work:71 Apps/Calc/Work.s14 10 11 14 call GET_USEFUL_WINDOW_BASE_NAMTBL16 ld bc, (32 * 2) 17 add hl, bc19 21 call BIOS_SETWRT22 ld a, (OS.timeCounter)23 ld d, a 24 25 and 1111 0000 b26 srl a 27 srl a 28 srl a 29 srl a 30 ld b, TILE_FONT_NUMBERS_0 + 031 add b32 out (PORT_0), a34 ld a, d 35 and 0000 1111 b36 ld b, TILE_FONT_NUMBERS_0 + 037 add b38 out (PORT_0), a41 retApps/Calc/Header.s73Calc_Draw:74 Apps/Calc/Draw.s15 call GET_USEFUL_WINDOW_BASE_NAMTBL7 8 ld a, (ix + PROCESS_STRUCT_IX.windowState)9 cp WINDOW_STATE.MAXIMIZED10 jp nz, .skip_111 inc hl12.skip_1:14 ex de, hl16 17 ld hl, Calc_Data.CALC_DISPLAY_TILES 18 ld b, 12 19 ld iyl, 2 + 12 20 call DRAW_ON_WINDOW_USEFUL_AREA22 ret23Apps/Calc/Header.s76Calc_Click:77 Apps/Calc/Click.s14 5 6 retApps/Calc/Header.s79Calc_GetFocus:80 Apps/Calc/GetFocus.s14 5 6 retApps/Calc/Header.s82Calc_LoseFocus:83 Apps/Calc/LoseFocus.s14 5 6 retApps/Calc/Header.s85Calc_Close:86 Apps/Calc/Close.s14 7 16 retApps/Calc/Header.s88Calc.EndProgramCode: 9293Calc.StartProgramData:95Calc_Icon:96 Apps/Calc/Icon.s1 DB 00000000b2 DB 00000000b3 DB 00111111b4 DB 01000000b5 DB 01011111b6 DB 01010000b7 DB 01011111b8 DB 01000000b10 DB 01001001b11 DB 01011011b12 DB 01000000b13 DB 01001001b14 DB 01011011b15 DB 01000000b16 DB 01001001b17 DB 01011011b19 DB 01000000b20 DB 00111111b21 DB 00011111b22 DB 00000000b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b28 DB 00000000b29 DB 00000000b30 DB 11111111b31 DB 00000000b32 DB 11111000b33 DB 00001000b34 DB 11111000b35 DB 00000000b37 DB 00100100b38 DB 01101101b39 DB 00000000b40 DB 00100100b41 DB 01101101b42 DB 00000000b43 DB 00100100b44 DB 01101101b46 DB 00000000b47 DB 11111111b48 DB 11111111b49 DB 00000000b50 DB 00000000b51 DB 00000000b52 DB 00000000b53 DB 00000000b55 DB 00000000b56 DB 00000000b57 DB 11111000b58 DB 00000100b59 DB 00000110b60 DB 00000110b61 DB 00000110b62 DB 00000110b64 DB 10010110b65 DB 10110110b66 DB 00000110b67 DB 10010110b68 DB 10110110b69 DB 00000110b70 DB 00010110b71 DB 11110110b73 DB 00000110b74 DB 11111110b75 DB 11111100b76 DB 00000000b77 DB 00000000b78 DB 00000000b79 DB 00000000b80 DB 00000000b81Apps/Calc/Header.s98Calc_Data:99 Apps/Calc/Data.s12.CALC_DISPLAY_TILES:3 db TILE_WINDOW_TITLE_MIDDLE_TOP4 db TILE_WINDOW_TITLE_MIDDLE_TOP5 db TILE_WINDOW_TITLE_MIDDLE_TOP6 db TILE_WINDOW_TITLE_MIDDLE_TOP7 db TILE_WINDOW_TITLE_MIDDLE_TOP8 db TILE_WINDOW_TITLE_MIDDLE_TOP9 db TILE_WINDOW_TITLE_MIDDLE_TOP10 db TILE_WINDOW_TITLE_MIDDLE_TOP11 db TILE_WINDOW_TITLE_MIDDLE_TOP12 db TILE_WINDOW_TITLE_MIDDLE_TOP13 db TILE_WINDOW_TITLE_MIDDLE_TOP14 db TILE_WINDOW_TITLE_MIDDLE_TOP16 db TILE_EMPTY_BLACK17 db TILE_EMPTY_BLACK18 db TILE_EMPTY_BLACK19 db TILE_EMPTY_BLACK20 db TILE_EMPTY_BLACK21 db TILE_EMPTY_BLACK22 db TILE_EMPTY_BLACK23 db TILE_EMPTY_BLACK24 db TILE_EMPTY_BLACK25 db TILE_FONT_REVERSED_NUMBERS_0 + 1 26 db TILE_FONT_REVERSED_NUMBERS_0 + 227 db TILE_FONT_REVERSED_NUMBERS_0 + 32931 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT32 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT33 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT34 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT36 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 7, TILE_WINDOW_BORDER_RIGHT37 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 8, TILE_WINDOW_BORDER_RIGHT38 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 9, TILE_WINDOW_BORDER_RIGHT39 db TILE_LINE_VERTICAL, TILE_SLASH, TILE_WINDOW_BORDER_RIGHT41 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW42 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW43 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW44 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW46 47 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT48 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT49 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT50 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT52 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 4, TILE_WINDOW_BORDER_RIGHT53 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 5, TILE_WINDOW_BORDER_RIGHT54 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 6, TILE_WINDOW_BORDER_RIGHT55 db TILE_LINE_VERTICAL, TILE_STAR, TILE_WINDOW_BORDER_RIGHT57 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW58 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW59 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW60 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW62 63 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT64 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT65 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT66 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT68 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 1, TILE_WINDOW_BORDER_RIGHT69 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 2, TILE_WINDOW_BORDER_RIGHT70 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 3, TILE_WINDOW_BORDER_RIGHT71 db TILE_LINE_VERTICAL, TILE_MINUS, TILE_WINDOW_BORDER_RIGHT73 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW74 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW75 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW76 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW78 79 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT80 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT81 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT82 db TILE_LINE_TOP_LEFT, TILE_LINE_HORIZONTAL, TILE_LINE_TOP_RIGHT84 db TILE_LINE_VERTICAL, TILE_FONT_NUMBERS_0 + 0, TILE_WINDOW_BORDER_RIGHT85 db TILE_LINE_VERTICAL, TILE_DOT, TILE_WINDOW_BORDER_RIGHT86 db TILE_LINE_VERTICAL, TILE_EQUAL, TILE_WINDOW_BORDER_RIGHT87 db TILE_LINE_VERTICAL, TILE_PLUS, TILE_WINDOW_BORDER_RIGHT89 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW90 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW91 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW92 db TILE_LINE_BOTTOM_LEFT, TILE_WINDOW_BORDER_MIDDLE_BOTTOM, TILE_LINE_BOTTOM_RIGHT_SHADOW94Apps/Calc/Header.s101Calc.EndProgramData: 102System\Main.s33 Apps/Paint/Header.s1Paint:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 - 39.y: db 410.width: db 1411.height: db 812.minWidth: db 1213.minHeight: db 615.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 15 17 db TILE_FONT_REVERSED_LOWERCASE_A + 0 18 db TILE_FONT_REVERSED_LOWERCASE_A + 8 19 db TILE_FONT_REVERSED_LOWERCASE_A + 13 20 db TILE_FONT_REVERSED_LOWERCASE_A + 19 21 db 0 22 db 023 db 024 db 025 db 026 db 027 db 028 db 029 db 030 db 031 db 032.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 15 34 db TILE_FONT_REVERSED_LOWERCASE_A + 13 35 db TILE_FONT_REVERSED_LOWERCASE_A + 19 36 db TILE_EMPTY_BLACK37.iconTitle:38 db TILE_EMPTY39 db TILE_FONT_LOWERCASE_A + 15 40 db TILE_FONT_LOWERCASE_A + 0 41 db TILE_FONT_LOWERCASE_A + 8 42 db TILE_FONT_LOWERCASE_A + 13 43 db TILE_FONT_LOWERCASE_A + 19 44 db TILE_EMPTY46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Paint_Open52.workAddr: dw Paint_Work53.drawAddr: dw Paint_Draw54.clickAddr: dw Paint_Click55.getFocusAddr: dw Paint_GetFocus56.loseFocusAddr: dw Paint_LoseFocus57.closeAddr: dw Paint_Close59.iconAddr: dw Paint_Icon61.ramSize: dw 1024 6465Paint.StartProgramCode:67Paint_Open:68 Apps/Paint/Open.s14 8 11 ret12Apps/Paint/Header.s70Paint_Work:71 Apps/Paint/Work.s14 ret5Apps/Paint/Header.s73Paint_Draw:74 Apps/Paint/Draw.s14 call GET_USEFUL_WINDOW_BASE_NAMTBL6 7 ld a, (ix + PROCESS_STRUCT_IX.windowState)8 cp WINDOW_STATE.MAXIMIZED9 jp nz, .skip_110 inc hl11.skip_1:13 ex de, hl15 16 push de17 ld hl, Paint_Data.PAINT_TOOLBAR 18 ld b, 3 19 ld iyl, 1 + 8 + 4 20 call DRAW_ON_WINDOW_USEFUL_AREA21 pop hl23 ret24Apps/Paint/Header.s76Paint_Click:77 Apps/Paint/Click.s14 call CONVERT_MOUSE_POSITION_IN_PIXELS_TO_TILES5 9 16 18 24 call _CONVERT_COL_LINE_TO_LINEAR26 ld bc, NAMTBL27 add hl, bc31 call BIOS_SETWRT32 ld a, TILE_EMPTY_BLACK33 out (PORT_0), a34 35 retApps/Paint/Header.s79Paint_GetFocus:80 Apps/Paint/GetFocus.s14 5 6 retApps/Paint/Header.s82Paint_LoseFocus:83 Apps/Paint/LoseFocus.s14 5 6 retApps/Paint/Header.s85Paint_Close:86 Apps/Paint/Close.s14 6 retApps/Paint/Header.s88Paint.EndProgramCode: 9293Paint.StartProgramData:95Paint_Icon:96 Apps/Paint/Icon.s12 DB 00000000b3 DB 00000011b4 DB 00001100b5 DB 00010001b6 DB 00100011b7 DB 00100011b8 DB 00100001b9 DB 01000000b11 DB 01001110b12 DB 01001111b13 DB 01011111b14 DB 01011111b15 DB 01000000b16 DB 01000001b17 DB 00100011b18 DB 00100011b20 DB 00010011b21 DB 00010000b22 DB 00001000b23 DB 00000110b24 DB 00000011b25 DB 00000110b26 DB 00001100b27 DB 00000000b2931 DB 00000000b32 DB 11110000b33 DB 00001100b34 DB 11000110b35 DB 11100011b36 DB 11100001b37 DB 11000001b38 DB 00000000b39 DB 00000011b40 DB 00000100b41 DB 10001001b42 DB 00001010b43 DB 00000101b44 DB 10000011b45 DB 10000000b46 DB 11000011b49 DB 11001111b50 DB 11001111b51 DB 00000111b52 DB 00000000b54 DB 11111111b55 DB 11111111b56 DB 00000000b57 DB 00000000b5860 DB 00000000b61 DB 00000100b62 DB 00000110b63 DB 00000110b64 DB 00001010b65 DB 00010110b66 DB 10011110b67 DB 10101100b69 DB 11010000b70 DB 11100000b71 DB 01110000b72 DB 11011000b73 DB 01001100b74 DB 10001100b75 DB 00001100b76 DB 00001100b78 DB 10011100b79 DB 00111000b80 DB 01110000b81 DB 11100000b82 DB 11000000b83 DB 10000000b84 DB 00000000b85 DB 00000000b8788Apps/Paint/Header.s98Paint_Data:99 Apps/Paint/Data.s12.PAINT_TOOLBAR:4 db TILE_EMPTY5 db TILE_EMPTY6 db TILE_LINE_VERTICAL8 10 11 db TILE_COLOR_1 12 db TILE_COLOR_113 db TILE_LINE_VERTICAL15 16 db TILE_COLOR_217 db TILE_COLOR_318 db TILE_LINE_VERTICAL20 21 db TILE_COLOR_422 db TILE_COLOR_523 db TILE_LINE_VERTICAL25 26 db TILE_COLOR_627 db TILE_COLOR_728 db TILE_LINE_VERTICAL30 31 db TILE_COLOR_832 db TILE_COLOR_933 db TILE_LINE_VERTICAL35 36 db TILE_COLOR_1037 db TILE_COLOR_1138 db TILE_LINE_VERTICAL40 41 db TILE_COLOR_1242 db TILE_COLOR_1343 db TILE_LINE_VERTICAL45 46 db TILE_COLOR_1447 db TILE_COLOR_1548 db TILE_LINE_VERTICAL50 52 db TILE_EMPTY53 db TILE_EMPTY54 db TILE_LINE_VERTICAL56 57 db TILE_EMPTY58 db TILE_EMPTY59 db TILE_LINE_VERTICAL61 62 db TILE_EMPTY63 db TILE_EMPTY64 db TILE_LINE_VERTICAL66 67 db TILE_EMPTY68 db TILE_EMPTY69 db TILE_LINE_VERTICAL71Apps/Paint/Header.s101Paint.EndProgramData: 103System\Main.s34 Apps/Settings/Header.s1Settings:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 29.y: db 210.width: db 2011.height: db 1612.minWidth: db 1213.minHeight: db 615.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 18 17 db TILE_FONT_REVERSED_LOWERCASE_A + 4 18 db TILE_FONT_REVERSED_LOWERCASE_A + 19 19 db TILE_FONT_REVERSED_LOWERCASE_A + 19 20 db TILE_FONT_REVERSED_LOWERCASE_A + 8 21 db TILE_FONT_REVERSED_LOWERCASE_A + 13 22 db TILE_FONT_REVERSED_LOWERCASE_A + 6 23 db TILE_FONT_REVERSED_LOWERCASE_A + 18 24 db 0 25 db 026 db 027 db 028 db 029 db 030 db 031 db 032.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 18 34 db TILE_FONT_REVERSED_LOWERCASE_A + 4 35 db TILE_FONT_REVERSED_LOWERCASE_A + 19 36 db TILE_EMPTY_BLACK37.iconTitle:38 db TILE_EMPTY39 db TILE_FONT_LOWERCASE_A + 18 40 db TILE_FONT_LOWERCASE_A + 4 41 db TILE_FONT_LOWERCASE_A + 19 42 db TILE_FONT_LOWERCASE_A + 19 43 db TILE_FONT_LOWERCASE_A + 8 44 db TILE_EMPTY46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Settings_Open52.workAddr: dw Settings_Work53.drawAddr: dw Settings_Draw54.clickAddr: dw Settings_Click55.getFocusAddr: dw Settings_GetFocus56.loseFocusAddr: dw Settings_LoseFocus57.closeAddr: dw Settings_Close59.iconAddr: dw Settings_Icon61.ramSize: dw 1024 6465Settings.StartProgramCode:67Settings_Open:68 Apps/Settings/Open.s14 8 11 ret12Apps/Settings/Header.s70Settings_Work:71 Apps/Settings/Work.s14 ret5Apps/Settings/Header.s73Settings_Draw:74 Apps/Settings/Draw.s14 call GET_USEFUL_WINDOW_BASE_NAMTBL613 ex de, hl15 16 ld hl, Settings_Data.SETTINGS_TABS 17 ld b, 18 18 ld iyl, 3 19 call DRAW_ON_WINDOW_USEFUL_AREA23 ret24Apps/Settings/Header.s76Settings_Click:77 Apps/Settings/Click.s15 7 8 call CONVERT_MOUSE_POSITION_IN_PIXELS_TO_TILES10 ld a, l11 sub (ix + PROCESS_STRUCT_IX.x)12 ld l, a14 ld a, h15 sub (ix + PROCESS_STRUCT_IX.y)16 ld h, a20 21 ld a, h22 cp 2 + 123 ret nc26 27 ld a, l28 cp 5 + 129 jp nc, .continue_131 jp .ClickTab_Video33.continue_1:35 36 ld a, l37 cp 11 + 138 jp nc, .continue_240 jp .ClickTab_Mouse42.continue_2:44 45 ld a, l46 cp 16 + 147 jp nc, .continue_349 jp .ClickTab_Time51.continue_3:55 ret58.ClickTab_Video:59 ret61.ClickTab_Mouse:62 ret64.ClickTab_Time:65 retApps/Settings/Header.s79Settings_GetFocus:80 Apps/Settings/GetFocus.s14 5 6 retApps/Settings/Header.s82Settings_LoseFocus:83 Apps/Settings/LoseFocus.s14 5 6 retApps/Settings/Header.s85Settings_Close:86 Apps/Settings/Close.s14 6 retApps/Settings/Header.s88Settings.EndProgramCode: 9293Settings.StartProgramData:95Settings_Icon:96 Apps/Settings/Icon.s12 DB 00000000 b3 DB 01110000 b4 DB 01110000 b5 DB 01110000 b6 DB 00000000 b7 DB 01110111 b8 DB 01110111 b9 DB 01110111 b11 DB 00000000 b12 DB 01110000 b13 DB 01110000 b14 DB 01110000 b15 DB 00000000 b16 DB 00000000 b17 DB 00000000 b18 DB 00000000 b20 DB 11111111 b21 DB 10001111 b22 DB 10001111 b23 DB 10001111 b24 DB 11111111 b25 DB 10001000 b26 DB 10001000 b27 DB 10001000 b2931 DB 00000000b32 DB 11110000b33 DB 00001100b34 DB 11000110b35 DB 11100011b36 DB 11100001b37 DB 11000001b38 DB 00000000b40 DB 00000011b41 DB 00000100b42 DB 10001001b43 DB 00001010b44 DB 00000101b45 DB 10000011b46 DB 10000000b47 DB 11000011b49 DB 11001111b50 DB 11001111b51 DB 00000111b52 DB 00000000b53 DB 11111111b54 DB 11111111b55 DB 00000000b56 DB 00000000b5759 DB 00000000b60 DB 00000100b61 DB 00000110b62 DB 00000110b63 DB 00001010b64 DB 00010110b65 DB 10011110b66 DB 10101100b68 DB 11010000b69 DB 11100000b70 DB 01110000b71 DB 11011000b72 DB 01001100b73 DB 10001100b74 DB 00001100b75 DB 00001100b77 DB 10011100b78 DB 00111000b79 DB 01110000b80 DB 11100000b81 DB 11000000b82 DB 10000000b83 DB 00000000b84 DB 00000000b8687Apps/Settings/Header.s98Settings_Data:99 Apps/Settings/Data.s12.SETTINGS_TABS:4 db TILE_LINE_TOP_LEFT6 db TILE_LINE_HORIZONTAL7 db TILE_LINE_HORIZONTAL8 db TILE_LINE_HORIZONTAL9 db TILE_LINE_HORIZONTAL10 db TILE_LINE_HORIZONTAL12 db TILE_LINE_TOP_MID14 db TILE_LINE_HORIZONTAL15 db TILE_LINE_HORIZONTAL16 db TILE_LINE_HORIZONTAL17 db TILE_LINE_HORIZONTAL18 db TILE_LINE_HORIZONTAL20 db TILE_LINE_TOP_MID22 db TILE_LINE_HORIZONTAL23 db TILE_LINE_HORIZONTAL24 db TILE_LINE_HORIZONTAL25 db TILE_LINE_HORIZONTAL27 db TILE_LINE_TOP_RIGHT2830 db TILE_LINE_VERTICAL32 db TILE_FONT_LOWERCASE_A + 21 33 db TILE_FONT_LOWERCASE_A + 8 34 db TILE_FONT_LOWERCASE_A + 3 35 db TILE_FONT_LOWERCASE_A + 4 36 db TILE_FONT_LOWERCASE_A + 14 38 db TILE_LINE_VERTICAL40 db TILE_FONT_LOWERCASE_A + 12 41 db TILE_FONT_LOWERCASE_A + 14 42 db TILE_FONT_LOWERCASE_A + 20 43 db TILE_FONT_LOWERCASE_A + 18 44 db TILE_FONT_LOWERCASE_A + 4 46 db TILE_LINE_VERTICAL48 db TILE_FONT_LOWERCASE_A + 19 49 db TILE_FONT_LOWERCASE_A + 8 50 db TILE_FONT_LOWERCASE_A + 12 51 db TILE_FONT_LOWERCASE_A + 4 53 db TILE_LINE_VERTICAL5557 db TILE_LINE_VERTICAL59 db TILE_EMPTY60 db TILE_EMPTY61 db TILE_EMPTY62 db TILE_EMPTY63 db TILE_EMPTY65 db TILE_LINE_BOTTOM_LEFT67 db TILE_LINE_HORIZONTAL68 db TILE_LINE_HORIZONTAL69 db TILE_LINE_HORIZONTAL70 db TILE_LINE_HORIZONTAL71 db TILE_LINE_HORIZONTAL73 db TILE_LINE_BOTTOM_MID75 db TILE_LINE_HORIZONTAL76 db TILE_LINE_HORIZONTAL77 db TILE_LINE_HORIZONTAL78 db TILE_LINE_HORIZONTAL80 db TILE_LINE_MID_RIGHT81Apps/Settings/Header.s101Settings.EndProgramData: 103System\Main.s38Execute:39 40 di 41 im 1 42 ld sp, (BIOS_HIMEM) 43 ei45 48 call _INIT50 54 58 62 66 71 72 78 82 86.OS_MainLoop:89 90 call _GET_NUMBER_OF_PROCESSES_OPENED91 ld (Temp), a93 94 call _DRAW_MOUSE_CURSOR95 call _MOUSE_CLICK96 call _MOUSE_OVER98 99 call _READ_KEYBOARD102 103 ld a, (OS.timeCounter)104 or a105 jp nz, .skip106 107 call _DRAW_TASKBAR_CLOCK109 .skip:110 112 113 ld ix, (OS.currentProcessAddr)114 ld a, ixl115 or ixh116 jp z, .noCurrentProcess 118 ld e, (ix + PROCESS_STRUCT_IX.workAddr) 119 ld d, (ix + PROCESS_STRUCT_IX.workAddr + 1) 120 call JP_DE121 .noCurrentProcess:123 jp .OS_MainLoop127 db "End ROM started at 0x4000"129 ds PageSize - ($ - 0x4000), 255 133134 org 0xc000, 0xe5ff136 System/Ram.s13710121519RamStart:2123Seed: rw 125OS:2728.mouseSpriteAttributes:29.mouseY: rb 130.mouseX: rb 131.mousePattern: rb 132.mouseColor: rb 133.mouseY_1: rb 134.mouseX_1: rb 135.mousePattern_1: rb 136.mouseColor_1: rb 137.windowCorner_TopLeft_Y: rb 138.windowCorner_TopLeft_X: rb 139.windowCorner_TopLeft_Pattern: rb 140.windowCorner_TopLeft_Color: rb 141.windowCorner_TopRight_Y: rb 142.windowCorner_TopRight_X: rb 143.windowCorner_TopRight_Pattern: rb 144.windowCorner_TopRight_Color: rb 145.windowCorner_BottomLeft_Y: rb 146.windowCorner_BottomLeft_X: rb 147.windowCorner_BottomLeft_Pattern: rb 148.windowCorner_BottomLeft_Color: rb 149.windowCorner_BottomRight_Y: rb 150.windowCorner_BottomRight_X: rb 151.windowCorner_BottomRight_Pattern: rb 152.windowCorner_BottomRight_Color: rb 154.mouseButton_1: rb 155.mouseButton_2: rb 157.oldMouseButton_1: rb 158.oldMouseButton_2: rb 160.mouseLastClick_Jiffy: rw 161.isDoubleClick: rb 164.isDraggingWindow: rb 165.dragOffset_X: rb 1 66.dragOffset_Y: rb 167.isResizingWindow: rb 168.resizeWindowCorner_BottomRight_X_Min: rb 169.resizeWindowCorner_BottomRight_Y_Min: rb 171.oldKeyboardMatrix: rb 11 73.ticksSinceLastInput: rw 1 7677.currentTime: 78.currentTime_Hours: rb 179.currentTime_Minutes: rb 180.currentTime_Seconds: rb 182.currentDate: 83.currentDate_Day: rb 184.currentDate_Month: rb 185.currentDate_Year: rb 287.timeCounter: rb 1 9192.storeOldInterruptHook: rb 693.interruptBusy: rb 19698100106.screenMapping: rb 32*24107.currentTileMouseOver: rb 1 109.nextWindow_x: rb 1110.nextWindow_y: rb 1112.mouseOver_Activated: rb 1113.mouseOver_screenMappingValue: rb 1114.mouseOver_tileToBeRestored: rb 1115.mouseOver_NAMTBL_addr: rw 1117.taskbar_Button_0_Process_addr: rw 1118.taskbar_Button_1_Process_addr: rw 1119.taskbar_Button_2_Process_addr: rw 1120.taskbar_Button_3_Process_addr: rw 1122.desktop_Tiles: rb 32 * 22124125.currentProcessAddr: rw 1 126.nextAvailableProcessAddr: rw 1128130.processes: 131 rb Process_struct.size * (MAX_PROCESS_ID + 1) 132 .process_slot_0: equ .processes + (Process_struct.size * 0)133 .process_slot_1: equ .processes + (Process_struct.size * 1)134 .process_slot_2: equ .processes + (Process_struct.size * 2)135 .process_slot_3: equ .processes + (Process_struct.size * 3)136.processes_end:137.processes_size: equ $ - .processes140143.PROCESS_VARS_AREA_SIZE: equ 1024145.processesVariablesArea: 146 rb .PROCESS_VARS_AREA_SIZE * (MAX_PROCESS_ID + 1) 147 .processesVariablesArea_0: equ .processesVariablesArea + (.PROCESS_VARS_AREA_SIZE * 0)148 .processesVariablesArea_1: equ .processesVariablesArea + (.PROCESS_VARS_AREA_SIZE * 1)149 .processesVariablesArea_2: equ .processesVariablesArea + (.PROCESS_VARS_AREA_SIZE * 2)150 .processesVariablesArea_3: equ .processesVariablesArea + (.PROCESS_VARS_AREA_SIZE * 3)151.processesVariablesArea_end:152.processesVariablesArea_size: equ $ - .processesVariablesArea154156157Process_struct:158.processId: rb 1 159.windowState: rb 1 160.x: rb 1161.y: rb 1162.width: rb 1163.height: rb 1164.minWidth: rb 1165.minHeight: rb 1167.windowTitle: rb 16168.taskbarTitle: rb 4169.iconTitle: rb 7170.isFixedSize: rb 1 171.vertScrollbarEnabled: rb 1 172.vertScrollbarPosition: rb 1173177182183.openAddr: rw 1184.workAddr: rw 1185.drawAddr: rw 1186.clickAddr: rw 1187.getFocusAddr: rw 1188.loseFocusAddr: rw 1189.closeAddr: rw 1191.iconAddr: rw 1 193.ramSize: rw 1 202.size_Header: equ $ - Process_struct204205.ramStartAddr: rw 1206.vramStartTileAddr: rw 1208.layer: rb 1 211.previousWindowState: rb 1 213.size: equ $ - Process_struct216219PROCESS_STRUCT_IX:220.processId: equ Process_struct.processId - Process_struct221.windowState: equ Process_struct.windowState - Process_struct222.x: equ Process_struct.x - Process_struct223.y: equ Process_struct.y - Process_struct224.width: equ Process_struct.width - Process_struct225.height: equ Process_struct.height - Process_struct226.minWidth: equ Process_struct.minWidth - Process_struct227.minHeight: equ Process_struct.minHeight - Process_struct229.windowTitle: equ Process_struct.windowTitle - Process_struct230.taskbarTitle: equ Process_struct.taskbarTitle - Process_struct231.iconTitle: equ Process_struct.iconTitle - Process_struct232.isFixedSize: equ Process_struct.isFixedSize - Process_struct233.vertScrollbarEnabled: equ Process_struct.vertScrollbarEnabled - Process_struct234.vertScrollbarPosition: equ Process_struct.vertScrollbarPosition - Process_struct236.openAddr: equ Process_struct.openAddr - Process_struct237.workAddr: equ Process_struct.workAddr - Process_struct238.drawAddr: equ Process_struct.drawAddr - Process_struct239.clickAddr: equ Process_struct.clickAddr - Process_struct240.getFocusAddr: equ Process_struct.getFocusAddr - Process_struct241.loseFocusAddr: equ Process_struct.loseFocusAddr - Process_struct242.closeAddr: equ Process_struct.closeAddr - Process_struct244.iconAddr: equ Process_struct.iconAddr - Process_struct246247.ramStartAddr: equ Process_struct.ramStartAddr - Process_struct248.vramStartTileAddr: equ Process_struct.vramStartTileAddr - Process_struct250.layer: equ Process_struct.layer - Process_struct252.previousWindowState: equ Process_struct.previousWindowState - Process_struct254257258Temp: rb 1259TempWord: rw 1261263TempIcon: rb NUMBER_OF_TILES_PER_ICON * 8267RamEnd:System\Main.s137