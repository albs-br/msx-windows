System\Main.s1FNAME "msx-windows.rom" 3PageSize: equ 0x4000 56 org 0x40008 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11System\Main.s9 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619System\Main.s10 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2428REG0SAV: equ 0xF3DF29REG1SAV: equ 0xF3E030REG2SAV: equ 0xF3E131REG3SAV: equ 0xF3E232REG4SAV: equ 0xF3E333REG5SAV: equ 0xF3E434REG6SAV: equ 0xF3E535REG7SAV: equ 0xF3E637REG8SAV: equ 0xFFE738REG9SAV: equ 0xFFE839REG10SAV: equ 0xFFE940REG11SAV: equ 0xFFEA41REG12SAV: equ 0xFFEB42REG13SAV: equ 0xFFEC43REG14SAV: equ 0xFFED44REG15SAV: equ 0xFFEE45REG16SAV: equ 0xFFEF46REG17SAV: equ 0xFFF047REG18SAV: equ 0xFFF148REG19SAV: equ 0xFFF249REG20SAV: equ 0xFFF350REG21SAV: equ 0xFFF451REG22SAV: equ 0xFFF552REG23SAV: equ 0xFFF65456REG25SAV: equ 0xFFFA57REG26SAV: equ 0xFFFB58REG27SAV: equ 0xFFFC59System\Main.s11 Include/CommonRoutines.s1411ClearRam:12 ld hl, RamStart 13 ld de, RamEnd + 1 15.loop:16 xor a 17 ld (hl), a19 inc hl20 call BIOS_DCOMPR 21 ret z22 jp .loop2629ClearRamArea:30 xor a31.loop:32 ld (hl), a33 inc hl34 djnz .loop36 ret4044SetPaletteColor:45 push bc46 47 ld b, a 48 ld c, 16 49 call BIOS_WRTVDP50 ld c, PORT_2 51 pop de53 ld a, d 54 di55 out (c), a56 ld a, e 57 ei58 out (c), a60 ret6266SetPaletteColor_Without_DI_EI:67 push bc68 69 ld b, a 70 ld c, 16 71 call WRTVDP_without_DI_EI72 ld c, PORT_2 73 pop de75 ld a, d 77 out (c), a78 ld a, e 80 out (c), a82 ret8590SetPaletteColor_FromAddress:91 92 ld b, a 93 ld c, 16 94 call BIOS_WRTVDP95 ld c, PORT_2 97 ld a, (hl) 98 di99 out (c), a100 inc hl101 ld a, (hl) 102 ei103 out (c), a105 ret109110LoadPalette:111 112 ld b, 0 113 ld c, 16 114 call BIOS_WRTVDP115 ld c, PORT_2 117 ld b, 16118.loop:119 di120 ld a, (hl)121 out (c), a122 inc hl123 ld a, (hl)124 out (c), a125 ei126 inc hl127 djnz .loop128 129 ret133134EnableRomPage2:135137 call BIOS_RSLREG138 rrca139 rrca140 and 3 141 ld c,a142 ld b,0143 ld hl, BIOS_EXPTBL144 add hl,bc145 ld a,(hl)146 and 80h147 or c148 ld c,a149 inc hl150 inc hl151 inc hl152 inc hl153 ld a,(hl)154 and 0Ch155 or c156 ld h,080h157 call BIOS_ENASLT 159 ret162166Wait_B_Vblanks:167 168 push bc169 170 .loop:172 ld a, (BIOS_JIFFY)173 ld c, a174 .waitVBlank:175 ld a, (BIOS_JIFFY)176 cp c177 jp z, .waitVBlank179 djnz .loop180 181 pop bc183 ret185Wait_15_Vblanks:186 ld c, 15188 .loop:189 ld a, (BIOS_JIFFY)190 ld b, a191 .waitVBlank:192 ld a, (BIOS_JIFFY)193 cp b194 jp z, .waitVBlank196 dec c197 jp nz, .loop199 ret201Wait_Vblank:202.loop:203 ld a, (BIOS_JIFFY)204 ld b, a205.waitVBlank:206 ld a, (BIOS_JIFFY)207 cp b208 jp z, .waitVBlank210 ret212216SetVdp_Write:218 227 rlc h228 rla229 rlc h230 rla231 srl h232 srl h234 di235 236 out (PORT_1), a237 ld a, 14 + 128238 out (PORT_1), a240 241 ld a, l242 nop243 out (PORT_1), a244 ld a, h245 or 64246 ei247 out (PORT_1),a248 ret250254SetVdp_Read:255 rlc h256 rla257 rlc h258 rla259 srl h260 srl h261 di262 out (PORT_1), a263 ld a, 14 + 128264 out (PORT_1), a265 ld a, l266 nop267 out (PORT_1), a268 ld a, h269 ei270 out (PORT_1), a271 ret274282303 304306308310312317325333336ClearVram_MSX2:337 xor a 338 ld hl, 0 339 call SetVDP_Write341351 xor a353 357 358 ld d, 2 359.loop_2:360 ld c, 0 361.loop_1:362 ld b, 0 363.loop:364 out (PORT_0), a365 djnz .loop366 dec c367 jp nz, .loop_1368 dec d369 jp nz, .loop_2371 ret374Screen11:375 377 ld a, 8378 call BIOS_CHGMOD380 ld a, (REG25SAV)381 or 0001 1000 b382 ld (REG25SAV), a 383 ld b, a384 385 ld c, 25 386 call BIOS_WRTVDP387 ret389SetSprites16x16:390 ld a, (REG1SAV)391 or 0000 0010 b392 ld (REG1SAV), a393 ld b, a394 ld c, 1 395 call BIOS_WRTVDP396 ret398Set192Lines:399 403 ld a, (REG9SAV)404 and 0111 1111 b405 ld (REG9SAV), a406 ld b, a407 ld c, 9 408 call BIOS_WRTVDP409 ret411SetColor0ToNonTransparent:412 417 ld a, (REG8SAV)418 or 0010 0000 b419 ld b, 0010 1000 b 420 ld c, 0x08 421 call BIOS_WRTVDP422 ret424SetColor0ToTransparent:425 429 ld a, (REG8SAV)430 and 1101 1111 b431 ld (REG8SAV), a432 ld b, a433 ld c, 8 434 call BIOS_WRTVDP435 ret437DisableSprites:438 ld a, (REG8SAV)439 or 0000 0010 b440 ld b, a441 ld c, 8 442 call BIOS_WRTVDP443 ret445EnableSprites:446 ld a, (REG8SAV)447 and 1111 1101 b448 ld b, a449 ld c, 8 450 call BIOS_WRTVDP451 ret453457LDIRVM_MSX2:458 459 ex de, hl460 461 call SetVdp_Write462 ex de, hl463 ld d, c464 465 ld c, PORT_0 466 ld b, 0467.loop_1:468 otir469 dec d470 jp nz, .loop_1471 ret475481RandomNumber:482 push hl483 ld hl, (Seed)484 add hl, hl485 sbc a, a486 and 0x83487 xor l488 ld l, a489 ld (Seed), hl490 pop hl491 ret493 502 506512CheckCollision_16x16_16x16:514 ld a, d 515 sub b 516 jr c, .x1IsLarger 517 sub 16 518 ret nc 519 jp .checkVerticalCollision520.x1IsLarger:521 neg 526 527 sub 16 528 ret nc 530.checkVerticalCollision:531 ld a, e 532 sub c 533 jr c, .y1IsLarger 534 sub 16 535 ret 536.y1IsLarger:537 neg 542 543 sub 16 544 ret 548554CheckCollision_16x16_32x16:556 ld a, d 557 sub b 558 jr c, .x1IsLarger 559 sub 16 560 ret nc 561 jp .checkVerticalCollision562.x1IsLarger:563 neg 568 569 sub 32 570 ret nc 572.checkVerticalCollision:573 ld a, e 574 sub c 575 jr c, .y1IsLarger 576 sub 16 577 ret 578.y1IsLarger:579 neg 584 585 sub 16 586 ret 591597CheckCollision_8x8_16x16:599 ld a, d 600 sub b 601 jr c, .x1IsLarger 602 sub 8 603 ret nc 604 jp .checkVerticalCollision605.x1IsLarger:606 neg 611 612 sub 16 613 ret nc 615.checkVerticalCollision:616 ld a, e 617 sub c 618 jr c, .y1IsLarger 619 sub 8 620 ret 621.y1IsLarger:622 neg 627 628 sub 16 629 ret 635637643CheckCollision_Point_16x16:645 649 650 ld a, d651 cp b652 ret nc 654 ld a, b655 add 16 656 cp d657 ret nc 659 660 ld a, e661 cp c662 ret nc 664 667 ld a, e668 add 16669 ld e, a670 ld a, c671 cp e672 ret674 678 682 685 691696699709713716719724 725727734738740748 749757763770776779786792800802810817824827833835 837845850855859862873880885890893900905907913916918922926928931934937942 943946949 950955959962967 968971973 974979983987Execute_VDP_LMMM:988Execute_VDP_HMMM:989 ld a, 32 990 di991 out (PORT_1), a992 ld a, 17 + 128993 out (PORT_1), a994 ld c, 0x9B995.vdpReady:996 ld a, 2997 di998 out (PORT_1), a 999 ld a, 15 + 1281000 out (PORT_1), a1001 in a, (PORT_1)1002 rra1003 ld a, 0 1004 out (PORT_1), a1005 ld a, 15 + 1281006 ei1007 out (PORT_1), a 1008 jp c, .vdpReady1009 outi 1010 outi 1011 outi1012 outi1013 outi1014 outi1015 outi1016 outi1017 outi1018 outi1019 outi1020 outi1021 outi1022 outi1023 outi1024 ret10261030Execute_VDP_PSET:1031Execute_VDP_LINE:1032Execute_VDP_HMMV:1033 ld a, 36 1034 di1035 out (PORT_1), a1036 ld a, 17 + 1281037 out (PORT_1), a1038 ld c, 0x9B1039.vdpReady:1040 ld a, 21041 di1042 out (PORT_1), a 1043 ld a, 15 + 1281044 out (PORT_1), a1045 in a, (PORT_1)1046 rra1047 ld a, 0 1048 out (PORT_1), a1049 ld a, 15 + 1281050 ei1051 out (PORT_1), a 1052 jp c, .vdpReady1053 outi 1054 outi 1055 outi1056 outi1057 outi1058 outi1059 outi1060 outi1061 outi1062 outi1063 outi1064 ret10671070Execute_VDP_YMMM:1071 ld a, 34 1072 di1073 out (PORT_1), a1074 ld a, 17 + 1281075 out (PORT_1), a1076 ld c, 0x9B1077.vdpReady:1078 ld a, 21079 di1080 out (PORT_1), a 1081 ld a, 15 + 1281082 out (PORT_1), a1083 in a, (PORT_1)1084 rra1085 ld a, 0 1086 out (PORT_1), a1087 ld a, 15 + 1281088 ei1089 out (PORT_1), a 1090 jp c, .vdpReady1091 outi 1092 outi 1093 outi1094 outi1095 outi1096 outi1097 outi1098 outi1099 outi1100 outi1101 outi1102 outi1103 outi1104 ret1106VDP_COMMAND_HMMC: equ 1111 0000 b 1107VDP_COMMAND_YMMM: equ 1110 0000 b 1108VDP_COMMAND_HMMM: equ 1101 0000 b 1109VDP_COMMAND_HMMV: equ 1100 0000 b 11111112VDP_COMMAND_LMMC: equ 1011 0000 b 1113VDP_COMMAND_LMCM: equ 1010 0000 b 1114VDP_COMMAND_LMMM: equ 1001 0000 b 1115VDP_COMMAND_LMMV: equ 1000 0000 b 1117VDP_COMMAND_LINE: equ 0111 0000 b1118VDP_COMMAND_SRCH: equ 0110 0000 b1119VDP_COMMAND_PSET: equ 0101 0000 b1120VDP_COMMAND_POINT: equ 0100 0000 b1122VDP_COMMAND_STOP: equ 0000 0000 b11251126VDP_LOGIC_OPERATION_IMP: equ 0000 b1127VDP_LOGIC_OPERATION_AND: equ 0001 b1128VDP_LOGIC_OPERATION_OR: equ 0010 b1129VDP_LOGIC_OPERATION_XOR: equ 0011 b1130VDP_LOGIC_OPERATION_NOT: equ 0100 b1132VDP_LOGIC_OPERATION_TIMP: equ 1000 b1133VDP_LOGIC_OPERATION_TAND: equ 1001 b1134VDP_LOGIC_OPERATION_TOR: equ 1010 b1135VDP_LOGIC_OPERATION_TXOR: equ 1011 b1136VDP_LOGIC_OPERATION_TNOT: equ 1100 b11411145ReadStatusReg:11461147 ld a,(0007h) 1148 inc a1149 ld c,a 1151 out (c),b1152 ld a,080h+151153 out (c),a11541155 1156 ld a,(0006h) 1157 inc a1158 ld c,a 1159 in b,(c) 1160 11611162 ld a,(0007h) 1163 inc a1164 ld c,a 1165 xor a1166 out (c),a1167 ld a,080h+151168 out (c),a1169 1171 ret11741175WRTVDP_without_DI_EI:1176 ld a, b1177 1178 out (PORT_1),a1179 ld a, c1180 or 1281181 1183 out (PORT_1), a1184 ret11881191SNSMAT_NO_DI_EI:1192 ld c, a1193.C_OK:11941195 in a, (PPI.C)1196 and 0xf0 1197 or c11981199 out (PPI.C), a1200 in a, (PPI.B)1201 ret120412071209JP_HL:1210 jp (hl)1211JP_BC:1212 push bc1213 ret1214JP_DE:1215 push de1216 ret1217JP_IX:1218 jp (ix)1219JP_IY:1220 jp (iy)1221JP_HL_S:1222 exx1223 push hl1224 exx1225 ret1226JP_BC_S:1227 exx1228 push bc1229 exx1230 ret1231JP_DE_S:1232 exx1233 push de1234 exx1235 ret12381240Fast_LDIR_Multiples_of_16:12411242.loop:1243 ldi 1244 ldi1245 ldi1246 ldi1247 ldi1248 ldi1249 ldi1250 ldi1251 ldi1252 ldi1253 ldi1254 ldi1255 ldi1256 ldi1257 ldi1258 ldi1259 jp pe, .loop System\Main.s1314 System/Constants.s134SCREEN_MAPPING_DESKTOP: equ 2555SCREEN_MAPPING_TASKBAR: equ 2546 7SCREEN_MAPPING_WINDOWS: equ 0000 0000 b8SCREEN_MAPPING_WINDOWS_TITLE_BAR: equ 0001 0000 b9SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON: equ 0010 0000 b10SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON: equ 0011 0000 b11SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON: equ 0100 0000 b12SCREEN_MAPPING_WINDOWS_RESIZE_CORNER: equ 0101 0000 b15WINDOW_STATE:16.MINIMIZED: equ 117.RESTORED: equ 218.MAXIMIZED: equ 321MOUSE_ON_JOYPORT_1: equ 0x131022MOUSE_ON_JOYPORT_2: equ 0x6C2024MOUSE_PORT: equ MOUSE_ON_JOYPORT_1System\Main.s15 System/Interrupt.s1_INIT_INTERRUPT:3 4 xor a5 ld (os.interruptBusy), a7 ld hl, .storeOldInterruptHook_init8 ld de, os.storeOldInterruptHook9 ld bc, 610 ldir12 ld hl, BIOS_H_TIMI13 ld de, os.storeOldInterruptHook14 ld bc, 515 ldir17 ld hl, INTERRUPT18 ld de, BIOS_H_TIMI19 ld bc, 320 ldir22 ret26.storeOldInterruptHook_init:27 db 0, 0, 0, 0, 028 db 0xc9 30INTERRUPT:31 32 jp HANDLER33 34HANDLER:35 36 ld a, (os.interruptBusy)37 and a38 ret nz39 ld a, 25540 ld (os.interruptBusy), a42 43 call _UPDATE_SYSTEM_TIME44 45 46 ld hl, (OS.ticksSinceLastInput)47 inc hl48 ld (OS.ticksSinceLastInput), hl50 55 58 ld de, MOUSE_PORT59 call GTMOUS60 61 ld a, h62 cp 25563 jp nz, .skip64 cp l65 call z, .noMouse67.skip:69 70 ld a, ixh71 ld (OS.mouseButton_1), a72 ld a, ixl73 ld (OS.mouseButton_2), a76 80 81 ld a, h82 neg83 ld h, a85 86 ld a, l87 neg88 ld l, a90 91 xor a92 or ixh 93 or ixl 94 or h 95 or l 96 jp z, .skip_197 ld de, 098 ld (OS.ticksSinceLastInput), de99.skip_1:100 101 ld e, h 102 ld d, l 103 ld a, (os.mouseX)104 ld l, a 105 ld a, (os.mouseY)106 ld h, a 107 call CLIPADD108 109 ld a, l110 ld (os.mouseX), a111 ld (os.mouseX_1), a112 ld a, h113 ld (os.mouseY), a114 ld (OS.mouseY_1), a116 xor a117 ld (os.interruptBusy), a119 jp os.storeOldInterruptHook121122.noMouse:123 124 ret126131 132System\Main.s16 System/Init/Init.s1 System/Init/InitVdp.s12NAMTBL: equ 0x1800 3PATTBL: equ 0x0000 4COLTBL: equ 0x2000 5SPRPAT: equ 0x3800 6SPRATR: equ 0x1b00 9_INIT_VDP:12 13 ld a, 15 14 ld (BIOS_FORCLR), a 15 ld a, 1 16 ld (BIOS_BAKCLR), a 17 ld a, 4 18 ld (BIOS_BDRCLR), a 19 call BIOS_CHGCLR 21 22 ld a, 223 call BIOS_CHGMOD25 call SetSprites16x1627 call BIOS_DISSCR29 30 32 33 xor a 34 ld bc, 1024 * 16 35 ld hl, 0x0000 36 call BIOS_FILVRM38 39 ld hl, TILE_PATTERNS 40 ld de, PATTBL 41 ld bc, TILE_PATTERNS.size 42 call BIOS_LDIRVM 44 ld hl, TILE_PATTERNS 45 ld de, PATTBL + (256 * 8) 46 ld bc, TILE_PATTERNS.size 47 call BIOS_LDIRVM 49 ld hl, TILE_PATTERNS 50 ld de, PATTBL + (512 * 8) 51 ld bc, TILE_PATTERNS.size 52 call BIOS_LDIRVM 54 55 ld a, 0x1f 56 ld bc, 256 * 8 * 3 57 ld hl, COLTBL 58 call BIOS_FILVRM60 61 ld a, 0xf1 62 ld bc, TILE_FONT_REVERSED_PATTERNS.size 63 ld hl, COLTBL + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 64 call BIOS_FILVRM65 66 ld a, 0xf1 67 ld bc, TILE_FONT_REVERSED_PATTERNS.size 68 ld hl, COLTBL + (256 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 69 call BIOS_FILVRM70 71 ld a, 0xf1 72 ld bc, TILE_FONT_REVERSED_PATTERNS.size 73 ld hl, COLTBL + (512 * 8) + (TILE_FONT_REVERSED_PATTERNS - TILE_PATTERNS) 74 call BIOS_FILVRM76 82 99 100 ld hl, SPRITE_PATTERNS 101 ld de, SPRPAT 102 ld bc, SPRITE_PATTERNS.size 103 call BIOS_LDIRVM 105 111 call BIOS_ENASCR113 ret115122123NAMTBL_TEST:124 db TILE_EMPTY125 db TILE_EMPTY126 db TILE_WINDOW_TITLE_TOP_LEFT127 db TILE_WINDOW_TITLE_MIDDLE_TOP128 db TILE_WINDOW_TITLE_MIDDLE_TOP129 db TILE_WINDOW_TITLE_MIDDLE_TOP130 db TILE_WINDOW_TITLE_MIDDLE_TOP131 db TILE_WINDOW_TOP_RIGHT_CORNER_TOP132 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0134 db TILE_EMPTY135 db TILE_EMPTY136 db TILE_WINDOW_TITLE_BOTTOM_LEFT137 db TILE_WINDOW_TITLE_MIDDLE_BOTTOM138 db TILE_WINDOW_MINIMIZE_BUTTON139 db TILE_WINDOW_MAXIMIZE_BUTTON140 db TILE_WINDOW_CLOSE_BUTTON141 db TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM142 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0144 db TILE_EMPTY145 db TILE_EMPTY146 db TILE_WINDOW_BORDER_LEFT147 db TILE_FONT_LOWERCASE_A + 0148 db TILE_FONT_LOWERCASE_A + 25149 db TILE_FONT_NUMBERS_0 + 0150 db TILE_FONT_NUMBERS_0 + 9151 db TILE_WINDOW_BORDER_RIGHT152 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0154 db TILE_EMPTY155 db TILE_EMPTY156 db TILE_WINDOW_BORDER_LEFT157 db TILE_FONT_UPPERCASE_A + 0158 db TILE_FONT_UPPERCASE_A + 25159 db TILE_FONT_REVERSED_SYMBOLS + 0160 db TILE_EMPTY161 db TILE_WINDOW_BORDER_RIGHT162 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0164 db TILE_EMPTY165 db TILE_EMPTY166 db TILE_WINDOW_BORDER_LEFT167 169 db TILE_FONT_REVERSED_LOWERCASE_A + 0170 db TILE_FONT_REVERSED_LOWERCASE_A + 25171 db TILE_FONT_REVERSED_NUMBERS_0 + 0172 db TILE_FONT_REVERSED_NUMBERS_0 + 9173 db TILE_WINDOW_RESIZE_CORNER_TOP174 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0176 db TILE_EMPTY177 db TILE_EMPTY178 db TILE_WINDOW_BORDER_BOTTOM_LEFT179 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM180 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM181 db TILE_WINDOW_BORDER_MIDDLE_BOTTOM182 db TILE_WINDOW_RESIZE_CORNER_LEFT183 db TILE_WINDOW_RESIZE_CORNER_RIGHT184 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0186 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0188.size: equ $ - NAMTBL_TEST191196System/Init/Init.s2 System/Init/InitRam.s1_INIT_RAM:3 5 xor a6 ld (RamStart), a7 ld hl, RamStart8 ld de, RamStart + 19 ld bc, RamEnd - RamStart - 110 ldir12 13 ld a, 0xff14 ld (OS.processes), a15 ld hl, OS.processes16 ld de, OS.processes + 117 ld bc, OS.processes_size - 118 ldir19 20 21 ld hl, OS.processes22 ld (OS.nextAvailableProcessAddr), hl24 25 ld hl, 026 ld (OS.currentProcessAddr), hl28 29 ld a, 128 - 830 ld (OS.mouseY), a31 ld (OS.mouseY_1), a32 ld a, 96 - 833 ld (OS.mouseX), a34 ld (OS.mouseX_1), a35 ld a, SPRITE_INDEX_CURSOR_036 ld (OS.mousePattern), a37 ld a, SPRITE_INDEX_CURSOR_138 ld (OS.mousePattern_1), a39 ld a, 1 40 ld (OS.mouseColor), a41 ld a, 15 42 ld (OS.mouseColor_1), a44 xor a45 ld (OS.mouseButton_1), a46 ld (OS.mouseButton_2), a47 ld (OS.oldMouseButton_1), a48 ld (OS.oldMouseButton_2), a49 50 ld (OS.isDraggingWindow), a51 ld (OS.dragOffset_X), a52 ld (OS.dragOffset_Y), a55 56 ld a, 1111 1111 b57 ld (OS.keyboardMatrix + 0), a58 ld (OS.keyboardMatrix + 1), a59 ld (OS.keyboardMatrix + 2), a60 ld (OS.keyboardMatrix + 3), a61 ld (OS.keyboardMatrix + 4), a62 ld (OS.keyboardMatrix + 5), a63 ld (OS.keyboardMatrix + 6), a64 ld (OS.keyboardMatrix + 7), a65 ld (OS.keyboardMatrix + 8), a66 ld (OS.keyboardMatrix + 9), a69 70 ld a, 871 ld (OS.nextWindow_x), a72 ld a, 473 ld (OS.nextWindow_y), a75 xor a76 ld (OS.mouseOver_Activated), a77 ld (OS.mouseOver_screenMappingValue), a78 ld (OS.mouseOver_tileToBeRestored), a79 ld hl, 080 ld (OS.mouseOver_NAMTBL_addr), a84 call _INIT_SCREEN_MAPPING88 ret91System/Init/Init.s7_INIT:9 10 xor a11 ld (BIOS_CLIKSW), a13 call _INIT_VDP15 call _INIT_RAM17 call _INIT_SYSTEM_TIME19 call _INIT_INTERRUPT21 call _INIT_DESKTOP25 28 call _DRAW_DESKTOP29 call _DRAW_TASKBAR31 ret34System\Main.s17 System/Desktop/Desktop.s1 System/Desktop/Taskbar.s1810_DRAW_TASKBAR:12 13 ld hl, TASKBAR_INIT 14 ld de, NAMTBL + (32 * 22) 15 ld bc, 64 16 call BIOS_LDIRVM 20 call _DRAW_TASKBAR_BUTTONS23 call _DRAW_TASKBAR_CLOCK26 ret30_DRAW_TASKBAR_BUTTONS:32 ld iy, NAMTBL + (32 * 23) + 534 35 ld hl, 0xffff36 ld (OS.taskbar_Button_0_Process_addr), hl37 ld (OS.taskbar_Button_1_Process_addr), hl38 ld (OS.taskbar_Button_2_Process_addr), hl39 ld (OS.taskbar_Button_3_Process_addr), hl41 ld hl, OS.taskbar_Button_0_Process_addr42 ld (TempWord), hl44 45 ld hl, OS.processes46 ld b, MAX_PROCESS_ID + 147.loop_1:48 ld a, (hl)49 inc a50 jp z, .next 52 55 push hl 56 pop ix58 59 push de60 ld de, (TempWord)62 ld a, l63 ld (de), a64 inc de65 ld a, h66 ld (de), a67 inc de69 ld (TempWord), de70 pop de72 push hl, bc73 74 ld bc, PROCESS_STRUCT_IX.taskbarTitle75 add hl, bc77 push hl 78 pop de80 push iy 81 pop hl82 call BIOS_SETWRT84 ld c, 4 86 .loop_2:87 ld a, (de)88 cp 3389 jp z, .end_191 push de93 ld de, (OS.currentProcessAddr)94 95 push ix 96 pop hl98 call BIOS_DCOMPR100 pop de102 jp nz, .printNormal104 105 ld a, (de)106 add TILE_FONT_LOWERCASE_A - TILE_FONT_REVERSED_LOWERCASE_A107 jp .continue_2108 .printNormal:109 ld a, (de)110 .continue_2:111 out (PORT_0), a113 dec c114 jp z, .end_1116 inc de117 jp .loop_2119 .end_1:120 121 ld bc, 5122 add iy, bc 124 pop bc, hl128.next:129 ld de, Process_struct.size130 add hl, de132 djnz .loop_1134 ret138139_DRAW_TASKBAR_CLOCK:141 142 ld hl, NAMTBL + (32 * 23) + 26 143 call BIOS_SETWRT144 ld c, PORT_0147 ld b, TILE_FONT_REVERSED_NUMBERS_0149 150 ld a, (OS.currentTime_Hours)151 srl a 152 srl a 153 srl a 154 srl a 155 or a156 jp z, .skipTensOfHours 157 add b 158 jp .continue159.skipTensOfHours:160 ld a, TILE_EMPTY_BLACK161.continue:162 out (c), a164 165 ld a, (OS.currentTime_Hours)166 and 0000 1111 b167 add b 168 out (c), a170 171 nop172 nop173 ld a, TILE_FONT_REVERSED_SYMBOLS + 0 174 out (c), a176 177 ld a, (OS.currentTime_Minutes)178 srl a 179 srl a 180 srl a 181 srl a 182 add b 183 out (c), a184 185 186 ld a, (OS.currentTime_Minutes)187 and 0000 1111 b188 add b 189 out (c), a191 ret195TASKBAR_INIT:196 197 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP198 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP199 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP200 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP201 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP202 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP203 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP204 db TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP, TILE_TASKBAR_TOP206 207 db TILE_EMPTY_BLACK, TILE_HOME_ICON, TILE_EMPTY_BLACK208 209 db TILE_SHOW_DESKTOP_ICON, TILE_EMPTY_BLACK211 db TILE_EMPTY_BLACK212 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK213 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK214 222 223 db TILE_EMPTY_BLACK224 225 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK226 230 231 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK232 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK233 234 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK235 236 240 db TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK, TILE_EMPTY_BLACK241 242 db TILE_EMPTY_BLACK243System/Desktop/Desktop.s5_INIT_DESKTOP:7 9 10 ld ix, Notepad.Header11 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)12 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)14 15 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_0 * 8) 16 ld bc, NUMBER_OF_TILES_PER_ICON * 8 17 call BIOS_LDIRVM 20 ld ix, Calc.Header21 ld l, (ix + PROCESS_STRUCT_IX.iconAddr)22 ld h, (ix + PROCESS_STRUCT_IX.iconAddr + 1)24 25 ld de, PATTBL + (TILE_BASE_DESKTOP_ICON_1 * 8) 26 ld bc, NUMBER_OF_TILES_PER_ICON * 8 27 call BIOS_LDIRVM 30 32 33 ld a, TILE_EMPTY34 ld (OS.desktop_Tiles), a35 ld hl, OS.desktop_Tiles36 ld de, OS.desktop_Tiles + 137 ld bc, 0 + (32 * 22) - 138 ldir41 48 ld ix, Notepad.Header49 ld a, TILE_BASE_DESKTOP_ICON_050 ld hl, OS.desktop_Tiles51 call _DRAW_DESKTOP_ICON53 ld ix, Calc.Header54 ld a, TILE_BASE_DESKTOP_ICON_155 ld hl, OS.desktop_Tiles + 856 call _DRAW_DESKTOP_ICON58 63 ret67_DRAW_DESKTOP_ICON:68 push hl69 ld de, 0 + (32 * 1) + 370 add hl, de71 72 73 ld de, 3275 ld b, 376 .loop_1:77 push hl78 ld (hl), a79 80 inc a81 add hl, de82 ld (hl), a84 inc a85 add hl, de86 ld (hl), a88 inc a89 pop hl90 inc hl92 djnz .loop_193 pop hl95 96 ld de, 0 + (32 * 4) + 197 add hl, de98 ld b, 7 99.loop_10:100 ld a, (ix + PROCESS_STRUCT_IX.iconTitle)101 102 ld (hl), a103 inc ix104 inc hl105 djnz .loop_10106.endLoop_10:109 ret113_DRAW_DESKTOP:115126 ld hl, NAMTBL127 call BIOS_SETWRT128 ld hl, OS.desktop_Tiles129 ld c, PORT_0131 ld d, 22 132.outerLoop:133 ld b, 32 134 .innerLoop:135 outi136 jp nz, .innerLoop 138 dec d139 jp nz, .outerLoop141 ret144System\Main.s18 System/Window/Window.s1 System/Window/DrawWindow.s13_DRAW_WINDOW:5 7 8 ld a, (ix + PROCESS_STRUCT_IX.windowState) 9 cp WINDOW_STATE.MINIMIZED10 ret z12 13 14 15 ld l, (ix + PROCESS_STRUCT_IX.x) 16 ld h, (ix + PROCESS_STRUCT_IX.y) 17 18 call _CONVERT_COL_LINE_TO_LINEAR19 20 25 26 ld bc, NAMTBL27 add hl, bc31 32 36 38 push hl39 call BIOS_SETWRT40 41 ld a, TILE_WINDOW_TITLE_TOP_LEFT42 out (PORT_0), a44 ld a, (ix + PROCESS_STRUCT_IX.width) 45 sub 2 46 ld b, a47 .loop_1: 48 ld a, TILE_WINDOW_TITLE_MIDDLE_TOP49 out (PORT_0), a50 djnz .loop_152 nop53 nop54 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_TOP55 out (PORT_0), a56 pop hl57 58 59 ld de, 3260 add hl, de61 62 push hl63 call BIOS_SETWRT64 ld a, TILE_WINDOW_TITLE_BOTTOM_LEFT65 out (PORT_0), a66 67 ld a, (ix + PROCESS_STRUCT_IX.width) 68 sub 5 69 ld b, a70 .loop_2:71 ld a, TILE_WINDOW_TITLE_MIDDLE_BOTTOM72 out (PORT_0), a73 djnz .loop_275 nop76 nop77 ld a, TILE_WINDOW_MINIMIZE_BUTTON78 out (PORT_0), a80 nop81 nop82 ld a, TILE_WINDOW_MAXIMIZE_BUTTON83 out (PORT_0), a85 nop86 nop87 ld a, TILE_WINDOW_CLOSE_BUTTON88 out (PORT_0), a90 nop91 nop92 ld a, TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM93 out (PORT_0), a94 pop hl96 97 push hl, ix98 inc hl99 call BIOS_SETWRT100 101 ld b, 16 102 .loop_10:103 ld a, (ix + PROCESS_STRUCT_IX.windowTitle) 104 or a 105 jp z, .endLoop_10106 out (PORT_0), a107 inc ix108 djnz .loop_10109 .endLoop_10:110 pop ix, hl112 114 ld a, (ix + PROCESS_STRUCT_IX.height) 115 sub 4 116 ld b, a117.loop_height:118 push bc120 ld de, 32121 add hl, de122 123 push hl124 call BIOS_SETWRT125 ld a, TILE_WINDOW_BORDER_LEFT126 out (PORT_0), a128 ld a, (ix + PROCESS_STRUCT_IX.width) 129 sub 2 130 ld b, a131 .loop_3:132 ld a, TILE_EMPTY133 out (PORT_0), a134 djnz .loop_3136 nop137 nop138 ld a, TILE_WINDOW_BORDER_RIGHT139 out (PORT_0), a140 pop hl142 pop bc143 djnz .loop_height145 147 148 ld de, 32149 add hl, de150 151 push hl152 call BIOS_SETWRT153 ld a, TILE_WINDOW_BORDER_LEFT154 out (PORT_0), a155 156 ld a, (ix + PROCESS_STRUCT_IX.width) 157 sub 2 158 ld b, a159 .loop_4:160 ld a, TILE_EMPTY161 out (PORT_0), a162 djnz .loop_4164 nop165 nop166 ld a, TILE_WINDOW_RESIZE_CORNER_TOP167 out (PORT_0), a168 pop hl170 171 ld de, 32172 add hl, de173 174 push hl175 call BIOS_SETWRT176 ld a, TILE_WINDOW_BORDER_BOTTOM_LEFT177 out (PORT_0), a178 179 ld a, (ix + PROCESS_STRUCT_IX.width) 180 sub 3 181 ld b, a182 .loop_5:183 ld a, TILE_WINDOW_BORDER_MIDDLE_BOTTOM184 out (PORT_0), a185 djnz .loop_5187 nop188 nop189 ld a, TILE_WINDOW_RESIZE_CORNER_LEFT190 out (PORT_0), a192 nop193 nop194 ld a, TILE_WINDOW_RESIZE_CORNER_RIGHT195 out (PORT_0), a196 pop hl198 202 204 ld e, (ix + PROCESS_STRUCT_IX.drawAddr) 205 ld d, (ix + PROCESS_STRUCT_IX.drawAddr + 1) 206 call JP_DE210 ret214217_DRAW_STRING:218 219 call BIOS_SETWRT220 221.loop:222 ld a, (de)223 or a224 ret z 226 230 231 232 cp 32233 jp z, .setTileEmpty235 236 add -65 + TILE_FONT_UPPERCASE_A 239.continue:240 out (PORT_0), a242 inc de244 jp .loop246.setTileEmpty:247 ld a, TILE_EMPTY248 jp .continue250System/Window/Window.s2 System/Window/CloseWindow.s13_CLOSE_WINDOW:5 10 12 retSystem/Window/Window.s3 System/Window/ScreenMapping.s14_UPDATE_SCREEN:6 12 16 call Wait_Vblank18 call _DRAW_DESKTOP22 23 call _INIT_SCREEN_MAPPING25 28 ld c, 0 29 ld de, Process_struct.size31.outerLoop:32 ld hl, OS.processes + PROCESS_STRUCT_IX.layer 34 ld b, MAX_PROCESS_ID + 135 .innerLoop:36 37 ld a, (hl)38 cp c39 push hl, de, bc40 call z, .execute41 pop bc, de, hl43 ld de, Process_struct.size44 add hl, de46 djnz .innerLoop48 inc c49 ld a, c50 cp MAX_PROCESS_ID + 151 ret z53 jp .outerLoop55 57.execute:59 60 ld de, PROCESS_STRUCT_IX.layer61 xor a 62 sbc hl, de64 65 push hl66 pop ix68 69 ld l, (ix + PROCESS_STRUCT_IX.x) 70 ld h, (ix + PROCESS_STRUCT_IX.y) 71 72 call _CONVERT_COL_LINE_TO_LINEAR74 call _UPDATE_SCREEN_MAPPING_WINDOW76 call _DRAW_WINDOW78 ret8285_UPDATE_SCREEN_MAPPING_WINDOW:87 88 ld a, (ix + PROCESS_STRUCT_IX.windowState) 89 cp WINDOW_STATE.MINIMIZED90 ret z92 93 ex de, hl94 ld hl, OS.screenMapping95 add hl, de96 97 ld de, 32 99 100 push hl101 ld c, (ix + PROCESS_STRUCT_IX.height) 102 .outerLoop_1:103 push hl104 ld b, (ix + PROCESS_STRUCT_IX.width) 105 .loop_20:106 107 108 ld a, (ix + PROCESS_STRUCT_IX.processId)109 or SCREEN_MAPPING_WINDOWS110 111 ld (hl), a112 inc hl113 djnz .loop_20114 pop hl116 add hl, de117 dec c118 jp nz, .outerLoop_1119 pop hl121 122 ld a, (ix + PROCESS_STRUCT_IX.processId)123 or SCREEN_MAPPING_WINDOWS_TITLE_BAR124 ld c, a126 127 push hl128 ld b, (ix + PROCESS_STRUCT_IX.width) 129 .loop_21:130 ld (hl), c131 inc hl132 djnz .loop_21133 pop hl134 135 add hl, de 136 push hl137 ld a, (ix + PROCESS_STRUCT_IX.width) 138 sub 4 139 ld b, a140 .loop_22:141 ld (hl), c142 inc hl143 djnz .loop_22145 ld a, (ix + PROCESS_STRUCT_IX.processId)146 or SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON147 ld (hl), a148 inc hl150 ld a, (ix + PROCESS_STRUCT_IX.processId)151 or SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON152 ld (hl), a153 inc hl155 ld a, (ix + PROCESS_STRUCT_IX.processId)156 or SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON157 ld (hl), a158 inc hl160 pop hl162 ret165166_INIT_SCREEN_MAPPING:168 169 ld hl, OS.screenMapping170 push hl 171 pop de172 inc de173 ld bc, 0 + (32 * 22) - 1 174 ld a, SCREEN_MAPPING_DESKTOP 175 ld (hl), a176 ldir178183 184185 186192 ld a, SCREEN_MAPPING_TASKBAR 193 ld b, 32 * 2 194.loop_2:195 ld (hl), a196 inc hl197 djnz .loop_2200 retSystem/Window/Window.s713_CONVERT_COL_LINE_TO_LINEAR:14 15 26 xor a 28 srl h 29 rra 30 srl h31 rra32 srl h33 rra35 or l 36 ld l, a38 ret4146_GET_WINDOW_BASE_NAMTBL:48 49 ld l, (ix + PROCESS_STRUCT_IX.x) 50 ld h, (ix + PROCESS_STRUCT_IX.y) 51 52 call _CONVERT_COL_LINE_TO_LINEAR53 54 ld bc, NAMTBL + (32 * 2) + 155 add hl, bc57 62 ret6569_GET_WINDOW_TITLE_BASE_NAMTBL:71 72 ld l, (ix + PROCESS_STRUCT_IX.x) 73 ld h, (ix + PROCESS_STRUCT_IX.y) 74 75 call _CONVERT_COL_LINE_TO_LINEAR76 77 ld bc, NAMTBL78 add hl, bc80 83 retSystem\Main.s19 System/Keyboard/Keyboard.s1 18_READ_KEYBOARD:20 ld a, (BIOS_NEWKEY + 8)21 ld b, a23 push bc24 bit 7, b 25 call z, .keyPressed_R26 pop bc28 push bc29 bit 4, b 30 call z, .keyPressed_L31 pop bc34 35 ld a, b36 ld (OS.keyboardMatrix + 8), a38 41 ret43.keyPressed_R:44 45 ld a, (OS.keyboardMatrix + 8)46 bit 7, a47 ret z49 51 ld hl, Notepad.Header52 call _LOAD_PROCESS54 ret56.keyPressed_L:57 58 ld a, (OS.keyboardMatrix + 8)59 bit 4, a60 ret z62 69 ld hl, Calc.Header70 call _LOAD_PROCESS72 ret7579 80838588 8994System\Main.s20 System/Mouse/Mouse.s1 System/Mouse/DrawMouseCursor.s1_DRAW_MOUSE_CURSOR:3 4 ld hl, SPRATR5 call BIOS_SETWRT6 ld c, PORT_07 ld hl, OS.mouseSpriteAttributes9 ld a, (hl) 10 dec a11 inc hl12 out (c), a 14 17 nop18 nop19 nop20 outi 22 nop23 nop24 nop25 outi 27 nop28 nop29 nop30 outi 32 ld a, (hl) 33 dec a34 inc hl35 out (c), a 37 nop38 nop39 nop40 outi 42 nop43 nop44 nop45 outi 47 nop48 nop49 nop50 outi 5464 66 ld a, (OS.isDraggingWindow)67 or a68 jp z, .skip_170 ld a, (hl) 71 dec a72 inc hl73 out (c), a 75 nop76 nop77 nop78 outi 80 nop81 nop82 nop83 outi 85 nop86 nop87 nop88 outi 9092.skip_1:93 nop94 nop95 ld a, 20896 out (c), a 100 101 ld a, (OS.mouseX) 103 srl a 104 srl a 105 srl a 106 ld l, a108 ld a, (OS.mouseY) 110 srl a 111 srl a 112 srl a 113 ld h, a115 call _CONVERT_COL_LINE_TO_LINEAR117 ld bc, OS.screenMapping118 add hl, bc120 ld a, (hl)122 ld (OS.currentTileMouseOver), a124 131 ret133136System/Mouse/Mouse.s2 System/Mouse/MouseClick.s1_MOUSE_CLICK:3 4 ld a, (OS.isDraggingWindow)5 or a6 jp z, .skip_17 8 ld a, (OS.mouseButton_1) 9 or a10 jp z, _END_DRAG_WINDOW11 jp _DO_DRAG_WINDOW13.skip_1:14 16 ld a, (OS.mouseButton_1) 17 ld b, a18 or a19 jp z, .return 22 ld a, (OS.oldMouseButton_1) 23 or a24 jp nz, .return 27 28 ld a, b29 ld (OS.oldMouseButton_1), a3133 35 36 ld a, (OS.currentTileMouseOver)38 39 cp SCREEN_MAPPING_DESKTOP 40 jp z, .click_Desktop41 cp SCREEN_MAPPING_TASKBAR 42 jp z, .click_Taskbar44 45 and 0000 1111 b 46 ld c, a48 53 ld a, (OS.currentTileMouseOver)54 and 1111 0000 b 56 cp SCREEN_MAPPING_WINDOWS57 jp z, .click_Window59 cp SCREEN_MAPPING_WINDOWS_TITLE_BAR60 jp z, .click_WindowTitleBar62 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON63 jp z, .click_WindowCloseButton65 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON66 jp z, .click_WindowMinimizeButton68 ret70.return:71 72 ld a, b73 ld (OS.oldMouseButton_1), a74 ret7678.click_Window:81 82 call _GET_PROCESS_BY_ID83 call z, _SET_CURRENT_PROCESS84 ret nz86 89 ret9193.click_WindowTitleBar:95 98 99 call _GET_PROCESS_BY_ID100 call z, _SET_CURRENT_PROCESS102 call _START_DRAG_WINDOW104 ret107109.click_WindowCloseButton:111 112 call _GET_PROCESS_BY_ID114 ret nz116 call _CLOSE_PROCESS118 ret120122.click_WindowMinimizeButton:124 125 call _GET_PROCESS_BY_ID126 ret nz128 call _MINIMIZE_PROCESS130 ret132134.click_Desktop:135 ret137139.click_Taskbar:141 143 ld a, (OS.mouseY)144 cp 191 + 1 - 10 145 ret c149 ld a, (OS.mouseX)150 151 152 cp 20 * 8153 ld hl, (OS.taskbar_Button_3_Process_addr)154 jp nc, .click_Taskbar_button156 157 cp 15 * 8158 ld hl, (OS.taskbar_Button_2_Process_addr)159 jp nc, .click_Taskbar_button161 162 cp 10 * 8163 ld hl, (OS.taskbar_Button_1_Process_addr)164 jp nc, .click_Taskbar_button166 167 cp 5 * 8168 ld hl, (OS.taskbar_Button_0_Process_addr)169 jp nc, .click_Taskbar_button171 172 cp 3 * 8173 jp c, .skip_10174 cp 4 * 8175 jp c, .click_Taskbar_ShowDesktop176.skip_10:179 ret183.click_Taskbar_ShowDesktop:185 186 ld hl, OS.processes187 ld de, Process_struct.size188 ld b, MAX_PROCESS_ID + 1189.loop_1:190 ld a, (hl)191 cp 0xff 192 jp z, .next_1194 push hl, de, bc195 ld c, a196 call _GET_PROCESS_BY_ID198 call _MINIMIZE_PROCESS199 pop bc, de, hl201.next_1:202 add hl, de203 djnz .loop_1204 205 ret209.click_Taskbar_button:211 212 push hl213 inc hl214 ld a, l215 or h216 pop hl217 ret z219 call _SET_CURRENT_PROCESS221 ret225_START_DRAG_WINDOW:226 227 ld a, 1228 ld (OS.isDraggingWindow), a231 push hl232 pop ix234 236 ld a, (ix + PROCESS_STRUCT_IX.x) 240 add a 241 add a242 add a243 ld (OS.windowCorner_TopLeft_X), a244 ld b, a246 ld a, (OS.mouseX)248 sub b250 ld (OS.dragOffset_X), a254 255 ld a, (ix + PROCESS_STRUCT_IX.y) 259 add a 260 add a261 add a262 ld (OS.windowCorner_TopLeft_Y), a263 ld b, a265 ld a, (OS.mouseY)267 sub b269 ld (OS.dragOffset_Y), a273 274 ld a, SPRITE_INDEX_WINDOW_TOP_LEFT275 ld (OS.windowCorner_TopLeft_Pattern), a276 ld a, 4 277 ld (OS.windowCorner_TopLeft_Color), a278 280 ret284_DO_DRAG_WINDOW:285 286 ld a, (OS.dragOffset_X)287 ld b, a288 ld a, (OS.mouseX)289 sub b290 ld (OS.windowCorner_TopLeft_X), a292 293 ld a, (OS.dragOffset_Y)294 ld b, a295 ld a, (OS.mouseY)296 sub b297 ld (OS.windowCorner_TopLeft_Y), a299 ret303_END_DRAG_WINDOW:304 305 306 xor a307 ld (OS.isDraggingWindow), a309 retSystem/Mouse/Mouse.s3 System/Mouse/MouseOver.s1_MOUSE_OVER:3 4 ld a, (OS.mouseOver_Activated)5 or a6 jp z, .skip_18 9 ld a, (OS.currentTileMouseOver)10 ld b, a11 ld a, (OS.mouseOver_screenMappingValue)12 cp b13 jp nz, .notOver_WindowButton14 ret z16.skip_1:19 20 ld a, (OS.currentTileMouseOver)22 23 cp SCREEN_MAPPING_DESKTOP 24 ret z25 cp SCREEN_MAPPING_TASKBAR 26 ret z29 30 and 0000 1111 b 31 ld c, a33 ld a, (OS.currentTileMouseOver)34 and 1111 0000 b 37 40 cp SCREEN_MAPPING_WINDOWS_CLOSE_BUTTON41 jp z, .over_WindowCloseButton43 cp SCREEN_MAPPING_WINDOWS_MAXIMIZE_RESTORE_BUTTON44 jp z, .over_WindowMaximizeRestoreButton46 cp SCREEN_MAPPING_WINDOWS_MINIMIZE_BUTTON47 jp z, .over_WindowMinimizeRestoreButton49 ret51.over_WindowCloseButton:53 54 call _GET_PROCESS_BY_ID55 ret nz57 call .getWindowCloseButton_NAMTBL59 ld iy, TILE_WINDOW_CLOSE_BUTTON_PATTERN60 ld b, TILE_WINDOW_CLOSE_BUTTON62 call .setMouseOver64 ret68.over_WindowMaximizeRestoreButton:70 71 call _GET_PROCESS_BY_ID72 ret nz74 call .getWindowCloseButton_NAMTBL75 dec hl 77 ld iy, TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN78 ld b, TILE_WINDOW_MAXIMIZE_BUTTON80 call .setMouseOver82 ret86.over_WindowMinimizeRestoreButton:88 89 call _GET_PROCESS_BY_ID90 ret nz92 call .getWindowCloseButton_NAMTBL93 dec hl94 dec hl 96 ld iy, TILE_WINDOW_MINIMIZE_BUTTON_PATTERN97 ld b, TILE_WINDOW_MINIMIZE_BUTTON99 call .setMouseOver101 ret105.notOver_WindowButton:107 108 ld a, (OS.mouseOver_screenMappingValue)109 and 0000 1111 b 110 ld c, a113 114 xor a115 ld (OS.mouseOver_Activated), a117 118 ld (OS.mouseOver_screenMappingValue), a121 122 call _GET_PROCESS_BY_ID123 ret nz 126 127 128 129 ld hl, (OS.mouseOver_NAMTBL_addr)130 call BIOS_SETWRT132 133 ld a, (OS.mouseOver_tileToBeRestored)134 out (PORT_0), a136 ret141145.setMouseOver:147149 150 ld a, (OS.mouseOver_Activated)151 or a152 ret nz154 156 ld a, b157 ld (OS.mouseOver_tileToBeRestored), a159 160 ld a, 1161 ld (OS.mouseOver_Activated), a163 164 ld a, (OS.currentTileMouseOver)165 ld (OS.mouseOver_screenMappingValue), a167 171 push hl173 176 ld a, (OS.mouseY)177 cp 64178 jp c, .updateScreenTop179 cp 128180 jp c, .updateScreenMiddle181 jp .updateScreenBottom183.updateScreenTop:184 187 push iy 188 pop hl190 ld de, PATTBL + (TILE_MOUSE_OVER * 8) 191 ld bc, 8 192 call BIOS_LDIRVM 194 ld a, 0xe1 196 ld bc, 8 197 ld hl, COLTBL + (TILE_MOUSE_OVER * 8) 198 call BIOS_FILVRM199 200 jp .continue_1202.updateScreenMiddle:203 206 push iy 207 pop hl209 ld de, PATTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 210 ld bc, 8 211 call BIOS_LDIRVM 213 ld a, 0xe1 214 ld bc, 8 215 ld hl, COLTBL + (256 * 8) + (TILE_MOUSE_OVER * 8) 216 call BIOS_FILVRM217 218 jp .continue_1220.updateScreenBottom:221 224 push iy 225 pop hl227 ld de, PATTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 228 ld bc, 8 229 call BIOS_LDIRVM 231 ld a, 0xe1 232 ld bc, 8 233 ld hl, COLTBL + (512 * 8) + (TILE_MOUSE_OVER * 8) 234 call BIOS_FILVRM235 236.continue_1:238 pop hl240 241 242 ld (OS.mouseOver_NAMTBL_addr), hl244 245 call BIOS_SETWRT246 ld a, TILE_MOUSE_OVER247 out (PORT_0), a249 ret251258265267274276279283287.getWindowCloseButton_NAMTBL:288 push hl289 pop ix290 call _GET_WINDOW_TITLE_BASE_NAMTBL291 292 ld c, (ix + PROCESS_STRUCT_IX.width) 293 ld b, 0294 add hl, bc295 ld bc, 32 - 2 296 add hl, bc297 retSystem/Mouse/Mouse.s7WAIT1: equ 10 8WAIT2: equ 30 1118GTMOUS:19 ld b, WAIT2 20 call GTOFS2 22 23 ld ix, 024 bit 4, a25 jp nz, .mouseButton_1_NotClicked26 ld ixh, 127.mouseButton_1_NotClicked:28 bit 5, a29 jp nz, .mouseButton_2_NotClicked30 ld ixl, 131.mouseButton_2_NotClicked:33 and 0x0F34 rlca35 rlca36 rlca37 rlca38 ld c, a39 call GTOFST 40 and 0x0F41 or c42 ld h, a 43 call GTOFST 44 and 0x0F45 rlca46 rlca47 rlca48 rlca49 ld c, a50 call GTOFST 51 and 0x0F52 or c53 ld l, a 54 ret55 56GTOFST: 57 ld b, WAIT158GTOFS2: 59 ld a, 15 61 out (0xA0), a62 in a, (0xA1) 63 and 0x80 64 or d 65 out (0xA1), a66 xor e67 ld d, a68 69 call WAITMS 70 71 ld a, 1472 out (0xA0), a73 74 in a, (0xA2)75 ret76WAITMS:77 ld a, b78WTTR:79 djnz WTTR80 db 0xED,0x55 81 rlca82 rlca83 ld b, a84WTTR2:85 djnz WTTR286 ld b, a 87WTTR3:88 djnz WTTR390 ret 92100CLIPADD:101 102 ld a, l103 ld b, e104 call LIMITADD105 ld l, a106 107 ld a, h108 ld b, d109 call LIMITADD110 ld h, a111 cp 191112 ret c113 ld h, 191114 ret115 116LIMITADD:117 118122 123 124 sub 128 125 add a, b 126 jp pe, .CLIP 127 add a, 128 128 ret 129.CLIP: 130 ld a, b 131 cpl 132 add a, a 133 sbc a, a 134 ret 135System\Main.s21 System/Process/Process.s1 System/Process/LoadProcess.s13_LOAD_PROCESS:5 6 ld de, (OS.nextAvailableProcessAddr)7 ld a, 0xff8 cp d9 jp nz, .skip_010 cp e11 jp z, .showAlertMaxProcessLimitReached12.skip_0:14 15 push hl16 ld a, 0xff17 ld hl, (OS.nextAvailableProcessAddr)18 ld (hl), a19 20 push hl 21 pop de23 inc de25 27 ld bc, Process_struct.size - 128 ldir29 pop hl32 34 ld de, (OS.nextAvailableProcessAddr) 35 ld bc, Process_struct.size_Header 36 ldir 38 39 ld hl, (OS.nextAvailableProcessAddr)40 ld (OS.currentProcessAddr), hl43 45 46 49 50 54 58 62 65 66 ld hl, (OS.currentProcessAddr)67 call _GET_NEXT_AVAILABLE_PROCESS_ID68 ld a, ixh69 cp 25570 jp z, .maxProcessLimitReached71 ld hl, (OS.currentProcessAddr)72 ld (hl), a 74 75 call _GET_NEXT_AVAILABLE_PROCESS_ADDR76 78 ld (OS.nextAvailableProcessAddr), hl82 ld ix, (OS.currentProcessAddr)84 86 87 88 call _GET_NUMBER_OF_PROCESSES_OPENED89 dec a90 ld (ix + PROCESS_STRUCT_IX.layer), a93 95 ld a, (OS.nextWindow_x)96 ld (ix + PROCESS_STRUCT_IX.x), a97 add 298 ld (OS.nextWindow_x), a100 ld a, (OS.nextWindow_y)101 ld (ix + PROCESS_STRUCT_IX.y), a102 add 2103 ld (OS.nextWindow_y), a104 cp 12105 call nc, .resetNextWindow_XY 111 call _UPDATE_SCREEN114 call _DRAW_TASKBAR116 118 ld ix, (OS.currentProcessAddr)119 ld e, (ix + PROCESS_STRUCT_IX.openAddr) 120 ld d, (ix + PROCESS_STRUCT_IX.openAddr + 1) 121 call JP_DE125 131 132 133 140 ret142.maxProcessLimitReached:143 144 ld hl, 0xffff145 ld (OS.nextAvailableProcessAddr), hl147 ret149.showAlertMaxProcessLimitReached:151 155 ret157.resetNextWindow_XY:158 xor a159 ld (OS.nextWindow_x), a160 ld (OS.nextWindow_y), a162 ret164System/Process/Process.s2 System/Process/SetCurrentProcess.s13_SET_CURRENT_PROCESS:7 8 ld (OS.currentProcessAddr), hl10 push hl 11 pop ix13 15 ld a, WINDOW_STATE.RESTORED16 ld (ix + PROCESS_STRUCT_IX.windowState), a18 push hl19 20 ld c, (ix + PROCESS_STRUCT_IX.layer)21 22 23 call _ADJUST_LAYER_OF_PROCESSES25 26 call _GET_NUMBER_OF_PROCESSES_OPENED27 dec a28 ld (ix + PROCESS_STRUCT_IX.layer), a29 pop hl31 call _UPDATE_SCREEN33 call _DRAW_TASKBAR35 40 43 ret47System/Process/Process.s3 System/Process/CloseProcess.s13_CLOSE_PROCESS:5 6 push hl7 pop ix9 10 push hl11 ld e, (ix + PROCESS_STRUCT_IX.closeAddr) 12 ld d, (ix + PROCESS_STRUCT_IX.closeAddr + 1) 13 call JP_DE14 pop hl16 17 push hl18 ld c, (ix + PROCESS_STRUCT_IX.layer)19 call _ADJUST_LAYER_OF_PROCESSES20 pop hl23 push hl24 call _CLOSE_WINDOW25 pop hl30 push hl31 32 ld a, 0xff33 34 ld (hl), a35 36 push hl 37 pop de39 inc de41 43 ld bc, Process_struct.size - 145 ldir46 47 pop hl51 call _UPDATE_SCREEN54 call _DRAW_TASKBAR56 57 call _GET_NEXT_AVAILABLE_PROCESS_ADDR58 60 ld (OS.nextAvailableProcessAddr), hl64 65 ld hl, 0x000066 ld (OS.currentProcessAddr), hl70 ret71System/Process/Process.s4 System/Process/MinimizeProcess.s13_MINIMIZE_PROCESS:5 6 push hl7 pop ix9 10 ld a, WINDOW_STATE.MINIMIZED11 ld (ix + PROCESS_STRUCT_IX.windowState), a13 push ix15 16 ld hl, (OS.currentProcessAddr)17 push ix 18 pop de19 call BIOS_DCOMPR 20 jp nz, .skip_122 ld hl, 0x000023 ld (OS.currentProcessAddr), hl24 .skip_1:26 pop ix28 call _CLOSE_WINDOW30 call _UPDATE_SCREEN33 35 xor a36 ld (OS.mouseOver_Activated), a38 39 ld (OS.mouseOver_screenMappingValue), a41 42 ld hl, (OS.mouseOver_NAMTBL_addr)43 call BIOS_SETWRT45 ld a, TILE_EMPTY46 out (PORT_0), a48 ld a, SCREEN_MAPPING_DESKTOP 49 ld (OS.currentTileMouseOver), a50 53 call _DRAW_TASKBAR 56 retSystem/Process/Process.s8MAX_PROCESS_ID: equ 3 1215_GET_NEXT_AVAILABLE_PROCESS_ID:16 ld ixh, 0 18.outerLoop:19 ld hl, OS.processes21.loop:22 ld a, (hl)23 cp ixh24 jp z, .goToNext 26 ld bc, Process_struct.size27 add hl, bc 29 30 ld de, OS.processes_end31 call BIOS_DCOMPR 32 jp nz, .loop34 35 ret37.goToNext:38 inc ixh39 ld a, ixh40 cp MAX_PROCESS_ID + 141 jp nz, .outerLoop43 44 ld ixh, 25546 ret4952_GET_NEXT_AVAILABLE_PROCESS_ADDR:54 ld hl, OS.processes55 ld de, Process_struct.size56 ld b, MAX_PROCESS_ID + 157.loop:58 ld a, (hl)59 60 inc a 61 ret z63 add hl, de65 djnz .loop67 68 ld hl, 0xffff70 ret7477_GET_NUMBER_OF_PROCESSES_OPENED:79 ld hl, OS.processes80 ld de, Process_struct.size81 ld b, MAX_PROCESS_ID + 182 xor a 83.loop:84 ld c, (hl)85 86 inc c 87 jp z, .next89 90 inc a92.next:93 add hl, de95 djnz .loop97 ret101107_GET_PROCESS_BY_ID:108 109 ld hl, OS.processes110 ld de, Process_struct.size111 ld b, MAX_PROCESS_ID + 1112.loop_1:113 ld a, (hl)114 cp c115 ret z116 add hl, de117 djnz .loop_1119 120 ld hl, 0x0000122 ret125127131135142147149154159163165168_ADJUST_LAYER_OF_PROCESSES:170 ld hl, OS.processes + PROCESS_STRUCT_IX.layer171 ld de, Process_struct.size172 ld b, MAX_PROCESS_ID + 1173.loop:174 ld a, (hl)175 cp 0xff176 jp z, .next 178 cp c179 jp c, .next 181 182 dec a183 ld (hl), a185.next:186 add hl, de188 djnz .loop190 ret192System\Main.s22 System/Time/Time.s1_INIT_SYSTEM_TIME:3 xor a5 ld (os.timeCounter), a7 8 ld a, 0x129 ld (OS.currentTime_Hours), a10 xor a11 ld (OS.currentTime_Minutes), a12 ld (OS.currentTime_Seconds), a13 ld (OS.timeCounter), a15 16 ld hl, OS.currentDate17 ld (hl), a18 inc hl19 ld (hl), a20 inc hl21 ld (hl), a23 ret27SYSTEM_HERTZ_RATE: equ 60 29_UPDATE_SYSTEM_TIME:31 ld a, (os.timeCounter)32 inc a33 ld (os.timeCounter), a34 cp SYSTEM_HERTZ_RATE35 ret nz37 38 xor a39 ld (os.timeCounter), a41 43 44 ld a, (OS.currentTime_Seconds)45 inc a 46 daa47 ld (OS.currentTime_Seconds), a49 50 cp 0x6051 ret nz52 ld a, (OS.currentTime_Minutes)53 inc a 54 daa55 ld (OS.currentTime_Minutes), a56 57 xor a58 ld (OS.currentTime_Seconds), a60 61 ld a, (OS.currentTime_Minutes)62 cp 0x6063 ret nz64 ld a, (OS.currentTime_Hours)65 inc a66 daa68 cp 0x13 69 jp nz, .not13Hours70 ld a, 0x0171.not13Hours:72 ld (OS.currentTime_Hours), a73 74 xor a75 ld (OS.currentTime_Minutes), a79 retSystem\Main.s2426 Graphics/Tiles.s1TILE_PATTERNS:35TILE_EMPTY: equ 06 DB 00000000b7 DB 00000000b8 DB 00000000b9 DB 00000000b10 DB 00000000b11 DB 00000000b12 DB 00000000b13 DB 00000000b15TILE_WINDOW_TITLE_TOP_LEFT: equ 116 DB 00000000b17 DB 00000000b18 DB 00000000b19 DB 00000000b20 DB 00000000b21 DB 00000000b22 DB 01111111b23 DB 01111111b25TILE_WINDOW_TITLE_BOTTOM_LEFT: equ 226 DB 01111111b27 DB 01111111b28 DB 01111111b29 DB 01111111b30 DB 01111111b31 DB 01111111b32 DB 01111111b33 DB 01111111b35TILE_WINDOW_TITLE_MIDDLE_TOP: equ 336 DB 00000000b37 DB 00000000b38 DB 00000000b39 DB 00000000b40 DB 00000000b41 DB 00000000b42 DB 11111111b43 DB 11111111b45TILE_EMPTY_BLACK: equ 446TILE_WINDOW_TITLE_MIDDLE_BOTTOM: equ 447 DB 11111111b48 DB 11111111b49 DB 11111111b50 DB 11111111b51 DB 11111111b52 DB 11111111b53 DB 11111111b54 DB 11111111b56TILE_WINDOW_BORDER_LEFT: equ 557 DB 01000000b58 DB 01000000b59 DB 01000000b60 DB 01000000b61 DB 01000000b62 DB 01000000b63 DB 01000000b64 DB 01000000b66TILE_WINDOW_BORDER_BOTTOM_LEFT: equ 667 DB 01000000b68 DB 01000000b69 DB 01000000b70 DB 01111111b71 DB 00001111b72 DB 00001111b73 DB 00001111b74 DB 00000000b76TILE_WINDOW_BORDER_MIDDLE_BOTTOM: equ 777 DB 00000000b78 DB 00000000b79 DB 00000000b80 DB 11111111b81 DB 11111111b82 DB 11111111b83 DB 11111111b84 DB 00000000b86TILE_WINDOW_RESIZE_CORNER_LEFT: equ 887 DB 00000001b88 DB 00000011b89 DB 00000110b90 DB 11111111b91 DB 11111111b92 DB 11111111b93 DB 11111111b94 DB 00000000b96TILE_WINDOW_RESIZE_CORNER_TOP: equ 997 DB 00011110b98 DB 00011110b99 DB 00011110b100 DB 00011110b101 DB 00011110b102 DB 00111110b103 DB 01111110b104 DB 11011110b106TILE_WINDOW_RESIZE_CORNER_RIGHT: equ 10107 DB 10111110b108 DB 01111110b109 DB 11011110b110 DB 11111110b111 DB 11111110b112 DB 11111110b113 DB 11111110b114 DB 00000000b117TILE_WINDOW_MINIMIZE_BUTTON_PATTERN:118TILE_WINDOW_MINIMIZE_BUTTON: equ 11119 DB 11111111b120 DB 11111111b121 DB 11111111b122 DB 11111111b123 DB 11000001b124 DB 11000001b125 DB 11111111b126 DB 11111111b128TILE_WINDOW_MAXIMIZE_BUTTON_PATTERN:129TILE_WINDOW_MAXIMIZE_BUTTON: equ 12130 DB 11111111b131 DB 11000001b132 DB 11000001b133 DB 11011101b134 DB 11011101b135 DB 11000001b136 DB 11111111b137 DB 11111111b139TILE_WINDOW_CLOSE_BUTTON_PATTERN:140TILE_WINDOW_CLOSE_BUTTON: equ 13141 DB 11111111b142 DB 11011101b143 DB 11101011b144 DB 11110111b145 DB 11101011b146 DB 11011101b147 DB 11111111b148 DB 11111111b149 150TILE_WINDOW_TOP_RIGHT_CORNER_TOP: equ 14151 DB 00000000b152 DB 00000000b153 DB 00000000b154 DB 00000000b155 DB 00000000b156 DB 00000000b157 DB 11110000b158 DB 11110000b160TILE_WINDOW_TOP_RIGHT_CORNER_BOTTOM: equ 15161 DB 11110000b162 DB 11111110b163 DB 11111110b164 DB 11111110b165 DB 11111110b166 DB 11111110b167 DB 11111110b168 DB 11111110b170TILE_WINDOW_BORDER_RIGHT: equ 16171 DB 00011110b172 DB 00011110b173 DB 00011110b174 DB 00011110b175 DB 00011110b176 DB 00011110b177 DB 00011110b178 DB 00011110b180190192TILE_TASKBAR_TOP: equ 17193 DB 00000000 b194 DB 00000000 b195 DB 00000000 b196 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 11111111 b200 DB 11111111 b202TILE_HOME_ICON: equ 18203 DB 11100111 b204 DB 11011011 b205 DB 10111101 b206 DB 01100110 b207 DB 11000011 b208 DB 10000001 b209 DB 10011001 b210 DB 10011001 b212TILE_SHOW_DESKTOP_ICON: equ 19213 DB 10011001 b214 DB 10111101 b215 DB 11111111 b216 DB 11111111 b217 DB 11111111 b218 DB 10111101 b219 DB 10011001 b220 DB 11111111 b222224234244254264274284294304314324 360362BASE_INDEX_TILE_FONT: equ 20364TILE_FONT_REVERSED_PATTERNS:366368TILE_FONT_REVERSED_NUMBERS_PATTERNS:370TILE_FONT_REVERSED_NUMBERS_0: equ BASE_INDEX_TILE_FONT + 0372 373 db 00000000 b374 db 00111100 b375 db 01100110 b376 db 01101110 b377 db 01110110 b378 db 01100110 b379 db 00111100 b380 db 00000000 b381 382 db 00000000 b383 db 00011000 b384 db 00111000 b385 db 00011000 b386 db 00011000 b387 db 00011000 b388 db 01111110 b389 db 00000000 b390 391 db 00000000 b392 db 00111100 b393 db 01100110 b394 db 00001100 b395 db 00011000 b396 db 00110000 b397 db 01111110 b398 db 00000000 b399 400 db 00000000 b401 db 01111110 b402 db 00001100 b403 db 00011000 b404 db 00001100 b405 db 01100110 b406 db 00111100 b407 db 00000000 b408 409 db 00000000 b410 db 00001100 b411 db 00011100 b412 db 00111100 b413 db 01101100 b414 db 01111110 b415 db 00001100 b416 db 00000000 b417 418 db 00000000 b419 db 01111110 b420 db 01100000 b421 db 01111100 b422 db 00000110 b423 db 01100110 b424 db 00111100 b425 db 00000000 b426 427 db 00000000 b428 db 00111100 b429 db 01100000 b430 db 01111100 b431 db 01100110 b432 db 01100110 b433 db 00111100 b434 db 00000000 b435 436 db 00000000 b437 db 01111110 b438 db 00000110 b439 db 00001100 b440 db 00011000 b441 db 00110000 b442 db 00110000 b443 db 00000000 b444 445 db 00000000 b446 db 00111100 b447 db 01100110 b448 db 00111100 b449 db 01100110 b450 db 01100110 b451 db 00111100 b452 db 00000000 b453 454 db 00000000 b455 db 00111100 b456 db 01100110 b457 db 00111110 b458 db 00000110 b459 db 00001100 b460 db 00111000 b461 db 00000000 b464467TILE_FONT_REVERSED_LOWERCASE_PATTERNS:469TILE_FONT_REVERSED_LOWERCASE_A: equ TILE_FONT_REVERSED_NUMBERS_0 + 10471 472 db 00000000 b473 db 00000000 b474 db 00111100 b475 db 00000110 b476 db 00111110 b477 db 01100110 b478 db 00111110 b479 db 00000000 b480 481 db 00000000 b482 db 01100000 b483 db 01100000 b484 db 01111100 b485 db 01100110 b486 db 01100110 b487 db 01111100 b488 db 00000000 b489 490 db 00000000 b491 db 00000000 b492 db 00111100 b493 db 01100000 b494 db 01100000 b495 db 01100000 b496 db 00111100 b497 db 00000000 b498 499 db 00000000 b500 db 00000110 b501 db 00000110 b502 db 00111110 b503 db 01100110 b504 db 01100110 b505 db 00111110 b506 db 00000000 b507 508 db 00000000 b509 db 00000000 b510 db 00111100 b511 db 01100110 b512 db 01111110 b513 db 01100000 b514 db 00111100 b515 db 00000000 b516 517 db 00000000 b518 db 00001110 b519 db 00011000 b520 db 00111110 b521 db 00011000 b522 db 00011000 b523 db 00011000 b524 db 00000000 b525 526 db 00000000 b527 db 00000000 b528 db 00111110 b529 db 01100110 b530 db 01100110 b531 db 00111110 b532 db 00000110 b533 db 01111100 b534 535 db 00000000 b536 db 01100000 b537 db 01100000 b538 db 01111100 b539 db 01100110 b540 db 01100110 b541 db 01100110 b542 db 00000000 b543 544 db 00000000 b545 db 00011000 b546 db 00000000 b547 db 00111000 b548 db 00011000 b549 db 00011000 b550 db 00111100 b551 db 00000000 b552 553 db 00000000 b554 db 00000110 b555 db 00000000 b556 db 00000110 b557 db 00000110 b558 db 00000110 b559 db 00000110 b560 db 00111100 b561 562 db 00000000 b563 db 01100000 b564 db 01100000 b565 db 01101100 b566 db 01111000 b567 db 01101100 b568 db 01100110 b569 db 00000000 b570 571 db 00000000 b572 db 00111000 b573 db 00011000 b574 db 00011000 b575 db 00011000 b576 db 00011000 b577 db 00111100 b578 db 00000000 b579 580 db 00000000 b581 db 00000000 b582 db 01100110 b583 db 01111111 b584 db 01111111 b585 db 01101011 b586 db 01100011 b587 db 00000000 b588 589 db 00000000 b590 db 00000000 b591 db 01111100 b592 db 01100110 b593 db 01100110 b594 db 01100110 b595 db 01100110 b596 db 00000000 b597 598 db 00000000 b599 db 00000000 b600 db 00111100 b601 db 01100110 b602 db 01100110 b603 db 01100110 b604 db 00111100 b605 db 00000000 b606 607 db 00000000 b608 db 00000000 b609 db 01111100 b610 db 01100110 b611 db 01100110 b612 db 01111100 b613 db 01100000 b614 db 01100000 b615 616 db 00000000 b617 db 00000000 b618 db 00111110 b619 db 01100110 b620 db 01100110 b621 db 00111110 b622 db 00000110 b623 db 00000110 b624 625 db 00000000 b626 db 00000000 b627 db 01111100 b628 db 01100110 b629 db 01100000 b630 db 01100000 b631 db 01100000 b632 db 00000000 b633 634 db 00000000 b635 db 00000000 b636 db 00111110 b637 db 01100000 b638 db 00111100 b639 db 00000110 b640 db 01111100 b641 db 00000000 b642 643 db 00000000 b644 db 00011000 b645 db 01111110 b646 db 00011000 b647 db 00011000 b648 db 00011000 b649 db 00001110 b650 db 00000000 b651 652 db 00000000 b653 db 00000000 b654 db 01100110 b655 db 01100110 b656 db 01100110 b657 db 01100110 b658 db 00111110 b659 db 00000000 b660 661 db 00000000 b662 db 00000000 b663 db 01100110 b664 db 01100110 b665 db 01100110 b666 db 00111100 b667 db 00011000 b668 db 00000000 b669 670 db 00000000 b671 db 00000000 b672 db 01100011 b673 db 01101011 b674 db 01111111 b675 db 00111110 b676 db 00110110 b677 db 00000000 b678 679 db 00000000 b680 db 00000000 b681 db 01100110 b682 db 00111100 b683 db 00011000 b684 db 00111100 b685 db 01100110 b686 db 00000000 b687 688 db 00000000 b689 db 00000000 b690 db 01100110 b691 db 01100110 b692 db 01100110 b693 db 00111110 b694 db 00001100 b695 db 01111000 b696 697 db 00000000 b698 db 00000000 b699 db 01111110 b700 db 00001100 b701 db 00011000 b702 db 00110000 b703 db 01111110 b704 db 00000000 b706TILE_FONT_REVERSED_LOWERCASE_PATTERNS.size: equ $ - TILE_FONT_REVERSED_LOWERCASE_PATTERNS709711TILE_FONT_REVERSED_SYMBOLS_PATTERNS:713TILE_FONT_REVERSED_SYMBOLS: equ TILE_FONT_REVERSED_LOWERCASE_A + 26715 716 db 00000000 b717 db 00000000 b718 db 00011000 b719 db 00011000 b720 db 00000000 b721 db 00011000 b722 db 00011000 b723 db 00000000 b725728TILE_FONT_REVERSED_PATTERNS.SIZE: equ $ - TILE_FONT_REVERSED_PATTERNS731733735TILE_FONT_NUMBERS_PATTERNS:737TILE_FONT_NUMBERS_0: equ TILE_FONT_REVERSED_SYMBOLS + 1739 740 db 00000000 b741 db 00111100 b742 db 01100110 b743 db 01101110 b744 db 01110110 b745 db 01100110 b746 db 00111100 b747 db 00000000 b748 749 db 00000000 b750 db 00011000 b751 db 00111000 b752 db 00011000 b753 db 00011000 b754 db 00011000 b755 db 01111110 b756 db 00000000 b757 758 db 00000000 b759 db 00111100 b760 db 01100110 b761 db 00001100 b762 db 00011000 b763 db 00110000 b764 db 01111110 b765 db 00000000 b766 767 db 00000000 b768 db 01111110 b769 db 00001100 b770 db 00011000 b771 db 00001100 b772 db 01100110 b773 db 00111100 b774 db 00000000 b775 776 db 00000000 b777 db 00001100 b778 db 00011100 b779 db 00111100 b780 db 01101100 b781 db 01111110 b782 db 00001100 b783 db 00000000 b784 785 db 00000000 b786 db 01111110 b787 db 01100000 b788 db 01111100 b789 db 00000110 b790 db 01100110 b791 db 00111100 b792 db 00000000 b793 794 db 00000000 b795 db 00111100 b796 db 01100000 b797 db 01111100 b798 db 01100110 b799 db 01100110 b800 db 00111100 b801 db 00000000 b802 803 db 00000000 b804 db 01111110 b805 db 00000110 b806 db 00001100 b807 db 00011000 b808 db 00110000 b809 db 00110000 b810 db 00000000 b811 812 db 00000000 b813 db 00111100 b814 db 01100110 b815 db 00111100 b816 db 01100110 b817 db 01100110 b818 db 00111100 b819 db 00000000 b820 821 db 00000000 b822 db 00111100 b823 db 01100110 b824 db 00111110 b825 db 00000110 b826 db 00001100 b827 db 00111000 b828 db 00000000 b832835TILE_FONT_LOWERCASE_PATTERNS:837TILE_FONT_LOWERCASE_A: equ TILE_FONT_NUMBERS_0 + 10839 840 db 00000000 b841 db 00000000 b842 db 00111100 b843 db 00000110 b844 db 00111110 b845 db 01100110 b846 db 00111110 b847 db 00000000 b848 849 db 00000000 b850 db 01100000 b851 db 01100000 b852 db 01111100 b853 db 01100110 b854 db 01100110 b855 db 01111100 b856 db 00000000 b857 858 db 00000000 b859 db 00000000 b860 db 00111100 b861 db 01100000 b862 db 01100000 b863 db 01100000 b864 db 00111100 b865 db 00000000 b866 867 db 00000000 b868 db 00000110 b869 db 00000110 b870 db 00111110 b871 db 01100110 b872 db 01100110 b873 db 00111110 b874 db 00000000 b875 876 db 00000000 b877 db 00000000 b878 db 00111100 b879 db 01100110 b880 db 01111110 b881 db 01100000 b882 db 00111100 b883 db 00000000 b884 885 db 00000000 b886 db 00001110 b887 db 00011000 b888 db 00111110 b889 db 00011000 b890 db 00011000 b891 db 00011000 b892 db 00000000 b893 894 db 00000000 b895 db 00000000 b896 db 00111110 b897 db 01100110 b898 db 01100110 b899 db 00111110 b900 db 00000110 b901 db 01111100 b902 903 db 00000000 b904 db 01100000 b905 db 01100000 b906 db 01111100 b907 db 01100110 b908 db 01100110 b909 db 01100110 b910 db 00000000 b911 912 db 00000000 b913 db 00011000 b914 db 00000000 b915 db 00111000 b916 db 00011000 b917 db 00011000 b918 db 00111100 b919 db 00000000 b920 921 db 00000000 b922 db 00000110 b923 db 00000000 b924 db 00000110 b925 db 00000110 b926 db 00000110 b927 db 00000110 b928 db 00111100 b929 930 db 00000000 b931 db 01100000 b932 db 01100000 b933 db 01101100 b934 db 01111000 b935 db 01101100 b936 db 01100110 b937 db 00000000 b938 939 db 00000000 b940 db 00111000 b941 db 00011000 b942 db 00011000 b943 db 00011000 b944 db 00011000 b945 db 00111100 b946 db 00000000 b947 948 db 00000000 b949 db 00000000 b950 db 01100110 b951 db 01111111 b952 db 01111111 b953 db 01101011 b954 db 01100011 b955 db 00000000 b956 957 db 00000000 b958 db 00000000 b959 db 01111100 b960 db 01100110 b961 db 01100110 b962 db 01100110 b963 db 01100110 b964 db 00000000 b965 966 db 00000000 b967 db 00000000 b968 db 00111100 b969 db 01100110 b970 db 01100110 b971 db 01100110 b972 db 00111100 b973 db 00000000 b974 975 db 00000000 b976 db 00000000 b977 db 01111100 b978 db 01100110 b979 db 01100110 b980 db 01111100 b981 db 01100000 b982 db 01100000 b983 984 db 00000000 b985 db 00000000 b986 db 00111110 b987 db 01100110 b988 db 01100110 b989 db 00111110 b990 db 00000110 b991 db 00000110 b992 993 db 00000000 b994 db 00000000 b995 db 01111100 b996 db 01100110 b997 db 01100000 b998 db 01100000 b999 db 01100000 b1000 db 00000000 b1001 1002 db 00000000 b1003 db 00000000 b1004 db 00111110 b1005 db 01100000 b1006 db 00111100 b1007 db 00000110 b1008 db 01111100 b1009 db 00000000 b1010 1011 db 00000000 b1012 db 00011000 b1013 db 01111110 b1014 db 00011000 b1015 db 00011000 b1016 db 00011000 b1017 db 00001110 b1018 db 00000000 b1019 1020 db 00000000 b1021 db 00000000 b1022 db 01100110 b1023 db 01100110 b1024 db 01100110 b1025 db 01100110 b1026 db 00111110 b1027 db 00000000 b1028 1029 db 00000000 b1030 db 00000000 b1031 db 01100110 b1032 db 01100110 b1033 db 01100110 b1034 db 00111100 b1035 db 00011000 b1036 db 00000000 b1037 1038 db 00000000 b1039 db 00000000 b1040 db 01100011 b1041 db 01101011 b1042 db 01111111 b1043 db 00111110 b1044 db 00110110 b1045 db 00000000 b1046 1047 db 00000000 b1048 db 00000000 b1049 db 01100110 b1050 db 00111100 b1051 db 00011000 b1052 db 00111100 b1053 db 01100110 b1054 db 00000000 b1055 1056 db 00000000 b1057 db 00000000 b1058 db 01100110 b1059 db 01100110 b1060 db 01100110 b1061 db 00111110 b1062 db 00001100 b1063 db 01111000 b1064 1065 db 00000000 b1066 db 00000000 b1067 db 01111110 b1068 db 00001100 b1069 db 00011000 b1070 db 00110000 b1071 db 01111110 b1072 db 00000000 b107410761078TILE_FONT_UPPERCASE_PATTERNS:1080TILE_FONT_UPPERCASE_A: equ TILE_FONT_LOWERCASE_A + 261082 1083 db 00000000 b1084 db 00011000 b1085 db 00111100 b1086 db 01100110 b1087 db 01100110 b1088 db 01111110 b1089 db 01100110 b1090 db 00000000 b1091 1092 db 00000000 b1093 db 01111100 b1094 db 01100110 b1095 db 01111100 b1096 db 01100110 b1097 db 01100110 b1098 db 01111100 b1099 db 00000000 b1100 1101 db 00000000 b1102 db 00111100 b1103 db 01100110 b1104 db 01100000 b1105 db 01100000 b1106 db 01100110 b1107 db 00111100 b1108 db 00000000 b1109 1110 db 00000000 b1111 db 01111000 b1112 db 01101100 b1113 db 01100110 b1114 db 01100110 b1115 db 01101100 b1116 db 01111000 b1117 db 00000000 b1118 1119 db 00000000 b1120 db 01111110 b1121 db 01100000 b1122 db 01111100 b1123 db 01100000 b1124 db 01100000 b1125 db 01111110 b1126 db 00000000 b1127 1128 db 00000000 b1129 db 01111110 b1130 db 01100000 b1131 db 01111100 b1132 db 01100000 b1133 db 01100000 b1134 db 01100000 b1135 db 00000000 b1136 1137 db 00000000 b1138 db 00111110 b1139 db 01100000 b1140 db 01100000 b1141 db 01101110 b1142 db 01100110 b1143 db 00111110 b1144 db 00000000 b1145 1146 db 00000000 b1147 db 01100110 b1148 db 01100110 b1149 db 01111110 b1150 db 01100110 b1151 db 01100110 b1152 db 01100110 b1153 db 00000000 b1154 1155 db 00000000 b1156 db 01111110 b1157 db 00011000 b1158 db 00011000 b1159 db 00011000 b1160 db 00011000 b1161 db 01111110 b1162 db 00000000 b1163 1164 db 00000000 b1165 db 00000110 b1166 db 00000110 b1167 db 00000110 b1168 db 00000110 b1169 db 01100110 b1170 db 00111100 b1171 db 00000000 b1172 1173 db 00000000 b1174 db 01100110 b1175 db 01101100 b1176 db 01111000 b1177 db 01111000 b1178 db 01101100 b1179 db 01100110 b1180 db 00000000 b1181 1182 db 00000000 b1183 db 01100000 b1184 db 01100000 b1185 db 01100000 b1186 db 01100000 b1187 db 01100000 b1188 db 01111110 b1189 db 00000000 b1190 1191 db 00000000 b1192 db 01100011 b1193 db 01110111 b1194 db 01111111 b1195 db 01101011 b1196 db 01100011 b1197 db 01100011 b1198 db 00000000 b1199 1200 db 00000000 b1201 db 01100110 b1202 db 01110110 b1203 db 01111110 b1204 db 01111110 b1205 db 01101110 b1206 db 01100110 b1207 db 00000000 b1208 1209 db 00000000 b1210 db 00111100 b1211 db 01100110 b1212 db 01100110 b1213 db 01100110 b1214 db 01100110 b1215 db 00111100 b1216 db 00000000 b1217 1218 db 00000000 b1219 db 01111100 b1220 db 01100110 b1221 db 01100110 b1222 db 01111100 b1223 db 01100000 b1224 db 01100000 b1225 db 00000000 b1226 1227 db 00000000 b1228 db 00111100 b1229 db 01100110 b1230 db 01100110 b1231 db 01100110 b1232 db 01101100 b1233 db 00110110 b1234 db 00000000 b1235 1236 db 00000000 b1237 db 01111100 b1238 db 01100110 b1239 db 01100110 b1240 db 01111100 b1241 db 01101100 b1242 db 01100110 b1243 db 00000000 b1244 1245 db 00000000 b1246 db 00111100 b1247 db 01100000 b1248 db 00111100 b1249 db 00000110 b1250 db 00000110 b1251 db 00111100 b1252 db 00000000 b1253 1254 db 00000000 b1255 db 01111110 b1256 db 00011000 b1257 db 00011000 b1258 db 00011000 b1259 db 00011000 b1260 db 00011000 b1261 db 00000000 b1262 1263 db 00000000 b1264 db 01100110 b1265 db 01100110 b1266 db 01100110 b1267 db 01100110 b1268 db 01100110 b1269 db 01111110 b1270 db 00000000 b1271 1272 db 00000000 b1273 db 01100110 b1274 db 01100110 b1275 db 01100110 b1276 db 01100110 b1277 db 00111100 b1278 db 00011000 b1279 db 00000000 b1280 1281 db 00000000 b1282 db 01100011 b1283 db 01100011 b1284 db 01101011 b1285 db 01111111 b1286 db 01110111 b1287 db 01100011 b1288 db 00000000 b1289 1290 db 00000000 b1291 db 01100110 b1292 db 01100110 b1293 db 00111100 b1294 db 00111100 b1295 db 01100110 b1296 db 01100110 b1297 db 00000000 b1298 1299 db 00000000 b1300 db 01100110 b1301 db 01100110 b1302 db 00111100 b1303 db 00011000 b1304 db 00011000 b1305 db 00011000 b1306 db 00000000 b1307 1308 db 00000000 b1309 db 01111110 b1310 db 00001100 b1311 db 00011000 b1312 db 00110000 b1313 db 01100000 b1314 db 01111110 b1315 db 00000000 b1318TILE_PATTERNS.size: equ $ - TILE_PATTERNS13201323TILE_MOUSE_OVER: equ TILE_BASE_DESKTOP_ICONS - 1132513271329NUMBER_OF_TILES_PER_ICON: equ 91331TILE_BASE_DESKTOP_ICONS: equ 190 1333 TILE_BASE_DESKTOP_ICON_0: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 0)1334 TILE_BASE_DESKTOP_ICON_1: equ TILE_BASE_DESKTOP_ICONS + (NUMBER_OF_TILES_PER_ICON * 1)133613381340NUMBER_OF_TILES_RESERVED_PER_PROCESS: equ 121342TILE_BASE_INDEX_PROCESSES: equ 208 1344 TILE_BASE_INDEX_PROCESS_0: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 0)1345 TILE_BASE_INDEX_PROCESS_1: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 1)1346 TILE_BASE_INDEX_PROCESS_2: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 2)1347 TILE_BASE_INDEX_PROCESS_3: equ TILE_BASE_INDEX_PROCESSES + (NUMBER_OF_TILES_RESERVED_PER_PROCESS * 3)System\Main.s27 Graphics/Sprites.s1SPRITE_PATTERNS:3SPRITE_INDEX_CURSOR_0: equ 0 * 44 6 DB 10000000b7 DB 11000000b8 DB 10100000b9 DB 10010000b10 DB 10001000b11 DB 10000100b12 DB 10000010b13 DB 10000001b14 DB 10000000b15 DB 10000000b16 DB 10000011b17 DB 10010010b18 DB 10101001b19 DB 11001001b20 DB 00000110b21 DB 00000000b22 DB 00000000b23 DB 00000000b24 DB 00000000b25 DB 00000000b26 DB 00000000b27 DB 00000000b28 DB 00000000b29 DB 00000000b30 DB 10000000b31 DB 01000000b32 DB 11000000b33 DB 00000000b34 DB 00000000b35 DB 00000000b36 DB 00000000b37 DB 00000000b38SPRITE_INDEX_CURSOR_1: equ 1 * 439 40 DB 00000000b41 DB 00000000b42 DB 01000000b43 DB 01100000b44 DB 01110000b45 DB 01111000b46 DB 01111100b47 DB 01111110b48 DB 01111111b49 DB 01111111b50 DB 01111100b51 DB 01101100b52 DB 01000110b53 DB 00000110b54 DB 00000000b55 DB 00000000b56 DB 00000000b57 DB 00000000b58 DB 00000000b59 DB 00000000b60 DB 00000000b61 DB 00000000b62 DB 00000000b63 DB 00000000b64 DB 00000000b65 DB 10000000b66 DB 00000000b67 DB 00000000b68 DB 00000000b69 DB 00000000b70 DB 00000000b71 DB 00000000b73SPRITE_INDEX_WINDOW_TOP_LEFT: equ 2 * 474 DB 11001100 b75 DB 10000000 b76 DB 00000000 b77 DB 00000000 b78 DB 10000000 b79 DB 10000000 b80 DB 00000000 b81 DB 00000000 b83 DB 10000000 b84 DB 10000000 b85 DB 00000000 b86 DB 00000000 b87 DB 10000000 b88 DB 10000000 b89 DB 00000000 b90 DB 00000000 b92 DB 11001100 b93 DB 00000000 b94 DB 00000000 b95 DB 00000000 b96 DB 00000000 b97 DB 00000000 b98 DB 00000000 b99 DB 00000000 b101 DB 00000000 b102 DB 00000000 b103 DB 00000000 b104 DB 00000000 b105 DB 00000000 b106 DB 00000000 b107 DB 00000000 b108 DB 00000000 b110SPRITE_INDEX_WINDOW_TOP_RIGHT: equ 3 * 4111 DB 11001100 b112 DB 00000000 b113 DB 00000000 b114 DB 00000000 b115 DB 00000000 b116 DB 00000000 b117 DB 00000000 b118 DB 00000000 b120 DB 00000000 b121 DB 00000000 b122 DB 00000000 b123 DB 00000000 b124 DB 00000000 b125 DB 00000000 b126 DB 00000000 b127 DB 00000000 b129 DB 00110011 b130 DB 00000001 b131 DB 00000000 b132 DB 00000000 b133 DB 00000001 b134 DB 00000001 b135 DB 00000000 b136 DB 00000000 b138 DB 00000001 b139 DB 00000001 b140 DB 00000000 b141 DB 00000000 b142 DB 00000001 b143 DB 00000001 b144 DB 00000000 b145 DB 00000000 b147SPRITE_INDEX_WINDOW_BOTTOM_LEFT: equ 4 * 4148 DB 00000000 b149 DB 00000000 b150 DB 10000000 b151 DB 10000000 b152 DB 00000000 b153 DB 00000000 b154 DB 10000000 b155 DB 10000000 b157 DB 00000000 b158 DB 00000000 b159 DB 10000000 b160 DB 10000000 b161 DB 00000000 b162 DB 00000000 b163 DB 10000000 b164 DB 11001100 b166 DB 00000000 b167 DB 00000000 b168 DB 00000000 b169 DB 00000000 b170 DB 00000000 b171 DB 00000000 b172 DB 00000000 b173 DB 00000000 b175 DB 00000000 b176 DB 00000000 b177 DB 00000000 b178 DB 00000000 b179 DB 00000000 b180 DB 00000000 b181 DB 00000000 b182 DB 11001100 b184SPRITE_INDEX_WINDOW_BOTTOM_RIGHT: equ 5 * 4185 DB 00000000 b186 DB 00000000 b187 DB 00000000 b188 DB 00000000 b189 DB 00000000 b190 DB 00000000 b191 DB 00000000 b192 DB 00000000 b194 DB 00000000 b195 DB 00000000 b196 DB 00000000 b197 DB 00000000 b198 DB 00000000 b199 DB 00000000 b200 DB 00000000 b201 DB 00110011 b203 DB 00000000 b204 DB 00000000 b205 DB 00000001 b206 DB 00000001 b207 DB 00000000 b208 DB 00000000 b209 DB 00000001 b210 DB 00000001 b212 DB 00000000 b213 DB 00000000 b214 DB 00000001 b215 DB 00000001 b216 DB 00000000 b217 DB 00000000 b218 DB 00000001 b219 DB 00110011 b221SPRITE_PATTERNS.size: equ $ - SPRITE_PATTERNSSystem\Main.s3031 Apps/Notepad/Header.s1Notepad:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 - 39.y: db 410.width: db 1311.height: db 812.minWidth: db 1013.minHeight: db 815.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 13 17 db TILE_FONT_REVERSED_LOWERCASE_A + 14 18 db TILE_FONT_REVERSED_LOWERCASE_A + 19 19 db TILE_FONT_REVERSED_LOWERCASE_A + 4 20 db TILE_FONT_REVERSED_LOWERCASE_A + 15 21 db TILE_FONT_REVERSED_LOWERCASE_A + 0 22 db TILE_FONT_REVERSED_LOWERCASE_A + 3 23 db 0 24 db 3325 db 3326 db 3327 db 3328 db 3329 db 3330 db 3331 db 3332.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 13 34 db TILE_FONT_REVERSED_LOWERCASE_A + 14 35 db TILE_FONT_REVERSED_LOWERCASE_A + 19 36 db TILE_FONT_REVERSED_LOWERCASE_A + 4 37.iconTitle:38 db TILE_FONT_LOWERCASE_A + 13 39 db TILE_FONT_LOWERCASE_A + 14 40 db TILE_FONT_LOWERCASE_A + 19 41 db TILE_FONT_LOWERCASE_A + 4 42 db TILE_FONT_LOWERCASE_A + 15 43 db TILE_FONT_LOWERCASE_A + 0 44 db TILE_FONT_LOWERCASE_A + 3 46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Notepad_Open52.workAddr: dw Notepad_Work53.drawAddr: dw Notepad_Draw54.clickAddr: dw Notepad_Click55.closeAddr: dw Notepad_Close57.iconAddr: dw Notepad_Icon59.ramSize: dw 1024 6263Notepad.StartProgramCode:65Notepad_Open:66 Apps/Notepad/Open.s14 10 11 14 call _GET_WINDOW_BASE_NAMTBL16 17 ld bc, 32 * 118 add hl, bc20 ld de, TEST_NOTEPAD_OPEN_EVENT_STRING21 call _DRAW_STRING23 29 ret32TEST_NOTEPAD_OPEN_EVENT_STRING: db 'N OPEN', 033Apps/Notepad/Header.s68Notepad_Work:69 Apps/Notepad/Work.s14 10 11 14 call _GET_WINDOW_BASE_NAMTBL17 20 21 ld bc, 32 * 222 add hl, bc24 ld de, TEST_NOTEPAD_WORK_EVENT_STRING25 call _DRAW_STRING27 31 35 ret38TEST_NOTEPAD_WORK_EVENT_STRING: db 'N WORK', 0Apps/Notepad/Header.s71Notepad_Draw:72 Apps/Notepad/Draw.s14 7 8 9 10 13 call _GET_WINDOW_BASE_NAMTBL15 ld de, TEST_NOTEPAD_DRAW_EVENT_STRING16 call _DRAW_STRING18 ret21TEST_NOTEPAD_DRAW_EVENT_STRING: db 'N DRAW', 0Apps/Notepad/Header.s74Notepad_Click:75 Apps/Notepad/Click.s1 2 3 retApps/Notepad/Header.s77Notepad_Close:78 Apps/Notepad/Close.s1 3 11 retApps/Notepad/Header.s80Notepad.EndProgramCode: 8485Notepad_Icon:86 Apps/Notepad/Icon.s12 db 255, 255, 255, 255, 255, 255, 255, 2553 db 255, 255, 255, 255, 255, 255, 255, 2554 db 255, 255, 255, 255, 255, 255, 255, 2555 db 255, 255, 255, 255, 255, 255, 255, 2556 db 255, 255, 255, 255, 255, 255, 255, 2557 db 255, 255, 255, 255, 255, 255, 255, 2558 db 255, 255, 255, 255, 255, 255, 255, 2559 db 255, 255, 255, 255, 255, 255, 255, 25510 db 255, 255, 255, 255, 255, 255, 255, 0000 1010 bApps/Notepad/Header.s87System\Main.s32 Apps/Calc/Header.s1Calc:34.Header:6.processId: db 255 7.windowState: db WINDOW_STATE.RESTORED8.x: db 8 + 139.y: db 1010.width: db 1011.height: db 812.minWidth: db 1013.minHeight: db 815.windowTitle:16 db TILE_FONT_REVERSED_LOWERCASE_A + 2 17 db TILE_FONT_REVERSED_LOWERCASE_A + 0 18 db TILE_FONT_REVERSED_LOWERCASE_A + 11 19 db TILE_FONT_REVERSED_LOWERCASE_A + 2 20 db 0 21 db 3322 db 3323 db 3324 db 3325 db 3326 db 3327 db 3328 db 3329 db 3330 db 3331 db 3332.taskbarTitle:33 db TILE_FONT_REVERSED_LOWERCASE_A + 2 34 db TILE_FONT_REVERSED_LOWERCASE_A + 0 35 db TILE_FONT_REVERSED_LOWERCASE_A + 11 36 db TILE_FONT_REVERSED_LOWERCASE_A + 2 37.iconTitle:38 db TILE_EMPTY39 db TILE_FONT_LOWERCASE_A + 2 40 db TILE_FONT_LOWERCASE_A + 0 41 db TILE_FONT_LOWERCASE_A + 11 42 db TILE_FONT_LOWERCASE_A + 2 43 db TILE_EMPTY44 db TILE_EMPTY46.isFixedSize: db 047.vertScrollbarEnabled: db 048.vertScrollbarPosition: db 051.openAddr: dw Calc_Open52.workAddr: dw Calc_Work53.drawAddr: dw Calc_Draw54.clickAddr: dw Calc_Click55.closeAddr: dw Calc_Close57.iconAddr: dw Calc_Icon59.ramSize: dw 1024 6263Calc.StartProgramCode:65Calc_Open:66 Apps/Calc/Open.s14 7 ld l, (ix + PROCESS_STRUCT_IX.x) 8 ld h, (ix + PROCESS_STRUCT_IX.y) 9 call _CONVERT_COL_LINE_TO_LINEAR10 11 ld bc, NAMTBL + (32 * 2) + 112 add hl, bc14 16 call BIOS_SETWRT17 ld a, TILE_FONT_UPPERCASE_A + 1 18 out (PORT_0), a20 retApps/Calc/Header.s68Calc_Work:69 Apps/Calc/Work.s14 7 ld l, (ix + PROCESS_STRUCT_IX.x) 8 ld h, (ix + PROCESS_STRUCT_IX.y) 9 call _CONVERT_COL_LINE_TO_LINEAR10 11 ld bc, NAMTBL + (32 * 4) + 112 add hl, bc14 16 call BIOS_SETWRT17 ld a, (OS.timeCounter)18 ld d, a 19 20 and 1111 0000 b21 srl a 22 srl a 23 srl a 24 srl a 25 ld b, TILE_FONT_NUMBERS_0 + 026 add b27 out (PORT_0), a29 ld a, d 30 and 0000 1111 b31 ld b, TILE_FONT_NUMBERS_0 + 032 add b33 out (PORT_0), a36 retApps/Calc/Header.s71Calc_Draw:72 Apps/Calc/Draw.s1 2 3 retApps/Calc/Header.s74Calc_Click:75 Apps/Calc/Click.s1 2 3 retApps/Calc/Header.s77Calc_Close:78 Apps/Calc/Close.s1 4 13 retApps/Calc/Header.s80Calc.EndProgramCode: 8485Calc_Icon:86 Apps/Calc/Icon.s12 db 255, 255, 255, 255, 255, 255, 255, 2553 db 255, 255, 255, 255, 255, 255, 255, 2554 db 255, 255, 255, 255, 255, 255, 255, 2555 db 255, 255, 255, 255, 255, 255, 255, 2556 db 255, 255, 255, 255, 255, 255, 255, 2557 db 255, 255, 255, 255, 255, 255, 255, 2558 db 255, 255, 255, 255, 255, 255, 255, 2559 db 255, 255, 255, 255, 255, 255, 255, 25510 db 255, 255, 255, 255, 255, 255, 255, 1000 0001 bApps/Calc/Header.s87System\Main.s36Execute:37 38 di 39 im 1 40 ld sp, (BIOS_HIMEM) 41 ei43 46 call _INIT48 52 56 60 64 69 70 76 80 84.OS_MainLoop:87 88 call _GET_NUMBER_OF_PROCESSES_OPENED89 ld (Temp), a91 92 call _DRAW_MOUSE_CURSOR93 call _MOUSE_CLICK94 call _MOUSE_OVER96 97 call _READ_KEYBOARD100 101 ld a, (OS.timeCounter)102 or a103 jp nz, .skip104 105 call _DRAW_TASKBAR_CLOCK107 .skip:108 110 111 ld ix, (OS.currentProcessAddr)112 ld a, ixl113 or ixh114 jp z, .noCurrentProcess 116 ld e, (ix + PROCESS_STRUCT_IX.workAddr) 117 ld d, (ix + PROCESS_STRUCT_IX.workAddr + 1) 118 call JP_DE119 .noCurrentProcess:121 jp .OS_MainLoop125 db "End ROM started at 0x4000"127 ds PageSize - ($ - 0x4000), 255 131132 org 0xc000, 0xe5ff134 System/Ram.s13710121519RamStart:2123Seed: rw 125OS:2728.mouseSpriteAttributes:29.mouseY: rb 130.mouseX: rb 131.mousePattern: rb 132.mouseColor: rb 133.mouseY_1: rb 134.mouseX_1: rb 135.mousePattern_1: rb 136.mouseColor_1: rb 137.windowCorner_TopLeft_Y: rb 138.windowCorner_TopLeft_X: rb 139.windowCorner_TopLeft_Pattern: rb 140.windowCorner_TopLeft_Color: rb 141 43.mouseButton_1: rb 144.mouseButton_2: rb 146.oldMouseButton_1: rb 147.oldMouseButton_2: rb 149.isDraggingWindow: rb 150.dragOffset_X: rb 151.dragOffset_Y: rb 153.keyboardMatrix: rb 10 55.ticksSinceLastInput: rw 1 5859.currentTime: 60.currentTime_Hours: rb 161.currentTime_Minutes: rb 162.currentTime_Seconds: rb 164.currentDate: rb 3 66.timeCounter: rb 1 7071.storeOldInterruptHook: rb 672.interruptBusy: rb 175777985.screenMapping: rb 32*2486.currentTileMouseOver: rb 1 88.nextWindow_x: rb 189.nextWindow_y: rb 191.mouseOver_Activated: rb 192.mouseOver_screenMappingValue: rb 193.mouseOver_tileToBeRestored: rb 194.mouseOver_NAMTBL_addr: rw 196.taskbar_Button_0_Process_addr: rw 197.taskbar_Button_1_Process_addr: rw 198.taskbar_Button_2_Process_addr: rw 199.taskbar_Button_3_Process_addr: rw 1101.desktop_Tiles: rb 32 * 22103104.currentProcessAddr: rw 1 105.nextAvailableProcessAddr: rw 1107109.processes: 110 rb Process_struct.size * (MAX_PROCESS_ID + 1) 111 .process_slot_0: equ .processes + (Process_struct.size * 0)112 .process_slot_1: equ .processes + (Process_struct.size * 1)113 .process_slot_2: equ .processes + (Process_struct.size * 2)114 .process_slot_3: equ .processes + (Process_struct.size * 3)115.processes_end:116.processes_size: equ $ - .processes118120Process_struct:121.processId: rb 1 122.windowState: rb 1 123.x: rb 1124.y: rb 1125.width: rb 1126.height: rb 1127.minWidth: rb 1128.minHeight: rb 1130.windowTitle: rb 16131.taskbarTitle: rb 4132.iconTitle: rb 7133.isFixedSize: rb 1 134.vertScrollbarEnabled: rb 1 135.vertScrollbarPosition: rb 1136140145146.openAddr: rw 1147.workAddr: rw 1148.drawAddr: rw 1149.clickAddr: rw 1150.closeAddr: rw 1152.iconAddr: rw 1154.ramSize: rw 1 163.size_Header: equ $ - Process_struct165166.ramStartAddr: rw 1167.vramStartTileAddr: rw 1169.layer: rb 1 172.size: equ $ - Process_struct174177PROCESS_STRUCT_IX:178.processId: equ Process_struct.processId - Process_struct179.windowState: equ Process_struct.windowState - Process_struct180.x: equ Process_struct.x - Process_struct181.y: equ Process_struct.y - Process_struct182.width: equ Process_struct.width - Process_struct183.height: equ Process_struct.height - Process_struct184.minWidth: equ Process_struct.minWidth - Process_struct185.minHeight: equ Process_struct.minHeight - Process_struct187.windowTitle: equ Process_struct.windowTitle - Process_struct188.taskbarTitle: equ Process_struct.taskbarTitle - Process_struct189.iconTitle: equ Process_struct.iconTitle - Process_struct190.isFixedSize: equ Process_struct.isFixedSize - Process_struct191.vertScrollbarEnabled: equ Process_struct.vertScrollbarEnabled - Process_struct192.vertScrollbarPosition: equ Process_struct.vertScrollbarPosition - Process_struct194.openAddr: equ Process_struct.openAddr - Process_struct195.workAddr: equ Process_struct.workAddr - Process_struct196.drawAddr: equ Process_struct.drawAddr - Process_struct197.clickAddr: equ Process_struct.clickAddr - Process_struct198.closeAddr: equ Process_struct.closeAddr - Process_struct200.iconAddr: equ Process_struct.iconAddr - Process_struct202204.layer: equ Process_struct.layer - Process_struct208209Temp: rb 1210TempWord: rw 1212RamEnd:System\Main.s135